if(typeof jQuery!=="undefined"){var osjQuerryUse=jQuery;$osUse=$;};(function(api_session_token, api_modules, osApiId){

/*********************/
/****** 	form/before_render.js	 ***********/
/*********************/
/**
 * Created by vshevtsov on 19.12.2017.
 */

// create a form container #14342 (#os-preload-form-container will be removed)
if(!document.querySelector('.new_os')) {
    document.write('' +
        '<div class="new_os">' +
        '<div id="os-preload-form-container" class="new_f-container">' +
        '<div class="loading-container">' +
        '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100px" height="100px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve"><path opacity="0.2" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946 s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634 c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"></path><path d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0 C22.32,8.481,24.301,9.057,26.013,10.047z" transform="rotate(174.18 20 20)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 20 20" to="360 20 20" dur="1s" repeatCount="indefinite"></animateTransform></path></svg>' +
        '</div>' +
        '</div>' +
        '</div>');
}


/*********************/
/****** 	jquery.min.js	 ***********/
/*********************/
/*! jQuery v1.9.0 | (c) 2005, 2012 jQuery Foundation, Inc. | jquery.org/license */(function(e,t){"use strict";function n(e){var t=e.length,n=st.type(e);return st.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function r(e){var t=Tt[e]={};return st.each(e.match(lt)||[],function(e,n){t[n]=!0}),t}function i(e,n,r,i){if(st.acceptData(e)){var o,a,s=st.expando,u="string"==typeof n,l=e.nodeType,c=l?st.cache:e,f=l?e[s]:e[s]&&s;if(f&&c[f]&&(i||c[f].data)||!u||r!==t)return f||(l?e[s]=f=K.pop()||st.guid++:f=s),c[f]||(c[f]={},l||(c[f].toJSON=st.noop)),("object"==typeof n||"function"==typeof n)&&(i?c[f]=st.extend(c[f],n):c[f].data=st.extend(c[f].data,n)),o=c[f],i||(o.data||(o.data={}),o=o.data),r!==t&&(o[st.camelCase(n)]=r),u?(a=o[n],null==a&&(a=o[st.camelCase(n)])):a=o,a}}function o(e,t,n){if(st.acceptData(e)){var r,i,o,a=e.nodeType,u=a?st.cache:e,l=a?e[st.expando]:st.expando;if(u[l]){if(t&&(r=n?u[l]:u[l].data)){st.isArray(t)?t=t.concat(st.map(t,st.camelCase)):t in r?t=[t]:(t=st.camelCase(t),t=t in r?[t]:t.split(" "));for(i=0,o=t.length;o>i;i++)delete r[t[i]];if(!(n?s:st.isEmptyObject)(r))return}(n||(delete u[l].data,s(u[l])))&&(a?st.cleanData([e],!0):st.support.deleteExpando||u!=u.window?delete u[l]:u[l]=null)}}}function a(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(Nt,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:wt.test(r)?st.parseJSON(r):r}catch(o){}st.data(e,n,r)}else r=t}return r}function s(e){var t;for(t in e)if(("data"!==t||!st.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function u(){return!0}function l(){return!1}function c(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function f(e,t,n){if(t=t||0,st.isFunction(t))return st.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return st.grep(e,function(e){return e===t===n});if("string"==typeof t){var r=st.grep(e,function(e){return 1===e.nodeType});if(Wt.test(t))return st.filter(t,r,!n);t=st.filter(t,r)}return st.grep(e,function(e){return st.inArray(e,t)>=0===n})}function p(e){var t=zt.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}function d(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function h(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function g(e){var t=nn.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function m(e,t){for(var n,r=0;null!=(n=e[r]);r++)st._data(n,"globalEval",!t||st._data(t[r],"globalEval"))}function y(e,t){if(1===t.nodeType&&st.hasData(e)){var n,r,i,o=st._data(e),a=st._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(r=0,i=s[n].length;i>r;r++)st.event.add(t,n,s[n][r])}a.data&&(a.data=st.extend({},a.data))}}function v(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!st.support.noCloneEvent&&t[st.expando]){r=st._data(t);for(i in r.events)st.removeEvent(t,i,r.handle);t.removeAttribute(st.expando)}"script"===n&&t.text!==e.text?(h(t).text=e.text,g(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),st.support.html5Clone&&e.innerHTML&&!st.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Zt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function b(e,n){var r,i,o=0,a=e.getElementsByTagName!==t?e.getElementsByTagName(n||"*"):e.querySelectorAll!==t?e.querySelectorAll(n||"*"):t;if(!a)for(a=[],r=e.childNodes||e;null!=(i=r[o]);o++)!n||st.nodeName(i,n)?a.push(i):st.merge(a,b(i,n));return n===t||n&&st.nodeName(e,n)?st.merge([e],a):a}function x(e){Zt.test(e.type)&&(e.defaultChecked=e.checked)}function T(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Nn.length;i--;)if(t=Nn[i]+n,t in e)return t;return r}function w(e,t){return e=t||e,"none"===st.css(e,"display")||!st.contains(e.ownerDocument,e)}function N(e,t){for(var n,r=[],i=0,o=e.length;o>i;i++)n=e[i],n.style&&(r[i]=st._data(n,"olddisplay"),t?(r[i]||"none"!==n.style.display||(n.style.display=""),""===n.style.display&&w(n)&&(r[i]=st._data(n,"olddisplay",S(n.nodeName)))):r[i]||w(n)||st._data(n,"olddisplay",st.css(n,"display")));for(i=0;o>i;i++)n=e[i],n.style&&(t&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=t?r[i]||"":"none"));return e}function C(e,t,n){var r=mn.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function k(e,t,n,r,i){for(var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;4>o;o+=2)"margin"===n&&(a+=st.css(e,n+wn[o],!0,i)),r?("content"===n&&(a-=st.css(e,"padding"+wn[o],!0,i)),"margin"!==n&&(a-=st.css(e,"border"+wn[o]+"Width",!0,i))):(a+=st.css(e,"padding"+wn[o],!0,i),"padding"!==n&&(a+=st.css(e,"border"+wn[o]+"Width",!0,i)));return a}function E(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=ln(e),a=st.support.boxSizing&&"border-box"===st.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=un(e,t,o),(0>i||null==i)&&(i=e.style[t]),yn.test(i))return i;r=a&&(st.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+k(e,t,n||(a?"border":"content"),r,o)+"px"}function S(e){var t=V,n=bn[e];return n||(n=A(e,t),"none"!==n&&n||(cn=(cn||st("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(cn[0].contentWindow||cn[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=A(e,t),cn.detach()),bn[e]=n),n}function A(e,t){var n=st(t.createElement(e)).appendTo(t.body),r=st.css(n[0],"display");return n.remove(),r}function j(e,t,n,r){var i;if(st.isArray(t))st.each(t,function(t,i){n||kn.test(e)?r(e,i):j(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==st.type(t))r(e,t);else for(i in t)j(e+"["+i+"]",t[i],n,r)}function D(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(lt)||[];if(st.isFunction(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function L(e,n,r,i){function o(u){var l;return a[u]=!0,st.each(e[u]||[],function(e,u){var c=u(n,r,i);return"string"!=typeof c||s||a[c]?s?!(l=c):t:(n.dataTypes.unshift(c),o(c),!1)}),l}var a={},s=e===$n;return o(n.dataTypes[0])||!a["*"]&&o("*")}function H(e,n){var r,i,o=st.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((o[r]?e:i||(i={}))[r]=n[r]);return i&&st.extend(!0,e,i),e}function M(e,n,r){var i,o,a,s,u=e.contents,l=e.dataTypes,c=e.responseFields;for(o in c)o in r&&(n[c[o]]=r[o]);for(;"*"===l[0];)l.shift(),i===t&&(i=e.mimeType||n.getResponseHeader("Content-Type"));if(i)for(o in u)if(u[o]&&u[o].test(i)){l.unshift(o);break}if(l[0]in r)a=l[0];else{for(o in r){if(!l[0]||e.converters[o+" "+l[0]]){a=o;break}s||(s=o)}a=a||s}return a?(a!==l[0]&&l.unshift(a),r[a]):t}function q(e,t){var n,r,i,o,a={},s=0,u=e.dataTypes.slice(),l=u[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u[1])for(n in e.converters)a[n.toLowerCase()]=e.converters[n];for(;i=u[++s];)if("*"!==i){if("*"!==l&&l!==i){if(n=a[l+" "+i]||a["* "+i],!n)for(r in a)if(o=r.split(" "),o[1]===i&&(n=a[l+" "+o[0]]||a["* "+o[0]])){n===!0?n=a[r]:a[r]!==!0&&(i=o[0],u.splice(s--,0,i));break}if(n!==!0)if(n&&e["throws"])t=n(t);else try{t=n(t)}catch(c){return{state:"parsererror",error:n?c:"No conversion from "+l+" to "+i}}}l=i}return{state:"success",data:t}}function _(){try{return new e.XMLHttpRequest}catch(t){}}function F(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function O(){return setTimeout(function(){Qn=t}),Qn=st.now()}function B(e,t){st.each(t,function(t,n){for(var r=(rr[t]||[]).concat(rr["*"]),i=0,o=r.length;o>i;i++)if(r[i].call(e,t,n))return})}function P(e,t,n){var r,i,o=0,a=nr.length,s=st.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;for(var t=Qn||O(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,a=0,u=l.tweens.length;u>a;a++)l.tweens[a].run(o);return s.notifyWith(e,[l,o,n]),1>o&&u?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:st.extend({},t),opts:st.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Qn||O(),duration:n.duration,tweens:[],createTween:function(t,n){var r=st.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)l.tweens[n].run(1);return t?s.resolveWith(e,[l,t]):s.rejectWith(e,[l,t]),this}}),c=l.props;for(R(c,l.opts.specialEasing);a>o;o++)if(r=nr[o].call(l,e,c,l.opts))return r;return B(l,c),st.isFunction(l.opts.start)&&l.opts.start.call(e,l),st.fx.timer(st.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function R(e,t){var n,r,i,o,a;for(n in e)if(r=st.camelCase(n),i=t[r],o=e[n],st.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),a=st.cssHooks[r],a&&"expand"in a){o=a.expand(o),delete e[r];for(n in o)n in e||(e[n]=o[n],t[n]=i)}else t[r]=i}function W(e,t,n){var r,i,o,a,s,u,l,c,f,p=this,d=e.style,h={},g=[],m=e.nodeType&&w(e);n.queue||(c=st._queueHooks(e,"fx"),null==c.unqueued&&(c.unqueued=0,f=c.empty.fire,c.empty.fire=function(){c.unqueued||f()}),c.unqueued++,p.always(function(){p.always(function(){c.unqueued--,st.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===st.css(e,"display")&&"none"===st.css(e,"float")&&(st.support.inlineBlockNeedsLayout&&"inline"!==S(e.nodeName)?d.zoom=1:d.display="inline-block")),n.overflow&&(d.overflow="hidden",st.support.shrinkWrapBlocks||p.done(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(r in t)if(o=t[r],Zn.exec(o)){if(delete t[r],u=u||"toggle"===o,o===(m?"hide":"show"))continue;g.push(r)}if(a=g.length){s=st._data(e,"fxshow")||st._data(e,"fxshow",{}),"hidden"in s&&(m=s.hidden),u&&(s.hidden=!m),m?st(e).show():p.done(function(){st(e).hide()}),p.done(function(){var t;st._removeData(e,"fxshow");for(t in h)st.style(e,t,h[t])});for(r=0;a>r;r++)i=g[r],l=p.createTween(i,m?s[i]:0),h[i]=s[i]||st.style(e,i),i in s||(s[i]=l.start,m&&(l.end=l.start,l.start="width"===i||"height"===i?1:0))}}function $(e,t,n,r,i){return new $.prototype.init(e,t,n,r,i)}function I(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=wn[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function z(e){return st.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var X,U,V=e.document,Y=e.location,J=e.jQuery,G=e.$,Q={},K=[],Z="1.9.0",et=K.concat,tt=K.push,nt=K.slice,rt=K.indexOf,it=Q.toString,ot=Q.hasOwnProperty,at=Z.trim,st=function(e,t){return new st.fn.init(e,t,X)},ut=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,lt=/\S+/g,ct=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ft=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,pt=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,dt=/^[\],:{}\s]*$/,ht=/(?:^|:|,)(?:\s*\[)+/g,gt=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,mt=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,yt=/^-ms-/,vt=/-([\da-z])/gi,bt=function(e,t){return t.toUpperCase()},xt=function(){V.addEventListener?(V.removeEventListener("DOMContentLoaded",xt,!1),st.ready()):"complete"===V.readyState&&(V.detachEvent("onreadystatechange",xt),st.ready())};st.fn=st.prototype={jquery:Z,constructor:st,init:function(e,n,r){var i,o;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:ft.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof st?n[0]:n,st.merge(this,st.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:V,!0)),pt.test(i[1])&&st.isPlainObject(n))for(i in n)st.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(o=V.getElementById(i[2]),o&&o.parentNode){if(o.id!==i[2])return r.find(e);this.length=1,this[0]=o}return this.context=V,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):st.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),st.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return nt.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=st.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return st.each(this,e,t)},ready:function(e){return st.ready.promise().done(e),this},slice:function(){return this.pushStack(nt.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(st.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:tt,sort:[].sort,splice:[].splice},st.fn.init.prototype=st.fn,st.extend=st.fn.extend=function(){var e,n,r,i,o,a,s=arguments[0]||{},u=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},u=2),"object"==typeof s||st.isFunction(s)||(s={}),l===u&&(s=this,--u);l>u;u++)if(null!=(e=arguments[u]))for(n in e)r=s[n],i=e[n],s!==i&&(c&&i&&(st.isPlainObject(i)||(o=st.isArray(i)))?(o?(o=!1,a=r&&st.isArray(r)?r:[]):a=r&&st.isPlainObject(r)?r:{},s[n]=st.extend(c,a,i)):i!==t&&(s[n]=i));return s},st.extend({noConflict:function(t){return e.$===st&&(e.$=G),t&&e.jQuery===st&&(e.jQuery=J),st},isReady:!1,readyWait:1,holdReady:function(e){e?st.readyWait++:st.ready(!0)},ready:function(e){if(e===!0?!--st.readyWait:!st.isReady){if(!V.body)return setTimeout(st.ready);st.isReady=!0,e!==!0&&--st.readyWait>0||(U.resolveWith(V,[st]),st.fn.trigger&&st(V).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===st.type(e)},isArray:Array.isArray||function(e){return"array"===st.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?Q[it.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==st.type(e)||e.nodeType||st.isWindow(e))return!1;try{if(e.constructor&&!ot.call(e,"constructor")&&!ot.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||ot.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||V;var r=pt.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=st.buildFragment([e],t,i),i&&st(i).remove(),st.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=st.trim(n),n&&dt.test(n.replace(gt,"@").replace(mt,"]").replace(ht,"")))?Function("return "+n)():(st.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||st.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&st.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(yt,"ms-").replace(vt,bt)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,r){var i,o=0,a=e.length,s=n(e);if(r){if(s)for(;a>o&&(i=t.apply(e[o],r),i!==!1);o++);else for(o in e)if(i=t.apply(e[o],r),i===!1)break}else if(s)for(;a>o&&(i=t.call(e[o],o,e[o]),i!==!1);o++);else for(o in e)if(i=t.call(e[o],o,e[o]),i===!1)break;return e},trim:at&&!at.call("\ufeff\u00a0")?function(e){return null==e?"":at.call(e)}:function(e){return null==e?"":(e+"").replace(ct,"")},makeArray:function(e,t){var r=t||[];return null!=e&&(n(Object(e))?st.merge(r,"string"==typeof e?[e]:e):tt.call(r,e)),r},inArray:function(e,t,n){var r;if(t){if(rt)return rt.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r)for(;r>o;o++)e[i++]=n[o];else for(;n[o]!==t;)e[i++]=n[o++];return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,a=e.length;for(n=!!n;a>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,r){var i,o=0,a=e.length,s=n(e),u=[];if(s)for(;a>o;o++)i=t(e[o],o,r),null!=i&&(u[u.length]=i);else for(o in e)i=t(e[o],o,r),null!=i&&(u[u.length]=i);return et.apply([],u)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(r=e[n],n=e,e=r),st.isFunction(e)?(i=nt.call(arguments,2),o=function(){return e.apply(n||this,i.concat(nt.call(arguments)))},o.guid=e.guid=e.guid||st.guid++,o):t},access:function(e,n,r,i,o,a,s){var u=0,l=e.length,c=null==r;if("object"===st.type(r)){o=!0;for(u in r)st.access(e,n,u,r[u],!0,a,s)}else if(i!==t&&(o=!0,st.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(st(e),n)})),n))for(;l>u;u++)n(e[u],r,s?i:i.call(e[u],u,n(e[u],r)));return o?e:c?n.call(e):l?n(e[0],r):a},now:function(){return(new Date).getTime()}}),st.ready.promise=function(t){if(!U)if(U=st.Deferred(),"complete"===V.readyState)setTimeout(st.ready);else if(V.addEventListener)V.addEventListener("DOMContentLoaded",xt,!1),e.addEventListener("load",st.ready,!1);else{V.attachEvent("onreadystatechange",xt),e.attachEvent("onload",st.ready);var n=!1;try{n=null==e.frameElement&&V.documentElement}catch(r){}n&&n.doScroll&&function i(){if(!st.isReady){try{n.doScroll("left")}catch(e){return setTimeout(i,50)}st.ready()}}()}return U.promise(t)},st.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){Q["[object "+t+"]"]=t.toLowerCase()}),X=st(V);var Tt={};st.Callbacks=function(e){e="string"==typeof e?Tt[e]||r(e):st.extend({},e);var n,i,o,a,s,u,l=[],c=!e.once&&[],f=function(t){for(n=e.memory&&t,i=!0,u=a||0,a=0,s=l.length,o=!0;l&&s>u;u++)if(l[u].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}o=!1,l&&(c?c.length&&f(c.shift()):n?l=[]:p.disable())},p={add:function(){if(l){var t=l.length;(function r(t){st.each(t,function(t,n){var i=st.type(n);"function"===i?e.unique&&p.has(n)||l.push(n):n&&n.length&&"string"!==i&&r(n)})})(arguments),o?s=l.length:n&&(a=t,f(n))}return this},remove:function(){return l&&st.each(arguments,function(e,t){for(var n;(n=st.inArray(t,l,n))>-1;)l.splice(n,1),o&&(s>=n&&s--,u>=n&&u--)}),this},has:function(e){return st.inArray(e,l)>-1},empty:function(){return l=[],this},disable:function(){return l=c=n=t,this},disabled:function(){return!l},lock:function(){return c=t,n||p.disable(),this},locked:function(){return!c},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!l||i&&!c||(o?c.push(t):f(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!i}};return p},st.extend({Deferred:function(e){var t=[["resolve","done",st.Callbacks("once memory"),"resolved"],["reject","fail",st.Callbacks("once memory"),"rejected"],["notify","progress",st.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return st.Deferred(function(n){st.each(t,function(t,o){var a=o[0],s=st.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&st.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?st.extend(e,r):r}},i={};return r.pipe=r.then,st.each(t,function(e,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t,n,r,i=0,o=nt.call(arguments),a=o.length,s=1!==a||e&&st.isFunction(e.promise)?a:0,u=1===s?e:st.Deferred(),l=function(e,n,r){return function(i){n[e]=this,r[e]=arguments.length>1?nt.call(arguments):i,r===t?u.notifyWith(n,r):--s||u.resolveWith(n,r)}};if(a>1)for(t=Array(a),n=Array(a),r=Array(a);a>i;i++)o[i]&&st.isFunction(o[i].promise)?o[i].promise().done(l(i,r,o)).fail(u.reject).progress(l(i,n,t)):--s;return s||u.resolveWith(r,o),u.promise()}}),st.support=function(){var n,r,i,o,a,s,u,l,c,f,p=V.createElement("div");if(p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",r=p.getElementsByTagName("*"),i=p.getElementsByTagName("a")[0],!r||!i||!r.length)return{};o=V.createElement("select"),a=o.appendChild(V.createElement("option")),s=p.getElementsByTagName("input")[0],i.style.cssText="top:1px;float:left;opacity:.5",n={getSetAttribute:"t"!==p.className,leadingWhitespace:3===p.firstChild.nodeType,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(i.getAttribute("style")),hrefNormalized:"/a"===i.getAttribute("href"),opacity:/^0.5/.test(i.style.opacity),cssFloat:!!i.style.cssFloat,checkOn:!!s.value,optSelected:a.selected,enctype:!!V.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==V.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===V.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},s.checked=!0,n.noCloneChecked=s.cloneNode(!0).checked,o.disabled=!0,n.optDisabled=!a.disabled;try{delete p.test}catch(d){n.deleteExpando=!1}s=V.createElement("input"),s.setAttribute("value",""),n.input=""===s.getAttribute("value"),s.value="t",s.setAttribute("type","radio"),n.radioValue="t"===s.value,s.setAttribute("checked","t"),s.setAttribute("name","t"),u=V.createDocumentFragment(),u.appendChild(s),n.appendChecked=s.checked,n.checkClone=u.cloneNode(!0).cloneNode(!0).lastChild.checked,p.attachEvent&&(p.attachEvent("onclick",function(){n.noCloneEvent=!1}),p.cloneNode(!0).click());for(f in{submit:!0,change:!0,focusin:!0})p.setAttribute(l="on"+f,"t"),n[f+"Bubbles"]=l in e||p.attributes[l].expando===!1;return p.style.backgroundClip="content-box",p.cloneNode(!0).style.backgroundClip="",n.clearCloneStyle="content-box"===p.style.backgroundClip,st(function(){var r,i,o,a="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",s=V.getElementsByTagName("body")[0];s&&(r=V.createElement("div"),r.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",s.appendChild(r).appendChild(p),p.innerHTML="<table><tr><td></td><td>t</td></tr></table>",o=p.getElementsByTagName("td"),o[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===o[0].offsetHeight,o[0].style.display="",o[1].style.display="none",n.reliableHiddenOffsets=c&&0===o[0].offsetHeight,p.innerHTML="",p.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",n.boxSizing=4===p.offsetWidth,n.doesNotIncludeMarginInBodyOffset=1!==s.offsetTop,e.getComputedStyle&&(n.pixelPosition="1%"!==(e.getComputedStyle(p,null)||{}).top,n.boxSizingReliable="4px"===(e.getComputedStyle(p,null)||{width:"4px"}).width,i=p.appendChild(V.createElement("div")),i.style.cssText=p.style.cssText=a,i.style.marginRight=i.style.width="0",p.style.width="1px",n.reliableMarginRight=!parseFloat((e.getComputedStyle(i,null)||{}).marginRight)),p.style.zoom!==t&&(p.innerHTML="",p.style.cssText=a+"width:1px;padding:1px;display:inline;zoom:1",n.inlineBlockNeedsLayout=3===p.offsetWidth,p.style.display="block",p.innerHTML="<div></div>",p.firstChild.style.width="5px",n.shrinkWrapBlocks=3!==p.offsetWidth,s.style.zoom=1),s.removeChild(r),r=p=o=i=null)}),r=o=u=a=i=s=null,n}();var wt=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,Nt=/([A-Z])/g;st.extend({cache:{},expando:"jQuery"+(Z+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?st.cache[e[st.expando]]:e[st.expando],!!e&&!s(e)},data:function(e,t,n){return i(e,t,n,!1)},removeData:function(e,t){return o(e,t,!1)},_data:function(e,t,n){return i(e,t,n,!0)},_removeData:function(e,t){return o(e,t,!0)},acceptData:function(e){var t=e.nodeName&&st.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),st.fn.extend({data:function(e,n){var r,i,o=this[0],s=0,u=null;if(e===t){if(this.length&&(u=st.data(o),1===o.nodeType&&!st._data(o,"parsedAttrs"))){for(r=o.attributes;r.length>s;s++)i=r[s].name,i.indexOf("data-")||(i=st.camelCase(i.substring(5)),a(o,i,u[i]));st._data(o,"parsedAttrs",!0)}return u}return"object"==typeof e?this.each(function(){st.data(this,e)}):st.access(this,function(n){return n===t?o?a(o,e,st.data(o,e)):null:(this.each(function(){st.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){st.removeData(this,e)})}}),st.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=st._data(e,n),r&&(!i||st.isArray(r)?i=st._data(e,n,st.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=st.queue(e,t),r=n.length,i=n.shift(),o=st._queueHooks(e,t),a=function(){st.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),o.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return st._data(e,n)||st._data(e,n,{empty:st.Callbacks("once memory").add(function(){st._removeData(e,t+"queue"),st._removeData(e,n)})})}}),st.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?st.queue(this[0],e):n===t?this:this.each(function(){var t=st.queue(this,e,n);st._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&st.dequeue(this,e)})},dequeue:function(e){return this.each(function(){st.dequeue(this,e)})},delay:function(e,t){return e=st.fx?st.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=st.Deferred(),a=this,s=this.length,u=function(){--i||o.resolveWith(a,[a])};for("string"!=typeof e&&(n=e,e=t),e=e||"fx";s--;)r=st._data(a[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(u));return u(),o.promise(n)}});var Ct,kt,Et=/[\t\r\n]/g,St=/\r/g,At=/^(?:input|select|textarea|button|object)$/i,jt=/^(?:a|area)$/i,Dt=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,Lt=/^(?:checked|selected)$/i,Ht=st.support.getSetAttribute,Mt=st.support.input;st.fn.extend({attr:function(e,t){return st.access(this,st.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){st.removeAttr(this,e)})},prop:function(e,t){return st.access(this,st.prop,e,t,arguments.length>1)},removeProp:function(e){return e=st.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,a=0,s=this.length,u="string"==typeof e&&e;if(st.isFunction(e))return this.each(function(t){st(this).addClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(lt)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Et," "):" ")){for(o=0;i=t[o++];)0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=st.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,a=0,s=this.length,u=0===arguments.length||"string"==typeof e&&e;if(st.isFunction(e))return this.each(function(t){st(this).removeClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(lt)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Et," "):"")){for(o=0;i=t[o++];)for(;r.indexOf(" "+i+" ")>=0;)r=r.replace(" "+i+" "," ");n.className=e?st.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return st.isFunction(e)?this.each(function(n){st(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n)for(var i,o=0,a=st(this),s=t,u=e.match(lt)||[];i=u[o++];)s=r?s:!a.hasClass(i),a[s?"addClass":"removeClass"](i);else("undefined"===n||"boolean"===n)&&(this.className&&st._data(this,"__className__",this.className),this.className=this.className||e===!1?"":st._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(Et," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,o=this[0];{if(arguments.length)return i=st.isFunction(e),this.each(function(r){var o,a=st(this);1===this.nodeType&&(o=i?e.call(this,r,a.val()):e,null==o?o="":"number"==typeof o?o+="":st.isArray(o)&&(o=st.map(o,function(e){return null==e?"":e+""})),n=st.valHooks[this.type]||st.valHooks[this.nodeName.toLowerCase()],n&&"set"in n&&n.set(this,o,"value")!==t||(this.value=o))});if(o)return n=st.valHooks[o.type]||st.valHooks[o.nodeName.toLowerCase()],n&&"get"in n&&(r=n.get(o,"value"))!==t?r:(r=o.value,"string"==typeof r?r.replace(St,""):null==r?"":r)}}}),st.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,a=o?null:[],s=o?i+1:r.length,u=0>i?s:o?i:0;s>u;u++)if(n=r[u],!(!n.selected&&u!==i||(st.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&st.nodeName(n.parentNode,"optgroup"))){if(t=st(n).val(),o)return t;a.push(t)}return a},set:function(e,t){var n=st.makeArray(t);return st(e).find("option").each(function(){this.selected=st.inArray(st(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var i,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return e.getAttribute===t?st.prop(e,n,r):(a=1!==s||!st.isXMLDoc(e),a&&(n=n.toLowerCase(),o=st.attrHooks[n]||(Dt.test(n)?kt:Ct)),r===t?o&&a&&"get"in o&&null!==(i=o.get(e,n))?i:(e.getAttribute!==t&&(i=e.getAttribute(n)),null==i?t:i):null!==r?o&&a&&"set"in o&&(i=o.set(e,r,n))!==t?i:(e.setAttribute(n,r+""),r):(st.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(lt);if(o&&1===e.nodeType)for(;n=o[i++];)r=st.propFix[n]||n,Dt.test(n)?!Ht&&Lt.test(n)?e[st.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:st.attr(e,n,""),e.removeAttribute(Ht?n:r)},attrHooks:{type:{set:function(e,t){if(!st.support.radioValue&&"radio"===t&&st.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return a=1!==s||!st.isXMLDoc(e),a&&(n=st.propFix[n]||n,o=st.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&null!==(i=o.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):At.test(e.nodeName)||jt.test(e.nodeName)&&e.href?0:t}}}}),kt={get:function(e,n){var r=st.prop(e,n),i="boolean"==typeof r&&e.getAttribute(n),o="boolean"==typeof r?Mt&&Ht?null!=i:Lt.test(n)?e[st.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return o&&o.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?st.removeAttr(e,n):Mt&&Ht||!Lt.test(n)?e.setAttribute(!Ht&&st.propFix[n]||n,n):e[st.camelCase("default-"+n)]=e[n]=!0,n}},Mt&&Ht||(st.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return st.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t
},set:function(e,n,r){return st.nodeName(e,"input")?(e.defaultValue=n,t):Ct&&Ct.set(e,n,r)}}),Ht||(Ct=st.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&("id"===n||"name"===n||"coords"===n?""!==r.value:r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},st.attrHooks.contenteditable={get:Ct.get,set:function(e,t,n){Ct.set(e,""===t?!1:t,n)}},st.each(["width","height"],function(e,n){st.attrHooks[n]=st.extend(st.attrHooks[n],{set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}})})),st.support.hrefNormalized||(st.each(["href","src","width","height"],function(e,n){st.attrHooks[n]=st.extend(st.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return null==r?t:r}})}),st.each(["href","src"],function(e,t){st.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),st.support.style||(st.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),st.support.optSelected||(st.propHooks.selected=st.extend(st.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),st.support.enctype||(st.propFix.enctype="encoding"),st.support.checkOn||st.each(["radio","checkbox"],function(){st.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),st.each(["radio","checkbox"],function(){st.valHooks[this]=st.extend(st.valHooks[this],{set:function(e,n){return st.isArray(n)?e.checked=st.inArray(st(e).val(),n)>=0:t}})});var qt=/^(?:input|select|textarea)$/i,_t=/^key/,Ft=/^(?:mouse|contextmenu)|click/,Ot=/^(?:focusinfocus|focusoutblur)$/,Bt=/^([^.]*)(?:\.(.+)|)$/;st.event={global:{},add:function(e,n,r,i,o){var a,s,u,l,c,f,p,d,h,g,m,y=3!==e.nodeType&&8!==e.nodeType&&st._data(e);if(y){for(r.handler&&(a=r,r=a.handler,o=a.selector),r.guid||(r.guid=st.guid++),(l=y.events)||(l=y.events={}),(s=y.handle)||(s=y.handle=function(e){return st===t||e&&st.event.triggered===e.type?t:st.event.dispatch.apply(s.elem,arguments)},s.elem=e),n=(n||"").match(lt)||[""],c=n.length;c--;)u=Bt.exec(n[c])||[],h=m=u[1],g=(u[2]||"").split(".").sort(),p=st.event.special[h]||{},h=(o?p.delegateType:p.bindType)||h,p=st.event.special[h]||{},f=st.extend({type:h,origType:m,data:i,handler:r,guid:r.guid,selector:o,needsContext:o&&st.expr.match.needsContext.test(o),namespace:g.join(".")},a),(d=l[h])||(d=l[h]=[],d.delegateCount=0,p.setup&&p.setup.call(e,i,g,s)!==!1||(e.addEventListener?e.addEventListener(h,s,!1):e.attachEvent&&e.attachEvent("on"+h,s))),p.add&&(p.add.call(e,f),f.handler.guid||(f.handler.guid=r.guid)),o?d.splice(d.delegateCount++,0,f):d.push(f),st.event.global[h]=!0;e=null}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,m=st.hasData(e)&&st._data(e);if(m&&(u=m.events)){for(t=(t||"").match(lt)||[""],l=t.length;l--;)if(s=Bt.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){for(f=st.event.special[d]||{},d=(r?f.delegateType:f.bindType)||d,p=u[d]||[],s=s[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;o--;)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&f.teardown.call(e,h,m.handle)!==!1||st.removeEvent(e,d,m.handle),delete u[d])}else for(d in u)st.event.remove(e,d+t[l],n,r,!0);st.isEmptyObject(u)&&(delete m.handle,st._removeData(e,"events"))}},trigger:function(n,r,i,o){var a,s,u,l,c,f,p,d=[i||V],h=n.type||n,g=n.namespace?n.namespace.split("."):[];if(s=u=i=i||V,3!==i.nodeType&&8!==i.nodeType&&!Ot.test(h+st.event.triggered)&&(h.indexOf(".")>=0&&(g=h.split("."),h=g.shift(),g.sort()),c=0>h.indexOf(":")&&"on"+h,n=n[st.expando]?n:new st.Event(h,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=g.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:st.makeArray(r,[n]),p=st.event.special[h]||{},o||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!o&&!p.noBubble&&!st.isWindow(i)){for(l=p.delegateType||h,Ot.test(l+h)||(s=s.parentNode);s;s=s.parentNode)d.push(s),u=s;u===(i.ownerDocument||V)&&d.push(u.defaultView||u.parentWindow||e)}for(a=0;(s=d[a++])&&!n.isPropagationStopped();)n.type=a>1?l:p.bindType||h,f=(st._data(s,"events")||{})[n.type]&&st._data(s,"handle"),f&&f.apply(s,r),f=c&&s[c],f&&st.acceptData(s)&&f.apply&&f.apply(s,r)===!1&&n.preventDefault();if(n.type=h,!(o||n.isDefaultPrevented()||p._default&&p._default.apply(i.ownerDocument,r)!==!1||"click"===h&&st.nodeName(i,"a")||!st.acceptData(i)||!c||!i[h]||st.isWindow(i))){u=i[c],u&&(i[c]=null),st.event.triggered=h;try{i[h]()}catch(m){}st.event.triggered=t,u&&(i[c]=u)}return n.result}},dispatch:function(e){e=st.event.fix(e);var n,r,i,o,a,s=[],u=nt.call(arguments),l=(st._data(this,"events")||{})[e.type]||[],c=st.event.special[e.type]||{};if(u[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(s=st.event.handlers.call(this,e,l),n=0;(o=s[n++])&&!e.isPropagationStopped();)for(e.currentTarget=o.elem,r=0;(a=o.handlers[r++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(a.namespace))&&(e.handleObj=a,e.data=a.data,i=((st.event.special[a.origType]||{}).handle||a.handler).apply(o.elem,u),i!==t&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,a,s=[],u=n.delegateCount,l=e.target;if(u&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!=this;l=l.parentNode||this)if(l.disabled!==!0||"click"!==e.type){for(i=[],r=0;u>r;r++)a=n[r],o=a.selector+" ",i[o]===t&&(i[o]=a.needsContext?st(o,this).index(l)>=0:st.find(o,this,null,[l]).length),i[o]&&i.push(a);i.length&&s.push({elem:l,handlers:i})}return n.length>u&&s.push({elem:this,handlers:n.slice(u)}),s},fix:function(e){if(e[st.expando])return e;var t,n,r=e,i=st.event.fixHooks[e.type]||{},o=i.props?this.props.concat(i.props):this.props;for(e=new st.Event(r),t=o.length;t--;)n=o[t],e[n]=r[n];return e.target||(e.target=r.srcElement||V),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,i.filter?i.filter(e,r):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,o,a=n.button,s=n.fromElement;return null==e.pageX&&null!=n.clientX&&(r=e.target.ownerDocument||V,i=r.documentElement,o=r.body,e.pageX=n.clientX+(i&&i.scrollLeft||o&&o.scrollLeft||0)-(i&&i.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(i&&i.scrollTop||o&&o.scrollTop||0)-(i&&i.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?n.toElement:s),e.which||a===t||(e.which=1&a?1:2&a?3:4&a?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return st.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==V.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===V.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=st.extend(new st.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?st.event.trigger(i,null,t):st.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},st.removeEvent=V.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,n,r){var i="on"+n;e.detachEvent&&(e[i]===t&&(e[i]=null),e.detachEvent(i,r))},st.Event=function(e,n){return this instanceof st.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?u:l):this.type=e,n&&st.extend(this,n),this.timeStamp=e&&e.timeStamp||st.now(),this[st.expando]=!0,t):new st.Event(e,n)},st.Event.prototype={isDefaultPrevented:l,isPropagationStopped:l,isImmediatePropagationStopped:l,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=u,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=u,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=u,this.stopPropagation()}},st.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){st.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return(!i||i!==r&&!st.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),st.support.submitBubbles||(st.event.special.submit={setup:function(){return st.nodeName(this,"form")?!1:(st.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=st.nodeName(n,"input")||st.nodeName(n,"button")?n.form:t;r&&!st._data(r,"submitBubbles")&&(st.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),st._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&st.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return st.nodeName(this,"form")?!1:(st.event.remove(this,"._submit"),t)}}),st.support.changeBubbles||(st.event.special.change={setup:function(){return qt.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(st.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),st.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),st.event.simulate("change",this,e,!0)})),!1):(st.event.add(this,"beforeactivate._change",function(e){var t=e.target;qt.test(t.nodeName)&&!st._data(t,"changeBubbles")&&(st.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||st.event.simulate("change",this.parentNode,e,!0)}),st._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return st.event.remove(this,"._change"),!qt.test(this.nodeName)}}),st.support.focusinBubbles||st.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){st.event.simulate(t,e.target,st.event.fix(e),!0)};st.event.special[t]={setup:function(){0===n++&&V.addEventListener(e,r,!0)},teardown:function(){0===--n&&V.removeEventListener(e,r,!0)}}}),st.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(s in e)this.on(s,n,r,e[s],o);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=l;else if(!i)return this;return 1===o&&(a=i,i=function(e){return st().off(e),a.apply(this,arguments)},i.guid=a.guid||(a.guid=st.guid++)),this.each(function(){st.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,st(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,n,e[o]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=l),this.each(function(){st.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){st.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?st.event.trigger(e,n,r,!0):t},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),st.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){st.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)},_t.test(t)&&(st.event.fixHooks[t]=st.event.keyHooks),Ft.test(t)&&(st.event.fixHooks[t]=st.event.mouseHooks)}),function(e,t){function n(e){return ht.test(e+"")}function r(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>C.cacheLength&&delete e[t.shift()],e[n]=r}}function i(e){return e[P]=!0,e}function o(e){var t=L.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function a(e,t,n,r){var i,o,a,s,u,l,c,d,h,g;if((t?t.ownerDocument||t:R)!==L&&D(t),t=t||L,n=n||[],!e||"string"!=typeof e)return n;if(1!==(s=t.nodeType)&&9!==s)return[];if(!M&&!r){if(i=gt.exec(e))if(a=i[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return n;if(o.id===a)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&O(t,o)&&o.id===a)return n.push(o),n}else{if(i[2])return Q.apply(n,K.call(t.getElementsByTagName(e),0)),n;if((a=i[3])&&W.getByClassName&&t.getElementsByClassName)return Q.apply(n,K.call(t.getElementsByClassName(a),0)),n}if(W.qsa&&!q.test(e)){if(c=!0,d=P,h=t,g=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(l=f(e),(c=t.getAttribute("id"))?d=c.replace(vt,"\\$&"):t.setAttribute("id",d),d="[id='"+d+"'] ",u=l.length;u--;)l[u]=d+p(l[u]);h=dt.test(e)&&t.parentNode||t,g=l.join(",")}if(g)try{return Q.apply(n,K.call(h.querySelectorAll(g),0)),n}catch(m){}finally{c||t.removeAttribute("id")}}}return x(e.replace(at,"$1"),t,n,r)}function s(e,t){for(var n=e&&t&&e.nextSibling;n;n=n.nextSibling)if(n===t)return-1;return e?1:-1}function u(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function l(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function c(e){return i(function(t){return t=+t,i(function(n,r){for(var i,o=e([],n.length,t),a=o.length;a--;)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}function f(e,t){var n,r,i,o,s,u,l,c=X[e+" "];if(c)return t?0:c.slice(0);for(s=e,u=[],l=C.preFilter;s;){(!n||(r=ut.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),u.push(i=[])),n=!1,(r=lt.exec(s))&&(n=r.shift(),i.push({value:n,type:r[0].replace(at," ")}),s=s.slice(n.length));for(o in C.filter)!(r=pt[o].exec(s))||l[o]&&!(r=l[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),s=s.slice(n.length));if(!n)break}return t?s.length:s?a.error(e):X(e,u).slice(0)}function p(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function d(e,t,n){var r=t.dir,i=n&&"parentNode"===t.dir,o=I++;return t.first?function(t,n,o){for(;t=t[r];)if(1===t.nodeType||i)return e(t,n,o)}:function(t,n,a){var s,u,l,c=$+" "+o;if(a){for(;t=t[r];)if((1===t.nodeType||i)&&e(t,n,a))return!0}else for(;t=t[r];)if(1===t.nodeType||i)if(l=t[P]||(t[P]={}),(u=l[r])&&u[0]===c){if((s=u[1])===!0||s===N)return s===!0}else if(u=l[r]=[c],u[1]=e(t,n,a)||N,u[1]===!0)return!0}}function h(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function g(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;u>s;s++)(o=e[s])&&(!n||n(o,r,i))&&(a.push(o),l&&t.push(s));return a}function m(e,t,n,r,o,a){return r&&!r[P]&&(r=m(r)),o&&!o[P]&&(o=m(o,a)),i(function(i,a,s,u){var l,c,f,p=[],d=[],h=a.length,m=i||b(t||"*",s.nodeType?[s]:s,[]),y=!e||!i&&t?m:g(m,p,e,s,u),v=n?o||(i?e:h||r)?[]:a:y;if(n&&n(y,v,s,u),r)for(l=g(v,d),r(l,[],s,u),c=l.length;c--;)(f=l[c])&&(v[d[c]]=!(y[d[c]]=f));if(i){if(o||e){if(o){for(l=[],c=v.length;c--;)(f=v[c])&&l.push(y[c]=f);o(null,v=[],l,u)}for(c=v.length;c--;)(f=v[c])&&(l=o?Z.call(i,f):p[c])>-1&&(i[l]=!(a[l]=f))}}else v=g(v===a?v.splice(h,v.length):v),o?o(null,a,v,u):Q.apply(a,v)})}function y(e){for(var t,n,r,i=e.length,o=C.relative[e[0].type],a=o||C.relative[" "],s=o?1:0,u=d(function(e){return e===t},a,!0),l=d(function(e){return Z.call(t,e)>-1},a,!0),c=[function(e,n,r){return!o&&(r||n!==j)||((t=n).nodeType?u(e,n,r):l(e,n,r))}];i>s;s++)if(n=C.relative[e[s].type])c=[d(h(c),n)];else{if(n=C.filter[e[s].type].apply(null,e[s].matches),n[P]){for(r=++s;i>r&&!C.relative[e[r].type];r++);return m(s>1&&h(c),s>1&&p(e.slice(0,s-1)).replace(at,"$1"),n,r>s&&y(e.slice(s,r)),i>r&&y(e=e.slice(r)),i>r&&p(e))}c.push(n)}return h(c)}function v(e,t){var n=0,r=t.length>0,o=e.length>0,s=function(i,s,u,l,c){var f,p,d,h=[],m=0,y="0",v=i&&[],b=null!=c,x=j,T=i||o&&C.find.TAG("*",c&&s.parentNode||s),w=$+=null==x?1:Math.E;for(b&&(j=s!==L&&s,N=n);null!=(f=T[y]);y++){if(o&&f){for(p=0;d=e[p];p++)if(d(f,s,u)){l.push(f);break}b&&($=w,N=++n)}r&&((f=!d&&f)&&m--,i&&v.push(f))}if(m+=y,r&&y!==m){for(p=0;d=t[p];p++)d(v,h,s,u);if(i){if(m>0)for(;y--;)v[y]||h[y]||(h[y]=G.call(l));h=g(h)}Q.apply(l,h),b&&!i&&h.length>0&&m+t.length>1&&a.uniqueSort(l)}return b&&($=w,j=x),v};return r?i(s):s}function b(e,t,n){for(var r=0,i=t.length;i>r;r++)a(e,t[r],n);return n}function x(e,t,n,r){var i,o,a,s,u,l=f(e);if(!r&&1===l.length){if(o=l[0]=l[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&9===t.nodeType&&!M&&C.relative[o[1].type]){if(t=C.find.ID(a.matches[0].replace(xt,Tt),t)[0],!t)return n;e=e.slice(o.shift().value.length)}for(i=pt.needsContext.test(e)?-1:o.length-1;i>=0&&(a=o[i],!C.relative[s=a.type]);i--)if((u=C.find[s])&&(r=u(a.matches[0].replace(xt,Tt),dt.test(o[0].type)&&t.parentNode||t))){if(o.splice(i,1),e=r.length&&p(o),!e)return Q.apply(n,K.call(r,0)),n;break}}return S(e,l)(r,t,M,n,dt.test(e)),n}function T(){}var w,N,C,k,E,S,A,j,D,L,H,M,q,_,F,O,B,P="sizzle"+-new Date,R=e.document,W={},$=0,I=0,z=r(),X=r(),U=r(),V=typeof t,Y=1<<31,J=[],G=J.pop,Q=J.push,K=J.slice,Z=J.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},et="[\\x20\\t\\r\\n\\f]",tt="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",nt=tt.replace("w","w#"),rt="([*^$|!~]?=)",it="\\["+et+"*("+tt+")"+et+"*(?:"+rt+et+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+nt+")|)|)"+et+"*\\]",ot=":("+tt+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+it.replace(3,8)+")*)|.*)\\)|)",at=RegExp("^"+et+"+|((?:^|[^\\\\])(?:\\\\.)*)"+et+"+$","g"),ut=RegExp("^"+et+"*,"+et+"*"),lt=RegExp("^"+et+"*([\\x20\\t\\r\\n\\f>+~])"+et+"*"),ct=RegExp(ot),ft=RegExp("^"+nt+"$"),pt={ID:RegExp("^#("+tt+")"),CLASS:RegExp("^\\.("+tt+")"),NAME:RegExp("^\\[name=['\"]?("+tt+")['\"]?\\]"),TAG:RegExp("^("+tt.replace("w","w*")+")"),ATTR:RegExp("^"+it),PSEUDO:RegExp("^"+ot),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+et+"*(even|odd|(([+-]|)(\\d*)n|)"+et+"*(?:([+-]|)"+et+"*(\\d+)|))"+et+"*\\)|)","i"),needsContext:RegExp("^"+et+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+et+"*((?:-\\d)?\\d*)"+et+"*\\)|)(?=[^-]|$)","i")},dt=/[\x20\t\r\n\f]*[+~]/,ht=/\{\s*\[native code\]\s*\}/,gt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,mt=/^(?:input|select|textarea|button)$/i,yt=/^h\d$/i,vt=/'|\\/g,bt=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,xt=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,Tt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{K.call(H.childNodes,0)[0].nodeType}catch(wt){K=function(e){for(var t,n=[];t=this[e];e++)n.push(t);return n}}E=a.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},D=a.setDocument=function(e){var r=e?e.ownerDocument||e:R;return r!==L&&9===r.nodeType&&r.documentElement?(L=r,H=r.documentElement,M=E(r),W.tagNameNoComments=o(function(e){return e.appendChild(r.createComment("")),!e.getElementsByTagName("*").length}),W.attributes=o(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),W.getByClassName=o(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),W.getByName=o(function(e){e.id=P+0,e.innerHTML="<a name='"+P+"'></a><div name='"+P+"'></div>",H.insertBefore(e,H.firstChild);var t=r.getElementsByName&&r.getElementsByName(P).length===2+r.getElementsByName(P+0).length;return W.getIdNotName=!r.getElementById(P),H.removeChild(e),t}),C.attrHandle=o(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==V&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},W.getIdNotName?(C.find.ID=function(e,t){if(typeof t.getElementById!==V&&!M){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},C.filter.ID=function(e){var t=e.replace(xt,Tt);return function(e){return e.getAttribute("id")===t}}):(C.find.ID=function(e,n){if(typeof n.getElementById!==V&&!M){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==V&&r.getAttributeNode("id").value===e?[r]:t:[]}},C.filter.ID=function(e){var t=e.replace(xt,Tt);return function(e){var n=typeof e.getAttributeNode!==V&&e.getAttributeNode("id");return n&&n.value===t}}),C.find.TAG=W.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==V?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i];i++)1===n.nodeType&&r.push(n);return r}return o},C.find.NAME=W.getByName&&function(e,n){return typeof n.getElementsByName!==V?n.getElementsByName(name):t},C.find.CLASS=W.getByClassName&&function(e,n){return typeof n.getElementsByClassName===V||M?t:n.getElementsByClassName(e)},_=[],q=[":focus"],(W.qsa=n(r.querySelectorAll))&&(o(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||q.push("\\["+et+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||q.push(":checked")}),o(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&q.push("[*^$]="+et+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),q.push(",.*:")})),(W.matchesSelector=n(F=H.matchesSelector||H.mozMatchesSelector||H.webkitMatchesSelector||H.oMatchesSelector||H.msMatchesSelector))&&o(function(e){W.disconnectedMatch=F.call(e,"div"),F.call(e,"[s!='']:x"),_.push("!=",ot)}),q=RegExp(q.join("|")),_=RegExp(_.join("|")),O=n(H.contains)||H.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},B=H.compareDocumentPosition?function(e,t){var n;return e===t?(A=!0,0):(n=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&n||e.parentNode&&11===e.parentNode.nodeType?e===r||O(R,e)?-1:t===r||O(R,t)?1:0:4&n?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var n,i=0,o=e.parentNode,a=t.parentNode,u=[e],l=[t];if(e===t)return A=!0,0;if(e.sourceIndex&&t.sourceIndex)return(~t.sourceIndex||Y)-(O(R,e)&&~e.sourceIndex||Y);if(!o||!a)return e===r?-1:t===r?1:o?-1:a?1:0;if(o===a)return s(e,t);for(n=e;n=n.parentNode;)u.unshift(n);for(n=t;n=n.parentNode;)l.unshift(n);for(;u[i]===l[i];)i++;return i?s(u[i],l[i]):u[i]===R?-1:l[i]===R?1:0},A=!1,[0,0].sort(B),W.detectDuplicates=A,L):L},a.matches=function(e,t){return a(e,null,null,t)},a.matchesSelector=function(e,t){if((e.ownerDocument||e)!==L&&D(e),t=t.replace(bt,"='$1']"),!(!W.matchesSelector||M||_&&_.test(t)||q.test(t)))try{var n=F.call(e,t);if(n||W.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return a(t,L,null,[e]).length>0},a.contains=function(e,t){return(e.ownerDocument||e)!==L&&D(e),O(e,t)},a.attr=function(e,t){var n;return(e.ownerDocument||e)!==L&&D(e),M||(t=t.toLowerCase()),(n=C.attrHandle[t])?n(e):M||W.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},a.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},a.uniqueSort=function(e){var t,n=[],r=1,i=0;if(A=!W.detectDuplicates,e.sort(B),A){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));for(;i--;)e.splice(n[i],1)}return e},k=a.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=k(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=k(t);return n},C=a.selectors={cacheLength:50,createPseudo:i,match:pt,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(xt,Tt),e[3]=(e[4]||e[5]||"").replace(xt,Tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||a.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&a.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return pt.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&ct.test(n)&&(t=f(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(xt,Tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=z[e+" "];return t||(t=RegExp("(^|"+et+")"+e+"("+et+"|$)"))&&z(e,function(e){return t.test(e.className||typeof e.getAttribute!==V&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=a.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.substr(i.length-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.substr(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,f,p,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),v=!u&&!s;if(m){if(o){for(;g;){for(f=t;f=f[g];)if(s?f.nodeName.toLowerCase()===y:1===f.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?m.firstChild:m.lastChild],a&&v){for(c=m[P]||(m[P]={}),l=c[e]||[],d=l[0]===$&&l[1],p=l[0]===$&&l[2],f=d&&m.childNodes[d];f=++d&&f&&f[g]||(p=d=0)||h.pop();)if(1===f.nodeType&&++p&&f===t){c[e]=[$,d,p];break}}else if(v&&(l=(t[P]||(t[P]={}))[e])&&l[0]===$)p=l[1];else for(;(f=++d&&f&&f[g]||(p=d=0)||h.pop())&&((s?f.nodeName.toLowerCase()!==y:1!==f.nodeType)||!++p||(v&&((f[P]||(f[P]={}))[e]=[$,p]),f!==t)););return p-=i,p===r||0===p%r&&p/r>=0}}},PSEUDO:function(e,t){var n,r=C.pseudos[e]||C.setFilters[e.toLowerCase()]||a.error("unsupported pseudo: "+e);return r[P]?r(t):r.length>1?(n=[e,e,"",t],C.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,n){for(var i,o=r(e,t),a=o.length;a--;)i=Z.call(e,o[a]),e[i]=!(n[i]=o[a])}):function(e){return r(e,0,n)}):r}},pseudos:{not:i(function(e){var t=[],n=[],r=S(e.replace(at,"$1"));return r[P]?i(function(e,t,n,i){for(var o,a=r(e,null,i,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:i(function(e){return function(t){return a(e,t).length>0}}),contains:i(function(e){return function(t){return(t.textContent||t.innerText||k(t)).indexOf(e)>-1}}),lang:i(function(e){return ft.test(e||"")||a.error("unsupported lang: "+e),e=e.replace(xt,Tt).toLowerCase(),function(t){var n;do if(n=M?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===H},focus:function(e){return e===L.activeElement&&(!L.hasFocus||L.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!C.pseudos.empty(e)},header:function(e){return yt.test(e.nodeName)},input:function(e){return mt.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,n){return[0>n?n+t:n]}),even:c(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:c(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:c(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:c(function(e,t,n){for(var r=0>n?n+t:n;t>++r;)e.push(r);return e})}};for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C.pseudos[w]=u(w);for(w in{submit:!0,reset:!0})C.pseudos[w]=l(w);S=a.compile=function(e,t){var n,r=[],i=[],o=U[e+" "];if(!o){for(t||(t=f(e)),n=t.length;n--;)o=y(t[n]),o[P]?r.push(o):i.push(o);o=U(e,v(i,r))}return o},C.pseudos.nth=C.pseudos.eq,C.filters=T.prototype=C.pseudos,C.setFilters=new T,D(),a.attr=st.attr,st.find=a,st.expr=a.selectors,st.expr[":"]=st.expr.pseudos,st.unique=a.uniqueSort,st.text=a.getText,st.isXMLDoc=a.isXML,st.contains=a.contains}(e);var Pt=/Until$/,Rt=/^(?:parents|prev(?:Until|All))/,Wt=/^.[^:#\[\.,]*$/,$t=st.expr.match.needsContext,It={children:!0,contents:!0,next:!0,prev:!0};st.fn.extend({find:function(e){var t,n,r;if("string"!=typeof e)return r=this,this.pushStack(st(e).filter(function(){for(t=0;r.length>t;t++)if(st.contains(r[t],this))return!0}));for(n=[],t=0;this.length>t;t++)st.find(e,this[t],n);return n=this.pushStack(st.unique(n)),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=st(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(st.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(f(this,e,!1))},filter:function(e){return this.pushStack(f(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?$t.test(e)?st(e,this.context).index(this[0])>=0:st.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var n,r=0,i=this.length,o=[],a=$t.test(e)||"string"!=typeof e?st(e,t||this.context):0;i>r;r++)for(n=this[r];n&&n.ownerDocument&&n!==t&&11!==n.nodeType;){if(a?a.index(n)>-1:st.find.matchesSelector(n,e)){o.push(n);break}n=n.parentNode}return this.pushStack(o.length>1?st.unique(o):o)},index:function(e){return e?"string"==typeof e?st.inArray(this[0],st(e)):st.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?st(e,t):st.makeArray(e&&e.nodeType?[e]:e),r=st.merge(this.get(),n);return this.pushStack(st.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),st.fn.andSelf=st.fn.addBack,st.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return st.dir(e,"parentNode")},parentsUntil:function(e,t,n){return st.dir(e,"parentNode",n)},next:function(e){return c(e,"nextSibling")},prev:function(e){return c(e,"previousSibling")
},nextAll:function(e){return st.dir(e,"nextSibling")},prevAll:function(e){return st.dir(e,"previousSibling")},nextUntil:function(e,t,n){return st.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return st.dir(e,"previousSibling",n)},siblings:function(e){return st.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return st.sibling(e.firstChild)},contents:function(e){return st.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:st.merge([],e.childNodes)}},function(e,t){st.fn[e]=function(n,r){var i=st.map(this,t,n);return Pt.test(e)||(r=n),r&&"string"==typeof r&&(i=st.filter(r,i)),i=this.length>1&&!It[e]?st.unique(i):i,this.length>1&&Rt.test(e)&&(i=i.reverse()),this.pushStack(i)}}),st.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?st.find.matchesSelector(t[0],e)?[t[0]]:[]:st.find.matches(e,t)},dir:function(e,n,r){for(var i=[],o=e[n];o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!st(o).is(r));)1===o.nodeType&&i.push(o),o=o[n];return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var zt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Xt=/ jQuery\d+="(?:null|\d+)"/g,Ut=RegExp("<(?:"+zt+")[\\s/>]","i"),Vt=/^\s+/,Yt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Jt=/<([\w:]+)/,Gt=/<tbody/i,Qt=/<|&#?\w+;/,Kt=/<(?:script|style|link)/i,Zt=/^(?:checkbox|radio)$/i,en=/checked\s*(?:[^=]|=\s*.checked.)/i,tn=/^$|\/(?:java|ecma)script/i,nn=/^true\/(.*)/,rn=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,on={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:st.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},an=p(V),sn=an.appendChild(V.createElement("div"));on.optgroup=on.option,on.tbody=on.tfoot=on.colgroup=on.caption=on.thead,on.th=on.td,st.fn.extend({text:function(e){return st.access(this,function(e){return e===t?st.text(this):this.empty().append((this[0]&&this[0].ownerDocument||V).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(st.isFunction(e))return this.each(function(t){st(this).wrapAll(e.call(this,t))});if(this[0]){var t=st(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return st.isFunction(e)?this.each(function(t){st(this).wrapInner(e.call(this,t))}):this.each(function(){var t=st(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=st.isFunction(e);return this.each(function(n){st(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){st.nodeName(this,"body")||st(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,r=0;null!=(n=this[r]);r++)(!e||st.filter(e,[n]).length>0)&&(t||1!==n.nodeType||st.cleanData(b(n)),n.parentNode&&(t&&st.contains(n.ownerDocument,n)&&m(b(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&st.cleanData(b(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&st.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return st.clone(this,e,t)})},html:function(e){return st.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(Xt,""):t;if(!("string"!=typeof e||Kt.test(e)||!st.support.htmlSerialize&&Ut.test(e)||!st.support.leadingWhitespace&&Vt.test(e)||on[(Jt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(Yt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(st.cleanData(b(n,!1)),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=st.isFunction(e);return t||"string"==typeof e||(e=st(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;(n&&1===this.nodeType||11===this.nodeType)&&(st(this).remove(),t?t.parentNode.insertBefore(e,t):n.appendChild(e))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=et.apply([],e);var i,o,a,s,u,l,c=0,f=this.length,p=this,m=f-1,y=e[0],v=st.isFunction(y);if(v||!(1>=f||"string"!=typeof y||st.support.checkClone)&&en.test(y))return this.each(function(i){var o=p.eq(i);v&&(e[0]=y.call(this,i,n?o.html():t)),o.domManip(e,n,r)});if(f&&(i=st.buildFragment(e,this[0].ownerDocument,!1,this),o=i.firstChild,1===i.childNodes.length&&(i=o),o)){for(n=n&&st.nodeName(o,"tr"),a=st.map(b(i,"script"),h),s=a.length;f>c;c++)u=i,c!==m&&(u=st.clone(u,!0,!0),s&&st.merge(a,b(u,"script"))),r.call(n&&st.nodeName(this[c],"table")?d(this[c],"tbody"):this[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,st.map(a,g),c=0;s>c;c++)u=a[c],tn.test(u.type||"")&&!st._data(u,"globalEval")&&st.contains(l,u)&&(u.src?st.ajax({url:u.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):st.globalEval((u.text||u.textContent||u.innerHTML||"").replace(rn,"")));i=o=null}return this}}),st.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){st.fn[e]=function(e){for(var n,r=0,i=[],o=st(e),a=o.length-1;a>=r;r++)n=r===a?this:this.clone(!0),st(o[r])[t](n),tt.apply(i,n.get());return this.pushStack(i)}}),st.extend({clone:function(e,t,n){var r,i,o,a,s,u=st.contains(e.ownerDocument,e);if(st.support.html5Clone||st.isXMLDoc(e)||!Ut.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(sn.innerHTML=e.outerHTML,sn.removeChild(s=sn.firstChild)),!(st.support.noCloneEvent&&st.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||st.isXMLDoc(e)))for(r=b(s),i=b(e),a=0;null!=(o=i[a]);++a)r[a]&&v(o,r[a]);if(t)if(n)for(i=i||b(e),r=r||b(s),a=0;null!=(o=i[a]);a++)y(o,r[a]);else y(e,s);return r=b(s,"script"),r.length>0&&m(r,!u&&b(e,"script")),r=i=o=null,s},buildFragment:function(e,t,n,r){for(var i,o,a,s,u,l,c,f=e.length,d=p(t),h=[],g=0;f>g;g++)if(o=e[g],o||0===o)if("object"===st.type(o))st.merge(h,o.nodeType?[o]:o);else if(Qt.test(o)){for(s=s||d.appendChild(t.createElement("div")),a=(Jt.exec(o)||["",""])[1].toLowerCase(),u=on[a]||on._default,s.innerHTML=u[1]+o.replace(Yt,"<$1></$2>")+u[2],c=u[0];c--;)s=s.lastChild;if(!st.support.leadingWhitespace&&Vt.test(o)&&h.push(t.createTextNode(Vt.exec(o)[0])),!st.support.tbody)for(o="table"!==a||Gt.test(o)?"<table>"!==u[1]||Gt.test(o)?0:s:s.firstChild,c=o&&o.childNodes.length;c--;)st.nodeName(l=o.childNodes[c],"tbody")&&!l.childNodes.length&&o.removeChild(l);for(st.merge(h,s.childNodes),s.textContent="";s.firstChild;)s.removeChild(s.firstChild);s=d.lastChild}else h.push(t.createTextNode(o));for(s&&d.removeChild(s),st.support.appendChecked||st.grep(b(h,"input"),x),g=0;o=h[g++];)if((!r||-1===st.inArray(o,r))&&(i=st.contains(o.ownerDocument,o),s=b(d.appendChild(o),"script"),i&&m(s),n))for(c=0;o=s[c++];)tn.test(o.type||"")&&n.push(o);return s=null,d},cleanData:function(e,n){for(var r,i,o,a,s=0,u=st.expando,l=st.cache,c=st.support.deleteExpando,f=st.event.special;null!=(o=e[s]);s++)if((n||st.acceptData(o))&&(i=o[u],r=i&&l[i])){if(r.events)for(a in r.events)f[a]?st.event.remove(o,a):st.removeEvent(o,a,r.handle);l[i]&&(delete l[i],c?delete o[u]:o.removeAttribute!==t?o.removeAttribute(u):o[u]=null,K.push(i))}}});var un,ln,cn,fn=/alpha\([^)]*\)/i,pn=/opacity\s*=\s*([^)]*)/,dn=/^(top|right|bottom|left)$/,hn=/^(none|table(?!-c[ea]).+)/,gn=/^margin/,mn=RegExp("^("+ut+")(.*)$","i"),yn=RegExp("^("+ut+")(?!px)[a-z%]+$","i"),vn=RegExp("^([+-])=("+ut+")","i"),bn={BODY:"block"},xn={position:"absolute",visibility:"hidden",display:"block"},Tn={letterSpacing:0,fontWeight:400},wn=["Top","Right","Bottom","Left"],Nn=["Webkit","O","Moz","ms"];st.fn.extend({css:function(e,n){return st.access(this,function(e,n,r){var i,o,a={},s=0;if(st.isArray(n)){for(i=ln(e),o=n.length;o>s;s++)a[n[s]]=st.css(e,n[s],!1,i);return a}return r!==t?st.style(e,n,r):st.css(e,n)},e,n,arguments.length>1)},show:function(){return N(this,!0)},hide:function(){return N(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:w(this))?st(this).show():st(this).hide()})}}),st.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=un(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":st.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,u=st.camelCase(n),l=e.style;if(n=st.cssProps[u]||(st.cssProps[u]=T(l,u)),s=st.cssHooks[n]||st.cssHooks[u],r===t)return s&&"get"in s&&(o=s.get(e,!1,i))!==t?o:l[n];if(a=typeof r,"string"===a&&(o=vn.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(st.css(e,n)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"!==a||st.cssNumber[u]||(r+="px"),st.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(l[n]="inherit"),s&&"set"in s&&(r=s.set(e,r,i))===t)))try{l[n]=r}catch(c){}}},css:function(e,n,r,i){var o,a,s,u=st.camelCase(n);return n=st.cssProps[u]||(st.cssProps[u]=T(e.style,u)),s=st.cssHooks[n]||st.cssHooks[u],s&&"get"in s&&(o=s.get(e,!0,r)),o===t&&(o=un(e,n,i)),"normal"===o&&n in Tn&&(o=Tn[n]),r?(a=parseFloat(o),r===!0||st.isNumeric(a)?a||0:o):o},swap:function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i}}),e.getComputedStyle?(ln=function(t){return e.getComputedStyle(t,null)},un=function(e,n,r){var i,o,a,s=r||ln(e),u=s?s.getPropertyValue(n)||s[n]:t,l=e.style;return s&&(""!==u||st.contains(e.ownerDocument,e)||(u=st.style(e,n)),yn.test(u)&&gn.test(n)&&(i=l.width,o=l.minWidth,a=l.maxWidth,l.minWidth=l.maxWidth=l.width=u,u=s.width,l.width=i,l.minWidth=o,l.maxWidth=a)),u}):V.documentElement.currentStyle&&(ln=function(e){return e.currentStyle},un=function(e,n,r){var i,o,a,s=r||ln(e),u=s?s[n]:t,l=e.style;return null==u&&l&&l[n]&&(u=l[n]),yn.test(u)&&!dn.test(n)&&(i=l.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),l.left="fontSize"===n?"1em":u,u=l.pixelLeft+"px",l.left=i,a&&(o.left=a)),""===u?"auto":u}),st.each(["height","width"],function(e,n){st.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&hn.test(st.css(e,"display"))?st.swap(e,xn,function(){return E(e,n,i)}):E(e,n,i):t},set:function(e,t,r){var i=r&&ln(e);return C(e,t,r?k(e,n,r,st.support.boxSizing&&"border-box"===st.css(e,"boxSizing",!1,i),i):0)}}}),st.support.opacity||(st.cssHooks.opacity={get:function(e,t){return pn.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=st.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===st.trim(o.replace(fn,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=fn.test(o)?o.replace(fn,i):o+" "+i)}}),st(function(){st.support.reliableMarginRight||(st.cssHooks.marginRight={get:function(e,n){return n?st.swap(e,{display:"inline-block"},un,[e,"marginRight"]):t}}),!st.support.pixelPosition&&st.fn.position&&st.each(["top","left"],function(e,n){st.cssHooks[n]={get:function(e,r){return r?(r=un(e,n),yn.test(r)?st(e).position()[n]+"px":r):t}}})}),st.expr&&st.expr.filters&&(st.expr.filters.hidden=function(e){return 0===e.offsetWidth&&0===e.offsetHeight||!st.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||st.css(e,"display"))},st.expr.filters.visible=function(e){return!st.expr.filters.hidden(e)}),st.each({margin:"",padding:"",border:"Width"},function(e,t){st.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+wn[r]+t]=o[r]||o[r-2]||o[0];return i}},gn.test(e)||(st.cssHooks[e+t].set=C)});var Cn=/%20/g,kn=/\[\]$/,En=/\r?\n/g,Sn=/^(?:submit|button|image|reset)$/i,An=/^(?:input|select|textarea|keygen)/i;st.fn.extend({serialize:function(){return st.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=st.prop(this,"elements");return e?st.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!st(this).is(":disabled")&&An.test(this.nodeName)&&!Sn.test(e)&&(this.checked||!Zt.test(e))}).map(function(e,t){var n=st(this).val();return null==n?null:st.isArray(n)?st.map(n,function(e){return{name:t.name,value:e.replace(En,"\r\n")}}):{name:t.name,value:n.replace(En,"\r\n")}}).get()}}),st.param=function(e,n){var r,i=[],o=function(e,t){t=st.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=st.ajaxSettings&&st.ajaxSettings.traditional),st.isArray(e)||e.jquery&&!st.isPlainObject(e))st.each(e,function(){o(this.name,this.value)});else for(r in e)j(r,e[r],n,o);return i.join("&").replace(Cn,"+")};var jn,Dn,Ln=st.now(),Hn=/\?/,Mn=/#.*$/,qn=/([?&])_=[^&]*/,_n=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Fn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,On=/^(?:GET|HEAD)$/,Bn=/^\/\//,Pn=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Rn=st.fn.load,Wn={},$n={},In="*/".concat("*");try{Dn=Y.href}catch(zn){Dn=V.createElement("a"),Dn.href="",Dn=Dn.href}jn=Pn.exec(Dn.toLowerCase())||[],st.fn.load=function(e,n,r){if("string"!=typeof e&&Rn)return Rn.apply(this,arguments);var i,o,a,s=this,u=e.indexOf(" ");return u>=0&&(i=e.slice(u,e.length),e=e.slice(0,u)),st.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(o="POST"),s.length>0&&st.ajax({url:e,type:o,dataType:"html",data:n}).done(function(e){a=arguments,s.html(i?st("<div>").append(st.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,a||[e.responseText,t,e])}),this},st.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){st.fn[t]=function(e){return this.on(t,e)}}),st.each(["get","post"],function(e,n){st[n]=function(e,r,i,o){return st.isFunction(r)&&(o=o||i,i=r,r=t),st.ajax({url:e,type:n,dataType:o,data:r,success:i})}}),st.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Dn,type:"GET",isLocal:Fn.test(jn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":In,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":st.parseJSON,"text xml":st.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?H(H(e,st.ajaxSettings),t):H(st.ajaxSettings,e)},ajaxPrefilter:D(Wn),ajaxTransport:D($n),ajax:function(e,n){function r(e,n,r,s){var l,f,v,b,T,N=n;2!==x&&(x=2,u&&clearTimeout(u),i=t,a=s||"",w.readyState=e>0?4:0,r&&(b=M(p,w,r)),e>=200&&300>e||304===e?(p.ifModified&&(T=w.getResponseHeader("Last-Modified"),T&&(st.lastModified[o]=T),T=w.getResponseHeader("etag"),T&&(st.etag[o]=T)),304===e?(l=!0,N="notmodified"):(l=q(p,b),N=l.state,f=l.data,v=l.error,l=!v)):(v=N,(e||!N)&&(N="error",0>e&&(e=0))),w.status=e,w.statusText=(n||N)+"",l?g.resolveWith(d,[f,N,w]):g.rejectWith(d,[w,N,v]),w.statusCode(y),y=t,c&&h.trigger(l?"ajaxSuccess":"ajaxError",[w,p,l?f:v]),m.fireWith(d,[w,N]),c&&(h.trigger("ajaxComplete",[w,p]),--st.active||st.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var i,o,a,s,u,l,c,f,p=st.ajaxSetup({},n),d=p.context||p,h=p.context&&(d.nodeType||d.jquery)?st(d):st.event,g=st.Deferred(),m=st.Callbacks("once memory"),y=p.statusCode||{},v={},b={},x=0,T="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(2===x){if(!s)for(s={};t=_n.exec(a);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===x?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return x||(e=b[n]=b[n]||e,v[e]=t),this},overrideMimeType:function(e){return x||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>x)for(t in e)y[t]=[y[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||T;return i&&i.abort(t),r(0,t),this}};if(g.promise(w).complete=m.add,w.success=w.done,w.error=w.fail,p.url=((e||p.url||Dn)+"").replace(Mn,"").replace(Bn,jn[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=st.trim(p.dataType||"*").toLowerCase().match(lt)||[""],null==p.crossDomain&&(l=Pn.exec(p.url.toLowerCase()),p.crossDomain=!(!l||l[1]===jn[1]&&l[2]===jn[2]&&(l[3]||("http:"===l[1]?80:443))==(jn[3]||("http:"===jn[1]?80:443)))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=st.param(p.data,p.traditional)),L(Wn,p,n,w),2===x)return w;c=p.global,c&&0===st.active++&&st.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!On.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(Hn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=qn.test(o)?o.replace(qn,"$1_="+Ln++):o+(Hn.test(o)?"&":"?")+"_="+Ln++)),p.ifModified&&(st.lastModified[o]&&w.setRequestHeader("If-Modified-Since",st.lastModified[o]),st.etag[o]&&w.setRequestHeader("If-None-Match",st.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&w.setRequestHeader("Content-Type",p.contentType),w.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+In+"; q=0.01":""):p.accepts["*"]);for(f in p.headers)w.setRequestHeader(f,p.headers[f]);if(p.beforeSend&&(p.beforeSend.call(d,w,p)===!1||2===x))return w.abort();T="abort";for(f in{success:1,error:1,complete:1})w[f](p[f]);if(i=L($n,p,n,w)){w.readyState=1,c&&h.trigger("ajaxSend",[w,p]),p.async&&p.timeout>0&&(u=setTimeout(function(){w.abort("timeout")},p.timeout));try{x=1,i.send(v,r)}catch(N){if(!(2>x))throw N;r(-1,N)}}else r(-1,"No Transport");return w},getScript:function(e,n){return st.get(e,t,n,"script")},getJSON:function(e,t,n){return st.get(e,t,n,"json")}}),st.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return st.globalEval(e),e}}}),st.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),st.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=V.head||st("head")[0]||V.documentElement;return{send:function(t,i){n=V.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var Xn=[],Un=/(=)\?(?=&|$)|\?\?/;st.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Xn.pop()||st.expando+"_"+Ln++;return this[e]=!0,e}}),st.ajaxPrefilter("json jsonp",function(n,r,i){var o,a,s,u=n.jsonp!==!1&&(Un.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Un.test(n.data)&&"data");return u||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=st.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,u?n[u]=n[u].replace(Un,"$1"+o):n.jsonp!==!1&&(n.url+=(Hn.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||st.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=r.jsonpCallback,Xn.push(o)),s&&st.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Vn,Yn,Jn=0,Gn=e.ActiveXObject&&function(){var e;for(e in Vn)Vn[e](t,!0)};st.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&_()||F()}:_,Yn=st.ajaxSettings.xhr(),st.support.cors=!!Yn&&"withCredentials"in Yn,Yn=st.support.ajax=!!Yn,Yn&&st.ajaxTransport(function(n){if(!n.crossDomain||st.support.cors){var r;return{send:function(i,o){var a,s,u=n.xhr();if(n.username?u.open(n.type,n.url,n.async,n.username,n.password):u.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)u[s]=n.xhrFields[s];n.mimeType&&u.overrideMimeType&&u.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)u.setRequestHeader(s,i[s])}catch(l){}u.send(n.hasContent&&n.data||null),r=function(e,i){var s,l,c,f,p;try{if(r&&(i||4===u.readyState))if(r=t,a&&(u.onreadystatechange=st.noop,Gn&&delete Vn[a]),i)4!==u.readyState&&u.abort();else{f={},s=u.status,p=u.responseXML,c=u.getAllResponseHeaders(),p&&p.documentElement&&(f.xml=p),"string"==typeof u.responseText&&(f.text=u.responseText);try{l=u.statusText}catch(d){l=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=f.text?200:404}}catch(h){i||o(-1,h)}f&&o(s,l,f,c)},n.async?4===u.readyState?setTimeout(r):(a=++Jn,Gn&&(Vn||(Vn={},st(e).unload(Gn)),Vn[a]=r),u.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Qn,Kn,Zn=/^(?:toggle|show|hide)$/,er=RegExp("^(?:([+-])=|)("+ut+")([a-z%]*)$","i"),tr=/queueHooks$/,nr=[W],rr={"*":[function(e,t){var n,r,i=this.createTween(e,t),o=er.exec(t),a=i.cur(),s=+a||0,u=1,l=20;if(o){if(n=+o[2],r=o[3]||(st.cssNumber[e]?"":"px"),"px"!==r&&s){s=st.css(i.elem,e,!0)||n||1;do u=u||".5",s/=u,st.style(i.elem,e,s+r);while(u!==(u=i.cur()/a)&&1!==u&&--l)}i.unit=r,i.start=s,i.end=o[1]?s+(o[1]+1)*n:n}return i}]};st.Animation=st.extend(P,{tweener:function(e,t){st.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,r=0,i=e.length;i>r;r++)n=e[r],rr[n]=rr[n]||[],rr[n].unshift(t)},prefilter:function(e,t){t?nr.unshift(e):nr.push(e)}}),st.Tween=$,$.prototype={constructor:$,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(st.cssNumber[n]?"":"px")},cur:function(){var e=$.propHooks[this.prop];return e&&e.get?e.get(this):$.propHooks._default.get(this)},run:function(e){var t,n=$.propHooks[this.prop];return this.pos=t=this.options.duration?st.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):$.propHooks._default.set(this),this}},$.prototype.init.prototype=$.prototype,$.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=st.css(e.elem,e.prop,"auto"),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){st.fx.step[e.prop]?st.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[st.cssProps[e.prop]]||st.cssHooks[e.prop])?st.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},$.propHooks.scrollTop=$.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},st.each(["toggle","show","hide"],function(e,t){var n=st.fn[t];st.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(I(t,!0),e,r,i)}}),st.fn.extend({fadeTo:function(e,t,n,r){return this.filter(w).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=st.isEmptyObject(e),o=st.speed(t,n,r),a=function(){var t=P(this,st.extend({},e),o);a.finish=function(){t.stop(!0)},(i||st._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=st.timers,a=st._data(this);if(n)a[n]&&a[n].stop&&i(a[n]);else for(n in a)a[n]&&a[n].stop&&tr.test(n)&&i(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));(t||!r)&&st.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=st._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=st.timers,a=r?r.length:0;for(n.finish=!0,st.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),st.each({slideDown:I("show"),slideUp:I("hide"),slideToggle:I("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){st.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),st.speed=function(e,t,n){var r=e&&"object"==typeof e?st.extend({},e):{complete:n||!n&&t||st.isFunction(e)&&e,duration:e,easing:n&&t||t&&!st.isFunction(t)&&t};return r.duration=st.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in st.fx.speeds?st.fx.speeds[r.duration]:st.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){st.isFunction(r.old)&&r.old.call(this),r.queue&&st.dequeue(this,r.queue)},r},st.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},st.timers=[],st.fx=$.prototype.init,st.fx.tick=function(){var e,n=st.timers,r=0;for(Qn=st.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||st.fx.stop(),Qn=t},st.fx.timer=function(e){e()&&st.timers.push(e)&&st.fx.start()},st.fx.interval=13,st.fx.start=function(){Kn||(Kn=setInterval(st.fx.tick,st.fx.interval))},st.fx.stop=function(){clearInterval(Kn),Kn=null},st.fx.speeds={slow:600,fast:200,_default:400},st.fx.step={},st.expr&&st.expr.filters&&(st.expr.filters.animated=function(e){return st.grep(st.timers,function(t){return e===t.elem}).length}),st.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){st.offset.setOffset(this,e,t)});var n,r,i={top:0,left:0},o=this[0],a=o&&o.ownerDocument;if(a)return n=a.documentElement,st.contains(n,o)?(o.getBoundingClientRect!==t&&(i=o.getBoundingClientRect()),r=z(a),{top:i.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:i.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):i},st.offset={setOffset:function(e,t,n){var r=st.css(e,"position");"static"===r&&(e.style.position="relative");var i,o,a=st(e),s=a.offset(),u=st.css(e,"top"),l=st.css(e,"left"),c=("absolute"===r||"fixed"===r)&&st.inArray("auto",[u,l])>-1,f={},p={};c?(p=a.position(),i=p.top,o=p.left):(i=parseFloat(u)||0,o=parseFloat(l)||0),st.isFunction(t)&&(t=t.call(e,n,s)),null!=t.top&&(f.top=t.top-s.top+i),null!=t.left&&(f.left=t.left-s.left+o),"using"in t?t.using.call(e,f):a.css(f)}},st.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===st.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),st.nodeName(e[0],"html")||(n=e.offset()),n.top+=st.css(e[0],"borderTopWidth",!0),n.left+=st.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-st.css(r,"marginTop",!0),left:t.left-n.left-st.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||V.documentElement;e&&!st.nodeName(e,"html")&&"static"===st.css(e,"position");)e=e.offsetParent;return e||V.documentElement})}}),st.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);st.fn[e]=function(i){return st.access(this,function(e,i,o){var a=z(e);return o===t?a?n in a?a[n]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(r?st(a).scrollLeft():o,r?o:st(a).scrollTop()):e[i]=o,t)},e,i,arguments.length,null)}}),st.each({Height:"height",Width:"width"},function(e,n){st.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){st.fn[i]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||o===!0?"margin":"border");return st.access(this,function(n,r,i){var o;return st.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?st.css(n,r,s):st.style(n,r,i,s)},n,a?i:t,a,null)}})}),e.jQuery=e.$=st,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return st})})(window);


/*********************/
/****** 	jquery-ui-1.9.1.custom.min.js	 ***********/
/*********************/
/*! jQuery UI - v1.9.1 - 2012-11-19
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.autocomplete.js, jquery.ui.datepicker.js, jquery.ui.menu.js, jquery.ui.slider.js
* Copyright (c) 2012 jQuery Foundation and other contributors Licensed MIT */

(function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();return"area"===u?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"1.9.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight,e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=n.offsetHeight===100,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1,e.ui.ie6=parseFloat(t[1],10)===6}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},contains:e.contains,hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})})(jQuery);(function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var i,s,o,u,a=t.split(".")[0];t=t.split(".")[1],i=a+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[a]=e[a]||{},s=e[a][t],o=e[a][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,i){e.isFunction(i)&&(r[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},r=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=r,s=i.apply(this,arguments),this._super=t,this._superApply=n,s}}())}),o.prototype=e.widget.extend(u,{widgetEventPrefix:u.widgetEventPrefix||t},r,{constructor:o,namespace:a,widgetName:t,widgetBaseClass:i,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t)return f=r&&r.jquery?f.pushStack(r.get()):r,!1}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():new i(o,this)}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetName,this),e.data(r,this.widgetFullName,this),this._on(this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n){var r,i=this;n?(t=r=e(t),this.bindings=this.bindings.add(t)):(n=t,t=this.element,r=this.widget()),e.each(n,function(n,s){function o(){if(i.options.disabled===!0||e(this).hasClass("ui-state-disabled"))return;return(typeof s=="string"?i[s]:s).apply(i,arguments)}typeof s!="string"&&(o.guid=s.guid=s.guid||o.guid||e.guid++);var u=n.match(/^(\w+)\s*(.*)$/),a=u[1]+i.eventNamespace,f=u[2];f?r.delegate(f,a,o):t.bind(a,o)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&(e.effects.effect[u]||e.uiBackCompat!==!1&&e.effects[u])?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})})(jQuery);(function(e,t){var n=!1;e(document).mouseup(function(e){n=!1}),e.widget("ui.mouse",{version:"1.9.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return!e.ui.ie||document.documentMode>=9||!!t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(e){return this.mouseDelayMet},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return!0}})})(jQuery);(function(e,t){function h(e,t,n){return[parseInt(e[0],10)*(l.test(e[0])?t/100:1),parseInt(e[1],10)*(l.test(e[1])?n/100:1)]}function p(t,n){return parseInt(e.css(t,n),10)||0}e.ui=e.ui||{};var n,r=Math.max,i=Math.abs,s=Math.round,o=/left|center|right/,u=/top|center|bottom/,a=/[\+\-]\d+%?/,f=/^\w+/,l=/%$/,c=e.fn.position;e.position={scrollbarWidth:function(){if(n!==t)return n;var r,i,s=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return e("body").append(s),r=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,r===i&&(i=s[0].clientWidth),s.remove(),n=r-i},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),r=t.isWindow?"":t.element.css("overflow-y"),i=n==="scroll"||n==="auto"&&t.width<t.element[0].scrollWidth,s=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:i?e.position.scrollbarWidth():0,height:s?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]);return{element:n,isWindow:r,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return c.apply(this,arguments);t=e.extend({},t);var n,l,d,v,m,g=e(t.of),y=e.position.getWithinInfo(t.within),b=e.position.getScrollInfo(y),w=g[0],E=(t.collision||"flip").split(" "),S={};return w.nodeType===9?(l=g.width(),d=g.height(),v={top:0,left:0}):e.isWindow(w)?(l=g.width(),d=g.height(),v={top:g.scrollTop(),left:g.scrollLeft()}):w.preventDefault?(t.at="left top",l=d=0,v={top:w.pageY,left:w.pageX}):(l=g.outerWidth(),d=g.outerHeight(),v=g.offset()),m=e.extend({},v),e.each(["my","at"],function(){var e=(t[this]||"").split(" "),n,r;e.length===1&&(e=o.test(e[0])?e.concat(["center"]):u.test(e[0])?["center"].concat(e):["center","center"]),e[0]=o.test(e[0])?e[0]:"center",e[1]=u.test(e[1])?e[1]:"center",n=a.exec(e[0]),r=a.exec(e[1]),S[this]=[n?n[0]:0,r?r[0]:0],t[this]=[f.exec(e[0])[0],f.exec(e[1])[0]]}),E.length===1&&(E[1]=E[0]),t.at[0]==="right"?m.left+=l:t.at[0]==="center"&&(m.left+=l/2),t.at[1]==="bottom"?m.top+=d:t.at[1]==="center"&&(m.top+=d/2),n=h(S.at,l,d),m.left+=n[0],m.top+=n[1],this.each(function(){var o,u,a=e(this),f=a.outerWidth(),c=a.outerHeight(),w=p(this,"marginLeft"),x=p(this,"marginTop"),T=f+w+p(this,"marginRight")+b.width,N=c+x+p(this,"marginBottom")+b.height,C=e.extend({},m),k=h(S.my,a.outerWidth(),a.outerHeight());t.my[0]==="right"?C.left-=f:t.my[0]==="center"&&(C.left-=f/2),t.my[1]==="bottom"?C.top-=c:t.my[1]==="center"&&(C.top-=c/2),C.left+=k[0],C.top+=k[1],e.support.offsetFractions||(C.left=s(C.left),C.top=s(C.top)),o={marginLeft:w,marginTop:x},e.each(["left","top"],function(r,i){e.ui.position[E[r]]&&e.ui.position[E[r]][i](C,{targetWidth:l,targetHeight:d,elemWidth:f,elemHeight:c,collisionPosition:o,collisionWidth:T,collisionHeight:N,offset:[n[0]+k[0],n[1]+k[1]],my:t.my,at:t.at,within:y,elem:a})}),e.fn.bgiframe&&a.bgiframe(),t.using&&(u=function(e){var n=v.left-C.left,s=n+l-f,o=v.top-C.top,u=o+d-c,h={target:{element:g,left:v.left,top:v.top,width:l,height:d},element:{element:a,left:C.left,top:C.top,width:f,height:c},horizontal:s<0?"left":n>0?"right":"center",vertical:u<0?"top":o>0?"bottom":"middle"};l<f&&i(n+s)<l&&(h.horizontal="center"),d<c&&i(o+u)<d&&(h.vertical="middle"),r(i(n),i(s))>r(i(o),i(u))?h.important="horizontal":h.important="vertical",t.using.call(this,e,h)}),a.offset(e.extend(C,{using:u}))})},e.ui.position={fit:{left:function(e,t){var n=t.within,i=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,o=e.left-t.collisionPosition.marginLeft,u=i-o,a=o+t.collisionWidth-s-i,f;t.collisionWidth>s?u>0&&a<=0?(f=e.left+u+t.collisionWidth-s-i,e.left+=u-f):a>0&&u<=0?e.left=i:u>a?e.left=i+s-t.collisionWidth:e.left=i:u>0?e.left+=u:a>0?e.left-=a:e.left=r(e.left-o,e.left)},top:function(e,t){var n=t.within,i=n.isWindow?n.scrollTop:n.offset.top,s=t.within.height,o=e.top-t.collisionPosition.marginTop,u=i-o,a=o+t.collisionHeight-s-i,f;t.collisionHeight>s?u>0&&a<=0?(f=e.top+u+t.collisionHeight-s-i,e.top+=u-f):a>0&&u<=0?e.top=i:u>a?e.top=i+s-t.collisionHeight:e.top=i:u>0?e.top+=u:a>0?e.top-=a:e.top=r(e.top-o,e.top)}},flip:{left:function(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,s=n.width,o=n.isWindow?n.scrollLeft:n.offset.left,u=e.left-t.collisionPosition.marginLeft,a=u-o,f=u+t.collisionWidth-s-o,l=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,c=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,h=-2*t.offset[0],p,d;if(a<0){p=e.left+l+c+h+t.collisionWidth-s-r;if(p<0||p<i(a))e.left+=l+c+h}else if(f>0){d=e.left-t.collisionPosition.marginLeft+l+c+h-o;if(d>0||i(d)<f)e.left+=l+c+h}},top:function(e,t){var n=t.within,r=n.offset.top+n.scrollTop,s=n.height,o=n.isWindow?n.scrollTop:n.offset.top,u=e.top-t.collisionPosition.marginTop,a=u-o,f=u+t.collisionHeight-s-o,l=t.my[1]==="top",c=l?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,h=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,p=-2*t.offset[1],d,v;a<0?(v=e.top+c+h+p+t.collisionHeight-s-r,e.top+c+h+p>a&&(v<0||v<i(a))&&(e.top+=c+h+p)):f>0&&(d=e.top-t.collisionPosition.marginTop+c+h+p-o,e.top+c+h+p>f&&(d>0||i(d)<f)&&(e.top+=c+h+p))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in r)t.style[s]=r[s];t.appendChild(u),n=o||document.documentElement,n.insertBefore(t,n.firstChild),u.style.cssText="position: absolute; left: 10.7432222px;",i=e(u).offset().left,e.support.offsetFractions=i>10&&i<11,t.innerHTML="",n.removeChild(t)}(),e.uiBackCompat!==!1&&function(e){var n=e.fn.position;e.fn.position=function(r){if(!r||!r.offset)return n.call(this,r);var i=r.offset.split(" "),s=r.at.split(" ");return i.length===1&&(i[1]=i[0]),/^\d/.test(i[0])&&(i[0]="+"+i[0]),/^\d/.test(i[1])&&(i[1]="+"+i[1]),s.length===1&&(/left|center|right/.test(s[0])?s[1]="center":(s[1]=s[0],s[0]="center")),n.call(this,e.extend(r,{at:s[0]+i[0]+" "+s[1]+i[1],offset:t}))}}(jQuery)})(jQuery);(function(e,t){var n=0;e.widget("ui.autocomplete",{version:"1.9.1",defaultElement:"<input>",options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var t,n,r;this.isMultiLine=this._isMultiLine(),this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(i){if(this.element.prop("readOnly")){t=!0,r=!0,n=!0;return}t=!1,r=!1,n=!1;var s=e.ui.keyCode;switch(i.keyCode){case s.PAGE_UP:t=!0,this._move("previousPage",i);break;case s.PAGE_DOWN:t=!0,this._move("nextPage",i);break;case s.UP:t=!0,this._keyEvent("previous",i);break;case s.DOWN:t=!0,this._keyEvent("next",i);break;case s.ENTER:case s.NUMPAD_ENTER:this.menu.active&&(t=!0,i.preventDefault(),this.menu.select(i));break;case s.TAB:this.menu.active&&this.menu.select(i);break;case s.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(i),i.preventDefault());break;default:n=!0,this._searchTimeout(i)}},keypress:function(r){if(t){t=!1,r.preventDefault();return}if(n)return;var i=e.ui.keyCode;switch(r.keyCode){case i.PAGE_UP:this._move("previousPage",r);break;case i.PAGE_DOWN:this._move("nextPage",r);break;case i.UP:this._keyEvent("previous",r);break;case i.DOWN:this._keyEvent("next",r)}},input:function(e){if(r){r=!1,e.preventDefault();return}this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){if(this.cancelBlur){delete this.cancelBlur;return}clearTimeout(this.searching),this.close(e),this._change(e)}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete").appendTo(this.document.find(this.options.appendTo||"body")[0]).menu({input:e(),role:null}).zIndex(this.element.zIndex()+1).hide().data("menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var n=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(r){r.target!==t.element[0]&&r.target!==n&&!e.contains(n,r.target)&&t.close()})})},menufocus:function(t,n){if(this.isNewMenu){this.isNewMenu=!1;if(t.originalEvent&&/^mouse/.test(t.originalEvent.type)){this.menu.blur(),this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)});return}}var r=n.item.data("ui-autocomplete-item")||n.item.data("item.autocomplete");!1!==this._trigger("focus",t,{item:r})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(r.value):this.liveRegion.text(r.value)},menuselect:function(e,t){var n=t.item.data("ui-autocomplete-item")||t.item.data("item.autocomplete"),r=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=r,this._delay(function(){this.previous=r,this.selectedItem=n})),!1!==this._trigger("select",e,{item:n})&&this._value(n.value),this.term=this._value(),this.close(e),this.selectedItem=n}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element),e.fn.bgiframe&&this.menu.element.bgiframe(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),e==="source"&&this._initSource(),e==="appendTo"&&this.menu.element.appendTo(this.document.find(t||"body")[0]),e==="disabled"&&t&&this.xhr&&this.xhr.abort()},_isMultiLine:function(){return this.element.is("textarea")?!0:this.element.is("input")?!1:this.element.prop("isContentEditable")},_initSource:function(){var t,n,r=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(n,r){r(e.ui.autocomplete.filter(t,n.term))}):typeof this.options.source=="string"?(n=this.options.source,this.source=function(t,i){r.xhr&&r.xhr.abort(),r.xhr=e.ajax({url:n,data:t,dataType:"json",success:function(e){i(e)},error:function(){i([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){e=e!=null?e:this._value(),this.term=this._value();if(e.length<this.options.minLength)return this.close(t);if(this._trigger("search",t)===!1)return;return this._search(e)},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var e=this,t=++n;return function(r){t===n&&e.__response(r),e.pending--,e.pending||e.element.removeClass("ui-autocomplete-loading")}},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return typeof t=="string"?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var n=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(n,t),this.menu.refresh(),n.show(),this._resizeMenu(),n.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,n){var r=this;e.each(n,function(e,n){r._renderItemData(t,n)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,n){return e("<li>").append(e("<a>").text(n.label)).appendTo(t)},_move:function(e,t){if(!this.menu.element.is(":visible")){this.search(null,t);return}if(this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)){this._value(this.term),this.menu.blur();return}this.menu[e](t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){if(!this.isMultiLine||this.menu.element.is(":visible"))this._move(e,t),t.preventDefault()}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return r.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments);if(this.options.disabled||this.cancelSearch)return;e&&e.length?t=this.options.messages.results(e.length):t=this.options.messages.noResults,this.liveRegion.text(t)}})})(jQuery);(function($,undefined){function Datepicker(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},$.extend(this._defaults,this.regional[""]),this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function bindHover(e){var t="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(t,"mouseout",function(){$(this).removeClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!=-1&&$(this).removeClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!=-1&&$(this).removeClass("ui-datepicker-next-hover")}).delegate(t,"mouseover",function(){$.datepicker._isDisabledDatepicker(instActive.inline?e.parent()[0]:instActive.input[0])||($(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),$(this).addClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!=-1&&$(this).addClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!=-1&&$(this).addClass("ui-datepicker-next-hover"))})}function extendRemove(e,t){$.extend(e,t);for(var n in t)if(t[n]==null||t[n]==undefined)e[n]=t[n];return e}$.extend($.ui,{datepicker:{version:"1.9.1"}});var PROP_NAME="datepicker",dpuuid=(new Date).getTime(),instActive;$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return extendRemove(this._defaults,e||{}),this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase(),inline=nodeName=="div"||nodeName=="span";target.id||(this.uuid+=1,target.id="dp"+this.uuid);var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{}),nodeName=="input"?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst)},_newInst:function(e,t){var n=e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:n,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:t?bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')):this.dpDiv}},_connectDatepicker:function(e,t){var n=$(e);t.append=$([]),t.trigger=$([]);if(n.hasClass(this.markerClassName))return;this._attachments(n,t),n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(e,n,r){t.settings[n]=r}).bind("getData.datepicker",function(e,n){return this._get(t,n)}),this._autoSize(t),$.data(e,PROP_NAME,t),t.settings.disabled&&this._disableDatepicker(e)},_attachments:function(e,t){var n=this._get(t,"appendText"),r=this._get(t,"isRTL");t.append&&t.append.remove(),n&&(t.append=$('<span class="'+this._appendClass+'">'+n+"</span>"),e[r?"before":"after"](t.append)),e.unbind("focus",this._showDatepicker),t.trigger&&t.trigger.remove();var i=this._get(t,"showOn");(i=="focus"||i=="both")&&e.focus(this._showDatepicker);if(i=="button"||i=="both"){var s=this._get(t,"buttonText"),o=this._get(t,"buttonImage");t.trigger=$(this._get(t,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:o,alt:s,title:s}):$('<button type="button"></button>').addClass(this._triggerClass).html(o==""?s:$("<img/>").attr({src:o,alt:s,title:s}))),e[r?"before":"after"](t.trigger),t.trigger.click(function(){return $.datepicker._datepickerShowing&&$.datepicker._lastInput==e[0]?$.datepicker._hideDatepicker():$.datepicker._datepickerShowing&&$.datepicker._lastInput!=e[0]?($.datepicker._hideDatepicker(),$.datepicker._showDatepicker(e[0])):$.datepicker._showDatepicker(e[0]),!1})}},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t=new Date(2009,11,20),n=this._get(e,"dateFormat");if(n.match(/[DM]/)){var r=function(e){var t=0,n=0;for(var r=0;r<e.length;r++)e[r].length>t&&(t=e[r].length,n=r);return n};t.setMonth(r(this._get(e,n.match(/MM/)?"monthNames":"monthNamesShort"))),t.setDate(r(this._get(e,n.match(/DD/)?"dayNames":"dayNamesShort"))+20-t.getDay())}e.input.attr("size",this._formatDate(e,t).length)}},_inlineDatepicker:function(e,t){var n=$(e);if(n.hasClass(this.markerClassName))return;n.addClass(this.markerClassName).append(t.dpDiv).bind("setData.datepicker",function(e,n,r){t.settings[n]=r}).bind("getData.datepicker",function(e,n){return this._get(t,n)}),$.data(e,PROP_NAME,t),this._setDate(t,this._getDefaultDate(t),!0),this._updateDatepicker(t),this._updateAlternate(t),t.settings.disabled&&this._disableDatepicker(e),t.dpDiv.css("display","block")},_dialogDatepicker:function(e,t,n,r,i){var s=this._dialogInst;if(!s){this.uuid+=1;var o="dp"+this.uuid;this._dialogInput=$('<input type="text" id="'+o+'" style="position: absolute; top: -100px; width: 0px;"/>'),this._dialogInput.keydown(this._doKeyDown),$("body").append(this._dialogInput),s=this._dialogInst=this._newInst(this._dialogInput,!1),s.settings={},$.data(this._dialogInput[0],PROP_NAME,s)}extendRemove(s.settings,r||{}),t=t&&t.constructor==Date?this._formatDate(s,t):t,this._dialogInput.val(t),this._pos=i?i.length?i:[i.pageX,i.pageY]:null;if(!this._pos){var u=document.documentElement.clientWidth,a=document.documentElement.clientHeight,f=document.documentElement.scrollLeft||document.body.scrollLeft,l=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[u/2-100+f,a/2-150+l]}return this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),s.settings.onSelect=n,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),$.blockUI&&$.blockUI(this.dpDiv),$.data(this._dialogInput[0],PROP_NAME,s),this},_destroyDatepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);if(!t.hasClass(this.markerClassName))return;var r=e.nodeName.toLowerCase();$.removeData(e,PROP_NAME),r=="input"?(n.append.remove(),n.trigger.remove(),t.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):(r=="div"||r=="span")&&t.removeClass(this.markerClassName).empty()},_enableDatepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);if(!t.hasClass(this.markerClassName))return;var r=e.nodeName.toLowerCase();if(r=="input")e.disabled=!1,n.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if(r=="div"||r=="span"){var i=t.children("."+this._inlineClass);i.children().removeClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t})},_disableDatepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);if(!t.hasClass(this.markerClassName))return;var r=e.nodeName.toLowerCase();if(r=="input")e.disabled=!0,n.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if(r=="div"||r=="span"){var i=t.children("."+this._inlineClass);i.children().addClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t}),this._disabledInputs[this._disabledInputs.length]=e},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]==e)return!0;return!1},_getInst:function(e){try{return $.data(e,PROP_NAME)}catch(t){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,t,n){var r=this._getInst(e);if(arguments.length==2&&typeof t=="string")return t=="defaults"?$.extend({},$.datepicker._defaults):r?t=="all"?$.extend({},r.settings):this._get(r,t):null;var i=t||{};typeof t=="string"&&(i={},i[t]=n);if(r){this._curInst==r&&this._hideDatepicker();var s=this._getDateDatepicker(e,!0),o=this._getMinMaxDate(r,"min"),u=this._getMinMaxDate(r,"max");extendRemove(r.settings,i),o!==null&&i.dateFormat!==undefined&&i.minDate===undefined&&(r.settings.minDate=this._formatDate(r,o)),u!==null&&i.dateFormat!==undefined&&i.maxDate===undefined&&(r.settings.maxDate=this._formatDate(r,u)),this._attachments($(e),r),this._autoSize(r),this._setDate(r,s),this._updateAlternate(r),this._updateDatepicker(r)}},_changeDatepicker:function(e,t,n){this._optionDatepicker(e,t,n)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var n=this._getInst(e);n&&(this._setDate(n,t),this._updateDatepicker(n),this._updateAlternate(n))},_getDateDatepicker:function(e,t){var n=this._getInst(e);return n&&!n.inline&&this._setDateFromField(n,t),n?this._getDate(n):null},_doKeyDown:function(e){var t=$.datepicker._getInst(e.target),n=!0,r=t.dpDiv.is(".ui-datepicker-rtl");t._keyEvent=!0;if($.datepicker._datepickerShowing)switch(e.keyCode){case 9:$.datepicker._hideDatepicker(),n=!1;break;case 13:var i=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",t.dpDiv);i[0]&&$.datepicker._selectDay(e.target,t.selectedMonth,t.selectedYear,i[0]);var s=$.datepicker._get(t,"onSelect");if(s){var o=$.datepicker._formatDate(t);s.apply(t.input?t.input[0]:null,[o,t])}else $.datepicker._hideDatepicker();return!1;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&$.datepicker._clearDate(e.target),n=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&$.datepicker._gotoToday(e.target),n=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,r?1:-1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,-7,"D"),n=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,r?-1:1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,7,"D"),n=e.ctrlKey||e.metaKey;break;default:n=!1}else e.keyCode==36&&e.ctrlKey?$.datepicker._showDatepicker(this):n=!1;n&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var t=$.datepicker._getInst(e.target);if($.datepicker._get(t,"constrainInput")){var n=$.datepicker._possibleChars($.datepicker._get(t,"dateFormat")),r=String.fromCharCode(e.charCode==undefined?e.keyCode:e.charCode);return e.ctrlKey||e.metaKey||r<" "||!n||n.indexOf(r)>-1}},_doKeyUp:function(e){var t=$.datepicker._getInst(e.target);if(t.input.val()!=t.lastVal)try{var n=$.datepicker.parseDate($.datepicker._get(t,"dateFormat"),t.input?t.input.val():null,$.datepicker._getFormatConfig(t));n&&($.datepicker._setDateFromField(t),$.datepicker._updateAlternate(t),$.datepicker._updateDatepicker(t))}catch(r){$.datepicker.log(r)}return!0},_showDatepicker:function(e){e=e.target||e,e.nodeName.toLowerCase()!="input"&&(e=$("input",e.parentNode)[0]);if($.datepicker._isDisabledDatepicker(e)||$.datepicker._lastInput==e)return;var t=$.datepicker._getInst(e);$.datepicker._curInst&&$.datepicker._curInst!=t&&($.datepicker._curInst.dpDiv.stop(!0,!0),t&&$.datepicker._datepickerShowing&&$.datepicker._hideDatepicker($.datepicker._curInst.input[0]));var n=$.datepicker._get(t,"beforeShow"),r=n?n.apply(e,[e,t]):{};if(r===!1)return;extendRemove(t.settings,r),t.lastVal=null,$.datepicker._lastInput=e,$.datepicker._setDateFromField(t),$.datepicker._inDialog&&(e.value=""),$.datepicker._pos||($.datepicker._pos=$.datepicker._findPos(e),$.datepicker._pos[1]+=e.offsetHeight);var i=!1;$(e).parents().each(function(){return i|=$(this).css("position")=="fixed",!i});var s={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null,t.dpDiv.empty(),t.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),$.datepicker._updateDatepicker(t),s=$.datepicker._checkOffset(t,s,i),t.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":i?"fixed":"absolute",display:"none",left:s.left+"px",top:s.top+"px"});if(!t.inline){var o=$.datepicker._get(t,"showAnim"),u=$.datepicker._get(t,"duration"),a=function(){var e=t.dpDiv.find("iframe.ui-datepicker-cover");if(!!e.length){var n=$.datepicker._getBorders(t.dpDiv);e.css({left:-n[0],top:-n[1],width:t.dpDiv.outerWidth(),height:t.dpDiv.outerHeight()})}};t.dpDiv.zIndex($(e).zIndex()+1),$.datepicker._datepickerShowing=!0,$.effects&&($.effects.effect[o]||$.effects[o])?t.dpDiv.show(o,$.datepicker._get(t,"showOptions"),u,a):t.dpDiv[o||"show"](o?u:null,a),(!o||!u)&&a(),t.input.is(":visible")&&!t.input.is(":disabled")&&t.input.focus(),$.datepicker._curInst=t}},_updateDatepicker:function(e){this.maxRows=4;var t=$.datepicker._getBorders(e.dpDiv);instActive=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var n=e.dpDiv.find("iframe.ui-datepicker-cover");!n.length||n.css({left:-t[0],top:-t[1],width:e.dpDiv.outerWidth(),height:e.dpDiv.outerHeight()}),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var r=this._getNumberOfMonths(e),i=r[1],s=17;e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),i>1&&e.dpDiv.addClass("ui-datepicker-multi-"+i).css("width",s*i+"em"),e.dpDiv[(r[0]!=1||r[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e==$.datepicker._curInst&&$.datepicker._datepickerShowing&&e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&e.input[0]!=document.activeElement&&e.input.focus();if(e.yearshtml){var o=e.yearshtml;setTimeout(function(){o===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),o=e.yearshtml=null},0)}},_getBorders:function(e){var t=function(e){return{thin:1,medium:2,thick:3}[e]||e};return[parseFloat(t(e.css("border-left-width"))),parseFloat(t(e.css("border-top-width")))]},_checkOffset:function(e,t,n){var r=e.dpDiv.outerWidth(),i=e.dpDiv.outerHeight(),s=e.input?e.input.outerWidth():0,o=e.input?e.input.outerHeight():0,u=document.documentElement.clientWidth+(n?0:$(document).scrollLeft()),a=document.documentElement.clientHeight+(n?0:$(document).scrollTop());return t.left-=this._get(e,"isRTL")?r-s:0,t.left-=n&&t.left==e.input.offset().left?$(document).scrollLeft():0,t.top-=n&&t.top==e.input.offset().top+o?$(document).scrollTop():0,t.left-=Math.min(t.left,t.left+r>u&&u>r?Math.abs(t.left+r-u):0),t.top-=Math.min(t.top,t.top+i>a&&a>i?Math.abs(i+o):0),t},_findPos:function(e){var t=this._getInst(e),n=this._get(t,"isRTL");while(e&&(e.type=="hidden"||e.nodeType!=1||$.expr.filters.hidden(e)))e=e[n?"previousSibling":"nextSibling"];var r=$(e).offset();return[r.left,r.top]},_hideDatepicker:function(e){var t=this._curInst;if(!t||e&&t!=$.data(e,PROP_NAME))return;if(this._datepickerShowing){var n=this._get(t,"showAnim"),r=this._get(t,"duration"),i=function(){$.datepicker._tidyDialog(t)};$.effects&&($.effects.effect[n]||$.effects[n])?t.dpDiv.hide(n,$.datepicker._get(t,"showOptions"),r,i):t.dpDiv[n=="slideDown"?"slideUp":n=="fadeIn"?"fadeOut":"hide"](n?r:null,i),n||i(),this._datepickerShowing=!1;var s=this._get(t,"onClose");s&&s.apply(t.input?t.input[0]:null,[t.input?t.input.val():"",t]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),$.blockUI&&($.unblockUI(),$("body").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(!$.datepicker._curInst)return;var t=$(e.target),n=$.datepicker._getInst(t[0]);(t[0].id!=$.datepicker._mainDivId&&t.parents("#"+$.datepicker._mainDivId).length==0&&!t.hasClass($.datepicker.markerClassName)&&!t.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&(!$.datepicker._inDialog||!$.blockUI)||t.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!=n)&&$.datepicker._hideDatepicker()},_adjustDate:function(e,t,n){var r=$(e),i=this._getInst(r[0]);if(this._isDisabledDatepicker(r[0]))return;this._adjustInstDate(i,t+(n=="M"?this._get(i,"showCurrentAtPos"):0),n),this._updateDatepicker(i)},_gotoToday:function(e){var t=$(e),n=this._getInst(t[0]);if(this._get(n,"gotoCurrent")&&n.currentDay)n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear;else{var r=new Date;n.selectedDay=r.getDate(),n.drawMonth=n.selectedMonth=r.getMonth(),n.drawYear=n.selectedYear=r.getFullYear()}this._notifyChange(n),this._adjustDate(t)},_selectMonthYear:function(e,t,n){var r=$(e),i=this._getInst(r[0]);i["selected"+(n=="M"?"Month":"Year")]=i["draw"+(n=="M"?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10),this._notifyChange(i),this._adjustDate(r)},_selectDay:function(e,t,n,r){var i=$(e);if($(r).hasClass(this._unselectableClass)||this._isDisabledDatepicker(i[0]))return;var s=this._getInst(i[0]);s.selectedDay=s.currentDay=$("a",r).html(),s.selectedMonth=s.currentMonth=t,s.selectedYear=s.currentYear=n,this._selectDate(e,this._formatDate(s,s.currentDay,s.currentMonth,s.currentYear))},_clearDate:function(e){var t=$(e),n=this._getInst(t[0]);this._selectDate(t,"")},_selectDate:function(e,t){var n=$(e),r=this._getInst(n[0]);t=t!=null?t:this._formatDate(r),r.input&&r.input.val(t),this._updateAlternate(r);var i=this._get(r,"onSelect");i?i.apply(r.input?r.input[0]:null,[t,r]):r.input&&r.input.trigger("change"),r.inline?this._updateDatepicker(r):(this._hideDatepicker(),this._lastInput=r.input[0],typeof r.input[0]!="object"&&r.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var t=this._get(e,"altField");if(t){var n=this._get(e,"altFormat")||this._get(e,"dateFormat"),r=this._getDate(e),i=this.formatDate(n,r,this._getFormatConfig(e));$(t).each(function(){$(this).val(i)})}},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t=new Date(e.getTime());t.setDate(t.getDate()+4-(t.getDay()||7));var n=t.getTime();return t.setMonth(0),t.setDate(1),Math.floor(Math.round((n-t)/864e5)/7)+1},parseDate:function(e,t,n){if(e==null||t==null)throw"Invalid arguments";t=typeof t=="object"?t.toString():t+"";if(t=="")return null;var r=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff;r=typeof r!="string"?r:(new Date).getFullYear()%100+parseInt(r,10);var i=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,s=(n?n.dayNames:null)||this._defaults.dayNames,o=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,u=(n?n.monthNames:null)||this._defaults.monthNames,a=-1,f=-1,l=-1,c=-1,h=!1,p=function(t){var n=y+1<e.length&&e.charAt(y+1)==t;return n&&y++,n},d=function(e){var n=p(e),r=e=="@"?14:e=="!"?20:e=="y"&&n?4:e=="o"?3:2,i=new RegExp("^\\d{1,"+r+"}"),s=t.substring(g).match(i);if(!s)throw"Missing number at position "+g;return g+=s[0].length,parseInt(s[0],10)},v=function(e,n,r){var i=$.map(p(e)?r:n,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)}),s=-1;$.each(i,function(e,n){var r=n[1];if(t.substr(g,r.length).toLowerCase()==r.toLowerCase())return s=n[0],g+=r.length,!1});if(s!=-1)return s+1;throw"Unknown name at position "+g},m=function(){if(t.charAt(g)!=e.charAt(y))throw"Unexpected literal at position "+g;g++},g=0;for(var y=0;y<e.length;y++)if(h)e.charAt(y)=="'"&&!p("'")?h=!1:m();else switch(e.charAt(y)){case"d":l=d("d");break;case"D":v("D",i,s);break;case"o":c=d("o");break;case"m":f=d("m");break;case"M":f=v("M",o,u);break;case"y":a=d("y");break;case"@":var b=new Date(d("@"));a=b.getFullYear(),f=b.getMonth()+1,l=b.getDate();break;case"!":var b=new Date((d("!")-this._ticksTo1970)/1e4);a=b.getFullYear(),f=b.getMonth()+1,l=b.getDate();break;case"'":p("'")?m():h=!0;break;default:m()}if(g<t.length){var w=t.substr(g);if(!/^\s+/.test(w))throw"Extra/unparsed characters found in date: "+w}a==-1?a=(new Date).getFullYear():a<100&&(a+=(new Date).getFullYear()-(new Date).getFullYear()%100+(a<=r?0:-100));if(c>-1){f=1,l=c;do{var E=this._getDaysInMonth(a,f-1);if(l<=E)break;f++,l-=E}while(!0)}var b=this._daylightSavingAdjust(new Date(a,f-1,l));if(b.getFullYear()!=a||b.getMonth()+1!=f||b.getDate()!=l)throw"Invalid date";return b},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*24*60*60*1e7,formatDate:function(e,t,n){if(!t)return"";var r=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,i=(n?n.dayNames:null)||this._defaults.dayNames,s=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,o=(n?n.monthNames:null)||this._defaults.monthNames,u=function(t){var n=h+1<e.length&&e.charAt(h+1)==t;return n&&h++,n},a=function(e,t,n){var r=""+t;if(u(e))while(r.length<n)r="0"+r;return r},f=function(e,t,n,r){return u(e)?r[t]:n[t]},l="",c=!1;if(t)for(var h=0;h<e.length;h++)if(c)e.charAt(h)=="'"&&!u("'")?c=!1:l+=e.charAt(h);else switch(e.charAt(h)){case"d":l+=a("d",t.getDate(),2);break;case"D":l+=f("D",t.getDay(),r,i);break;case"o":l+=a("o",Math.round(((new Date(t.getFullYear(),t.getMonth(),t.getDate())).getTime()-(new Date(t.getFullYear(),0,0)).getTime())/864e5),3);break;case"m":l+=a("m",t.getMonth()+1,2);break;case"M":l+=f("M",t.getMonth(),s,o);break;case"y":l+=u("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":l+=t.getTime();break;case"!":l+=t.getTime()*1e4+this._ticksTo1970;break;case"'":u("'")?l+="'":c=!0;break;default:l+=e.charAt(h)}return l},_possibleChars:function(e){var t="",n=!1,r=function(t){var n=i+1<e.length&&e.charAt(i+1)==t;return n&&i++,n};for(var i=0;i<e.length;i++)if(n)e.charAt(i)=="'"&&!r("'")?n=!1:t+=e.charAt(i);else switch(e.charAt(i)){case"d":case"m":case"y":case"@":t+="0123456789";break;case"D":case"M":return null;case"'":r("'")?t+="'":n=!0;break;default:t+=e.charAt(i)}return t},_get:function(e,t){return e.settings[t]!==undefined?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()==e.lastVal)return;var n=this._get(e,"dateFormat"),r=e.lastVal=e.input?e.input.val():null,i,s;i=s=this._getDefaultDate(e);var o=this._getFormatConfig(e);try{i=this.parseDate(n,r,o)||s}catch(u){this.log(u),r=t?"":r}e.selectedDay=i.getDate(),e.drawMonth=e.selectedMonth=i.getMonth(),e.drawYear=e.selectedYear=i.getFullYear(),e.currentDay=r?i.getDate():0,e.currentMonth=r?i.getMonth():0,e.currentYear=r?i.getFullYear():0,this._adjustInstDate(e)},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(e,t,n){var r=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},i=function(t){try{return $.datepicker.parseDate($.datepicker._get(e,"dateFormat"),t,$.datepicker._getFormatConfig(e))}catch(n){}var r=(t.toLowerCase().match(/^c/)?$.datepicker._getDate(e):null)||new Date,i=r.getFullYear(),s=r.getMonth(),o=r.getDate(),u=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,a=u.exec(t);while(a){switch(a[2]||"d"){case"d":case"D":o+=parseInt(a[1],10);break;case"w":case"W":o+=parseInt(a[1],10)*7;break;case"m":case"M":s+=parseInt(a[1],10),o=Math.min(o,$.datepicker._getDaysInMonth(i,s));break;case"y":case"Y":i+=parseInt(a[1],10),o=Math.min(o,$.datepicker._getDaysInMonth(i,s))}a=u.exec(t)}return new Date(i,s,o)},s=t==null||t===""?n:typeof t=="string"?i(t):typeof t=="number"?isNaN(t)?n:r(t):new Date(t.getTime());return s=s&&s.toString()=="Invalid Date"?n:s,s&&(s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0)),this._daylightSavingAdjust(s)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,n){var r=!t,i=e.selectedMonth,s=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),(i!=e.selectedMonth||s!=e.selectedYear)&&!n&&this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(r?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&e.input.val()==""?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(e){var t=this._get(e,"stepMonths"),n="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(n,-t,"M")},next:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(n,+t,"M")},hide:function(){window["DP_jQuery_"+dpuuid].datepicker._hideDatepicker()},today:function(){window["DP_jQuery_"+dpuuid].datepicker._gotoToday(n)},selectDay:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectDay(n,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(n,this,"M"),!1},selectYear:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(n,this,"Y"),!1}};$(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t=new Date;t=this._daylightSavingAdjust(new Date(t.getFullYear(),t.getMonth(),t.getDate()));var n=this._get(e,"isRTL"),r=this._get(e,"showButtonPanel"),i=this._get(e,"hideIfNoPrevNext"),s=this._get(e,"navigationAsDateFormat"),o=this._getNumberOfMonths(e),u=this._get(e,"showCurrentAtPos"),a=this._get(e,"stepMonths"),f=o[0]!=1||o[1]!=1,l=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),c=this._getMinMaxDate(e,"min"),h=this._getMinMaxDate(e,"max"),p=e.drawMonth-u,d=e.drawYear;p<0&&(p+=12,d--);if(h){var v=this._daylightSavingAdjust(new Date(h.getFullYear(),h.getMonth()-o[0]*o[1]+1,h.getDate()));v=c&&v<c?c:v;while(this._daylightSavingAdjust(new Date(d,p,1))>v)p--,p<0&&(p=11,d--)}e.drawMonth=p,e.drawYear=d;var m=this._get(e,"prevText");m=s?this.formatDate(m,this._daylightSavingAdjust(new Date(d,p-a,1)),this._getFormatConfig(e)):m;var g=this._canAdjustMonth(e,-1,d,p)?'<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click" title="'+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+m+"</span></a>":i?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+m+"</span></a>",y=this._get(e,"nextText");y=s?this.formatDate(y,this._daylightSavingAdjust(new Date(d,p+a,1)),this._getFormatConfig(e)):y;var b=this._canAdjustMonth(e,1,d,p)?'<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click" title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+y+"</span></a>":i?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+y+"</span></a>",w=this._get(e,"currentText"),E=this._get(e,"gotoCurrent")&&e.currentDay?l:t;w=s?this.formatDate(w,E,this._getFormatConfig(e)):w;var S=e.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">'+this._get(e,"closeText")+"</button>",x=r?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(n?S:"")+(this._isInRange(e,E)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click">'+w+"</button>":"")+(n?"":S)+"</div>":"",T=parseInt(this._get(e,"firstDay"),10);T=isNaN(T)?0:T;var N=this._get(e,"showWeek"),C=this._get(e,"dayNames"),k=this._get(e,"dayNamesShort"),L=this._get(e,"dayNamesMin"),A=this._get(e,"monthNames"),O=this._get(e,"monthNamesShort"),M=this._get(e,"beforeShowDay"),_=this._get(e,"showOtherMonths"),D=this._get(e,"selectOtherMonths"),P=this._get(e,"calculateWeek")||this.iso8601Week,H=this._getDefaultDate(e),B="";for(var j=0;j<o[0];j++){var F="";this.maxRows=4;for(var I=0;I<o[1];I++){var q=this._daylightSavingAdjust(new Date(d,p,e.selectedDay)),R=" ui-corner-all",U="";if(f){U+='<div class="ui-datepicker-group';if(o[1]>1)switch(I){case 0:U+=" ui-datepicker-group-first",R=" ui-corner-"+(n?"right":"left");break;case o[1]-1:U+=" ui-datepicker-group-last",R=" ui-corner-"+(n?"left":"right");break;default:U+=" ui-datepicker-group-middle",R=""}U+='">'}U+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+R+'">'+(/all|left/.test(R)&&j==0?n?b:g:"")+(/all|right/.test(R)&&j==0?n?g:b:"")+this._generateMonthYearHeader(e,p,d,c,h,j>0||I>0,A,O)+'</div><table class="ui-datepicker-calendar"><thead>'+"<tr>";var z=N?'<th class="ui-datepicker-week-col">'+this._get(e,"weekHeader")+"</th>":"";for(var W=0;W<7;W++){var X=(W+T)%7;z+="<th"+((W+T+6)%7>=5?' class="ui-datepicker-week-end"':"")+">"+'<span title="'+C[X]+'">'+L[X]+"</span></th>"}U+=z+"</tr></thead><tbody>";var V=this._getDaysInMonth(d,p);d==e.selectedYear&&p==e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,V));var J=(this._getFirstDayOfMonth(d,p)-T+7)%7,K=Math.ceil((J+V)/7),Q=f?this.maxRows>K?this.maxRows:K:K;this.maxRows=Q;var G=this._daylightSavingAdjust(new Date(d,p,1-J));for(var Y=0;Y<Q;Y++){U+="<tr>";var Z=N?'<td class="ui-datepicker-week-col">'+this._get(e,"calculateWeek")(G)+"</td>":"";for(var W=0;W<7;W++){var et=M?M.apply(e.input?e.input[0]:null,[G]):[!0,""],tt=G.getMonth()!=p,nt=tt&&!D||!et[0]||c&&G<c||h&&G>h;Z+='<td class="'+((W+T+6)%7>=5?" ui-datepicker-week-end":"")+(tt?" ui-datepicker-other-month":"")+(G.getTime()==q.getTime()&&p==e.selectedMonth&&e._keyEvent||H.getTime()==G.getTime()&&H.getTime()==q.getTime()?" "+this._dayOverClass:"")+(nt?" "+this._unselectableClass+" ui-state-disabled":"")+(tt&&!_?"":" "+et[1]+(G.getTime()==l.getTime()?" "+this._currentClass:"")+(G.getTime()==t.getTime()?" ui-datepicker-today":""))+'"'+((!tt||_)&&et[2]?' title="'+et[2]+'"':"")+(nt?"":' data-handler="selectDay" data-event="click" data-month="'+G.getMonth()+'" data-year="'+G.getFullYear()+'"')+">"+(tt&&!_?"&#xa0;":nt?'<span class="ui-state-default">'+G.getDate()+"</span>":'<a class="ui-state-default'+(G.getTime()==t.getTime()?" ui-state-highlight":"")+(G.getTime()==l.getTime()?" ui-state-active":"")+(tt?" ui-priority-secondary":"")+'" href="#">'+G.getDate()+"</a>")+"</td>",G.setDate(G.getDate()+1),G=this._daylightSavingAdjust(G)}U+=Z+"</tr>"}p++,p>11&&(p=0,d++),U+="</tbody></table>"+(f?"</div>"+(o[0]>0&&I==o[1]-1?'<div class="ui-datepicker-row-break"></div>':""):""),F+=U}B+=F}return B+=x+($.ui.ie6&&!e.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':""),e._keyEvent=!1,B},_generateMonthYearHeader:function(e,t,n,r,i,s,o,u){var a=this._get(e,"changeMonth"),f=this._get(e,"changeYear"),l=this._get(e,"showMonthAfterYear"),c='<div class="ui-datepicker-title">',h="";if(s||!a)h+='<span class="ui-datepicker-month">'+o[t]+"</span>";else{var p=r&&r.getFullYear()==n,d=i&&i.getFullYear()==n;h+='<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">';for(var v=0;v<12;v++)(!p||v>=r.getMonth())&&(!d||v<=i.getMonth())&&(h+='<option value="'+v+'"'+(v==t?' selected="selected"':"")+">"+u[v]+"</option>");h+="</select>"}l||(c+=h+(s||!a||!f?"&#xa0;":""));if(!e.yearshtml){e.yearshtml="";if(s||!f)c+='<span class="ui-datepicker-year">'+n+"</span>";else{var m=this._get(e,"yearRange").split(":"),g=(new Date).getFullYear(),y=function(e){var t=e.match(/c[+-].*/)?n+parseInt(e.substring(1),10):e.match(/[+-].*/)?g+parseInt(e,10):parseInt(e,10);return isNaN(t)?g:t},b=y(m[0]),w=Math.max(b,y(m[1]||""));b=r?Math.max(b,r.getFullYear()):b,w=i?Math.min(w,i.getFullYear()):w,e.yearshtml+='<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">';for(;b<=w;b++)e.yearshtml+='<option value="'+b+'"'+(b==n?' selected="selected"':"")+">"+b+"</option>";e.yearshtml+="</select>",c+=e.yearshtml,e.yearshtml=null}}return c+=this._get(e,"yearSuffix"),l&&(c+=(s||!a||!f?"&#xa0;":"")+h),c+="</div>",c},_adjustInstDate:function(e,t,n){var r=e.drawYear+(n=="Y"?t:0),i=e.drawMonth+(n=="M"?t:0),s=Math.min(e.selectedDay,this._getDaysInMonth(r,i))+(n=="D"?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(r,i,s)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),(n=="M"||n=="Y")&&this._notifyChange(e)},_restrictMinMax:function(e,t){var n=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max"),i=n&&t<n?n:t;return i=r&&i>r?r:i,i},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return t==null?[1,1]:typeof t=="number"?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return(new Date(e,t,1)).getDay()},_canAdjustMonth:function(e,t,n,r){var i=this._getNumberOfMonths(e),s=this._daylightSavingAdjust(new Date(n,r+(t<0?t:i[0]*i[1]),1));return t<0&&s.setDate(this._getDaysInMonth(s.getFullYear(),s.getMonth())),this._isInRange(e,s)},_isInRange:function(e,t){var n=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max");return(!n||t.getTime()>=n.getTime())&&(!r||t.getTime()<=r.getTime())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t=typeof t!="string"?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,n,r){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var i=t?typeof t=="object"?t:this._daylightSavingAdjust(new Date(r,n,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),i,this._getFormatConfig(e))}}),$.fn.datepicker=function(e){if(!this.length)return this;$.datepicker.initialized||($(document).mousedown($.datepicker._checkExternalClick).find(document.body).append($.datepicker.dpDiv),$.datepicker.initialized=!0);var t=Array.prototype.slice.call(arguments,1);return typeof e!="string"||e!="isDisabled"&&e!="getDate"&&e!="widget"?e=="option"&&arguments.length==2&&typeof arguments[1]=="string"?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t)):this.each(function(){typeof e=="string"?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this].concat(t)):$.datepicker._attachDatepicker(this,e)}):$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t))},$.datepicker=new Datepicker,$.datepicker.initialized=!1,$.datepicker.uuid=(new Date).getTime(),$.datepicker.version="1.9.1",window["DP_jQuery_"+dpuuid]=$})(jQuery);(function(e,t){var n=!1;e.widget("ui.menu",{version:"1.9.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(t){var r=e(t.target).closest(".ui-menu-item");!n&&r.not(".ui-state-disabled").length&&(n=!0,this.select(t),r.has(".ui-menu").length?this.expand(t):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&this.active.parents(".ui-menu").length===1&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){var n=e(t.currentTarget);n.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,n)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var n=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,n)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){e(t.target).closest(".ui-menu").length||this.collapseAll(t),n=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){function a(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var n,r,i,s,o,u=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:u=!1,r=this.previousFilter||"",i=String.fromCharCode(t.keyCode),s=!1,clearTimeout(this.filterTimer),i===r?s=!0:i=r+i,o=new RegExp("^"+a(i),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(e(this).children("a").text())}),n=s&&n.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):n,n.length||(i=String.fromCharCode(t.keyCode),o=new RegExp("^"+a(i),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return o.test(e(this).children("a").text())})),n.length?(this.focus(t,n),n.length>1?(this.previousFilter=i,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}u&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,n=this.options.icons.submenu,r=this.element.find(this.options.menus+":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"});t=r.add(this.element),t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each(function(){var t=e(this);/[^\-—–\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider")}),t.children(".ui-state-disabled").attr("aria-disabled","true"),r.each(function(){var t=e(this),r=t.prev("a"),i=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);r.attr("aria-haspopup","true").prepend(i),t.attr("aria-labelledby",r.attr("id"))}),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},focus:function(e,t){var n,r;this.blur(e,e&&e.type==="focus"),this._scrollIntoView(t),this.active=t.first(),r=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",r.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&e.type==="keydown"?this._close():this.timer=this._delay(function(){this._close()},this.delay),n=t.children(".ui-menu"),n.length&&/^mouse/.test(e.type)&&this._startOpening(n),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var n,r,i,s,o,u;this._hasScroll()&&(n=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,r=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,i=t.offset().top-this.activeMenu.offset().top-n-r,s=this.activeMenu.scrollTop(),o=this.activeMenu.height(),u=t.height(),i<0?this.activeMenu.scrollTop(s+i):i+u>o&&this.activeMenu.scrollTop(s+i-o+u))},blur:function(e,t){t||clearTimeout(this.timer);if(!this.active)return;this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active})},_startOpening:function(e){clearTimeout(this.timer);if(e.attr("aria-hidden")!=="true")return;this.timer=this._delay(function(){this._close(),this._open(e)},this.delay)},_open:function(t){var n=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(n)},collapseAll:function(t,n){clearTimeout(this.timer),this.timer=this._delay(function(){var r=n?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));r.length||(r=this.element),this._close(r),this.blur(t),this.activeMenu=r},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,n){var r;this.active&&(e==="first"||e==="last"?r=this.active[e==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1):r=this.active[e+"All"](".ui-menu-item").eq(0));if(!r||!r.length||!this.active)r=this.activeMenu.children(".ui-menu-item")[t]();this.focus(n,r)},nextPage:function(t){var n,r,i;if(!this.active){this.next(t);return}if(this.isLastItem())return;this._hasScroll()?(r=this.active.offset().top,i=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-r-i<0}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())},previousPage:function(t){var n,r,i;if(!this.active){this.next(t);return}if(this.isFirstItem())return;this._hasScroll()?(r=this.active.offset().top,i=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-r+i>0}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item").first())},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var n={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,n)}})})(jQuery);(function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.9.1",widgetEventPrefix:"slidez",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var t,r,i=this.options,s=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",u=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(i.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),i.range&&(i.range===!0&&(i.values||(i.values=[this._valueMin(),this._valueMin()]),i.values.length&&i.values.length!==2&&(i.values=[i.values[0],i.values[0]])),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(i.range==="min"||i.range==="max"?" ui-slider-range-"+i.range:""))),r=i.values&&i.values.length||1;for(t=s.length;t<r;t++)u.push(o);this.handles=s.add(e(u.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){i.disabled||e(this).addClass("ui-state-hover")}).mouseleave(function(){e(this).removeClass("ui-state-hover")}).focus(function(){i.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)}),this._on(this.handles,{keydown:function(t){var r,i,s,o,u=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:t.preventDefault();if(!this._keySliding){this._keySliding=!0,e(t.target).addClass("ui-state-active"),r=this._start(t,u);if(r===!1)return}}o=this.options.step,this.options.values&&this.options.values.length?i=s=this.values(u):i=s=this.value();switch(t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-o)}this._slide(t,u,s)},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(n),i=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(r-l.values(t));i>n&&(i=n,s=e(this),o=t)}),c.range===!0&&this.values(1)===c.min&&(o+=1,s=e(this.handles[o])),u=this._start(t,o),u===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,s.addClass("ui-state-active").focus(),a=s.offset(),f=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),this.orientation==="vertical"&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t);return}if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();r=this.options.values,i=arguments[0];for(s=0;s<r.length;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"disabled":n?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(r=0;r<i;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e),e},_values:function(e){var t,n,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t),t;n=this.options.values.slice();for(r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(n[r]);return n},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;return Math.abs(n)*2>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(r){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100,l[a.orientation==="horizontal"?"left":"bottom"]=n+"%",e(this).stop(1,1)[f?"animate":"css"](l,u.animate),a.options.range===!0&&(a.orientation==="horizontal"?(r===0&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(r===0&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate}))),t=n}):(r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?(r-i)/(s-i)*100:0,l[this.orientation==="horizontal"?"left":"bottom"]=n+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),o==="max"&&this.orientation==="horizontal"&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),o==="max"&&this.orientation==="vertical"&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate}))}})})(jQuery);

/*********************/
/****** 	jquery.ui.datepicker-uk.min.js	 ***********/
/*********************/
/*! jQuery UI - v1.10.3 - 2013-05-03 os
 * http://jqueryui.com
 * Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */
jQuery(function(e){e.datepicker.regional.uk={closeText:"Закрити",prevText:"&#x3c;Поп",nextText:"Наст&#x3e;",currentText:"Сьогодні",monthNames:["Січень","Лютий","Березень","Квітень","Травень","Червень","Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"],monthNamesShort:["січ","лют","бер","квіт","трав","черв","лип","серп","вер","жовт","лист","груд"],dayNames:["неділя","понеділок","вівторок","среда","четвер","п`ятница","субота"],dayNamesMin:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],dayNamesShort:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Ти",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.setDefaults(e.datepicker.regional.uk)});

/*********************/
/****** 	jquery.ui.datepicker-ru.min.js	 ***********/
/*********************/
/*! jQuery UI - v1.10.3 - 2013-05-03 os
* http://jqueryui.com
* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */
jQuery(function(e){e.datepicker.regional.ru={closeText:"Закрыть",prevText:"&#x3C;Пред",nextText:"След&#x3E;",currentText:"Сегодня",monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],dayNamesShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Нед",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.setDefaults(e.datepicker.regional.ru)});


/*********************/
/****** 	jquery.cookie.js	 ***********/
/*********************/
/*!
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function ($, document, undefined) {

    var pluses = /\+/g;

    function raw(s) {
        return s;
    }

    function decoded(s) {
        return unRfc2068(decodeURIComponent(s.replace(pluses, ' ')));
    }

    function unRfc2068(value) {
        if (value.indexOf('"') === 0) {
            // This is a quoted cookie as according to RFC2068, unescape
            value = value.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
        }
        return value;
    }

    function fromJSON(value) {
        return config.json ? JSON.parse(value) : value;
    }

    var config = $.cookie = function (key, value, options) {

        // write
        if (value !== undefined) {
            options = $.extend({}, config.defaults, options);

            if (value === null) {
                options.expires = -1;
            }

            if (typeof options.expires === 'number') {
                var days = options.expires, t = options.expires = new Date();
                t.setDate(t.getDate() + days);
            }

            value = config.json ? JSON.stringify(value) : String(value);

            return (document.cookie = [
                encodeURIComponent(key), '=', config.raw ? value : encodeURIComponent(value),
                options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
                options.path    ? '; path=' + options.path : '',
                options.domain  ? '; domain=' + options.domain : '',
                options.secure  ? '; secure' : ''
            ].join(''));
        }

        // read
        var decode = config.raw ? raw : decoded;
        var cookies = document.cookie.split('; ');
        var result = key ? null : {};
        for (var i = 0, l = cookies.length; i < l; i++) {
            var parts = cookies[i].split('=');
            var name = decode(parts.shift());
            var cookie = decode(parts.join('='));

            if (key && key === name) {
                result = fromJSON(cookie);
                break;
            }

            if (!key) {
                result[name] = fromJSON(cookie);
            }
        }

        return result;
    };

    config.defaults = {};

    $.removeCookie = function (key, options) {
        if ($.cookie(key) !== null) {
            $.cookie(key, null, options);
            return true;
        }
        return false;
    };

})(jQuery, document);


/*********************/
/****** 	owl.carousel.min.js	 ***********/
/*********************/
/**
 * Owl Carousel v2.2.1
 * Copyright 2013-2017 David Deutsch
 * Licensed under  ()
 */
!function(a,b,c,d){function e(b,c){this.settings=null,this.options=a.extend({},e.Defaults,c),this.$element=a(b),this._handlers={},this._plugins={},this._supress={},this._current=null,this._speed=null,this._coordinates=[],this._breakpoint=null,this._width=null,this._items=[],this._clones=[],this._mergers=[],this._widths=[],this._invalidated={},this._pipe=[],this._drag={time:null,target:null,pointer:null,stage:{start:null,current:null},direction:null},this._states={current:{},tags:{initializing:["busy"],animating:["busy"],dragging:["interacting"]}},a.each(["onResize","onThrottledResize"],a.proxy(function(b,c){this._handlers[c]=a.proxy(this[c],this)},this)),a.each(e.Plugins,a.proxy(function(a,b){this._plugins[a.charAt(0).toLowerCase()+a.slice(1)]=new b(this)},this)),a.each(e.Workers,a.proxy(function(b,c){this._pipe.push({filter:c.filter,run:a.proxy(c.run,this)})},this)),this.setup(),this.initialize()}e.Defaults={items:3,loop:!1,center:!1,rewind:!1,mouseDrag:!0,touchDrag:!0,pullDrag:!0,freeDrag:!1,margin:0,stagePadding:0,merge:!1,mergeFit:!0,autoWidth:!1,startPosition:0,rtl:!1,smartSpeed:250,fluidSpeed:!1,dragEndSpeed:!1,responsive:{},responsiveRefreshRate:200,responsiveBaseElement:b,fallbackEasing:"swing",info:!1,nestedItemSelector:!1,itemElement:"div",stageElement:"div",refreshClass:"owl-refresh",loadedClass:"owl-loaded",loadingClass:"owl-loading",rtlClass:"owl-rtl",responsiveClass:"owl-responsive",dragClass:"owl-drag",itemClass:"owl-item",stageClass:"owl-stage",stageOuterClass:"owl-stage-outer",grabClass:"owl-grab"},e.Width={Default:"default",Inner:"inner",Outer:"outer"},e.Type={Event:"event",State:"state"},e.Plugins={},e.Workers=[{filter:["width","settings"],run:function(){this._width=this.$element.width()}},{filter:["width","items","settings"],run:function(a){a.current=this._items&&this._items[this.relative(this._current)]}},{filter:["items","settings"],run:function(){this.$stage.children(".cloned").remove()}},{filter:["width","items","settings"],run:function(a){var b=this.settings.margin||"",c=!this.settings.autoWidth,d=this.settings.rtl,e={width:"auto","margin-left":d?b:"","margin-right":d?"":b};!c&&this.$stage.children().css(e),a.css=e}},{filter:["width","items","settings"],run:function(a){var b=(this.width()/this.settings.items).toFixed(3)-this.settings.margin,c=null,d=this._items.length,e=!this.settings.autoWidth,f=[];for(a.items={merge:!1,width:b};d--;)c=this._mergers[d],c=this.settings.mergeFit&&Math.min(c,this.settings.items)||c,a.items.merge=c>1||a.items.merge,f[d]=e?b*c:this._items[d].width();this._widths=f}},{filter:["items","settings"],run:function(){var b=[],c=this._items,d=this.settings,e=Math.max(2*d.items,4),f=2*Math.ceil(c.length/2),g=d.loop&&c.length?d.rewind?e:Math.max(e,f):0,h="",i="";for(g/=2;g--;)b.push(this.normalize(b.length/2,!0)),h+=c[b[b.length-1]][0].outerHTML,b.push(this.normalize(c.length-1-(b.length-1)/2,!0)),i=c[b[b.length-1]][0].outerHTML+i;this._clones=b,a(h).addClass("cloned").appendTo(this.$stage),a(i).addClass("cloned").prependTo(this.$stage)}},{filter:["width","items","settings"],run:function(){for(var a=this.settings.rtl?1:-1,b=this._clones.length+this._items.length,c=-1,d=0,e=0,f=[];++c<b;)d=f[c-1]||0,e=this._widths[this.relative(c)]+this.settings.margin,f.push(d+e*a);this._coordinates=f}},{filter:["width","items","settings"],run:function(){var a=this.settings.stagePadding,b=this._coordinates,c={width:Math.ceil(Math.abs(b[b.length-1]))+2*a,"padding-left":a||"","padding-right":a||""};this.$stage.css(c)}},{filter:["width","items","settings"],run:function(a){var b=this._coordinates.length,c=!this.settings.autoWidth,d=this.$stage.children();if(c&&a.items.merge)for(;b--;)a.css.width=this._widths[this.relative(b)],d.eq(b).css(a.css);else c&&(a.css.width=a.items.width,d.css(a.css))}},{filter:["items"],run:function(){this._coordinates.length<1&&this.$stage.removeAttr("style")}},{filter:["width","items","settings"],run:function(a){a.current=a.current?this.$stage.children().index(a.current):0,a.current=Math.max(this.minimum(),Math.min(this.maximum(),a.current)),this.reset(a.current)}},{filter:["position"],run:function(){this.animate(this.coordinates(this._current))}},{filter:["width","position","items","settings"],run:function(){var a,b,c,d,e=this.settings.rtl?1:-1,f=2*this.settings.stagePadding,g=this.coordinates(this.current())+f,h=g+this.width()*e,i=[];for(c=0,d=this._coordinates.length;c<d;c++)a=this._coordinates[c-1]||0,b=Math.abs(this._coordinates[c])+f*e,(this.op(a,"<=",g)&&this.op(a,">",h)||this.op(b,"<",g)&&this.op(b,">",h))&&i.push(c);this.$stage.children(".active").removeClass("active"),this.$stage.children(":eq("+i.join("), :eq(")+")").addClass("active"),this.settings.center&&(this.$stage.children(".center").removeClass("center"),this.$stage.children().eq(this.current()).addClass("center"))}}],e.prototype.initialize=function(){if(this.enter("initializing"),this.trigger("initialize"),this.$element.toggleClass(this.settings.rtlClass,this.settings.rtl),this.settings.autoWidth&&!this.is("pre-loading")){var b,c,e;b=this.$element.find("img"),c=this.settings.nestedItemSelector?"."+this.settings.nestedItemSelector:d,e=this.$element.children(c).width(),b.length&&e<=0&&this.preloadAutoWidthImages(b)}this.$element.addClass(this.options.loadingClass),this.$stage=a("<"+this.settings.stageElement+' class="'+this.settings.stageClass+'"/>').wrap('<div class="'+this.settings.stageOuterClass+'"/>'),this.$element.append(this.$stage.parent()),this.replace(this.$element.children().not(this.$stage.parent())),this.$element.is(":visible")?this.refresh():this.invalidate("width"),this.$element.removeClass(this.options.loadingClass).addClass(this.options.loadedClass),this.registerEventHandlers(),this.leave("initializing"),this.trigger("initialized")},e.prototype.setup=function(){var b=this.viewport(),c=this.options.responsive,d=-1,e=null;c?(a.each(c,function(a){a<=b&&a>d&&(d=Number(a))}),e=a.extend({},this.options,c[d]),"function"==typeof e.stagePadding&&(e.stagePadding=e.stagePadding()),delete e.responsive,e.responsiveClass&&this.$element.attr("class",this.$element.attr("class").replace(new RegExp("("+this.options.responsiveClass+"-)\\S+\\s","g"),"$1"+d))):e=a.extend({},this.options),this.trigger("change",{property:{name:"settings",value:e}}),this._breakpoint=d,this.settings=e,this.invalidate("settings"),this.trigger("changed",{property:{name:"settings",value:this.settings}})},e.prototype.optionsLogic=function(){this.settings.autoWidth&&(this.settings.stagePadding=!1,this.settings.merge=!1)},e.prototype.prepare=function(b){var c=this.trigger("prepare",{content:b});return c.data||(c.data=a("<"+this.settings.itemElement+"/>").addClass(this.options.itemClass).append(b)),this.trigger("prepared",{content:c.data}),c.data},e.prototype.update=function(){for(var b=0,c=this._pipe.length,d=a.proxy(function(a){return this[a]},this._invalidated),e={};b<c;)(this._invalidated.all||a.grep(this._pipe[b].filter,d).length>0)&&this._pipe[b].run(e),b++;this._invalidated={},!this.is("valid")&&this.enter("valid")},e.prototype.width=function(a){switch(a=a||e.Width.Default){case e.Width.Inner:case e.Width.Outer:return this._width;default:return this._width-2*this.settings.stagePadding+this.settings.margin}},e.prototype.refresh=function(){this.enter("refreshing"),this.trigger("refresh"),this.setup(),this.optionsLogic(),this.$element.addClass(this.options.refreshClass),this.update(),this.$element.removeClass(this.options.refreshClass),this.leave("refreshing"),this.trigger("refreshed")},e.prototype.onThrottledResize=function(){b.clearTimeout(this.resizeTimer),this.resizeTimer=b.setTimeout(this._handlers.onResize,this.settings.responsiveRefreshRate)},e.prototype.onResize=function(){return!!this._items.length&&(this._width!==this.$element.width()&&(!!this.$element.is(":visible")&&(this.enter("resizing"),this.trigger("resize").isDefaultPrevented()?(this.leave("resizing"),!1):(this.invalidate("width"),this.refresh(),this.leave("resizing"),void this.trigger("resized")))))},e.prototype.registerEventHandlers=function(){a.support.transition&&this.$stage.on(a.support.transition.end+".owl.core",a.proxy(this.onTransitionEnd,this)),this.settings.responsive!==!1&&this.on(b,"resize",this._handlers.onThrottledResize),this.settings.mouseDrag&&(this.$element.addClass(this.options.dragClass),this.$stage.on("mousedown.owl.core",a.proxy(this.onDragStart,this)),this.$stage.on("dragstart.owl.core selectstart.owl.core",function(){return!1})),this.settings.touchDrag&&(this.$stage.on("touchstart.owl.core",a.proxy(this.onDragStart,this)),this.$stage.on("touchcancel.owl.core",a.proxy(this.onDragEnd,this)))},e.prototype.onDragStart=function(b){var d=null;3!==b.which&&(a.support.transform?(d=this.$stage.css("transform").replace(/.*\(|\)| /g,"").split(","),d={x:d[16===d.length?12:4],y:d[16===d.length?13:5]}):(d=this.$stage.position(),d={x:this.settings.rtl?d.left+this.$stage.width()-this.width()+this.settings.margin:d.left,y:d.top}),this.is("animating")&&(a.support.transform?this.animate(d.x):this.$stage.stop(),this.invalidate("position")),this.$element.toggleClass(this.options.grabClass,"mousedown"===b.type),this.speed(0),this._drag.time=(new Date).getTime(),this._drag.target=a(b.target),this._drag.stage.start=d,this._drag.stage.current=d,this._drag.pointer=this.pointer(b),a(c).on("mouseup.owl.core touchend.owl.core",a.proxy(this.onDragEnd,this)),a(c).one("mousemove.owl.core touchmove.owl.core",a.proxy(function(b){var d=this.difference(this._drag.pointer,this.pointer(b));a(c).on("mousemove.owl.core touchmove.owl.core",a.proxy(this.onDragMove,this)),Math.abs(d.x)<Math.abs(d.y)&&this.is("valid")||(b.preventDefault(),this.enter("dragging"),this.trigger("drag"))},this)))},e.prototype.onDragMove=function(a){var b=null,c=null,d=null,e=this.difference(this._drag.pointer,this.pointer(a)),f=this.difference(this._drag.stage.start,e);this.is("dragging")&&(a.preventDefault(),this.settings.loop?(b=this.coordinates(this.minimum()),c=this.coordinates(this.maximum()+1)-b,f.x=((f.x-b)%c+c)%c+b):(b=this.settings.rtl?this.coordinates(this.maximum()):this.coordinates(this.minimum()),c=this.settings.rtl?this.coordinates(this.minimum()):this.coordinates(this.maximum()),d=this.settings.pullDrag?-1*e.x/5:0,f.x=Math.max(Math.min(f.x,b+d),c+d)),this._drag.stage.current=f,this.animate(f.x))},e.prototype.onDragEnd=function(b){var d=this.difference(this._drag.pointer,this.pointer(b)),e=this._drag.stage.current,f=d.x>0^this.settings.rtl?"left":"right";a(c).off(".owl.core"),this.$element.removeClass(this.options.grabClass),(0!==d.x&&this.is("dragging")||!this.is("valid"))&&(this.speed(this.settings.dragEndSpeed||this.settings.smartSpeed),this.current(this.closest(e.x,0!==d.x?f:this._drag.direction)),this.invalidate("position"),this.update(),this._drag.direction=f,(Math.abs(d.x)>3||(new Date).getTime()-this._drag.time>300)&&this._drag.target.one("click.owl.core",function(){return!1})),this.is("dragging")&&(this.leave("dragging"),this.trigger("dragged"))},e.prototype.closest=function(b,c){var d=-1,e=30,f=this.width(),g=this.coordinates();return this.settings.freeDrag||a.each(g,a.proxy(function(a,h){return"left"===c&&b>h-e&&b<h+e?d=a:"right"===c&&b>h-f-e&&b<h-f+e?d=a+1:this.op(b,"<",h)&&this.op(b,">",g[a+1]||h-f)&&(d="left"===c?a+1:a),d===-1},this)),this.settings.loop||(this.op(b,">",g[this.minimum()])?d=b=this.minimum():this.op(b,"<",g[this.maximum()])&&(d=b=this.maximum())),d},e.prototype.animate=function(b){var c=this.speed()>0;this.is("animating")&&this.onTransitionEnd(),c&&(this.enter("animating"),this.trigger("translate")),a.support.transform3d&&a.support.transition?this.$stage.css({transform:"translate3d("+b+"px,0px,0px)",transition:this.speed()/1e3+"s"}):c?this.$stage.animate({left:b+"px"},this.speed(),this.settings.fallbackEasing,a.proxy(this.onTransitionEnd,this)):this.$stage.css({left:b+"px"})},e.prototype.is=function(a){return this._states.current[a]&&this._states.current[a]>0},e.prototype.current=function(a){if(a===d)return this._current;if(0===this._items.length)return d;if(a=this.normalize(a),this._current!==a){var b=this.trigger("change",{property:{name:"position",value:a}});b.data!==d&&(a=this.normalize(b.data)),this._current=a,this.invalidate("position"),this.trigger("changed",{property:{name:"position",value:this._current}})}return this._current},e.prototype.invalidate=function(b){return"string"===a.type(b)&&(this._invalidated[b]=!0,this.is("valid")&&this.leave("valid")),a.map(this._invalidated,function(a,b){return b})},e.prototype.reset=function(a){a=this.normalize(a),a!==d&&(this._speed=0,this._current=a,this.suppress(["translate","translated"]),this.animate(this.coordinates(a)),this.release(["translate","translated"]))},e.prototype.normalize=function(a,b){var c=this._items.length,e=b?0:this._clones.length;return!this.isNumeric(a)||c<1?a=d:(a<0||a>=c+e)&&(a=((a-e/2)%c+c)%c+e/2),a},e.prototype.relative=function(a){return a-=this._clones.length/2,this.normalize(a,!0)},e.prototype.maximum=function(a){var b,c,d,e=this.settings,f=this._coordinates.length;if(e.loop)f=this._clones.length/2+this._items.length-1;else if(e.autoWidth||e.merge){for(b=this._items.length,c=this._items[--b].width(),d=this.$element.width();b--&&(c+=this._items[b].width()+this.settings.margin,!(c>d)););f=b+1}else f=e.center?this._items.length-1:this._items.length-e.items;return a&&(f-=this._clones.length/2),Math.max(f,0)},e.prototype.minimum=function(a){return a?0:this._clones.length/2},e.prototype.items=function(a){return a===d?this._items.slice():(a=this.normalize(a,!0),this._items[a])},e.prototype.mergers=function(a){return a===d?this._mergers.slice():(a=this.normalize(a,!0),this._mergers[a])},e.prototype.clones=function(b){var c=this._clones.length/2,e=c+this._items.length,f=function(a){return a%2===0?e+a/2:c-(a+1)/2};return b===d?a.map(this._clones,function(a,b){return f(b)}):a.map(this._clones,function(a,c){return a===b?f(c):null})},e.prototype.speed=function(a){return a!==d&&(this._speed=a),this._speed},e.prototype.coordinates=function(b){var c,e=1,f=b-1;return b===d?a.map(this._coordinates,a.proxy(function(a,b){return this.coordinates(b)},this)):(this.settings.center?(this.settings.rtl&&(e=-1,f=b+1),c=this._coordinates[b],c+=(this.width()-c+(this._coordinates[f]||0))/2*e):c=this._coordinates[f]||0,c=Math.ceil(c))},e.prototype.duration=function(a,b,c){return 0===c?0:Math.min(Math.max(Math.abs(b-a),1),6)*Math.abs(c||this.settings.smartSpeed)},e.prototype.to=function(a,b){var c=this.current(),d=null,e=a-this.relative(c),f=(e>0)-(e<0),g=this._items.length,h=this.minimum(),i=this.maximum();this.settings.loop?(!this.settings.rewind&&Math.abs(e)>g/2&&(e+=f*-1*g),a=c+e,d=((a-h)%g+g)%g+h,d!==a&&d-e<=i&&d-e>0&&(c=d-e,a=d,this.reset(c))):this.settings.rewind?(i+=1,a=(a%i+i)%i):a=Math.max(h,Math.min(i,a)),this.speed(this.duration(c,a,b)),this.current(a),this.$element.is(":visible")&&this.update()},e.prototype.next=function(a){a=a||!1,this.to(this.relative(this.current())+1,a)},e.prototype.prev=function(a){a=a||!1,this.to(this.relative(this.current())-1,a)},e.prototype.onTransitionEnd=function(a){if(a!==d&&(a.stopPropagation(),(a.target||a.srcElement||a.originalTarget)!==this.$stage.get(0)))return!1;this.leave("animating"),this.trigger("translated")},e.prototype.viewport=function(){var d;return this.options.responsiveBaseElement!==b?d=a(this.options.responsiveBaseElement).width():b.innerWidth?d=b.innerWidth:c.documentElement&&c.documentElement.clientWidth?d=c.documentElement.clientWidth:console.warn("Can not detect viewport width."),d},e.prototype.replace=function(b){this.$stage.empty(),this._items=[],b&&(b=b instanceof jQuery?b:a(b)),this.settings.nestedItemSelector&&(b=b.find("."+this.settings.nestedItemSelector)),b.filter(function(){return 1===this.nodeType}).each(a.proxy(function(a,b){b=this.prepare(b),this.$stage.append(b),this._items.push(b),this._mergers.push(1*b.find("[data-merge]").addBack("[data-merge]").attr("data-merge")||1)},this)),this.reset(this.isNumeric(this.settings.startPosition)?this.settings.startPosition:0),this.invalidate("items")},e.prototype.add=function(b,c){var e=this.relative(this._current);c=c===d?this._items.length:this.normalize(c,!0),b=b instanceof jQuery?b:a(b),this.trigger("add",{content:b,position:c}),b=this.prepare(b),0===this._items.length||c===this._items.length?(0===this._items.length&&this.$stage.append(b),0!==this._items.length&&this._items[c-1].after(b),this._items.push(b),this._mergers.push(1*b.find("[data-merge]").addBack("[data-merge]").attr("data-merge")||1)):(this._items[c].before(b),this._items.splice(c,0,b),this._mergers.splice(c,0,1*b.find("[data-merge]").addBack("[data-merge]").attr("data-merge")||1)),this._items[e]&&this.reset(this._items[e].index()),this.invalidate("items"),this.trigger("added",{content:b,position:c})},e.prototype.remove=function(a){a=this.normalize(a,!0),a!==d&&(this.trigger("remove",{content:this._items[a],position:a}),this._items[a].remove(),this._items.splice(a,1),this._mergers.splice(a,1),this.invalidate("items"),this.trigger("removed",{content:null,position:a}))},e.prototype.preloadAutoWidthImages=function(b){b.each(a.proxy(function(b,c){this.enter("pre-loading"),c=a(c),a(new Image).one("load",a.proxy(function(a){c.attr("src",a.target.src),c.css("opacity",1),this.leave("pre-loading"),!this.is("pre-loading")&&!this.is("initializing")&&this.refresh()},this)).attr("src",c.attr("src")||c.attr("data-src")||c.attr("data-src-retina"))},this))},e.prototype.destroy=function(){this.$element.off(".owl.core"),this.$stage.off(".owl.core"),a(c).off(".owl.core"),this.settings.responsive!==!1&&(b.clearTimeout(this.resizeTimer),this.off(b,"resize",this._handlers.onThrottledResize));for(var d in this._plugins)this._plugins[d].destroy();this.$stage.children(".cloned").remove(),this.$stage.unwrap(),this.$stage.children().contents().unwrap(),this.$stage.children().unwrap(),this.$element.removeClass(this.options.refreshClass).removeClass(this.options.loadingClass).removeClass(this.options.loadedClass).removeClass(this.options.rtlClass).removeClass(this.options.dragClass).removeClass(this.options.grabClass).attr("class",this.$element.attr("class").replace(new RegExp(this.options.responsiveClass+"-\\S+\\s","g"),"")).removeData("owl.carousel")},e.prototype.op=function(a,b,c){var d=this.settings.rtl;switch(b){case"<":return d?a>c:a<c;case">":return d?a<c:a>c;case">=":return d?a<=c:a>=c;case"<=":return d?a>=c:a<=c}},e.prototype.on=function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c)},e.prototype.off=function(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent("on"+b,c)},e.prototype.trigger=function(b,c,d,f,g){var h={item:{count:this._items.length,index:this.current()}},i=a.camelCase(a.grep(["on",b,d],function(a){return a}).join("-").toLowerCase()),j=a.Event([b,"owl",d||"carousel"].join(".").toLowerCase(),a.extend({relatedTarget:this},h,c));return this._supress[b]||(a.each(this._plugins,function(a,b){b.onTrigger&&b.onTrigger(j)}),this.register({type:e.Type.Event,name:b}),this.$element.trigger(j),this.settings&&"function"==typeof this.settings[i]&&this.settings[i].call(this,j)),j},e.prototype.enter=function(b){a.each([b].concat(this._states.tags[b]||[]),a.proxy(function(a,b){this._states.current[b]===d&&(this._states.current[b]=0),this._states.current[b]++},this))},e.prototype.leave=function(b){a.each([b].concat(this._states.tags[b]||[]),a.proxy(function(a,b){this._states.current[b]--},this))},e.prototype.register=function(b){if(b.type===e.Type.Event){if(a.event.special[b.name]||(a.event.special[b.name]={}),!a.event.special[b.name].owl){var c=a.event.special[b.name]._default;a.event.special[b.name]._default=function(a){return!c||!c.apply||a.namespace&&a.namespace.indexOf("owl")!==-1?a.namespace&&a.namespace.indexOf("owl")>-1:c.apply(this,arguments)},a.event.special[b.name].owl=!0}}else b.type===e.Type.State&&(this._states.tags[b.name]?this._states.tags[b.name]=this._states.tags[b.name].concat(b.tags):this._states.tags[b.name]=b.tags,this._states.tags[b.name]=a.grep(this._states.tags[b.name],a.proxy(function(c,d){return a.inArray(c,this._states.tags[b.name])===d},this)))},e.prototype.suppress=function(b){a.each(b,a.proxy(function(a,b){this._supress[b]=!0},this))},e.prototype.release=function(b){a.each(b,a.proxy(function(a,b){delete this._supress[b]},this))},e.prototype.pointer=function(a){var c={x:null,y:null};return a=a.originalEvent||a||b.event,a=a.touches&&a.touches.length?a.touches[0]:a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:a,a.pageX?(c.x=a.pageX,c.y=a.pageY):(c.x=a.clientX,c.y=a.clientY),c},e.prototype.isNumeric=function(a){return!isNaN(parseFloat(a))},e.prototype.difference=function(a,b){return{x:a.x-b.x,y:a.y-b.y}},a.fn.owlCarousel=function(b){var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=a(this),f=d.data("owl.carousel");f||(f=new e(this,"object"==typeof b&&b),d.data("owl.carousel",f),a.each(["next","prev","to","destroy","refresh","replace","add","remove"],function(b,c){f.register({type:e.Type.Event,name:c}),f.$element.on(c+".owl.carousel.core",a.proxy(function(a){a.namespace&&a.relatedTarget!==this&&(this.suppress([c]),f[c].apply(this,[].slice.call(arguments,1)),this.release([c]))},f))})),"string"==typeof b&&"_"!==b.charAt(0)&&f[b].apply(f,c)})},a.fn.owlCarousel.Constructor=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function(b){this._core=b,this._interval=null,this._visible=null,this._handlers={"initialized.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.autoRefresh&&this.watch()},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this._core.$element.on(this._handlers)};e.Defaults={autoRefresh:!0,autoRefreshInterval:500},e.prototype.watch=function(){this._interval||(this._visible=this._core.$element.is(":visible"),this._interval=b.setInterval(a.proxy(this.refresh,this),this._core.settings.autoRefreshInterval))},e.prototype.refresh=function(){this._core.$element.is(":visible")!==this._visible&&(this._visible=!this._visible,this._core.$element.toggleClass("owl-hidden",!this._visible),this._visible&&this._core.invalidate("width")&&this._core.refresh())},e.prototype.destroy=function(){var a,c;b.clearInterval(this._interval);for(a in this._handlers)this._core.$element.off(a,this._handlers[a]);for(c in Object.getOwnPropertyNames(this))"function"!=typeof this[c]&&(this[c]=null)},a.fn.owlCarousel.Constructor.Plugins.AutoRefresh=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function(b){this._core=b,this._loaded=[],this._handlers={"initialized.owl.carousel change.owl.carousel resized.owl.carousel":a.proxy(function(b){if(b.namespace&&this._core.settings&&this._core.settings.lazyLoad&&(b.property&&"position"==b.property.name||"initialized"==b.type))for(var c=this._core.settings,e=c.center&&Math.ceil(c.items/2)||c.items,f=c.center&&e*-1||0,g=(b.property&&b.property.value!==d?b.property.value:this._core.current())+f,h=this._core.clones().length,i=a.proxy(function(a,b){this.load(b)},this);f++<e;)this.load(h/2+this._core.relative(g)),h&&a.each(this._core.clones(this._core.relative(g)),i),g++},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this._core.$element.on(this._handlers)};e.Defaults={lazyLoad:!1},e.prototype.load=function(c){var d=this._core.$stage.children().eq(c),e=d&&d.find(".owl-lazy");!e||a.inArray(d.get(0),this._loaded)>-1||(e.each(a.proxy(function(c,d){var e,f=a(d),g=b.devicePixelRatio>1&&f.attr("data-src-retina")||f.attr("data-src");this._core.trigger("load",{element:f,url:g},"lazy"),f.is("img")?f.one("load.owl.lazy",a.proxy(function(){f.css("opacity",1),this._core.trigger("loaded",{element:f,url:g},"lazy")},this)).attr("src",g):(e=new Image,e.onload=a.proxy(function(){f.css({"background-image":'url("'+g+'")',opacity:"1"}),this._core.trigger("loaded",{element:f,url:g},"lazy")},this),e.src=g)},this)),this._loaded.push(d.get(0)))},e.prototype.destroy=function(){var a,b;for(a in this.handlers)this._core.$element.off(a,this.handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.Lazy=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function(b){this._core=b,this._handlers={"initialized.owl.carousel refreshed.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.autoHeight&&this.update()},this),"changed.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.autoHeight&&"position"==a.property.name&&this.update()},this),"loaded.owl.lazy":a.proxy(function(a){a.namespace&&this._core.settings.autoHeight&&a.element.closest("."+this._core.settings.itemClass).index()===this._core.current()&&this.update()},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this._core.$element.on(this._handlers)};e.Defaults={autoHeight:!1,autoHeightClass:"owl-height"},e.prototype.update=function(){var b=this._core._current,c=b+this._core.settings.items,d=this._core.$stage.children().toArray().slice(b,c),e=[],f=0;a.each(d,function(b,c){e.push(a(c).height())}),f=Math.max.apply(null,e),this._core.$stage.parent().height(f).addClass(this._core.settings.autoHeightClass)},e.prototype.destroy=function(){var a,b;for(a in this._handlers)this._core.$element.off(a,this._handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.AutoHeight=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function(b){this._core=b,this._videos={},this._playing=null,this._handlers={"initialized.owl.carousel":a.proxy(function(a){a.namespace&&this._core.register({type:"state",name:"playing",tags:["interacting"]})},this),"resize.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.video&&this.isInFullScreen()&&a.preventDefault()},this),"refreshed.owl.carousel":a.proxy(function(a){a.namespace&&this._core.is("resizing")&&this._core.$stage.find(".cloned .owl-video-frame").remove()},this),"changed.owl.carousel":a.proxy(function(a){a.namespace&&"position"===a.property.name&&this._playing&&this.stop()},this),"prepared.owl.carousel":a.proxy(function(b){if(b.namespace){var c=a(b.content).find(".owl-video");c.length&&(c.css("display","none"),this.fetch(c,a(b.content)))}},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this._core.$element.on(this._handlers),this._core.$element.on("click.owl.video",".owl-video-play-icon",a.proxy(function(a){this.play(a)},this))};e.Defaults={video:!1,videoHeight:!1,videoWidth:!1},e.prototype.fetch=function(a,b){var c=function(){return a.attr("data-vimeo-id")?"vimeo":a.attr("data-vzaar-id")?"vzaar":"youtube"}(),d=a.attr("data-vimeo-id")||a.attr("data-youtube-id")||a.attr("data-vzaar-id"),e=a.attr("data-width")||this._core.settings.videoWidth,f=a.attr("data-height")||this._core.settings.videoHeight,g=a.attr("href");if(!g)throw new Error("Missing video URL.");if(d=g.match(/(http:|https:|)\/\/(player.|www.|app.)?(vimeo\.com|youtu(be\.com|\.be|be\.googleapis\.com)|vzaar\.com)\/(video\/|videos\/|embed\/|channels\/.+\/|groups\/.+\/|watch\?v=|v\/)?([A-Za-z0-9._%-]*)(\&\S+)?/),d[3].indexOf("youtu")>-1)c="youtube";else if(d[3].indexOf("vimeo")>-1)c="vimeo";else{if(!(d[3].indexOf("vzaar")>-1))throw new Error("Video URL not supported.");c="vzaar"}d=d[6],this._videos[g]={type:c,id:d,width:e,height:f},b.attr("data-video",g),this.thumbnail(a,this._videos[g])},e.prototype.thumbnail=function(b,c){var d,e,f,g=c.width&&c.height?'style="width:'+c.width+"px;height:"+c.height+'px;"':"",h=b.find("img"),i="src",j="",k=this._core.settings,l=function(a){e='<div class="owl-video-play-icon"></div>',d=k.lazyLoad?'<div class="owl-video-tn '+j+'" '+i+'="'+a+'"></div>':'<div class="owl-video-tn" style="opacity:1;background-image:url('+a+')"></div>',b.after(d),b.after(e)};if(b.wrap('<div class="owl-video-wrapper"'+g+"></div>"),this._core.settings.lazyLoad&&(i="data-src",j="owl-lazy"),h.length)return l(h.attr(i)),h.remove(),!1;"youtube"===c.type?(f="//img.youtube.com/vi/"+c.id+"/hqdefault.jpg",l(f)):"vimeo"===c.type?a.ajax({type:"GET",url:"//vimeo.com/api/v2/video/"+c.id+".json",jsonp:"callback",dataType:"jsonp",success:function(a){f=a[0].thumbnail_large,l(f)}}):"vzaar"===c.type&&a.ajax({type:"GET",url:"//vzaar.com/api/videos/"+c.id+".json",jsonp:"callback",dataType:"jsonp",success:function(a){f=a.framegrab_url,l(f)}})},e.prototype.stop=function(){this._core.trigger("stop",null,"video"),this._playing.find(".owl-video-frame").remove(),this._playing.removeClass("owl-video-playing"),this._playing=null,this._core.leave("playing"),this._core.trigger("stopped",null,"video")},e.prototype.play=function(b){var c,d=a(b.target),e=d.closest("."+this._core.settings.itemClass),f=this._videos[e.attr("data-video")],g=f.width||"100%",h=f.height||this._core.$stage.height();this._playing||(this._core.enter("playing"),this._core.trigger("play",null,"video"),e=this._core.items(this._core.relative(e.index())),this._core.reset(e.index()),"youtube"===f.type?c='<iframe width="'+g+'" height="'+h+'" src="//www.youtube.com/embed/'+f.id+"?autoplay=1&rel=0&v="+f.id+'" frameborder="0" allowfullscreen></iframe>':"vimeo"===f.type?c='<iframe src="//player.vimeo.com/video/'+f.id+'?autoplay=1" width="'+g+'" height="'+h+'" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>':"vzaar"===f.type&&(c='<iframe frameborder="0"height="'+h+'"width="'+g+'" allowfullscreen mozallowfullscreen webkitAllowFullScreen src="//view.vzaar.com/'+f.id+'/player?autoplay=true"></iframe>'),a('<div class="owl-video-frame">'+c+"</div>").insertAfter(e.find(".owl-video")),this._playing=e.addClass("owl-video-playing"))},e.prototype.isInFullScreen=function(){var b=c.fullscreenElement||c.mozFullScreenElement||c.webkitFullscreenElement;return b&&a(b).parent().hasClass("owl-video-frame")},e.prototype.destroy=function(){var a,b;this._core.$element.off("click.owl.video");for(a in this._handlers)this._core.$element.off(a,this._handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.Video=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function(b){this.core=b,this.core.options=a.extend({},e.Defaults,this.core.options),this.swapping=!0,this.previous=d,this.next=d,this.handlers={"change.owl.carousel":a.proxy(function(a){a.namespace&&"position"==a.property.name&&(this.previous=this.core.current(),this.next=a.property.value)},this),"drag.owl.carousel dragged.owl.carousel translated.owl.carousel":a.proxy(function(a){a.namespace&&(this.swapping="translated"==a.type)},this),"translate.owl.carousel":a.proxy(function(a){a.namespace&&this.swapping&&(this.core.options.animateOut||this.core.options.animateIn)&&this.swap()},this)},this.core.$element.on(this.handlers)};e.Defaults={animateOut:!1,animateIn:!1},e.prototype.swap=function(){if(1===this.core.settings.items&&a.support.animation&&a.support.transition){this.core.speed(0);var b,c=a.proxy(this.clear,this),d=this.core.$stage.children().eq(this.previous),e=this.core.$stage.children().eq(this.next),f=this.core.settings.animateIn,g=this.core.settings.animateOut;this.core.current()!==this.previous&&(g&&(b=this.core.coordinates(this.previous)-this.core.coordinates(this.next),d.one(a.support.animation.end,c).css({left:b+"px"}).addClass("animated owl-animated-out").addClass(g)),f&&e.one(a.support.animation.end,c).addClass("animated owl-animated-in").addClass(f))}},e.prototype.clear=function(b){a(b.target).css({left:""}).removeClass("animated owl-animated-out owl-animated-in").removeClass(this.core.settings.animateIn).removeClass(this.core.settings.animateOut),this.core.onTransitionEnd()},e.prototype.destroy=function(){var a,b;for(a in this.handlers)this.core.$element.off(a,this.handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},
a.fn.owlCarousel.Constructor.Plugins.Animate=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function(b){this._core=b,this._timeout=null,this._paused=!1,this._handlers={"changed.owl.carousel":a.proxy(function(a){a.namespace&&"settings"===a.property.name?this._core.settings.autoplay?this.play():this.stop():a.namespace&&"position"===a.property.name&&this._core.settings.autoplay&&this._setAutoPlayInterval()},this),"initialized.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.autoplay&&this.play()},this),"play.owl.autoplay":a.proxy(function(a,b,c){a.namespace&&this.play(b,c)},this),"stop.owl.autoplay":a.proxy(function(a){a.namespace&&this.stop()},this),"mouseover.owl.autoplay":a.proxy(function(){this._core.settings.autoplayHoverPause&&this._core.is("rotating")&&this.pause()},this),"mouseleave.owl.autoplay":a.proxy(function(){this._core.settings.autoplayHoverPause&&this._core.is("rotating")&&this.play()},this),"touchstart.owl.core":a.proxy(function(){this._core.settings.autoplayHoverPause&&this._core.is("rotating")&&this.pause()},this),"touchend.owl.core":a.proxy(function(){this._core.settings.autoplayHoverPause&&this.play()},this)},this._core.$element.on(this._handlers),this._core.options=a.extend({},e.Defaults,this._core.options)};e.Defaults={autoplay:!1,autoplayTimeout:5e3,autoplayHoverPause:!1,autoplaySpeed:!1},e.prototype.play=function(a,b){this._paused=!1,this._core.is("rotating")||(this._core.enter("rotating"),this._setAutoPlayInterval())},e.prototype._getNextTimeout=function(d,e){return this._timeout&&b.clearTimeout(this._timeout),b.setTimeout(a.proxy(function(){this._paused||this._core.is("busy")||this._core.is("interacting")||c.hidden||this._core.next(e||this._core.settings.autoplaySpeed)},this),d||this._core.settings.autoplayTimeout)},e.prototype._setAutoPlayInterval=function(){this._timeout=this._getNextTimeout()},e.prototype.stop=function(){this._core.is("rotating")&&(b.clearTimeout(this._timeout),this._core.leave("rotating"))},e.prototype.pause=function(){this._core.is("rotating")&&(this._paused=!0)},e.prototype.destroy=function(){var a,b;this.stop();for(a in this._handlers)this._core.$element.off(a,this._handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.autoplay=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){"use strict";var e=function(b){this._core=b,this._initialized=!1,this._pages=[],this._controls={},this._templates=[],this.$element=this._core.$element,this._overrides={next:this._core.next,prev:this._core.prev,to:this._core.to},this._handlers={"prepared.owl.carousel":a.proxy(function(b){b.namespace&&this._core.settings.dotsData&&this._templates.push('<div class="'+this._core.settings.dotClass+'">'+a(b.content).find("[data-dot]").addBack("[data-dot]").attr("data-dot")+"</div>")},this),"added.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.dotsData&&this._templates.splice(a.position,0,this._templates.pop())},this),"remove.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.dotsData&&this._templates.splice(a.position,1)},this),"changed.owl.carousel":a.proxy(function(a){a.namespace&&"position"==a.property.name&&this.draw()},this),"initialized.owl.carousel":a.proxy(function(a){a.namespace&&!this._initialized&&(this._core.trigger("initialize",null,"navigation"),this.initialize(),this.update(),this.draw(),this._initialized=!0,this._core.trigger("initialized",null,"navigation"))},this),"refreshed.owl.carousel":a.proxy(function(a){a.namespace&&this._initialized&&(this._core.trigger("refresh",null,"navigation"),this.update(),this.draw(),this._core.trigger("refreshed",null,"navigation"))},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this.$element.on(this._handlers)};e.Defaults={nav:!1,navText:["prev","next"],navSpeed:!1,navElement:"div",navContainer:!1,navContainerClass:"owl-nav",navClass:["owl-prev","owl-next"],slideBy:1,dotClass:"owl-dot",dotsClass:"owl-dots",dots:!0,dotsEach:!1,dotsData:!1,dotsSpeed:!1,dotsContainer:!1},e.prototype.initialize=function(){var b,c=this._core.settings;this._controls.$relative=(c.navContainer?a(c.navContainer):a("<div>").addClass(c.navContainerClass).appendTo(this.$element)).addClass("disabled"),this._controls.$previous=a("<"+c.navElement+">").addClass(c.navClass[0]).html(c.navText[0]).prependTo(this._controls.$relative).on("click",a.proxy(function(a){this.prev(c.navSpeed)},this)),this._controls.$next=a("<"+c.navElement+">").addClass(c.navClass[1]).html(c.navText[1]).appendTo(this._controls.$relative).on("click",a.proxy(function(a){this.next(c.navSpeed)},this)),c.dotsData||(this._templates=[a("<div>").addClass(c.dotClass).append(a("<span>")).prop("outerHTML")]),this._controls.$absolute=(c.dotsContainer?a(c.dotsContainer):a("<div>").addClass(c.dotsClass).appendTo(this.$element)).addClass("disabled"),this._controls.$absolute.on("click","div",a.proxy(function(b){var d=a(b.target).parent().is(this._controls.$absolute)?a(b.target).index():a(b.target).parent().index();b.preventDefault(),this.to(d,c.dotsSpeed)},this));for(b in this._overrides)this._core[b]=a.proxy(this[b],this)},e.prototype.destroy=function(){var a,b,c,d;for(a in this._handlers)this.$element.off(a,this._handlers[a]);for(b in this._controls)this._controls[b].remove();for(d in this.overides)this._core[d]=this._overrides[d];for(c in Object.getOwnPropertyNames(this))"function"!=typeof this[c]&&(this[c]=null)},e.prototype.update=function(){var a,b,c,d=this._core.clones().length/2,e=d+this._core.items().length,f=this._core.maximum(!0),g=this._core.settings,h=g.center||g.autoWidth||g.dotsData?1:g.dotsEach||g.items;if("page"!==g.slideBy&&(g.slideBy=Math.min(g.slideBy,g.items)),g.dots||"page"==g.slideBy)for(this._pages=[],a=d,b=0,c=0;a<e;a++){if(b>=h||0===b){if(this._pages.push({start:Math.min(f,a-d),end:a-d+h-1}),Math.min(f,a-d)===f)break;b=0,++c}b+=this._core.mergers(this._core.relative(a))}},e.prototype.draw=function(){var b,c=this._core.settings,d=this._core.items().length<=c.items,e=this._core.relative(this._core.current()),f=c.loop||c.rewind;this._controls.$relative.toggleClass("disabled",!c.nav||d),c.nav&&(this._controls.$previous.toggleClass("disabled",!f&&e<=this._core.minimum(!0)),this._controls.$next.toggleClass("disabled",!f&&e>=this._core.maximum(!0))),this._controls.$absolute.toggleClass("disabled",!c.dots||d),c.dots&&(b=this._pages.length-this._controls.$absolute.children().length,c.dotsData&&0!==b?this._controls.$absolute.html(this._templates.join("")):b>0?this._controls.$absolute.append(new Array(b+1).join(this._templates[0])):b<0&&this._controls.$absolute.children().slice(b).remove(),this._controls.$absolute.find(".active").removeClass("active"),this._controls.$absolute.children().eq(a.inArray(this.current(),this._pages)).addClass("active"))},e.prototype.onTrigger=function(b){var c=this._core.settings;b.page={index:a.inArray(this.current(),this._pages),count:this._pages.length,size:c&&(c.center||c.autoWidth||c.dotsData?1:c.dotsEach||c.items)}},e.prototype.current=function(){var b=this._core.relative(this._core.current());return a.grep(this._pages,a.proxy(function(a,c){return a.start<=b&&a.end>=b},this)).pop()},e.prototype.getPosition=function(b){var c,d,e=this._core.settings;return"page"==e.slideBy?(c=a.inArray(this.current(),this._pages),d=this._pages.length,b?++c:--c,c=this._pages[(c%d+d)%d].start):(c=this._core.relative(this._core.current()),d=this._core.items().length,b?c+=e.slideBy:c-=e.slideBy),c},e.prototype.next=function(b){a.proxy(this._overrides.to,this._core)(this.getPosition(!0),b)},e.prototype.prev=function(b){a.proxy(this._overrides.to,this._core)(this.getPosition(!1),b)},e.prototype.to=function(b,c,d){var e;!d&&this._pages.length?(e=this._pages.length,a.proxy(this._overrides.to,this._core)(this._pages[(b%e+e)%e].start,c)):a.proxy(this._overrides.to,this._core)(b,c)},a.fn.owlCarousel.Constructor.Plugins.Navigation=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){"use strict";var e=function(c){this._core=c,this._hashes={},this.$element=this._core.$element,this._handlers={"initialized.owl.carousel":a.proxy(function(c){c.namespace&&"URLHash"===this._core.settings.startPosition&&a(b).trigger("hashchange.owl.navigation")},this),"prepared.owl.carousel":a.proxy(function(b){if(b.namespace){var c=a(b.content).find("[data-hash]").addBack("[data-hash]").attr("data-hash");if(!c)return;this._hashes[c]=b.content}},this),"changed.owl.carousel":a.proxy(function(c){if(c.namespace&&"position"===c.property.name){var d=this._core.items(this._core.relative(this._core.current())),e=a.map(this._hashes,function(a,b){return a===d?b:null}).join();if(!e||b.location.hash.slice(1)===e)return;b.location.hash=e}},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this.$element.on(this._handlers),a(b).on("hashchange.owl.navigation",a.proxy(function(a){var c=b.location.hash.substring(1),e=this._core.$stage.children(),f=this._hashes[c]&&e.index(this._hashes[c]);f!==d&&f!==this._core.current()&&this._core.to(this._core.relative(f),!1,!0)},this))};e.Defaults={URLhashListener:!1},e.prototype.destroy=function(){var c,d;a(b).off("hashchange.owl.navigation");for(c in this._handlers)this._core.$element.off(c,this._handlers[c]);for(d in Object.getOwnPropertyNames(this))"function"!=typeof this[d]&&(this[d]=null)},a.fn.owlCarousel.Constructor.Plugins.Hash=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){function e(b,c){var e=!1,f=b.charAt(0).toUpperCase()+b.slice(1);return a.each((b+" "+h.join(f+" ")+f).split(" "),function(a,b){if(g[b]!==d)return e=!c||b,!1}),e}function f(a){return e(a,!0)}var g=a("<support>").get(0).style,h="Webkit Moz O ms".split(" "),i={transition:{end:{WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"}},animation:{end:{WebkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",OAnimation:"oAnimationEnd",animation:"animationend"}}},j={csstransforms:function(){return!!e("transform")},csstransforms3d:function(){return!!e("perspective")},csstransitions:function(){return!!e("transition")},cssanimations:function(){return!!e("animation")}};j.csstransitions()&&(a.support.transition=new String(f("transition")),a.support.transition.end=i.transition.end[a.support.transition]),j.cssanimations()&&(a.support.animation=new String(f("animation")),a.support.animation.end=i.animation.end[a.support.animation]),j.csstransforms()&&(a.support.transform=new String(f("transform")),a.support.transform3d=j.csstransforms3d())}(window.Zepto||window.jQuery,window,document);

/*********************/
/****** 	jquery.ui.draggable.min.js	 ***********/
/*********************/
/*! jQuery UI - v1.10.3 - 2013-05-03
* http://jqueryui.com
* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */
(function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"original"!==this.options.helper||e.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1):!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return s.parents("body").length||s.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s[0]===this.element[0]||/(fixed|absolute)/.test(s.css("position"))||s.css("position","absolute"),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;return n.containment?"window"===n.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):"document"===n.containment?(this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):n.containment.constructor===Array?(this.containment=n.containment,undefined):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=e(n.containment),s=i[0],s&&(t="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i),undefined):(this.containment=null,undefined)},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:n.scrollTop(),left:n.scrollLeft()}),{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*s}},_generatePosition:function(t){var i,s,n,a,o=this.options,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=t.pageX,l=t.pageY;return this.offset.scroll||(this.offset.scroll={top:r.scrollTop(),left:r.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(s=this.relative_container.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,h=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s]),"drag"===t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var s=e(this).data("ui-draggable"),n=s.options,a=e.extend({},i,{item:s.element});s.sortables=[],e(n.connectToSortable).each(function(){var i=e.data(this,"ui-sortable");i&&!i.options.disabled&&(s.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,a))})},stop:function(t,i){var s=e(this).data("ui-draggable"),n=e.extend({},i,{item:s.element});e.each(s.sortables,function(){this.instance.isOver?(this.instance.isOver=0,s.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===s.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,n))})},drag:function(t,i){var s=e(this).data("ui-draggable"),n=this;e.each(s.sortables,function(){var a=!1,o=this;this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(a=!0,e.each(s.sortables,function(){return this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this!==o&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(o.instance.element[0],this.instance.element[0])&&(a=!1),a})),a?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(n).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=s.offset.click.top,this.instance.offset.click.left=s.offset.click.left,this.instance.offset.parent.left-=s.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=s.offset.parent.top-this.instance.offset.parent.top,s._trigger("toSortable",t),s.dropped=this.instance.element,s.currentItem=s.element,this.instance.fromOutside=s),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),s._trigger("fromSortable",t),s.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("ui-draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var s=e(i.helper),n=e(this).data("ui-draggable").options;s.css("opacity")&&(n._opacity=s.css("opacity")),s.css("opacity",n.opacity)},stop:function(t,i){var s=e(this).data("ui-draggable").options;s._opacity&&e(i.helper).css("opacity",s._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("ui-draggable"),s=i.options,n=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(s.axis&&"x"===s.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<s.scrollSensitivity?i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop+s.scrollSpeed:t.pageY-i.overflowOffset.top<s.scrollSensitivity&&(i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop-s.scrollSpeed)),s.axis&&"y"===s.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<s.scrollSensitivity?i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft+s.scrollSpeed:t.pageX-i.overflowOffset.left<s.scrollSensitivity&&(i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft-s.scrollSpeed))):(s.axis&&"x"===s.axis||(t.pageY-e(document).scrollTop()<s.scrollSensitivity?n=e(document).scrollTop(e(document).scrollTop()-s.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<s.scrollSensitivity&&(n=e(document).scrollTop(e(document).scrollTop()+s.scrollSpeed))),s.axis&&"y"===s.axis||(t.pageX-e(document).scrollLeft()<s.scrollSensitivity?n=e(document).scrollLeft(e(document).scrollLeft()-s.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<s.scrollSensitivity&&(n=e(document).scrollLeft(e(document).scrollLeft()+s.scrollSpeed)))),n!==!1&&e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var i=e(this),s=i.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:s.top,left:s.left})})},drag:function(t,i){var s,n,a,o,r,h,l,u,c,d,p=e(this).data("ui-draggable"),f=p.options,m=f.snapTolerance,g=i.offset.left,v=g+p.helperProportions.width,b=i.offset.top,y=b+p.helperProportions.height;for(c=p.snapElements.length-1;c>=0;c--)r=p.snapElements[c].left,h=r+p.snapElements[c].width,l=p.snapElements[c].top,u=l+p.snapElements[c].height,r-m>v||g>h+m||l-m>y||b>u+m||!e.contains(p.snapElements[c].item.ownerDocument,p.snapElements[c].item)?(p.snapElements[c].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=!1):("inner"!==f.snapMode&&(s=m>=Math.abs(l-y),n=m>=Math.abs(u-b),a=m>=Math.abs(r-v),o=m>=Math.abs(h-g),s&&(i.position.top=p._convertPositionTo("relative",{top:l-p.helperProportions.height,left:0}).top-p.margins.top),n&&(i.position.top=p._convertPositionTo("relative",{top:u,left:0}).top-p.margins.top),a&&(i.position.left=p._convertPositionTo("relative",{top:0,left:r-p.helperProportions.width}).left-p.margins.left),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:h}).left-p.margins.left)),d=s||n||a||o,"outer"!==f.snapMode&&(s=m>=Math.abs(l-b),n=m>=Math.abs(u-y),a=m>=Math.abs(r-g),o=m>=Math.abs(h-v),s&&(i.position.top=p._convertPositionTo("relative",{top:l,left:0}).top-p.margins.top),n&&(i.position.top=p._convertPositionTo("relative",{top:u-p.helperProportions.height,left:0}).top-p.margins.top),a&&(i.position.left=p._convertPositionTo("relative",{top:0,left:r}).left-p.margins.left),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:h-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[c].snapping&&(s||n||a||o||d)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=s||n||a||o||d)}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,i=this.data("ui-draggable").options,s=e.makeArray(e(i.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});s.length&&(t=parseInt(e(s[0]).css("zIndex"),10)||0,e(s).each(function(i){e(this).css("zIndex",t+i)}),this.css("zIndex",t+s.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var s=e(i.helper),n=e(this).data("ui-draggable").options;s.css("zIndex")&&(n._zIndex=s.css("zIndex")),s.css("zIndex",n.zIndex)},stop:function(t,i){var s=e(this).data("ui-draggable").options;s._zIndex&&e(i.helper).css("zIndex",s._zIndex)}})})(jQuery);

/*********************/
/****** 	jquery.ui.touch-punch.min.js	 ***********/
/*********************/
/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 2011–2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
!function(a){function f(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var e,b=a.ui.mouse.prototype,c=b._mouseInit,d=b._mouseDestroy;b._touchStart=function(a){var b=this;!e&&b._mouseCapture(a.originalEvent.changedTouches[0])&&(e=!0,b._touchMoved=!1,f(a,"mouseover"),f(a,"mousemove"),f(a,"mousedown"))},b._touchMove=function(a){e&&(this._touchMoved=!0,f(a,"mousemove"))},b._touchEnd=function(a){e&&(f(a,"mouseup"),f(a,"mouseout"),this._touchMoved||f(a,"click"),e=!1)},b._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),c.call(b)},b._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),d.call(b)}}}(jQuery);

/*********************/
/****** 	jquery.fancybox-3.3.5.min.js	 ***********/
/*********************/
// ==================================================
// fancyBox v3.3.5
//
// Licensed GPLv3 for open source use
// or fancyBox Commercial License for commercial use
//
// http://fancyapps.com/fancybox/
// Copyright 2018 fancyApps
//
// ==================================================
!function(t,e,n,o){"use strict";function i(t,e){var o,i,a=[],s=0;t&&t.isDefaultPrevented()||(t.preventDefault(),e=t&&t.data?t.data.options:e||{},o=e.$target||n(t.currentTarget),i=o.attr("data-fancybox")||"",i?(a=e.selector?n(e.selector):t.data?t.data.items:[],a=a.length?a.filter('[data-fancybox="'+i+'"]'):n('[data-fancybox="'+i+'"]'),s=a.index(o),s<0&&(s=0)):a=[o],n.fancybox.open(a,e,s))}if(t.console=t.console||{info:function(t){}},n){if(n.fn.fancybox)return void console.info("fancyBox already initialized");var a={loop:!1,gutter:50,keyboard:!0,arrows:!0,infobar:!0,smallBtn:"auto",toolbar:"auto",buttons:["zoom","thumbs","close"],idleTime:3,protect:!1,modal:!1,image:{preload:!1},ajax:{settings:{data:{fancybox:!0}}},iframe:{tpl:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen allowtransparency="true" src=""></iframe>',preload:!0,css:{},attr:{scrolling:"auto"}},defaultType:"image",animationEffect:"zoom",animationDuration:366,zoomOpacity:"auto",transitionEffect:"fade",transitionDuration:366,slideClass:"",baseClass:"",baseTpl:'<div class="fancybox-container" role="dialog" tabindex="-1"><div class="fancybox-bg"></div><div class="fancybox-inner"><div class="fancybox-infobar"><span data-fancybox-index></span>&nbsp;/&nbsp;<span data-fancybox-count></span></div><div class="fancybox-toolbar">{{buttons}}</div><div class="fancybox-navigation">{{arrows}}</div><div class="fancybox-stage"></div><div class="fancybox-caption"></div></div></div>',spinnerTpl:'<div class="fancybox-loading"></div>',errorTpl:'<div class="fancybox-error"><p>{{ERROR}}</p></div>',btnTpl:{download:'<a download data-fancybox-download class="fancybox-button fancybox-button--download" title="{{DOWNLOAD}}" href="javascript:;"><svg viewBox="0 0 40 40"><path d="M13,16 L20,23 L27,16 M20,7 L20,23 M10,24 L10,28 L30,28 L30,24" /></svg></a>',zoom:'<button data-fancybox-zoom class="fancybox-button fancybox-button--zoom" title="{{ZOOM}}"><svg viewBox="0 0 40 40"><path d="M18,17 m-8,0 a8,8 0 1,0 16,0 a8,8 0 1,0 -16,0 M24,22 L31,29" /></svg></button>',close:'<button data-fancybox-close class="fancybox-button fancybox-button--close" title="{{CLOSE}}"><svg viewBox="0 0 40 40"><path d="M10,10 L30,30 M30,10 L10,30" /></svg></button>',smallBtn:'<button data-fancybox-close class="fancybox-close-small" title="{{CLOSE}}"><svg viewBox="0 0 32 32"><path d="M10,10 L22,22 M22,10 L10,22"></path></svg></button>',arrowLeft:'<a data-fancybox-prev class="fancybox-button fancybox-button--arrow_left" title="{{PREV}}" href="javascript:;"><svg viewBox="0 0 40 40"><path d="M18,12 L10,20 L18,28 M10,20 L30,20"></path></svg></a>',arrowRight:'<a data-fancybox-next class="fancybox-button fancybox-button--arrow_right" title="{{NEXT}}" href="javascript:;"><svg viewBox="0 0 40 40"><path d="M10,20 L30,20 M22,12 L30,20 L22,28"></path></svg></a>'},parentEl:"body",autoFocus:!1,backFocus:!0,trapFocus:!0,fullScreen:{autoStart:!1},touch:{vertical:!0,momentum:!0},hash:null,media:{},slideShow:{autoStart:!1,speed:4e3},thumbs:{autoStart:!1,hideOnClose:!0,parentEl:".fancybox-container",axis:"y"},wheel:"auto",onInit:n.noop,beforeLoad:n.noop,afterLoad:n.noop,beforeShow:n.noop,afterShow:n.noop,beforeClose:n.noop,afterClose:n.noop,onActivate:n.noop,onDeactivate:n.noop,clickContent:function(t,e){return"image"===t.type&&"zoom"},clickSlide:"close",clickOutside:"close",dblclickContent:!1,dblclickSlide:!1,dblclickOutside:!1,mobile:{idleTime:!1,clickContent:function(t,e){return"image"===t.type&&"toggleControls"},clickSlide:function(t,e){return"image"===t.type?"toggleControls":"close"},dblclickContent:function(t,e){return"image"===t.type&&"zoom"},dblclickSlide:function(t,e){return"image"===t.type&&"zoom"}},lang:"en",i18n:{en:{CLOSE:"Close",NEXT:"Next",PREV:"Previous",ERROR:"The requested content cannot be loaded. <br/> Please try again later.",PLAY_START:"Start slideshow",PLAY_STOP:"Pause slideshow",FULL_SCREEN:"Full screen",THUMBS:"Thumbnails",DOWNLOAD:"Download",SHARE:"Share",ZOOM:"Zoom"},de:{CLOSE:"Schliessen",NEXT:"Weiter",PREV:"Zurück",ERROR:"Die angeforderten Daten konnten nicht geladen werden. <br/> Bitte versuchen Sie es später nochmal.",PLAY_START:"Diaschau starten",PLAY_STOP:"Diaschau beenden",FULL_SCREEN:"Vollbild",THUMBS:"Vorschaubilder",DOWNLOAD:"Herunterladen",SHARE:"Teilen",ZOOM:"Maßstab"}}},s=n(t),r=n(e),c=0,l=function(t){return t&&t.hasOwnProperty&&t instanceof n},d=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||function(e){return t.setTimeout(e,1e3/60)}}(),u=function(){var t,n=e.createElement("fakeelement"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in i)if(n.style[t]!==o)return i[t];return"transitionend"}(),f=function(t){return t&&t.length&&t[0].offsetHeight},p=function(t,e){var o=n.extend(!0,{},t,e);return n.each(e,function(t,e){n.isArray(e)&&(o[t]=e)}),o},h=function(t,o,i){var a=this;a.opts=p({index:i},n.fancybox.defaults),n.isPlainObject(o)&&(a.opts=p(a.opts,o)),n.fancybox.isMobile&&(a.opts=p(a.opts,a.opts.mobile)),a.id=a.opts.id||++c,a.currIndex=parseInt(a.opts.index,10)||0,a.prevIndex=null,a.prevPos=null,a.currPos=0,a.firstRun=!0,a.group=[],a.slides={},a.addContent(t),a.group.length&&(a.$lastFocus=n(e.activeElement).trigger("blur"),a.init())};n.extend(h.prototype,{init:function(){var i,a,s,r=this,c=r.group[r.currIndex],l=c.opts,d=n.fancybox.scrollbarWidth;n.fancybox.getInstance()||l.hideScrollbar===!1||(n("body").addClass("fancybox-active"),!n.fancybox.isMobile&&e.body.scrollHeight>t.innerHeight&&(d===o&&(i=n('<div style="width:100px;height:100px;overflow:scroll;" />').appendTo("body"),d=n.fancybox.scrollbarWidth=i[0].offsetWidth-i[0].clientWidth,i.remove()),n("head").append('<style id="fancybox-style-noscroll" type="text/css">.compensate-for-scrollbar { margin-right: '+d+"px; }</style>"),n("body").addClass("compensate-for-scrollbar"))),s="",n.each(l.buttons,function(t,e){s+=l.btnTpl[e]||""}),a=n(r.translate(r,l.baseTpl.replace("{{buttons}}",s).replace("{{arrows}}",l.btnTpl.arrowLeft+l.btnTpl.arrowRight))).attr("id","fancybox-container-"+r.id).addClass("fancybox-is-hidden").addClass(l.baseClass).data("FancyBox",r).appendTo(l.parentEl),r.$refs={container:a},["bg","inner","infobar","toolbar","stage","caption","navigation"].forEach(function(t){r.$refs[t]=a.find(".fancybox-"+t)}),r.trigger("onInit"),r.activate(),r.jumpTo(r.currIndex)},translate:function(t,e){var n=t.opts.i18n[t.opts.lang];return e.replace(/\{\{(\w+)\}\}/g,function(t,e){var i=n[e];return i===o?t:i})},addContent:function(t){var e,i=this,a=n.makeArray(t);n.each(a,function(t,e){var a,s,r,c,l,d={},u={};n.isPlainObject(e)?(d=e,u=e.opts||e):"object"===n.type(e)&&n(e).length?(a=n(e),u=a.data()||{},u=n.extend(!0,{},u,u.options),u.$orig=a,d.src=i.opts.src||u.src||a.attr("href"),d.type||d.src||(d.type="inline",d.src=e)):d={type:"html",src:e+""},d.opts=n.extend(!0,{},i.opts,u),n.isArray(u.buttons)&&(d.opts.buttons=u.buttons),s=d.type||d.opts.type,c=d.src||"",!s&&c&&((r=c.match(/\.(mp4|mov|ogv)((\?|#).*)?$/i))?(s="video",d.opts.videoFormat||(d.opts.videoFormat="video/"+("ogv"===r[1]?"ogg":r[1]))):c.match(/(^data:image\/[a-z0-9+\/=]*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg|ico)((\?|#).*)?$)/i)?s="image":c.match(/\.(pdf)((\?|#).*)?$/i)?s="iframe":"#"===c.charAt(0)&&(s="inline")),s?d.type=s:i.trigger("objectNeedsType",d),d.contentType||(d.contentType=n.inArray(d.type,["html","inline","ajax"])>-1?"html":d.type),d.index=i.group.length,"auto"==d.opts.smallBtn&&(d.opts.smallBtn=n.inArray(d.type,["html","inline","ajax"])>-1),"auto"===d.opts.toolbar&&(d.opts.toolbar=!d.opts.smallBtn),d.opts.$trigger&&d.index===i.opts.index&&(d.opts.$thumb=d.opts.$trigger.find("img:first")),d.opts.$thumb&&d.opts.$thumb.length||!d.opts.$orig||(d.opts.$thumb=d.opts.$orig.find("img:first")),"function"===n.type(d.opts.caption)&&(d.opts.caption=d.opts.caption.apply(e,[i,d])),"function"===n.type(i.opts.caption)&&(d.opts.caption=i.opts.caption.apply(e,[i,d])),d.opts.caption instanceof n||(d.opts.caption=d.opts.caption===o?"":d.opts.caption+""),"ajax"===d.type&&(l=c.split(/\s+/,2),l.length>1&&(d.src=l.shift(),d.opts.filter=l.shift())),d.opts.modal&&(d.opts=n.extend(!0,d.opts,{infobar:0,toolbar:0,smallBtn:0,keyboard:0,slideShow:0,fullScreen:0,thumbs:0,touch:0,clickContent:!1,clickSlide:!1,clickOutside:!1,dblclickContent:!1,dblclickSlide:!1,dblclickOutside:!1})),i.group.push(d)}),Object.keys(i.slides).length&&(i.updateControls(),e=i.Thumbs,e&&e.isActive&&(e.create(),e.focus()))},addEvents:function(){var o=this;o.removeEvents(),o.$refs.container.on("click.fb-close","[data-fancybox-close]",function(t){t.stopPropagation(),t.preventDefault(),o.close(t)}).on("touchstart.fb-prev click.fb-prev","[data-fancybox-prev]",function(t){t.stopPropagation(),t.preventDefault(),o.previous()}).on("touchstart.fb-next click.fb-next","[data-fancybox-next]",function(t){t.stopPropagation(),t.preventDefault(),o.next()}).on("click.fb","[data-fancybox-zoom]",function(t){o[o.isScaledDown()?"scaleToActual":"scaleToFit"]()}),s.on("orientationchange.fb resize.fb",function(t){t&&t.originalEvent&&"resize"===t.originalEvent.type?d(function(){o.update()}):(o.$refs.stage.hide(),setTimeout(function(){o.$refs.stage.show(),o.update()},n.fancybox.isMobile?600:250))}),r.on("focusin.fb",function(t){var o=n.fancybox?n.fancybox.getInstance():null;o.isClosing||!o.current||!o.current.opts.trapFocus||n(t.target).hasClass("fancybox-container")||n(t.target).is(e)||o&&"fixed"!==n(t.target).css("position")&&!o.$refs.container.has(t.target).length&&(t.stopPropagation(),o.focus())}),r.on("keydown.fb",function(t){var e=o.current,i=t.keyCode||t.which;if(e&&e.opts.keyboard&&!(t.ctrlKey||t.altKey||t.shiftKey||n(t.target).is("input")||n(t.target).is("textarea")))return 8===i||27===i?(t.preventDefault(),void o.close(t)):37===i||38===i?(t.preventDefault(),void o.previous()):39===i||40===i?(t.preventDefault(),void o.next()):void o.trigger("afterKeydown",t,i)}),o.group[o.currIndex].opts.idleTime&&(o.idleSecondsCounter=0,r.on("mousemove.fb-idle mouseleave.fb-idle mousedown.fb-idle touchstart.fb-idle touchmove.fb-idle scroll.fb-idle keydown.fb-idle",function(t){o.idleSecondsCounter=0,o.isIdle&&o.showControls(),o.isIdle=!1}),o.idleInterval=t.setInterval(function(){o.idleSecondsCounter++,o.idleSecondsCounter>=o.group[o.currIndex].opts.idleTime&&!o.isDragging&&(o.isIdle=!0,o.idleSecondsCounter=0,o.hideControls())},1e3))},removeEvents:function(){var e=this;s.off("orientationchange.fb resize.fb"),r.off("focusin.fb keydown.fb .fb-idle"),this.$refs.container.off(".fb-close .fb-prev .fb-next"),e.idleInterval&&(t.clearInterval(e.idleInterval),e.idleInterval=null)},previous:function(t){return this.jumpTo(this.currPos-1,t)},next:function(t){return this.jumpTo(this.currPos+1,t)},jumpTo:function(t,e){var i,a,s,r,c,l,d,u=this,p=u.group.length;if(!(u.isDragging||u.isClosing||u.isAnimating&&u.firstRun)){if(t=parseInt(t,10),a=u.current?u.current.opts.loop:u.opts.loop,!a&&(t<0||t>=p))return!1;if(i=u.firstRun=!Object.keys(u.slides).length,!(p<2&&!i&&u.isDragging)){if(r=u.current,u.prevIndex=u.currIndex,u.prevPos=u.currPos,s=u.createSlide(t),p>1&&((a||s.index>0)&&u.createSlide(t-1),(a||s.index<p-1)&&u.createSlide(t+1)),u.current=s,u.currIndex=s.index,u.currPos=s.pos,u.trigger("beforeShow",i),u.updateControls(),l=n.fancybox.getTranslate(s.$slide),s.isMoved=(0!==l.left||0!==l.top)&&!s.$slide.hasClass("fancybox-animated"),s.forcedDuration=o,n.isNumeric(e)?s.forcedDuration=e:e=s.opts[i?"animationDuration":"transitionDuration"],e=parseInt(e,10),i)return s.opts.animationEffect&&e&&u.$refs.container.css("transition-duration",e+"ms"),u.$refs.container.removeClass("fancybox-is-hidden"),f(u.$refs.container),u.$refs.container.addClass("fancybox-is-open"),f(u.$refs.container),s.$slide.addClass("fancybox-slide--previous"),u.loadSlide(s),s.$slide.removeClass("fancybox-slide--previous").addClass("fancybox-slide--current"),void u.preload("image");n.each(u.slides,function(t,e){n.fancybox.stop(e.$slide)}),s.$slide.removeClass("fancybox-slide--next fancybox-slide--previous").addClass("fancybox-slide--current"),s.isMoved?(c=Math.round(s.$slide.width()),n.each(u.slides,function(t,o){var i=o.pos-s.pos;n.fancybox.animate(o.$slide,{top:0,left:i*c+i*o.opts.gutter},e,function(){o.$slide.removeAttr("style").removeClass("fancybox-slide--next fancybox-slide--previous"),o.pos===u.currPos&&(s.isMoved=!1,u.complete())})})):u.$refs.stage.children().removeAttr("style"),s.isLoaded?u.revealContent(s):u.loadSlide(s),u.preload("image"),r.pos!==s.pos&&(d="fancybox-slide--"+(r.pos>s.pos?"next":"previous"),r.$slide.removeClass("fancybox-slide--complete fancybox-slide--current fancybox-slide--next fancybox-slide--previous"),r.isComplete=!1,e&&(s.isMoved||s.opts.transitionEffect)&&(s.isMoved?r.$slide.addClass(d):(d="fancybox-animated "+d+" fancybox-fx-"+s.opts.transitionEffect,n.fancybox.animate(r.$slide,d,e,function(){r.$slide.removeClass(d).removeAttr("style")}))))}}},createSlide:function(t){var e,o,i=this;return o=t%i.group.length,o=o<0?i.group.length+o:o,!i.slides[t]&&i.group[o]&&(e=n('<div class="fancybox-slide"></div>').appendTo(i.$refs.stage),i.slides[t]=n.extend(!0,{},i.group[o],{pos:t,$slide:e,isLoaded:!1}),i.updateSlide(i.slides[t])),i.slides[t]},scaleToActual:function(t,e,i){var a,s,r,c,l,d=this,u=d.current,f=u.$content,p=n.fancybox.getTranslate(u.$slide).width,h=n.fancybox.getTranslate(u.$slide).height,g=u.width,b=u.height;!d.isAnimating&&f&&"image"==u.type&&u.isLoaded&&!u.hasError&&(n.fancybox.stop(f),d.isAnimating=!0,t=t===o?.5*p:t,e=e===o?.5*h:e,a=n.fancybox.getTranslate(f),a.top-=n.fancybox.getTranslate(u.$slide).top,a.left-=n.fancybox.getTranslate(u.$slide).left,c=g/a.width,l=b/a.height,s=.5*p-.5*g,r=.5*h-.5*b,g>p&&(s=a.left*c-(t*c-t),s>0&&(s=0),s<p-g&&(s=p-g)),b>h&&(r=a.top*l-(e*l-e),r>0&&(r=0),r<h-b&&(r=h-b)),d.updateCursor(g,b),n.fancybox.animate(f,{top:r,left:s,scaleX:c,scaleY:l},i||330,function(){d.isAnimating=!1}),d.SlideShow&&d.SlideShow.isActive&&d.SlideShow.stop())},scaleToFit:function(t){var e,o=this,i=o.current,a=i.$content;!o.isAnimating&&a&&"image"==i.type&&i.isLoaded&&!i.hasError&&(n.fancybox.stop(a),o.isAnimating=!0,e=o.getFitPos(i),o.updateCursor(e.width,e.height),n.fancybox.animate(a,{top:e.top,left:e.left,scaleX:e.width/a.width(),scaleY:e.height/a.height()},t||330,function(){o.isAnimating=!1}))},getFitPos:function(t){var e,n,o,i,a,s=this,r=t.$content,c=t.width||t.opts.width,l=t.height||t.opts.height,d={};return!!(t.isLoaded&&r&&r.length)&&(i={top:parseInt(t.$slide.css("paddingTop"),10),right:parseInt(t.$slide.css("paddingRight"),10),bottom:parseInt(t.$slide.css("paddingBottom"),10),left:parseInt(t.$slide.css("paddingLeft"),10)},e=parseInt(s.$refs.stage.width(),10)-(i.left+i.right),n=parseInt(s.$refs.stage.height(),10)-(i.top+i.bottom),c&&l||(c=e,l=n),o=Math.min(1,e/c,n/l),c=Math.floor(o*c),l=Math.floor(o*l),"image"===t.type?(d.top=Math.floor(.5*(n-l))+i.top,d.left=Math.floor(.5*(e-c))+i.left):"video"===t.contentType&&(a=t.opts.width&&t.opts.height?c/l:t.opts.ratio||16/9,l>c/a?l=c/a:c>l*a&&(c=l*a)),d.width=c,d.height=l,d)},update:function(){var t=this;n.each(t.slides,function(e,n){t.updateSlide(n)})},updateSlide:function(t,e){var o=this,i=t&&t.$content,a=t.width||t.opts.width,s=t.height||t.opts.height;i&&(a||s||"video"===t.contentType)&&!t.hasError&&(n.fancybox.stop(i),n.fancybox.setTranslate(i,o.getFitPos(t)),t.pos===o.currPos&&(o.isAnimating=!1,o.updateCursor())),t.$slide.trigger("refresh"),o.$refs.toolbar.toggleClass("compensate-for-scrollbar",t.$slide.get(0).scrollHeight>t.$slide.get(0).clientHeight),o.trigger("onUpdate",t)},centerSlide:function(t,e){var i,a,s=this;s.current&&(i=Math.round(t.$slide.width()),a=t.pos-s.current.pos,n.fancybox.animate(t.$slide,{top:0,left:a*i+a*t.opts.gutter,opacity:1},e===o?0:e,null,!1))},updateCursor:function(t,e){var o,i=this,a=i.current,s=i.$refs.container.removeClass("fancybox-is-zoomable fancybox-can-zoomIn fancybox-can-drag fancybox-can-zoomOut");a&&!i.isClosing&&(o=i.isZoomable(),s.toggleClass("fancybox-is-zoomable",o),n("[data-fancybox-zoom]").prop("disabled",!o),o&&("zoom"===a.opts.clickContent||n.isFunction(a.opts.clickContent)&&"zoom"===a.opts.clickContent(a))?i.isScaledDown(t,e)?s.addClass("fancybox-can-zoomIn"):a.opts.touch?s.addClass("fancybox-can-drag"):s.addClass("fancybox-can-zoomOut"):a.opts.touch&&"video"!==a.contentType&&s.addClass("fancybox-can-drag"))},isZoomable:function(){var t,e=this,n=e.current;if(n&&!e.isClosing&&"image"===n.type&&!n.hasError){if(!n.isLoaded)return!0;if(t=e.getFitPos(n),n.width>t.width||n.height>t.height)return!0}return!1},isScaledDown:function(t,e){var i=this,a=!1,s=i.current,r=s.$content;return t!==o&&e!==o?a=t<s.width&&e<s.height:r&&(a=n.fancybox.getTranslate(r),a=a.width<s.width&&a.height<s.height),a},canPan:function(){var t,e=this,n=!1,o=e.current;return"image"===o.type&&(t=o.$content)&&!o.hasError&&(n=e.getFitPos(o),n=Math.abs(t.width()-n.width)>1||Math.abs(t.height()-n.height)>1),n},loadSlide:function(t){var e,o,i,a=this;if(!t.isLoading&&!t.isLoaded){switch(t.isLoading=!0,a.trigger("beforeLoad",t),e=t.type,o=t.$slide,o.off("refresh").trigger("onReset").addClass(t.opts.slideClass),e){case"image":a.setImage(t);break;case"iframe":a.setIframe(t);break;case"html":a.setContent(t,t.src||t.content);break;case"video":a.setContent(t,'<video class="fancybox-video" controls controlsList="nodownload"><source src="'+t.src+'" type="'+t.opts.videoFormat+"\">Your browser doesn't support HTML5 video</video");break;case"inline":n(t.src).length?a.setContent(t,n(t.src)):a.setError(t);break;case"ajax":a.showLoading(t),i=n.ajax(n.extend({},t.opts.ajax.settings,{url:t.src,success:function(e,n){"success"===n&&a.setContent(t,e)},error:function(e,n){e&&"abort"!==n&&a.setError(t)}})),o.one("onReset",function(){i.abort()});break;default:a.setError(t)}return!0}},setImage:function(e){var o,i,a,s,r,c=this,l=e.opts.srcset||e.opts.image.srcset;if(e.timouts=setTimeout(function(){var t=e.$image;!e.isLoading||t&&t[0].complete||e.hasError||c.showLoading(e)},350),l){s=t.devicePixelRatio||1,r=t.innerWidth*s,a=l.split(",").map(function(t){var e={};return t.trim().split(/\s+/).forEach(function(t,n){var o=parseInt(t.substring(0,t.length-1),10);return 0===n?e.url=t:void(o&&(e.value=o,e.postfix=t[t.length-1]))}),e}),a.sort(function(t,e){return t.value-e.value});for(var d=0;d<a.length;d++){var u=a[d];if("w"===u.postfix&&u.value>=r||"x"===u.postfix&&u.value>=s){i=u;break}}!i&&a.length&&(i=a[a.length-1]),i&&(e.src=i.url,e.width&&e.height&&"w"==i.postfix&&(e.height=e.width/e.height*i.value,e.width=i.value),e.opts.srcset=l)}e.$content=n('<div class="fancybox-content"></div>').addClass("fancybox-is-hidden").appendTo(e.$slide.addClass("fancybox-slide--image")),o=e.opts.thumb||!(!e.opts.$thumb||!e.opts.$thumb.length)&&e.opts.$thumb.attr("src"),e.opts.preload!==!1&&e.opts.width&&e.opts.height&&o&&(e.width=e.opts.width,e.height=e.opts.height,e.$ghost=n("<img />").one("error",function(){n(this).remove(),e.$ghost=null}).one("load",function(){c.afterLoad(e)}).addClass("fancybox-image").appendTo(e.$content).attr("src",o)),c.setBigImage(e)},setBigImage:function(t){var e=this,o=n("<img />");t.$image=o.one("error",function(){e.setError(t)}).one("load",function(){var n;t.$ghost||(e.resolveImageSlideSize(t,this.naturalWidth,this.naturalHeight),e.afterLoad(t)),t.timouts&&(clearTimeout(t.timouts),t.timouts=null),e.isClosing||(t.opts.srcset&&(n=t.opts.sizes,n&&"auto"!==n||(n=(t.width/t.height>1&&s.width()/s.height()>1?"100":Math.round(t.width/t.height*100))+"vw"),o.attr("sizes",n).attr("srcset",t.opts.srcset)),t.$ghost&&setTimeout(function(){t.$ghost&&!e.isClosing&&t.$ghost.hide()},Math.min(300,Math.max(1e3,t.height/1600))),e.hideLoading(t))}).addClass("fancybox-image").attr("src",t.src).appendTo(t.$content),(o[0].complete||"complete"==o[0].readyState)&&o[0].naturalWidth&&o[0].naturalHeight?o.trigger("load"):o[0].error&&o.trigger("error")},resolveImageSlideSize:function(t,e,n){var o=parseInt(t.opts.width,10),i=parseInt(t.opts.height,10);t.width=e,t.height=n,o>0&&(t.width=o,t.height=Math.floor(o*n/e)),i>0&&(t.width=Math.floor(i*e/n),t.height=i)},setIframe:function(t){var e,i=this,a=t.opts.iframe,s=t.$slide;t.$content=n('<div class="fancybox-content'+(a.preload?" fancybox-is-hidden":"")+'"></div>').css(a.css).appendTo(s),s.addClass("fancybox-slide--"+t.contentType),t.$iframe=e=n(a.tpl.replace(/\{rnd\}/g,(new Date).getTime())).attr(a.attr).appendTo(t.$content),a.preload?(i.showLoading(t),e.on("load.fb error.fb",function(e){this.isReady=1,t.$slide.trigger("refresh"),i.afterLoad(t)}),s.on("refresh.fb",function(){var n,i,s=t.$content,r=a.css.width,c=a.css.height;if(1===e[0].isReady){try{n=e.contents(),i=n.find("body")}catch(t){}i&&i.length&&i.children().length&&(s.css({width:"",height:""}),r===o&&(r=Math.ceil(Math.max(i[0].clientWidth,i.outerWidth(!0)))),r&&s.width(r),c===o&&(c=Math.ceil(Math.max(i[0].clientHeight,i.outerHeight(!0)))),c&&s.height(c)),s.removeClass("fancybox-is-hidden")}})):this.afterLoad(t),e.attr("src",t.src),s.one("onReset",function(){try{n(this).find("iframe").hide().unbind().attr("src","//about:blank")}catch(t){}n(this).off("refresh.fb").empty(),t.isLoaded=!1})},setContent:function(t,e){var o=this;o.isClosing||(o.hideLoading(t),t.$content&&n.fancybox.stop(t.$content),t.$slide.empty(),l(e)&&e.parent().length?(e.parent().parent(".fancybox-slide--inline").trigger("onReset"),t.$placeholder=n("<div>").hide().insertAfter(e),e.css("display","inline-block")):t.hasError||("string"===n.type(e)&&(e=n("<div>").append(n.trim(e)).contents(),3===e[0].nodeType&&(e=n("<div>").html(e))),t.opts.filter&&(e=n("<div>").html(e).find(t.opts.filter))),t.$slide.one("onReset",function(){n(this).find("video,audio").trigger("pause"),t.$placeholder&&(t.$placeholder.after(e.hide()).remove(),t.$placeholder=null),t.$smallBtn&&(t.$smallBtn.remove(),t.$smallBtn=null),t.hasError||(n(this).empty(),t.isLoaded=!1)}),n(e).appendTo(t.$slide),n(e).is("video,audio")&&(n(e).addClass("fancybox-video"),n(e).wrap("<div></div>"),t.contentType="video",t.opts.width=t.opts.width||n(e).attr("width"),t.opts.height=t.opts.height||n(e).attr("height")),t.$content=t.$slide.children().filter("div,form,main,video,audio").first().addClass("fancybox-content"),t.$slide.addClass("fancybox-slide--"+t.contentType),this.afterLoad(t))},setError:function(t){t.hasError=!0,t.$slide.trigger("onReset").removeClass("fancybox-slide--"+t.contentType).addClass("fancybox-slide--error"),t.contentType="html",this.setContent(t,this.translate(t,t.opts.errorTpl)),t.pos===this.currPos&&(this.isAnimating=!1)},showLoading:function(t){var e=this;t=t||e.current,t&&!t.$spinner&&(t.$spinner=n(e.translate(e,e.opts.spinnerTpl)).appendTo(t.$slide))},hideLoading:function(t){var e=this;t=t||e.current,t&&t.$spinner&&(t.$spinner.remove(),delete t.$spinner)},afterLoad:function(t){var e=this;e.isClosing||(t.isLoading=!1,t.isLoaded=!0,e.trigger("afterLoad",t),e.hideLoading(t),t.pos===e.currPos&&e.updateCursor(),!t.opts.smallBtn||t.$smallBtn&&t.$smallBtn.length||(t.$smallBtn=n(e.translate(t,t.opts.btnTpl.smallBtn)).prependTo(t.$content)),t.opts.protect&&t.$content&&!t.hasError&&(t.$content.on("contextmenu.fb",function(t){return 2==t.button&&t.preventDefault(),!0}),"image"===t.type&&n('<div class="fancybox-spaceball"></div>').appendTo(t.$content)),e.revealContent(t))},revealContent:function(t){var e,i,a,s,r=this,c=t.$slide,l=!1,d=!1;return e=t.opts[r.firstRun?"animationEffect":"transitionEffect"],a=t.opts[r.firstRun?"animationDuration":"transitionDuration"],a=parseInt(t.forcedDuration===o?a:t.forcedDuration,10),t.pos===r.currPos&&(t.isComplete?e=!1:r.isAnimating=!0),!t.isMoved&&t.pos===r.currPos&&a||(e=!1),"zoom"===e&&(t.pos===r.currPos&&a&&"image"===t.type&&!t.hasError&&(d=r.getThumbPos(t))?l=r.getFitPos(t):e="fade"),"zoom"===e?(l.scaleX=l.width/d.width,l.scaleY=l.height/d.height,s=t.opts.zoomOpacity,"auto"==s&&(s=Math.abs(t.width/t.height-d.width/d.height)>.1),s&&(d.opacity=.1,l.opacity=1),n.fancybox.setTranslate(t.$content.removeClass("fancybox-is-hidden"),d),f(t.$content),void n.fancybox.animate(t.$content,l,a,function(){r.isAnimating=!1,r.complete()})):(r.updateSlide(t),e?(n.fancybox.stop(c),i="fancybox-animated fancybox-slide--"+(t.pos>=r.prevPos?"next":"previous")+" fancybox-fx-"+e,c.removeAttr("style").removeClass("fancybox-slide--current fancybox-slide--next fancybox-slide--previous").addClass(i),t.$content.removeClass("fancybox-is-hidden"),f(c),void n.fancybox.animate(c,"fancybox-slide--current",a,function(e){c.removeClass(i).removeAttr("style"),t.pos===r.currPos&&r.complete()},!0)):(f(c),t.$content.removeClass("fancybox-is-hidden"),void(t.pos===r.currPos&&r.complete())))},getThumbPos:function(o){var i,a=this,s=!1,r=o.opts.$thumb,c=r&&r.length&&r[0].ownerDocument===e?r.offset():0,l=function(e){for(var o,i=e[0],a=i.getBoundingClientRect(),s=[];null!==i.parentElement;)"hidden"!==n(i.parentElement).css("overflow")&&"auto"!==n(i.parentElement).css("overflow")||s.push(i.parentElement.getBoundingClientRect()),i=i.parentElement;return o=s.every(function(t){var e=Math.min(a.right,t.right)-Math.max(a.left,t.left),n=Math.min(a.bottom,t.bottom)-Math.max(a.top,t.top);return e>0&&n>0}),o&&a.bottom>0&&a.right>0&&a.left<n(t).width()&&a.top<n(t).height()};return c&&l(r)&&(i=a.$refs.stage.offset(),s={top:c.top-i.top+parseFloat(r.css("border-top-width")||0),left:c.left-i.left+parseFloat(r.css("border-left-width")||0),width:r.width(),height:r.height(),scaleX:1,scaleY:1}),s},complete:function(){var t=this,o=t.current,i={};!o.isMoved&&o.isLoaded&&(o.isComplete||(o.isComplete=!0,o.$slide.siblings().trigger("onReset"),t.preload("inline"),f(o.$slide),o.$slide.addClass("fancybox-slide--complete"),n.each(t.slides,function(e,o){o.pos>=t.currPos-1&&o.pos<=t.currPos+1?i[o.pos]=o:o&&(n.fancybox.stop(o.$slide),o.$slide.off().remove())}),t.slides=i),t.isAnimating=!1,t.updateCursor(),t.trigger("afterShow"),o.$slide.find("video,audio").filter(":visible:first").trigger("play"),(n(e.activeElement).is("[disabled]")||o.opts.autoFocus&&"image"!=o.type&&"iframe"!==o.type)&&t.focus())},preload:function(t){var e=this,n=e.slides[e.currPos+1],o=e.slides[e.currPos-1];n&&n.type===t&&e.loadSlide(n),o&&o.type===t&&e.loadSlide(o)},focus:function(){var t,e=this.current;this.isClosing||e&&e.isComplete&&e.$content&&(t=e.$content.find("input[autofocus]:enabled:visible:first"),t.length||(t=e.$content.find("button,:input,[tabindex],a").filter(":enabled:visible:first")),t=t&&t.length?t:e.$content,t.trigger("focus"))},activate:function(){var t=this;n(".fancybox-container").each(function(){var e=n(this).data("FancyBox");e&&e.id!==t.id&&!e.isClosing&&(e.trigger("onDeactivate"),e.removeEvents(),e.isVisible=!1)}),t.isVisible=!0,(t.current||t.isIdle)&&(t.update(),t.updateControls()),t.trigger("onActivate"),t.addEvents()},close:function(t,e){var o,i,a,s,r,c,l,p=this,h=p.current,g=function(){p.cleanUp(t)};return!p.isClosing&&(p.isClosing=!0,p.trigger("beforeClose",t)===!1?(p.isClosing=!1,d(function(){p.update()}),!1):(p.removeEvents(),h.timouts&&clearTimeout(h.timouts),a=h.$content,o=h.opts.animationEffect,i=n.isNumeric(e)?e:o?h.opts.animationDuration:0,h.$slide.off(u).removeClass("fancybox-slide--complete fancybox-slide--next fancybox-slide--previous fancybox-animated"),h.$slide.siblings().trigger("onReset").remove(),i&&p.$refs.container.removeClass("fancybox-is-open").addClass("fancybox-is-closing"),p.hideLoading(h),p.hideControls(),p.updateCursor(),"zoom"!==o||t!==!0&&a&&i&&"image"===h.type&&!h.hasError&&(l=p.getThumbPos(h))||(o="fade"),"zoom"===o?(n.fancybox.stop(a),s=n.fancybox.getTranslate(a),c={top:s.top,left:s.left,scaleX:s.width/l.width,scaleY:s.height/l.height,width:l.width,height:l.height},r=h.opts.zoomOpacity,"auto"==r&&(r=Math.abs(h.width/h.height-l.width/l.height)>.1),r&&(l.opacity=0),n.fancybox.setTranslate(a,c),f(a),n.fancybox.animate(a,l,i,g),!0):(o&&i?t===!0?setTimeout(g,i):n.fancybox.animate(h.$slide.removeClass("fancybox-slide--current"),"fancybox-animated fancybox-slide--previous fancybox-fx-"+o,i,g):g(),!0)))},cleanUp:function(t){var e,o=this,i=n("body");o.current.$slide.trigger("onReset"),o.$refs.container.empty().remove(),o.trigger("afterClose",t),o.$lastFocus&&o.current.opts.backFocus&&o.$lastFocus.trigger("focus"),o.current=null,e=n.fancybox.getInstance(),e?e.activate():(i.removeClass("fancybox-active compensate-for-scrollbar"),n("#fancybox-style-noscroll").remove())},trigger:function(t,e){var o,i=Array.prototype.slice.call(arguments,1),a=this,s=e&&e.opts?e:a.current;return s?i.unshift(s):s=a,i.unshift(a),n.isFunction(s.opts[t])&&(o=s.opts[t].apply(s,i)),o===!1?o:void("afterClose"!==t&&a.$refs?a.$refs.container.trigger(t+".fb",i):r.trigger(t+".fb",i))},updateControls:function(t){var e=this,n=e.current,o=n.index,i=n.opts.caption,a=e.$refs.container,s=e.$refs.caption;n.$slide.trigger("refresh"),e.$caption=i&&i.length?s.html(i):null,e.isHiddenControls||e.isIdle||e.showControls(),a.find("[data-fancybox-count]").html(e.group.length),a.find("[data-fancybox-index]").html(o+1),a.find("[data-fancybox-prev]").toggleClass("disabled",!n.opts.loop&&o<=0),a.find("[data-fancybox-next]").toggleClass("disabled",!n.opts.loop&&o>=e.group.length-1),"image"===n.type?a.find("[data-fancybox-zoom]").show().end().find("[data-fancybox-download]").attr("href",n.opts.image.src||n.src).show():n.opts.toolbar&&a.find("[data-fancybox-download],[data-fancybox-zoom]").hide()},hideControls:function(){this.isHiddenControls=!0,this.$refs.container.removeClass("fancybox-show-infobar fancybox-show-toolbar fancybox-show-caption fancybox-show-nav")},showControls:function(){var t=this,e=t.current?t.current.opts:t.opts,n=t.$refs.container;t.isHiddenControls=!1,t.idleSecondsCounter=0,n.toggleClass("fancybox-show-toolbar",!(!e.toolbar||!e.buttons)).toggleClass("fancybox-show-infobar",!!(e.infobar&&t.group.length>1)).toggleClass("fancybox-show-nav",!!(e.arrows&&t.group.length>1)).toggleClass("fancybox-is-modal",!!e.modal),t.$caption?n.addClass("fancybox-show-caption "):n.removeClass("fancybox-show-caption")},toggleControls:function(){this.isHiddenControls?this.showControls():this.hideControls()}}),n.fancybox={version:"3.3.5",defaults:a,getInstance:function(t){var e=n('.fancybox-container:not(".fancybox-is-closing"):last').data("FancyBox"),o=Array.prototype.slice.call(arguments,1);return e instanceof h&&("string"===n.type(t)?e[t].apply(e,o):"function"===n.type(t)&&t.apply(e,o),e)},open:function(t,e,n){return new h(t,e,n)},close:function(t){var e=this.getInstance();e&&(e.close(),t===!0&&this.close())},destroy:function(){this.close(!0),r.add("body").off("click.fb-start","**")},isMobile:e.createTouch!==o&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),use3d:function(){var n=e.createElement("div");return t.getComputedStyle&&t.getComputedStyle(n)&&t.getComputedStyle(n).getPropertyValue("transform")&&!(e.documentMode&&e.documentMode<11)}(),getTranslate:function(t){var e;return!(!t||!t.length)&&(e=t[0].getBoundingClientRect(),{top:e.top||0,left:e.left||0,width:e.width,height:e.height,opacity:parseFloat(t.css("opacity"))})},setTranslate:function(t,e){var n="",i={};if(t&&e)return e.left===o&&e.top===o||(n=(e.left===o?t.position().left:e.left)+"px, "+(e.top===o?t.position().top:e.top)+"px",n=this.use3d?"translate3d("+n+", 0px)":"translate("+n+")"),e.scaleX!==o&&e.scaleY!==o&&(n=(n.length?n+" ":"")+"scale("+e.scaleX+", "+e.scaleY+")"),n.length&&(i.transform=n),e.opacity!==o&&(i.opacity=e.opacity),e.width!==o&&(i.width=e.width),e.height!==o&&(i.height=e.height),t.css(i)},animate:function(t,e,i,a,s){var r=!1;n.isFunction(i)&&(a=i,i=null),n.isPlainObject(e)||t.removeAttr("style"),n.fancybox.stop(t),t.on(u,function(o){(!o||!o.originalEvent||t.is(o.originalEvent.target)&&"z-index"!=o.originalEvent.propertyName)&&(n.fancybox.stop(t),r&&n.fancybox.setTranslate(t,r),
n.isPlainObject(e)?s===!1&&t.removeAttr("style"):s!==!0&&t.removeClass(e),n.isFunction(a)&&a(o))}),n.isNumeric(i)&&t.css("transition-duration",i+"ms"),n.isPlainObject(e)?(e.scaleX!==o&&e.scaleY!==o&&(r=n.extend({},e,{width:t.width()*e.scaleX,height:t.height()*e.scaleY,scaleX:1,scaleY:1}),delete e.width,delete e.height,t.parent().hasClass("fancybox-slide--image")&&t.parent().addClass("fancybox-is-scaling")),n.fancybox.setTranslate(t,e)):t.addClass(e),t.data("timer",setTimeout(function(){t.trigger("transitionend")},i+16))},stop:function(t){t&&t.length&&(clearTimeout(t.data("timer")),t.off("transitionend").css("transition-duration",""),t.parent().removeClass("fancybox-is-scaling"))}},n.fn.fancybox=function(t){var e;return t=t||{},e=t.selector||!1,e?n("body").off("click.fb-start",e).on("click.fb-start",e,{options:t},i):this.off("click.fb-start").on("click.fb-start",{items:this,options:t},i),this},r.on("click.fb-start","[data-fancybox]",i),r.on("click.fb-start","[data-trigger]",function(t){i(t,{$target:n('[data-fancybox="'+n(t.currentTarget).attr("data-trigger")+'"]').eq(n(t.currentTarget).attr("data-index")||0),$trigger:n(this)})})}}(window,document,window.jQuery||jQuery),function(t){"use strict";var e=function(e,n,o){if(e)return o=o||"","object"===t.type(o)&&(o=t.param(o,!0)),t.each(n,function(t,n){e=e.replace("$"+t,n||"")}),o.length&&(e+=(e.indexOf("?")>0?"&":"?")+o),e},n={youtube:{matcher:/(youtube\.com|youtu\.be|youtube\-nocookie\.com)\/(watch\?(.*&)?v=|v\/|u\/|embed\/?)?(videoseries\?list=(.*)|[\w-]{11}|\?listType=(.*)&list=(.*))(.*)/i,params:{autoplay:1,autohide:1,fs:1,rel:0,hd:1,wmode:"transparent",enablejsapi:1,html5:1},paramPlace:8,type:"iframe",url:"//www.youtube.com/embed/$4",thumb:"//img.youtube.com/vi/$4/hqdefault.jpg"},vimeo:{matcher:/^.+vimeo.com\/(.*\/)?([\d]+)(.*)?/,params:{autoplay:1,hd:1,show_title:1,show_byline:1,show_portrait:0,fullscreen:1,api:1},paramPlace:3,type:"iframe",url:"//player.vimeo.com/video/$2"},instagram:{matcher:/(instagr\.am|instagram\.com)\/p\/([a-zA-Z0-9_\-]+)\/?/i,type:"image",url:"//$1/p/$2/media/?size=l"},gmap_place:{matcher:/(maps\.)?google\.([a-z]{2,3}(\.[a-z]{2})?)\/(((maps\/(place\/(.*)\/)?\@(.*),(\d+.?\d+?)z))|(\?ll=))(.*)?/i,type:"iframe",url:function(t){return"//maps.google."+t[2]+"/?ll="+(t[9]?t[9]+"&z="+Math.floor(t[10])+(t[12]?t[12].replace(/^\//,"&"):""):t[12]+"").replace(/\?/,"&")+"&output="+(t[12]&&t[12].indexOf("layer=c")>0?"svembed":"embed")}},gmap_search:{matcher:/(maps\.)?google\.([a-z]{2,3}(\.[a-z]{2})?)\/(maps\/search\/)(.*)/i,type:"iframe",url:function(t){return"//maps.google."+t[2]+"/maps?q="+t[5].replace("query=","q=").replace("api=1","")+"&output=embed"}}};t(document).on("objectNeedsType.fb",function(o,i,a){var s,r,c,l,d,u,f,p=a.src||"",h=!1;s=t.extend(!0,{},n,a.opts.media),t.each(s,function(n,o){if(c=p.match(o.matcher)){if(h=o.type,f=n,u={},o.paramPlace&&c[o.paramPlace]){d=c[o.paramPlace],"?"==d[0]&&(d=d.substring(1)),d=d.split("&");for(var i=0;i<d.length;++i){var s=d[i].split("=",2);2==s.length&&(u[s[0]]=decodeURIComponent(s[1].replace(/\+/g," ")))}}return l=t.extend(!0,{},o.params,a.opts[n],u),p="function"===t.type(o.url)?o.url.call(this,c,l,a):e(o.url,c,l),r="function"===t.type(o.thumb)?o.thumb.call(this,c,l,a):e(o.thumb,c),"youtube"===n?p=p.replace(/&t=((\d+)m)?(\d+)s/,function(t,e,n,o){return"&start="+((n?60*parseInt(n,10):0)+parseInt(o,10))}):"vimeo"===n&&(p=p.replace("&%23","#")),!1}}),h?(a.opts.thumb||a.opts.$thumb&&a.opts.$thumb.length||(a.opts.thumb=r),"iframe"===h&&(a.opts=t.extend(!0,a.opts,{iframe:{preload:!1,attr:{scrolling:"no"}}})),t.extend(a,{type:h,src:p,origSrc:a.src,contentSource:f,contentType:"image"===h?"image":"gmap_place"==f||"gmap_search"==f?"map":"video"})):p&&(a.type=a.opts.defaultType)})}(window.jQuery||jQuery),function(t,e,n){"use strict";var o=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||function(e){return t.setTimeout(e,1e3/60)}}(),i=function(){return t.cancelAnimationFrame||t.webkitCancelAnimationFrame||t.mozCancelAnimationFrame||t.oCancelAnimationFrame||function(e){t.clearTimeout(e)}}(),a=function(e){var n=[];e=e.originalEvent||e||t.e,e=e.touches&&e.touches.length?e.touches:e.changedTouches&&e.changedTouches.length?e.changedTouches:[e];for(var o in e)e[o].pageX?n.push({x:e[o].pageX,y:e[o].pageY}):e[o].clientX&&n.push({x:e[o].clientX,y:e[o].clientY});return n},s=function(t,e,n){return e&&t?"x"===n?t.x-e.x:"y"===n?t.y-e.y:Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)):0},r=function(t){if(t.is('a,area,button,[role="button"],input,label,select,summary,textarea,video,audio')||n.isFunction(t.get(0).onclick)||t.data("selectable"))return!0;for(var e=0,o=t[0].attributes,i=o.length;e<i;e++)if("data-fancybox-"===o[e].nodeName.substr(0,14))return!0;return!1},c=function(e){var n=t.getComputedStyle(e)["overflow-y"],o=t.getComputedStyle(e)["overflow-x"],i=("scroll"===n||"auto"===n)&&e.scrollHeight>e.clientHeight,a=("scroll"===o||"auto"===o)&&e.scrollWidth>e.clientWidth;return i||a},l=function(t){for(var e=!1;;){if(e=c(t.get(0)))break;if(t=t.parent(),!t.length||t.hasClass("fancybox-stage")||t.is("body"))break}return e},d=function(t){var e=this;e.instance=t,e.$bg=t.$refs.bg,e.$stage=t.$refs.stage,e.$container=t.$refs.container,e.destroy(),e.$container.on("touchstart.fb.touch mousedown.fb.touch",n.proxy(e,"ontouchstart"))};d.prototype.destroy=function(){this.$container.off(".fb.touch")},d.prototype.ontouchstart=function(o){var i=this,c=n(o.target),d=i.instance,u=d.current,f=u.$content,p="touchstart"==o.type;if(p&&i.$container.off("mousedown.fb.touch"),(!o.originalEvent||2!=o.originalEvent.button)&&c.length&&!r(c)&&!r(c.parent())&&(c.is("img")||!(o.originalEvent.clientX>c[0].clientWidth+c.offset().left))){if(!u||d.isAnimating||d.isClosing)return o.stopPropagation(),void o.preventDefault();if(i.realPoints=i.startPoints=a(o),i.startPoints.length){if(o.stopPropagation(),i.startEvent=o,i.canTap=!0,i.$target=c,i.$content=f,i.opts=u.opts.touch,i.isPanning=!1,i.isSwiping=!1,i.isZooming=!1,i.isScrolling=!1,i.startTime=(new Date).getTime(),i.distanceX=i.distanceY=i.distance=0,i.canvasWidth=Math.round(u.$slide[0].clientWidth),i.canvasHeight=Math.round(u.$slide[0].clientHeight),i.contentLastPos=null,i.contentStartPos=n.fancybox.getTranslate(i.$content)||{top:0,left:0},i.sliderStartPos=i.sliderLastPos||n.fancybox.getTranslate(u.$slide),i.stagePos=n.fancybox.getTranslate(d.$refs.stage),i.sliderStartPos.top-=i.stagePos.top,i.sliderStartPos.left-=i.stagePos.left,i.contentStartPos.top-=i.stagePos.top,i.contentStartPos.left-=i.stagePos.left,n(e).off(".fb.touch").on(p?"touchend.fb.touch touchcancel.fb.touch":"mouseup.fb.touch mouseleave.fb.touch",n.proxy(i,"ontouchend")).on(p?"touchmove.fb.touch":"mousemove.fb.touch",n.proxy(i,"ontouchmove")),n.fancybox.isMobile&&e.addEventListener("scroll",i.onscroll,!0),!i.opts&&!d.canPan()||!c.is(i.$stage)&&!i.$stage.find(c).length)return void(c.is(".fancybox-image")&&o.preventDefault());n.fancybox.isMobile&&(l(c)||l(c.parent()))||o.preventDefault(),(1===i.startPoints.length||u.hasError)&&(i.instance.canPan()?(n.fancybox.stop(i.$content),i.$content.css("transition-duration",""),i.isPanning=!0):i.isSwiping=!0,i.$container.addClass("fancybox-controls--isGrabbing")),2===i.startPoints.length&&"image"===u.type&&(u.isLoaded||u.$ghost)&&(i.canTap=!1,i.isSwiping=!1,i.isPanning=!1,i.isZooming=!0,n.fancybox.stop(i.$content),i.$content.css("transition-duration",""),i.centerPointStartX=.5*(i.startPoints[0].x+i.startPoints[1].x)-n(t).scrollLeft(),i.centerPointStartY=.5*(i.startPoints[0].y+i.startPoints[1].y)-n(t).scrollTop(),i.percentageOfImageAtPinchPointX=(i.centerPointStartX-i.contentStartPos.left)/i.contentStartPos.width,i.percentageOfImageAtPinchPointY=(i.centerPointStartY-i.contentStartPos.top)/i.contentStartPos.height,i.startDistanceBetweenFingers=s(i.startPoints[0],i.startPoints[1]))}}},d.prototype.onscroll=function(t){var n=this;n.isScrolling=!0,e.removeEventListener("scroll",n.onscroll,!0)},d.prototype.ontouchmove=function(t){var e=this,o=n(t.target);return void 0!==t.originalEvent.buttons&&0===t.originalEvent.buttons?void e.ontouchend(t):e.isScrolling||!o.is(e.$stage)&&!e.$stage.find(o).length?void(e.canTap=!1):(e.newPoints=a(t),void((e.opts||e.instance.canPan())&&e.newPoints.length&&e.newPoints.length&&(e.isSwiping&&e.isSwiping===!0||t.preventDefault(),e.distanceX=s(e.newPoints[0],e.startPoints[0],"x"),e.distanceY=s(e.newPoints[0],e.startPoints[0],"y"),e.distance=s(e.newPoints[0],e.startPoints[0]),e.distance>0&&(e.isSwiping?e.onSwipe(t):e.isPanning?e.onPan():e.isZooming&&e.onZoom()))))},d.prototype.onSwipe=function(e){var a,s=this,r=s.isSwiping,c=s.sliderStartPos.left||0;if(r!==!0)"x"==r&&(s.distanceX>0&&(s.instance.group.length<2||0===s.instance.current.index&&!s.instance.current.opts.loop)?c+=Math.pow(s.distanceX,.8):s.distanceX<0&&(s.instance.group.length<2||s.instance.current.index===s.instance.group.length-1&&!s.instance.current.opts.loop)?c-=Math.pow(-s.distanceX,.8):c+=s.distanceX),s.sliderLastPos={top:"x"==r?0:s.sliderStartPos.top+s.distanceY,left:c},s.requestId&&(i(s.requestId),s.requestId=null),s.requestId=o(function(){s.sliderLastPos&&(n.each(s.instance.slides,function(t,e){var o=e.pos-s.instance.currPos;n.fancybox.setTranslate(e.$slide,{top:s.sliderLastPos.top,left:s.sliderLastPos.left+o*s.canvasWidth+o*e.opts.gutter})}),s.$container.addClass("fancybox-is-sliding"))});else if(Math.abs(s.distance)>10){if(s.canTap=!1,s.instance.group.length<2&&s.opts.vertical?s.isSwiping="y":s.instance.isDragging||s.opts.vertical===!1||"auto"===s.opts.vertical&&n(t).width()>800?s.isSwiping="x":(a=Math.abs(180*Math.atan2(s.distanceY,s.distanceX)/Math.PI),s.isSwiping=a>45&&a<135?"y":"x"),s.canTap=!1,"y"===s.isSwiping&&n.fancybox.isMobile&&(l(s.$target)||l(s.$target.parent())))return void(s.isScrolling=!0);s.instance.isDragging=s.isSwiping,s.startPoints=s.newPoints,n.each(s.instance.slides,function(t,e){n.fancybox.stop(e.$slide),e.$slide.css("transition-duration",""),e.inTransition=!1,e.pos===s.instance.current.pos&&(s.sliderStartPos.left=n.fancybox.getTranslate(e.$slide).left-n.fancybox.getTranslate(s.instance.$refs.stage).left)}),s.instance.SlideShow&&s.instance.SlideShow.isActive&&s.instance.SlideShow.stop()}},d.prototype.onPan=function(){var t=this;return s(t.newPoints[0],t.realPoints[0])<(n.fancybox.isMobile?10:5)?void(t.startPoints=t.newPoints):(t.canTap=!1,t.contentLastPos=t.limitMovement(),t.requestId&&(i(t.requestId),t.requestId=null),void(t.requestId=o(function(){n.fancybox.setTranslate(t.$content,t.contentLastPos)})))},d.prototype.limitMovement=function(){var t,e,n,o,i,a,s=this,r=s.canvasWidth,c=s.canvasHeight,l=s.distanceX,d=s.distanceY,u=s.contentStartPos,f=u.left,p=u.top,h=u.width,g=u.height;return i=h>r?f+l:f,a=p+d,t=Math.max(0,.5*r-.5*h),e=Math.max(0,.5*c-.5*g),n=Math.min(r-h,.5*r-.5*h),o=Math.min(c-g,.5*c-.5*g),l>0&&i>t&&(i=t-1+Math.pow(-t+f+l,.8)||0),l<0&&i<n&&(i=n+1-Math.pow(n-f-l,.8)||0),d>0&&a>e&&(a=e-1+Math.pow(-e+p+d,.8)||0),d<0&&a<o&&(a=o+1-Math.pow(o-p-d,.8)||0),{top:a,left:i}},d.prototype.limitPosition=function(t,e,n,o){var i=this,a=i.canvasWidth,s=i.canvasHeight;return n>a?(t=t>0?0:t,t=t<a-n?a-n:t):t=Math.max(0,a/2-n/2),o>s?(e=e>0?0:e,e=e<s-o?s-o:e):e=Math.max(0,s/2-o/2),{top:e,left:t}},d.prototype.onZoom=function(){var e=this,a=e.contentStartPos,r=a.width,c=a.height,l=a.left,d=a.top,u=s(e.newPoints[0],e.newPoints[1]),f=u/e.startDistanceBetweenFingers,p=Math.floor(r*f),h=Math.floor(c*f),g=(r-p)*e.percentageOfImageAtPinchPointX,b=(c-h)*e.percentageOfImageAtPinchPointY,m=(e.newPoints[0].x+e.newPoints[1].x)/2-n(t).scrollLeft(),y=(e.newPoints[0].y+e.newPoints[1].y)/2-n(t).scrollTop(),v=m-e.centerPointStartX,x=y-e.centerPointStartY,w=l+(g+v),$=d+(b+x),S={top:$,left:w,scaleX:f,scaleY:f};e.canTap=!1,e.newWidth=p,e.newHeight=h,e.contentLastPos=S,e.requestId&&(i(e.requestId),e.requestId=null),e.requestId=o(function(){n.fancybox.setTranslate(e.$content,e.contentLastPos)})},d.prototype.ontouchend=function(t){var o=this,s=Math.max((new Date).getTime()-o.startTime,1),r=o.isSwiping,c=o.isPanning,l=o.isZooming,d=o.isScrolling;return o.endPoints=a(t),o.$container.removeClass("fancybox-controls--isGrabbing"),n(e).off(".fb.touch"),e.removeEventListener("scroll",o.onscroll,!0),o.requestId&&(i(o.requestId),o.requestId=null),o.isSwiping=!1,o.isPanning=!1,o.isZooming=!1,o.isScrolling=!1,o.instance.isDragging=!1,o.canTap?o.onTap(t):(o.speed=366,o.velocityX=o.distanceX/s*.5,o.velocityY=o.distanceY/s*.5,o.speedX=Math.max(.5*o.speed,Math.min(1.5*o.speed,1/Math.abs(o.velocityX)*o.speed)),void(c?o.endPanning():l?o.endZooming():o.endSwiping(r,d)))},d.prototype.endSwiping=function(t,e){var o=this,i=!1,a=o.instance.group.length;o.sliderLastPos=null,"y"==t&&!e&&Math.abs(o.distanceY)>50?(n.fancybox.animate(o.instance.current.$slide,{top:o.sliderStartPos.top+o.distanceY+150*o.velocityY,opacity:0},200),i=o.instance.close(!0,200)):"x"==t&&o.distanceX>50&&a>1?i=o.instance.previous(o.speedX):"x"==t&&o.distanceX<-50&&a>1&&(i=o.instance.next(o.speedX)),i!==!1||"x"!=t&&"y"!=t||(e||a<2?o.instance.centerSlide(o.instance.current,150):o.instance.jumpTo(o.instance.current.index)),o.$container.removeClass("fancybox-is-sliding")},d.prototype.endPanning=function(){var t,e,o,i=this;i.contentLastPos&&(i.opts.momentum===!1?(t=i.contentLastPos.left,e=i.contentLastPos.top):(t=i.contentLastPos.left+i.velocityX*i.speed,e=i.contentLastPos.top+i.velocityY*i.speed),o=i.limitPosition(t,e,i.contentStartPos.width,i.contentStartPos.height),o.width=i.contentStartPos.width,o.height=i.contentStartPos.height,n.fancybox.animate(i.$content,o,330))},d.prototype.endZooming=function(){var t,e,o,i,a=this,s=a.instance.current,r=a.newWidth,c=a.newHeight;a.contentLastPos&&(t=a.contentLastPos.left,e=a.contentLastPos.top,i={top:e,left:t,width:r,height:c,scaleX:1,scaleY:1},n.fancybox.setTranslate(a.$content,i),r<a.canvasWidth&&c<a.canvasHeight?a.instance.scaleToFit(150):r>s.width||c>s.height?a.instance.scaleToActual(a.centerPointStartX,a.centerPointStartY,150):(o=a.limitPosition(t,e,r,c),n.fancybox.setTranslate(a.$content,n.fancybox.getTranslate(a.$content)),n.fancybox.animate(a.$content,o,150)))},d.prototype.onTap=function(e){var o,i=this,s=n(e.target),r=i.instance,c=r.current,l=e&&a(e)||i.startPoints,d=l[0]?l[0].x-n(t).scrollLeft()-i.stagePos.left:0,u=l[0]?l[0].y-n(t).scrollTop()-i.stagePos.top:0,f=function(t){var o=c.opts[t];if(n.isFunction(o)&&(o=o.apply(r,[c,e])),o)switch(o){case"close":r.close(i.startEvent);break;case"toggleControls":r.toggleControls(!0);break;case"next":r.next();break;case"nextOrClose":r.group.length>1?r.next():r.close(i.startEvent);break;case"zoom":"image"==c.type&&(c.isLoaded||c.$ghost)&&(r.canPan()?r.scaleToFit():r.isScaledDown()?r.scaleToActual(d,u):r.group.length<2&&r.close(i.startEvent))}};if((!e.originalEvent||2!=e.originalEvent.button)&&(s.is("img")||!(d>s[0].clientWidth+s.offset().left))){if(s.is(".fancybox-bg,.fancybox-inner,.fancybox-outer,.fancybox-container"))o="Outside";else if(s.is(".fancybox-slide"))o="Slide";else{if(!r.current.$content||!r.current.$content.find(s).addBack().filter(s).length)return;o="Content"}if(i.tapped){if(clearTimeout(i.tapped),i.tapped=null,Math.abs(d-i.tapX)>50||Math.abs(u-i.tapY)>50)return this;f("dblclick"+o)}else i.tapX=d,i.tapY=u,c.opts["dblclick"+o]&&c.opts["dblclick"+o]!==c.opts["click"+o]?i.tapped=setTimeout(function(){i.tapped=null,f("click"+o)},500):f("click"+o);return this}},n(e).on("onActivate.fb",function(t,e){e&&!e.Guestures&&(e.Guestures=new d(e))})}(window,document,window.jQuery||jQuery),function(t,e){"use strict";e.extend(!0,e.fancybox.defaults,{btnTpl:{slideShow:'<button data-fancybox-play class="fancybox-button fancybox-button--play" title="{{PLAY_START}}"><svg viewBox="0 0 40 40"><path d="M13,12 L27,20 L13,27 Z" /><path d="M15,10 v19 M23,10 v19" /></svg></button>'},slideShow:{autoStart:!1,speed:3e3}});var n=function(t){this.instance=t,this.init()};e.extend(n.prototype,{timer:null,isActive:!1,$button:null,init:function(){var t=this;t.$button=t.instance.$refs.toolbar.find("[data-fancybox-play]").on("click",function(){t.toggle()}),(t.instance.group.length<2||!t.instance.group[t.instance.currIndex].opts.slideShow)&&t.$button.hide()},set:function(t){var e=this;e.instance&&e.instance.current&&(t===!0||e.instance.current.opts.loop||e.instance.currIndex<e.instance.group.length-1)?e.timer=setTimeout(function(){e.isActive&&e.instance.jumpTo((e.instance.currIndex+1)%e.instance.group.length)},e.instance.current.opts.slideShow.speed):(e.stop(),e.instance.idleSecondsCounter=0,e.instance.showControls())},clear:function(){var t=this;clearTimeout(t.timer),t.timer=null},start:function(){var t=this,e=t.instance.current;e&&(t.isActive=!0,t.$button.attr("title",e.opts.i18n[e.opts.lang].PLAY_STOP).removeClass("fancybox-button--play").addClass("fancybox-button--pause"),t.set(!0))},stop:function(){var t=this,e=t.instance.current;t.clear(),t.$button.attr("title",e.opts.i18n[e.opts.lang].PLAY_START).removeClass("fancybox-button--pause").addClass("fancybox-button--play"),t.isActive=!1},toggle:function(){var t=this;t.isActive?t.stop():t.start()}}),e(t).on({"onInit.fb":function(t,e){e&&!e.SlideShow&&(e.SlideShow=new n(e))},"beforeShow.fb":function(t,e,n,o){var i=e&&e.SlideShow;o?i&&n.opts.slideShow.autoStart&&i.start():i&&i.isActive&&i.clear()},"afterShow.fb":function(t,e,n){var o=e&&e.SlideShow;o&&o.isActive&&o.set()},"afterKeydown.fb":function(n,o,i,a,s){var r=o&&o.SlideShow;!r||!i.opts.slideShow||80!==s&&32!==s||e(t.activeElement).is("button,a,input")||(a.preventDefault(),r.toggle())},"beforeClose.fb onDeactivate.fb":function(t,e){var n=e&&e.SlideShow;n&&n.stop()}}),e(t).on("visibilitychange",function(){var n=e.fancybox.getInstance(),o=n&&n.SlideShow;o&&o.isActive&&(t.hidden?o.clear():o.set())})}(document,window.jQuery||jQuery),function(t,e){"use strict";var n=function(){for(var e=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n={},o=0;o<e.length;o++){var i=e[o];if(i&&i[1]in t){for(var a=0;a<i.length;a++)n[e[0][a]]=i[a];return n}}return!1}();if(!n)return void(e&&e.fancybox&&(e.fancybox.defaults.btnTpl.fullScreen=!1));var o={request:function(e){e=e||t.documentElement,e[n.requestFullscreen](e.ALLOW_KEYBOARD_INPUT)},exit:function(){t[n.exitFullscreen]()},toggle:function(e){e=e||t.documentElement,this.isFullscreen()?this.exit():this.request(e)},isFullscreen:function(){return Boolean(t[n.fullscreenElement])},enabled:function(){return Boolean(t[n.fullscreenEnabled])}};e.extend(!0,e.fancybox.defaults,{btnTpl:{fullScreen:'<button data-fancybox-fullscreen class="fancybox-button fancybox-button--fullscreen" title="{{FULL_SCREEN}}"><svg viewBox="0 0 40 40"><path d="M9,12 v16 h22 v-16 h-22 v8" /></svg></button>'},fullScreen:{autoStart:!1}}),e(t).on({"onInit.fb":function(t,e){var n;e&&e.group[e.currIndex].opts.fullScreen?(n=e.$refs.container,n.on("click.fb-fullscreen","[data-fancybox-fullscreen]",function(t){t.stopPropagation(),t.preventDefault(),o.toggle()}),e.opts.fullScreen&&e.opts.fullScreen.autoStart===!0&&o.request(),e.FullScreen=o):e&&e.$refs.toolbar.find("[data-fancybox-fullscreen]").hide()},"afterKeydown.fb":function(t,e,n,o,i){e&&e.FullScreen&&70===i&&(o.preventDefault(),e.FullScreen.toggle())},"beforeClose.fb":function(t,e){e&&e.FullScreen&&e.$refs.container.hasClass("fancybox-is-fullscreen")&&o.exit()}}),e(t).on(n.fullscreenchange,function(){var t=o.isFullscreen(),n=e.fancybox.getInstance();n&&(n.current&&"image"===n.current.type&&n.isAnimating&&(n.current.$content.css("transition","none"),n.isAnimating=!1,n.update(!0,!0,0)),n.trigger("onFullscreenChange",t),n.$refs.container.toggleClass("fancybox-is-fullscreen",t))})}(document,window.jQuery||jQuery),function(t,e){"use strict";var n="fancybox-thumbs",o=n+"-active",i=n+"-loading";e.fancybox.defaults=e.extend(!0,{btnTpl:{thumbs:'<button data-fancybox-thumbs class="fancybox-button fancybox-button--thumbs" title="{{THUMBS}}"><svg viewBox="0 0 120 120"><path d="M30,30 h14 v14 h-14 Z M50,30 h14 v14 h-14 Z M70,30 h14 v14 h-14 Z M30,50 h14 v14 h-14 Z M50,50 h14 v14 h-14 Z M70,50 h14 v14 h-14 Z M30,70 h14 v14 h-14 Z M50,70 h14 v14 h-14 Z M70,70 h14 v14 h-14 Z" /></svg></button>'},thumbs:{autoStart:!1,hideOnClose:!0,parentEl:".fancybox-container",axis:"y"}},e.fancybox.defaults);var a=function(t){this.init(t)};e.extend(a.prototype,{$button:null,$grid:null,$list:null,isVisible:!1,isActive:!1,init:function(t){var e,n,o=this;o.instance=t,t.Thumbs=o,o.opts=t.group[t.currIndex].opts.thumbs,e=t.group[0],e=e.opts.thumb||!(!e.opts.$thumb||!e.opts.$thumb.length)&&e.opts.$thumb.attr("src"),t.group.length>1&&(n=t.group[1],n=n.opts.thumb||!(!n.opts.$thumb||!n.opts.$thumb.length)&&n.opts.$thumb.attr("src")),o.$button=t.$refs.toolbar.find("[data-fancybox-thumbs]"),o.opts&&e&&n&&e&&n?(o.$button.show().on("click",function(){o.toggle()}),o.isActive=!0):o.$button.hide()},create:function(){var t,o=this,a=o.instance,s=o.opts.parentEl,r=[];o.$grid||(o.$grid=e('<div class="'+n+" "+n+"-"+o.opts.axis+'"></div>').appendTo(a.$refs.container.find(s).addBack().filter(s)),o.$grid.on("click","li",function(){a.jumpTo(e(this).attr("data-index"))})),o.$list||(o.$list=e("<ul>").appendTo(o.$grid)),e.each(a.group,function(e,n){t=n.opts.thumb||(n.opts.$thumb?n.opts.$thumb.attr("src"):null),t||"image"!==n.type||(t=n.src),r.push('<li data-index="'+e+'" tabindex="0" class="'+i+'"'+(t&&t.length?' style="background-image:url('+t+')" />':"")+"></li>")}),o.$list[0].innerHTML=r.join(""),"x"===o.opts.axis&&o.$list.width(parseInt(o.$grid.css("padding-right"),10)+a.group.length*o.$list.children().eq(0).outerWidth(!0))},focus:function(t){var e,n,i=this,a=i.$list,s=i.$grid;i.instance.current&&(e=a.children().removeClass(o).filter('[data-index="'+i.instance.current.index+'"]').addClass(o),n=e.position(),"y"===i.opts.axis&&(n.top<0||n.top>a.height()-e.outerHeight())?a.stop().animate({scrollTop:a.scrollTop()+n.top},t):"x"===i.opts.axis&&(n.left<s.scrollLeft()||n.left>s.scrollLeft()+(s.width()-e.outerWidth()))&&a.parent().stop().animate({scrollLeft:n.left},t))},update:function(){var t=this;t.instance.$refs.container.toggleClass("fancybox-show-thumbs",this.isVisible),t.isVisible?(t.$grid||t.create(),t.instance.trigger("onThumbsShow"),t.focus(0)):t.$grid&&t.instance.trigger("onThumbsHide"),t.instance.update()},hide:function(){this.isVisible=!1,this.update()},show:function(){this.isVisible=!0,this.update()},toggle:function(){this.isVisible=!this.isVisible,this.update()}}),e(t).on({"onInit.fb":function(t,e){var n;e&&!e.Thumbs&&(n=new a(e),n.isActive&&n.opts.autoStart===!0&&n.show())},"beforeShow.fb":function(t,e,n,o){var i=e&&e.Thumbs;i&&i.isVisible&&i.focus(o?0:250)},"afterKeydown.fb":function(t,e,n,o,i){var a=e&&e.Thumbs;a&&a.isActive&&71===i&&(o.preventDefault(),a.toggle())},"beforeClose.fb":function(t,e){var n=e&&e.Thumbs;n&&n.isVisible&&n.opts.hideOnClose!==!1&&n.$grid.hide()}})}(document,window.jQuery||jQuery),function(t,e){"use strict";function n(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(t).replace(/[&<>"'`=\/]/g,function(t){return e[t]})}e.extend(!0,e.fancybox.defaults,{btnTpl:{share:'<button data-fancybox-share class="fancybox-button fancybox-button--share" title="{{SHARE}}"><svg viewBox="0 0 40 40"><path d="M6,30 C8,18 19,16 23,16 L23,16 L23,10 L33,20 L23,29 L23,24 C19,24 8,27 6,30 Z"></svg></button>'},share:{url:function(t,e){return!t.currentHash&&"inline"!==e.type&&"html"!==e.type&&(e.origSrc||e.src)||window.location},tpl:'<div class="fancybox-share"><h1>{{SHARE}}</h1><p><a class="fancybox-share__button fancybox-share__button--fb" href="https://www.facebook.com/sharer/sharer.php?u={{url}}"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m287 456v-299c0-21 6-35 35-35h38v-63c-7-1-29-3-55-3-54 0-91 33-91 94v306m143-254h-205v72h196" /></svg><span>Facebook</span></a><a class="fancybox-share__button fancybox-share__button--tw" href="https://twitter.com/intent/tweet?url={{url}}&text={{descr}}"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m456 133c-14 7-31 11-47 13 17-10 30-27 37-46-15 10-34 16-52 20-61-62-157-7-141 75-68-3-129-35-169-85-22 37-11 86 26 109-13 0-26-4-37-9 0 39 28 72 65 80-12 3-25 4-37 2 10 33 41 57 77 57-42 30-77 38-122 34 170 111 378-32 359-208 16-11 30-25 41-42z" /></svg><span>Twitter</span></a><a class="fancybox-share__button fancybox-share__button--pt" href="https://www.pinterest.com/pin/create/button/?url={{url}}&description={{descr}}&media={{media}}"><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m265 56c-109 0-164 78-164 144 0 39 15 74 47 87 5 2 10 0 12-5l4-19c2-6 1-8-3-13-9-11-15-25-15-45 0-58 43-110 113-110 62 0 96 38 96 88 0 67-30 122-73 122-24 0-42-19-36-44 6-29 20-60 20-81 0-19-10-35-31-35-25 0-44 26-44 60 0 21 7 36 7 36l-30 125c-8 37-1 83 0 87 0 3 4 4 5 2 2-3 32-39 42-75l16-64c8 16 31 29 56 29 74 0 124-67 124-157 0-69-58-132-146-132z" fill="#fff"/></svg><span>Pinterest</span></a></p><p><input class="fancybox-share__input" type="text" value="{{url_raw}}" /></p></div>'}}),e(t).on("click","[data-fancybox-share]",function(){var t,o,i=e.fancybox.getInstance(),a=i.current||null;a&&("function"===e.type(a.opts.share.url)&&(t=a.opts.share.url.apply(a,[i,a])),o=a.opts.share.tpl.replace(/\{\{media\}\}/g,"image"===a.type?encodeURIComponent(a.src):"").replace(/\{\{url\}\}/g,encodeURIComponent(t)).replace(/\{\{url_raw\}\}/g,n(t)).replace(/\{\{descr\}\}/g,i.$caption?encodeURIComponent(i.$caption.text()):""),e.fancybox.open({src:i.translate(i,o),type:"html",opts:{animationEffect:!1,afterLoad:function(t,e){i.$refs.container.one("beforeClose.fb",function(){t.close(null,0)}),e.$content.find(".fancybox-share__links a").click(function(){return window.open(this.href,"Share","width=550, height=450"),!1})}}}))})}(document,window.jQuery||jQuery),function(t,e,n){"use strict";function o(){var t=e.location.hash.substr(1),n=t.split("-"),o=n.length>1&&/^\+?\d+$/.test(n[n.length-1])?parseInt(n.pop(-1),10)||1:1,i=n.join("-");return{hash:t,index:o<1?1:o,gallery:i}}function i(t){var e;""!==t.gallery&&(e=n("[data-fancybox='"+n.escapeSelector(t.gallery)+"']").eq(t.index-1).trigger("click.fb-start"))}function a(t){var e,n;return!!t&&(e=t.current?t.current.opts:t.opts,n=e.hash||(e.$orig?e.$orig.data("fancybox"):""),""!==n&&n)}n.escapeSelector||(n.escapeSelector=function(t){var e=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g,n=function(t,e){return e?"\0"===t?"�":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t};return(t+"").replace(e,n)}),n(function(){n.fancybox.defaults.hash!==!1&&(n(t).on({"onInit.fb":function(t,e){var n,i;e.group[e.currIndex].opts.hash!==!1&&(n=o(),i=a(e),i&&n.gallery&&i==n.gallery&&(e.currIndex=n.index-1))},"beforeShow.fb":function(n,o,i,s){var r;i&&i.opts.hash!==!1&&(r=a(o),r&&(o.currentHash=r+(o.group.length>1?"-"+(i.index+1):""),e.location.hash!=="#"+o.currentHash&&(o.origHash||(o.origHash=e.location.hash),o.hashTimer&&clearTimeout(o.hashTimer),o.hashTimer=setTimeout(function(){"replaceState"in e.history?(e.history[s?"pushState":"replaceState"]({},t.title,e.location.pathname+e.location.search+"#"+o.currentHash),s&&(o.hasCreatedHistory=!0)):e.location.hash=o.currentHash,o.hashTimer=null},300))))},"beforeClose.fb":function(n,o,i){var s;i.opts.hash!==!1&&(s=a(o),o.currentHash&&o.hasCreatedHistory?e.history.back():o.currentHash&&("replaceState"in e.history?e.history.replaceState({},t.title,e.location.pathname+e.location.search+(o.origHash||"")):e.location.hash=o.origHash),o.currentHash=null,clearTimeout(o.hashTimer))}}),n(e).on("hashchange.fb",function(){var t,e=o();n.each(n(".fancybox-container").get().reverse(),function(e,o){var i=n(o).data("FancyBox");if(i.currentHash)return t=i,!1}),t?!t.currentHash||t.currentHash===e.gallery+"-"+e.index||1===e.index&&t.currentHash==e.gallery||(t.currentHash=null,t.close()):""!==e.gallery&&i(e)}),setTimeout(function(){n.fancybox.getInstance()||i(o())},50))})}(document,window,window.jQuery||jQuery),function(t,e){"use strict";var n=(new Date).getTime();e(t).on({"onInit.fb":function(t,e,o){e.$refs.stage.on("mousewheel DOMMouseScroll wheel MozMousePixelScroll",function(t){var o=e.current,i=(new Date).getTime();e.group.length<2||o.opts.wheel===!1||"auto"===o.opts.wheel&&"image"!==o.type||(t.preventDefault(),t.stopPropagation(),o.$slide.hasClass("fancybox-animated")||(t=t.originalEvent||t,i-n<250||(n=i,e[(-t.deltaY||-t.deltaX||t.wheelDelta||-t.detail)<0?"next":"previous"]())))})}})}(document,window.jQuery||jQuery);

/*********************/
/****** 	parsley.min.js	 ***********/
/*********************/
/*!
* Parsley.js
* Version 2.8.1 - built Sat, Feb 3rd 2018, 2:27 pm
* http://parsleyjs.org
* Guillaume Potier - <guillaume@wisembly.com>
* Marc-Andre Lafortune - <petroselinum@marc-andre.ca>
* MIT Licensed
*/
function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var _slice=Array.prototype.slice,_slicedToArray=function(){function e(e,t){var i=[],n=!0,r=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(l){r=!0,s=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw s}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):e.parsley=t(e.jQuery)}(this,function(e){"use strict";function t(e,t){return e.parsleyAdaptedCallback||(e.parsleyAdaptedCallback=function(){var i=Array.prototype.slice.call(arguments,0);i.unshift(this),e.apply(t||M,i)}),e.parsleyAdaptedCallback}function i(e){return 0===e.lastIndexOf(D,0)?e.substr(D.length):e}/**
   * inputevent - Alleviate browser bugs for input events
   * https://github.com/marcandre/inputevent
   * @version v0.0.3 - (built Thu, Apr 14th 2016, 5:58 pm)
   * @author Marc-Andre Lafortune <github@marc-andre.ca>
   * @license MIT
   */
function n(){var t=this,i=window||global;_extends(this,{isNativeEvent:function(e){return e.originalEvent&&e.originalEvent.isTrusted!==!1},fakeInputEvent:function(i){t.isNativeEvent(i)&&e(i.target).trigger("input")},misbehaves:function(i){t.isNativeEvent(i)&&(t.behavesOk(i),e(document).on("change.inputevent",i.data.selector,t.fakeInputEvent),t.fakeInputEvent(i))},behavesOk:function(i){t.isNativeEvent(i)&&e(document).off("input.inputevent",i.data.selector,t.behavesOk).off("change.inputevent",i.data.selector,t.misbehaves)},install:function(){if(!i.inputEventPatched){i.inputEventPatched="0.0.3";for(var n=["select",'input[type="checkbox"]','input[type="radio"]','input[type="file"]'],r=0;r<n.length;r++){var s=n[r];e(document).on("input.inputevent",s,{selector:s},t.behavesOk).on("change.inputevent",s,{selector:s},t.misbehaves)}}},uninstall:function(){delete i.inputEventPatched,e(document).off(".inputevent")}})}var r=1,s={},a={attr:function(e,t,i){var n,r,s,a=new RegExp("^"+t,"i");if("undefined"==typeof i)i={};else for(n in i)i.hasOwnProperty(n)&&delete i[n];if(!e)return i;for(s=e.attributes,n=s.length;n--;)r=s[n],r&&r.specified&&a.test(r.name)&&(i[this.camelize(r.name.slice(t.length))]=this.deserializeValue(r.value));return i},checkAttr:function(e,t,i){return e.hasAttribute(t+i)},setAttr:function(e,t,i,n){e.setAttribute(this.dasherize(t+i),String(n))},getType:function(e){return e.getAttribute("type")||"text"},generateID:function(){return""+r++},deserializeValue:function(e){var t;try{return e?"true"==e||"false"!=e&&("null"==e?null:isNaN(t=Number(e))?/^[\[\{]/.test(e)?JSON.parse(e):e:t):e}catch(i){return e}},camelize:function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},dasherize:function(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()},warn:function(){var e;window.console&&"function"==typeof window.console.warn&&(e=window.console).warn.apply(e,arguments)},warnOnce:function(e){s[e]||(s[e]=!0,this.warn.apply(this,arguments))},_resetWarnings:function(){s={}},trimString:function(e){return e.replace(/^\s+|\s+$/g,"")},parse:{date:function S(e){var t=e.match(/^(\d{4,})-(\d\d)-(\d\d)$/);if(!t)return null;var i=t.map(function(e){return parseInt(e,10)}),n=_slicedToArray(i,4),r=(n[0],n[1]),s=n[2],a=n[3],S=new Date(r,s-1,a);return S.getFullYear()!==r||S.getMonth()+1!==s||S.getDate()!==a?null:S},string:function(e){return e},integer:function(e){return isNaN(e)?null:parseInt(e,10)},number:function(e){if(isNaN(e))throw null;return parseFloat(e)},"boolean":function(e){return!/^\s*false\s*$/i.test(e)},object:function(e){return a.deserializeValue(e)},regexp:function(e){var t="";return/^\/.*\/(?:[gimy]*)$/.test(e)?(t=e.replace(/.*\/([gimy]*)$/,"$1"),e=e.replace(new RegExp("^/(.*?)/"+t+"$"),"$1")):e="^"+e+"$",new RegExp(e,t)}},parseRequirement:function(e,t){var i=this.parse[e||"string"];if(!i)throw'Unknown requirement specification: "'+e+'"';var n=i(t);if(null===n)throw"Requirement is not a "+e+': "'+t+'"';return n},namespaceEvents:function(t,i){return t=this.trimString(t||"").split(/\s+/),t[0]?e.map(t,function(e){return e+"."+i}).join(" "):""},difference:function(t,i){var n=[];return e.each(t,function(e,t){i.indexOf(t)==-1&&n.push(t)}),n},all:function(t){return e.when.apply(e,_toConsumableArray(t).concat([42,42]))},objectCreate:Object.create||function(){var e=function(){};return function(t){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof t)throw TypeError("Argument must be an object");e.prototype=t;var i=new e;return e.prototype=null,i}}(),_SubmitSelector:'input[type="submit"], button:submit'},o={namespace:"data-parsley-",inputs:"input, textarea, select",excluded:"input[type=button], input[type=submit], input[type=reset], input[type=hidden]",priorityEnabled:!0,multiple:null,group:null,uiEnabled:!0,validationThreshold:3,focus:"first",trigger:!1,triggerAfterFailure:"input",errorClass:"parsley-error",successClass:"parsley-success",classHandler:function(e){},errorsContainer:function(e){},errorsWrapper:'<ul class="parsley-errors-list"></ul>',errorTemplate:"<li></li>"},l=function(){this.__id__=a.generateID()};l.prototype={asyncSupport:!0,_pipeAccordingToValidationResult:function(){var t=this,i=function(){var i=e.Deferred();return!0!==t.validationResult&&i.reject(),i.resolve().promise()};return[i,i]},actualizeOptions:function(){return a.attr(this.element,this.options.namespace,this.domOptions),this.parent&&this.parent.actualizeOptions&&this.parent.actualizeOptions(),this},_resetOptions:function(e){this.domOptions=a.objectCreate(this.parent.options),this.options=a.objectCreate(this.domOptions);for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);this.actualizeOptions()},_listeners:null,on:function(e,t){this._listeners=this._listeners||{};var i=this._listeners[e]=this._listeners[e]||[];return i.push(t),this},subscribe:function(t,i){e.listenTo(this,t.toLowerCase(),i)},off:function(e,t){var i=this._listeners&&this._listeners[e];if(i)if(t)for(var n=i.length;n--;)i[n]===t&&i.splice(n,1);else delete this._listeners[e];return this},unsubscribe:function(t,i){e.unsubscribeTo(this,t.toLowerCase())},trigger:function(e,t,i){t=t||this;var n,r=this._listeners&&this._listeners[e];if(r)for(var s=r.length;s--;)if(n=r[s].call(t,t,i),n===!1)return n;return!this.parent||this.parent.trigger(e,t,i)},asyncIsValid:function(e,t){return a.warnOnce("asyncIsValid is deprecated; please use whenValid instead"),this.whenValid({group:e,force:t})},_findRelated:function(){return this.options.multiple?e(this.parent.element.querySelectorAll("["+this.options.namespace+'multiple="'+this.options.multiple+'"]')):this.$element}};var u=function(e,t){var i=e.match(/^\s*\[(.*)\]\s*$/);if(!i)throw'Requirement is not an array: "'+e+'"';var n=i[1].split(",").map(a.trimString);if(n.length!==t)throw"Requirement has "+n.length+" values when "+t+" are needed";return n},d=function(e,t,i){var n=null,r={};for(var s in e)if(s){var o=i(s);"string"==typeof o&&(o=a.parseRequirement(e[s],o)),r[s]=o}else n=a.parseRequirement(e[s],t);return[n,r]},h=function(t){e.extend(!0,this,t)};h.prototype={validate:function(e,t){if(this.fn)return arguments.length>3&&(t=[].slice.call(arguments,1,-1)),this.fn(e,t);if(Array.isArray(e)){if(!this.validateMultiple)throw"Validator `"+this.name+"` does not handle multiple values";return this.validateMultiple.apply(this,arguments)}var i=arguments[arguments.length-1];if(this.validateDate&&i._isDateInput())return arguments[0]=a.parse.date(arguments[0]),null!==arguments[0]&&this.validateDate.apply(this,arguments);if(this.validateNumber)return!isNaN(e)&&(arguments[0]=parseFloat(arguments[0]),this.validateNumber.apply(this,arguments));if(this.validateString)return this.validateString.apply(this,arguments);throw"Validator `"+this.name+"` only handles multiple values"},parseRequirements:function(t,i){if("string"!=typeof t)return Array.isArray(t)?t:[t];var n=this.requirementType;if(Array.isArray(n)){for(var r=u(t,n.length),s=0;s<r.length;s++)r[s]=a.parseRequirement(n[s],r[s]);return r}return e.isPlainObject(n)?d(n,t,i):[a.parseRequirement(n,t)]},requirementType:"string",priority:2};var p=function(e,t){this.__class__="ValidatorRegistry",this.locale="en",this.init(e||{},t||{})},c={email:/^((([a-zA-Z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-zA-Z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/,number:/^-?(\d*\.)?\d+(e[-+]?\d+)?$/i,integer:/^-?\d+$/,digits:/^\d+$/,alphanum:/^\w+$/i,date:{test:function(e){return null!==a.parse.date(e)}},url:new RegExp("^(?:(?:https?|ftp)://)?(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-zA-Z\\u00a1-\\uffff0-9]-*)*[a-zA-Z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-zA-Z\\u00a1-\\uffff0-9]-*)*[a-zA-Z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-zA-Z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:/\\S*)?$")};c.range=c.number;var f=function(e){var t=(""+e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0},m=function(e,t){return t.map(a.parse[e])},g=function(e,t){return function(i){for(var n=arguments.length,r=Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.pop(),t.apply(void 0,[i].concat(_toConsumableArray(m(e,r))))}},v=function(e){return{validateDate:g("date",e),validateNumber:g("number",e),requirementType:e.length<=2?"string":["string","string"],priority:30}};p.prototype={init:function(e,t){this.catalog=t,this.validators=_extends({},this.validators);for(var i in e)this.addValidator(i,e[i].fn,e[i].priority);window.Parsley.trigger("parsley:validator:init")},setLocale:function(e){if("undefined"==typeof this.catalog[e])throw new Error(e+" is not available in the catalog");return this.locale=e,this},addCatalog:function(e,t,i){return"object"==typeof t&&(this.catalog[e]=t),!0===i?this.setLocale(e):this},addMessage:function(e,t,i){return"undefined"==typeof this.catalog[e]&&(this.catalog[e]={}),this.catalog[e][t]=i,this},addMessages:function(e,t){for(var i in t)this.addMessage(e,i,t[i]);return this},addValidator:function(e,t,i){if(this.validators[e])a.warn('Validator "'+e+'" is already defined.');else if(o.hasOwnProperty(e))return void a.warn('"'+e+'" is a restricted keyword and is not a valid validator name.');return this._setValidator.apply(this,arguments)},hasValidator:function(e){return!!this.validators[e]},updateValidator:function(e,t,i){return this.validators[e]?this._setValidator.apply(this,arguments):(a.warn('Validator "'+e+'" is not already defined.'),this.addValidator.apply(this,arguments))},removeValidator:function(e){return this.validators[e]||a.warn('Validator "'+e+'" is not defined.'),delete this.validators[e],this},_setValidator:function(e,t,i){"object"!=typeof t&&(t={fn:t,priority:i}),t.validate||(t=new h(t)),this.validators[e]=t;for(var n in t.messages||{})this.addMessage(n,e,t.messages[n]);return this},getErrorMessage:function(e){var t;if("type"===e.name){var i=this.catalog[this.locale][e.name]||{};t=i[e.requirements]}else t=this.formatMessage(this.catalog[this.locale][e.name],e.requirements);return t||this.catalog[this.locale].defaultMessage||this.catalog.en.defaultMessage},formatMessage:function(e,t){if("object"==typeof t){for(var i in t)e=this.formatMessage(e,t[i]);return e}return"string"==typeof e?e.replace(/%s/i,t):""},validators:{notblank:{validateString:function(e){return/\S/.test(e)},priority:2},required:{validateMultiple:function(e){return e.length>0},validateString:function(e){return/\S/.test(e)},priority:512},type:{validateString:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],n=i.step,r=void 0===n?"any":n,s=i.base,a=void 0===s?0:s,o=c[t];if(!o)throw new Error("validator type `"+t+"` is not supported");if(!o.test(e))return!1;if("number"===t&&!/^any$/i.test(r||"")){var l=Number(e),u=Math.max(f(r),f(a));if(f(l)>u)return!1;var d=function(e){return Math.round(e*Math.pow(10,u))};if((d(l)-d(a))%d(r)!=0)return!1}return!0},requirementType:{"":"string",step:"string",base:"number"},priority:256},pattern:{validateString:function(e,t){return t.test(e)},requirementType:"regexp",priority:64},minlength:{validateString:function(e,t){return e.length>=t},requirementType:"integer",priority:30},maxlength:{validateString:function(e,t){return e.length<=t},requirementType:"integer",priority:30},length:{validateString:function(e,t,i){return e.length>=t&&e.length<=i},requirementType:["integer","integer"],priority:30},mincheck:{validateMultiple:function(e,t){return e.length>=t},requirementType:"integer",priority:30},maxcheck:{validateMultiple:function(e,t){return e.length<=t},requirementType:"integer",priority:30},check:{validateMultiple:function(e,t,i){return e.length>=t&&e.length<=i},requirementType:["integer","integer"],priority:30},min:v(function(e,t){return e>=t}),max:v(function(e,t){return e<=t}),range:v(function(e,t,i){return e>=t&&e<=i}),equalto:{validateString:function(t,i){var n=e(i);return n.length?t===n.val():t===i},priority:256}}};var y={},_=function k(e,t,i){for(var n=[],r=[],s=0;s<e.length;s++){for(var a=!1,o=0;o<t.length;o++)if(e[s].assert.name===t[o].assert.name){a=!0;break}a?r.push(e[s]):n.push(e[s])}return{kept:r,added:n,removed:i?[]:k(t,e,!0).added}};y.Form={_actualizeTriggers:function(){var e=this;this.$element.on("submit.Parsley",function(t){e.onSubmitValidate(t)}),this.$element.on("click.Parsley",a._SubmitSelector,function(t){e.onSubmitButton(t)}),!1!==this.options.uiEnabled&&this.element.setAttribute("novalidate","")},focus:function(){if(this._focusedField=null,!0===this.validationResult||"none"===this.options.focus)return null;for(var e=0;e<this.fields.length;e++){var t=this.fields[e];if(!0!==t.validationResult&&t.validationResult.length>0&&"undefined"==typeof t.options.noFocus&&(this._focusedField=t.$element,"first"===this.options.focus))break}return null===this._focusedField?null:this._focusedField.focus()},_destroyUI:function(){this.$element.off(".Parsley")}},y.Field={_reflowUI:function(){if(this._buildUI(),this._ui){var e=_(this.validationResult,this._ui.lastValidationResult);this._ui.lastValidationResult=this.validationResult,this._manageStatusClass(),this._manageErrorsMessages(e),this._actualizeTriggers(),!e.kept.length&&!e.added.length||this._failedOnce||(this._failedOnce=!0,this._actualizeTriggers())}},getErrorsMessages:function(){if(!0===this.validationResult)return[];for(var e=[],t=0;t<this.validationResult.length;t++)e.push(this.validationResult[t].errorMessage||this._getErrorMessage(this.validationResult[t].assert));return e},addError:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=t.message,n=t.assert,r=t.updateClass,s=void 0===r||r;this._buildUI(),this._addError(e,{message:i,assert:n}),s&&this._errorClass()},updateError:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=t.message,n=t.assert,r=t.updateClass,s=void 0===r||r;this._buildUI(),this._updateError(e,{message:i,assert:n}),s&&this._errorClass()},removeError:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=t.updateClass,n=void 0===i||i;this._buildUI(),this._removeError(e),n&&this._manageStatusClass()},_manageStatusClass:function(){this.hasConstraints()&&this.needsValidation()&&!0===this.validationResult?this._successClass():this.validationResult.length>0?this._errorClass():this._resetClass()},_manageErrorsMessages:function(t){if("undefined"==typeof this.options.errorsMessagesDisabled){if("undefined"!=typeof this.options.errorMessage)return t.added.length||t.kept.length?(this._insertErrorWrapper(),0===this._ui.$errorsWrapper.find(".parsley-custom-error-message").length&&this._ui.$errorsWrapper.append(e(this.options.errorTemplate).addClass("parsley-custom-error-message")),this._ui.$errorsWrapper.addClass("filled").find(".parsley-custom-error-message").html(this.options.errorMessage)):this._ui.$errorsWrapper.removeClass("filled").find(".parsley-custom-error-message").remove();for(var i=0;i<t.removed.length;i++)this._removeError(t.removed[i].assert.name);for(i=0;i<t.added.length;i++)this._addError(t.added[i].assert.name,{message:t.added[i].errorMessage,assert:t.added[i].assert});for(i=0;i<t.kept.length;i++)this._updateError(t.kept[i].assert.name,{message:t.kept[i].errorMessage,assert:t.kept[i].assert})}},_addError:function(t,i){var n=i.message,r=i.assert;this._insertErrorWrapper(),this._ui.$errorClassHandler.attr("aria-describedby",this._ui.errorsWrapperId),this._ui.$errorsWrapper.addClass("filled").append(e(this.options.errorTemplate).addClass("parsley-"+t).html(n||this._getErrorMessage(r)))},_updateError:function(e,t){var i=t.message,n=t.assert;this._ui.$errorsWrapper.addClass("filled").find(".parsley-"+e).html(i||this._getErrorMessage(n))},_removeError:function(e){this._ui.$errorClassHandler.removeAttr("aria-describedby"),this._ui.$errorsWrapper.removeClass("filled").find(".parsley-"+e).remove()},_getErrorMessage:function(e){var t=e.name+"Message";return"undefined"!=typeof this.options[t]?window.Parsley.formatMessage(this.options[t],e.requirements):window.Parsley.getErrorMessage(e)},_buildUI:function(){if(!this._ui&&!1!==this.options.uiEnabled){var t={};this.element.setAttribute(this.options.namespace+"id",this.__id__),t.$errorClassHandler=this._manageClassHandler(),t.errorsWrapperId="parsley-id-"+(this.options.multiple?"multiple-"+this.options.multiple:this.__id__),t.$errorsWrapper=e(this.options.errorsWrapper).attr("id",t.errorsWrapperId),t.lastValidationResult=[],t.validationInformationVisible=!1,this._ui=t}},_manageClassHandler:function(){if("string"==typeof this.options.classHandler&&e(this.options.classHandler).length)return e(this.options.classHandler);var t=this.options.classHandler;if("string"==typeof this.options.classHandler&&"function"==typeof window[this.options.classHandler]&&(t=window[this.options.classHandler]),"function"==typeof t){var i=t.call(this,this);if("undefined"!=typeof i&&i.length)return i}else{if("object"==typeof t&&t instanceof jQuery&&t.length)return t;t&&a.warn("The class handler `"+t+"` does not exist in DOM nor as a global JS function")}return this._inputHolder()},_inputHolder:function(){return this.options.multiple&&"SELECT"!==this.element.nodeName?this.$element.parent():this.$element},_insertErrorWrapper:function(){var t=this.options.errorsContainer;if(0!==this._ui.$errorsWrapper.parent().length)return this._ui.$errorsWrapper.parent();if("string"==typeof t){if(e(t).length)return e(t).append(this._ui.$errorsWrapper);"function"==typeof window[t]?t=window[t]:a.warn("The errors container `"+t+"` does not exist in DOM nor as a global JS function")}return"function"==typeof t&&(t=t.call(this,this)),"object"==typeof t&&t.length?t.append(this._ui.$errorsWrapper):this._inputHolder().after(this._ui.$errorsWrapper)},_actualizeTriggers:function(){var e,t=this,i=this._findRelated();i.off(".Parsley"),this._failedOnce?i.on(a.namespaceEvents(this.options.triggerAfterFailure,"Parsley"),function(){t._validateIfNeeded()}):(e=a.namespaceEvents(this.options.trigger,"Parsley"))&&i.on(e,function(e){t._validateIfNeeded(e)})},_validateIfNeeded:function(e){var t=this;e&&/key|input/.test(e.type)&&(!this._ui||!this._ui.validationInformationVisible)&&this.getValue().length<=this.options.validationThreshold||(this.options.debounce?(window.clearTimeout(this._debounced),this._debounced=window.setTimeout(function(){return t.validate()},this.options.debounce)):this.validate())},_resetUI:function(){this._failedOnce=!1,this._actualizeTriggers(),"undefined"!=typeof this._ui&&(this._ui.$errorsWrapper.removeClass("filled").children().remove(),this._resetClass(),this._ui.lastValidationResult=[],this._ui.validationInformationVisible=!1)},_destroyUI:function(){this._resetUI(),"undefined"!=typeof this._ui&&this._ui.$errorsWrapper.remove(),delete this._ui},_successClass:function(){this._ui.validationInformationVisible=!0,this._ui.$errorClassHandler.removeClass(this.options.errorClass).addClass(this.options.successClass)},_errorClass:function(){this._ui.validationInformationVisible=!0,this._ui.$errorClassHandler.removeClass(this.options.successClass).addClass(this.options.errorClass)},_resetClass:function(){this._ui.$errorClassHandler.removeClass(this.options.successClass).removeClass(this.options.errorClass)}};var w=function(t,i,n){this.__class__="Form",this.element=t,this.$element=e(t),this.domOptions=i,this.options=n,this.parent=window.Parsley,this.fields=[],this.validationResult=null},b={pending:null,resolved:!0,rejected:!1};w.prototype={onSubmitValidate:function(e){var t=this;if(!0!==e.parsley){var i=this._submitSource||this.$element.find(a._SubmitSelector)[0];if(this._submitSource=null,this.$element.find(".parsley-synthetic-submit-button").prop("disabled",!0),!i||null===i.getAttribute("formnovalidate")){window.Parsley._remoteCache={};var n=this.whenValidate({event:e});"resolved"===n.state()&&!1!==this._trigger("submit")||(e.stopImmediatePropagation(),e.preventDefault(),"pending"===n.state()&&n.done(function(){t._submit(i)}))}}},onSubmitButton:function(e){this._submitSource=e.currentTarget},_submit:function(t){if(!1!==this._trigger("submit")){if(t){var i=this.$element.find(".parsley-synthetic-submit-button").prop("disabled",!1);0===i.length&&(i=e('<input class="parsley-synthetic-submit-button" type="hidden">').appendTo(this.$element)),i.attr({name:t.getAttribute("name"),value:t.getAttribute("value")})}this.$element.trigger(_extends(e.Event("submit"),{parsley:!0}))}},validate:function(t){if(arguments.length>=1&&!e.isPlainObject(t)){a.warnOnce("Calling validate on a parsley form without passing arguments as an object is deprecated.");var i=_slice.call(arguments),n=i[0],r=i[1],s=i[2];t={group:n,force:r,event:s}}return b[this.whenValidate(t).state()]},whenValidate:function(){var t,i=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=n.group,s=n.force,o=n.event;this.submitEvent=o,o&&(this.submitEvent=_extends({},o,{preventDefault:function(){a.warnOnce("Using `this.submitEvent.preventDefault()` is deprecated; instead, call `this.validationResult = false`"),i.validationResult=!1}})),this.validationResult=!0,this._trigger("validate"),this._refreshFields();var l=this._withoutReactualizingFormOptions(function(){return e.map(i.fields,function(e){return e.whenValidate({force:s,group:r})})});return(t=a.all(l).done(function(){i._trigger("success")}).fail(function(){i.validationResult=!1,i.focus(),i._trigger("error")}).always(function(){i._trigger("validated")})).pipe.apply(t,_toConsumableArray(this._pipeAccordingToValidationResult()))},isValid:function(t){if(arguments.length>=1&&!e.isPlainObject(t)){a.warnOnce("Calling isValid on a parsley form without passing arguments as an object is deprecated.");var i=_slice.call(arguments),n=i[0],r=i[1];t={group:n,force:r}}return b[this.whenValid(t).state()]},whenValid:function(){var t=this,i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=i.group,r=i.force;this._refreshFields();var s=this._withoutReactualizingFormOptions(function(){return e.map(t.fields,function(e){return e.whenValid({group:n,force:r})})});return a.all(s)},refresh:function(){return this._refreshFields(),this},reset:function(){for(var e=0;e<this.fields.length;e++)this.fields[e].reset();this._trigger("reset")},destroy:function(){this._destroyUI();for(var e=0;e<this.fields.length;e++)this.fields[e].destroy();this.$element.removeData("Parsley"),this._trigger("destroy")},_refreshFields:function(){return this.actualizeOptions()._bindFields()},_bindFields:function(){var t=this,i=this.fields;return this.fields=[],this.fieldsMappedById={},this._withoutReactualizingFormOptions(function(){t.$element.find(t.options.inputs).not(t.options.excluded).each(function(e,i){var n=new window.Parsley.Factory(i,{},t);if(("Field"===n.__class__||"FieldMultiple"===n.__class__)&&!0!==n.options.excluded){var r=n.__class__+"-"+n.__id__;"undefined"==typeof t.fieldsMappedById[r]&&(t.fieldsMappedById[r]=n,t.fields.push(n))}}),e.each(a.difference(i,t.fields),function(e,t){t.reset()})}),this},_withoutReactualizingFormOptions:function(e){var t=this.actualizeOptions;this.actualizeOptions=function(){return this};var i=e();return this.actualizeOptions=t,i},_trigger:function(e){return this.trigger("form:"+e)}};var F=function(e,t,i,n,r){var s=window.Parsley._validatorRegistry.validators[t],a=new h(s);n=n||e.options[t+"Priority"]||a.priority,r=!0===r,_extends(this,{validator:a,name:t,requirements:i,priority:n,isDomConstraint:r}),this._parseRequirements(e.options)},C=function(e){var t=e[0].toUpperCase();return t+e.slice(1)};F.prototype={validate:function(e,t){var i;return(i=this.validator).validate.apply(i,[e].concat(_toConsumableArray(this.requirementList),[t]))},_parseRequirements:function(e){var t=this;this.requirementList=this.validator.parseRequirements(this.requirements,function(i){return e[t.name+C(i)]})}};var A=function(t,i,n,r){this.__class__="Field",this.element=t,this.$element=e(t),"undefined"!=typeof r&&(this.parent=r),this.options=n,this.domOptions=i,this.constraints=[],this.constraintsByName={},this.validationResult=!0,this._bindConstraints()},E={pending:null,resolved:!0,rejected:!1};A.prototype={validate:function(t){arguments.length>=1&&!e.isPlainObject(t)&&(a.warnOnce("Calling validate on a parsley field without passing arguments as an object is deprecated."),t={options:t});var i=this.whenValidate(t);if(!i)return!0;switch(i.state()){case"pending":return null;case"resolved":return!0;case"rejected":return this.validationResult}},whenValidate:function(){var e,t=this,i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=i.force,r=i.group;if(this.refresh(),!r||this._isInGroup(r))return this.value=this.getValue(),this._trigger("validate"),(e=this.whenValid({force:n,value:this.value,_refreshed:!0}).always(function(){t._reflowUI()}).done(function(){t._trigger("success")}).fail(function(){t._trigger("error")}).always(function(){t._trigger("validated")})).pipe.apply(e,_toConsumableArray(this._pipeAccordingToValidationResult()))},hasConstraints:function(){return 0!==this.constraints.length},needsValidation:function(e){return"undefined"==typeof e&&(e=this.getValue()),!(!e.length&&!this._isRequired()&&"undefined"==typeof this.options.validateIfEmpty)},_isInGroup:function(t){return Array.isArray(this.options.group)?-1!==e.inArray(t,this.options.group):this.options.group===t},isValid:function(t){if(arguments.length>=1&&!e.isPlainObject(t)){a.warnOnce("Calling isValid on a parsley field without passing arguments as an object is deprecated.");var i=_slice.call(arguments),n=i[0],r=i[1];t={force:n,value:r}}var s=this.whenValid(t);return!s||E[s.state()]},whenValid:function(){var t=this,i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=i.force,r=void 0!==n&&n,s=i.value,o=i.group,l=i._refreshed;if(l||this.refresh(),!o||this._isInGroup(o)){if(this.validationResult=!0,!this.hasConstraints())return e.when();if("undefined"!=typeof s&&null!==s||(s=this.getValue()),!this.needsValidation(s)&&!0!==r)return e.when();var u=this._getGroupedConstraints(),d=[];return e.each(u,function(i,n){var r=a.all(e.map(n,function(e){return t._validateConstraint(s,e)}));if(d.push(r),"rejected"===r.state())return!1}),a.all(d)}},_validateConstraint:function(t,i){var n=this,r=i.validate(t,this);return!1===r&&(r=e.Deferred().reject()),a.all([r]).fail(function(e){n.validationResult instanceof Array||(n.validationResult=[]),n.validationResult.push({assert:i,errorMessage:"string"==typeof e&&e})})},getValue:function(){var e;return e="function"==typeof this.options.value?this.options.value(this):"undefined"!=typeof this.options.value?this.options.value:this.$element.val(),"undefined"==typeof e||null===e?"":this._handleWhitespace(e)},reset:function(){return this._resetUI(),this._trigger("reset")},destroy:function(){this._destroyUI(),this.$element.removeData("Parsley"),this.$element.removeData("FieldMultiple"),this._trigger("destroy")},refresh:function(){return this._refreshConstraints(),this},_refreshConstraints:function(){return this.actualizeOptions()._bindConstraints()},refreshConstraints:function(){return a.warnOnce("Parsley's refreshConstraints is deprecated. Please use refresh"),this.refresh()},addConstraint:function(e,t,i,n){if(window.Parsley._validatorRegistry.validators[e]){var r=new F(this,e,t,i,n);"undefined"!==this.constraintsByName[r.name]&&this.removeConstraint(r.name),this.constraints.push(r),this.constraintsByName[r.name]=r}return this},removeConstraint:function(e){for(var t=0;t<this.constraints.length;t++)if(e===this.constraints[t].name){this.constraints.splice(t,1);break}return delete this.constraintsByName[e],this},updateConstraint:function(e,t,i){return this.removeConstraint(e).addConstraint(e,t,i)},_bindConstraints:function(){for(var e=[],t={},i=0;i<this.constraints.length;i++)!1===this.constraints[i].isDomConstraint&&(e.push(this.constraints[i]),t[this.constraints[i].name]=this.constraints[i]);this.constraints=e,this.constraintsByName=t;for(var n in this.options)this.addConstraint(n,this.options[n],void 0,!0);return this._bindHtml5Constraints()},_bindHtml5Constraints:function(){null!==this.element.getAttribute("required")&&this.addConstraint("required",!0,void 0,!0),null!==this.element.getAttribute("pattern")&&this.addConstraint("pattern",this.element.getAttribute("pattern"),void 0,!0);var e=this.element.getAttribute("min"),t=this.element.getAttribute("max");null!==e&&null!==t?this.addConstraint("range",[e,t],void 0,!0):null!==e?this.addConstraint("min",e,void 0,!0):null!==t&&this.addConstraint("max",t,void 0,!0),null!==this.element.getAttribute("minlength")&&null!==this.element.getAttribute("maxlength")?this.addConstraint("length",[this.element.getAttribute("minlength"),this.element.getAttribute("maxlength")],void 0,!0):null!==this.element.getAttribute("minlength")?this.addConstraint("minlength",this.element.getAttribute("minlength"),void 0,!0):null!==this.element.getAttribute("maxlength")&&this.addConstraint("maxlength",this.element.getAttribute("maxlength"),void 0,!0);var i=a.getType(this.element);return"number"===i?this.addConstraint("type",["number",{step:this.element.getAttribute("step")||"1",base:e||this.element.getAttribute("value")}],void 0,!0):/^(email|url|range|date)$/i.test(i)?this.addConstraint("type",i,void 0,!0):this},_isRequired:function(){return"undefined"!=typeof this.constraintsByName.required&&!1!==this.constraintsByName.required.requirements},_trigger:function(e){return this.trigger("field:"+e)},_handleWhitespace:function(e){return!0===this.options.trimValue&&a.warnOnce('data-parsley-trim-value="true" is deprecated, please use data-parsley-whitespace="trim"'),"squish"===this.options.whitespace&&(e=e.replace(/\s{2,}/g," ")),"trim"!==this.options.whitespace&&"squish"!==this.options.whitespace&&!0!==this.options.trimValue||(e=a.trimString(e)),e},_isDateInput:function(){var e=this.constraintsByName.type;return e&&"date"===e.requirements},_getGroupedConstraints:function(){if(!1===this.options.priorityEnabled)return[this.constraints];for(var e=[],t={},i=0;i<this.constraints.length;i++){var n=this.constraints[i].priority;t[n]||e.push(t[n]=[]),t[n].push(this.constraints[i])}return e.sort(function(e,t){return t[0].priority-e[0].priority}),e}};var x=A,$=function(){this.__class__="FieldMultiple"};$.prototype={addElement:function(e){return this.$elements.push(e),this},_refreshConstraints:function(){var t;if(this.constraints=[],"SELECT"===this.element.nodeName)return this.actualizeOptions()._bindConstraints(),this;for(var i=0;i<this.$elements.length;i++)if(e("html").has(this.$elements[i]).length){t=this.$elements[i].data("FieldMultiple")._refreshConstraints().constraints;for(var n=0;n<t.length;n++)this.addConstraint(t[n].name,t[n].requirements,t[n].priority,t[n].isDomConstraint)}else this.$elements.splice(i,1);return this},getValue:function(){if("function"==typeof this.options.value)return this.options.value(this);if("undefined"!=typeof this.options.value)return this.options.value;if("INPUT"===this.element.nodeName){var t=a.getType(this.element);if("radio"===t)return this._findRelated().filter(":checked").val()||"";if("checkbox"===t){
var i=[];return this._findRelated().filter(":checked").each(function(){i.push(e(this).val())}),i}}return"SELECT"===this.element.nodeName&&null===this.$element.val()?[]:this.$element.val()},_init:function(){return this.$elements=[this.$element],this}};var P=function(t,i,n){this.element=t,this.$element=e(t);var r=this.$element.data("Parsley");if(r)return"undefined"!=typeof n&&r.parent===window.Parsley&&(r.parent=n,r._resetOptions(r.options)),"object"==typeof i&&_extends(r.options,i),r;if(!this.$element.length)throw new Error("You must bind Parsley on an existing element.");if("undefined"!=typeof n&&"Form"!==n.__class__)throw new Error("Parent instance must be a Form instance");return this.parent=n||window.Parsley,this.init(i)};P.prototype={init:function(e){return this.__class__="Parsley",this.__version__="2.8.1",this.__id__=a.generateID(),this._resetOptions(e),"FORM"===this.element.nodeName||a.checkAttr(this.element,this.options.namespace,"validate")&&!this.$element.is(this.options.inputs)?this.bind("parsleyForm"):this.isMultiple()?this.handleMultiple():this.bind("parsleyField")},isMultiple:function(){var e=a.getType(this.element);return"radio"===e||"checkbox"===e||"SELECT"===this.element.nodeName&&null!==this.element.getAttribute("multiple")},handleMultiple:function(){var t,i,n=this;if(this.options.multiple=this.options.multiple||(t=this.element.getAttribute("name"))||this.element.getAttribute("id"),"SELECT"===this.element.nodeName&&null!==this.element.getAttribute("multiple"))return this.options.multiple=this.options.multiple||this.__id__,this.bind("parsleyFieldMultiple");if(!this.options.multiple)return a.warn("To be bound by Parsley, a radio, a checkbox and a multiple select input must have either a name or a multiple option.",this.$element),this;this.options.multiple=this.options.multiple.replace(/(:|\.|\[|\]|\{|\}|\$)/g,""),t&&e('input[name="'+t+'"]').each(function(e,t){var i=a.getType(t);"radio"!==i&&"checkbox"!==i||t.setAttribute(n.options.namespace+"multiple",n.options.multiple)});for(var r=this._findRelated(),s=0;s<r.length;s++)if(i=e(r.get(s)).data("Parsley"),"undefined"!=typeof i){this.$element.data("FieldMultiple")||i.addElement(this.$element);break}return this.bind("parsleyField",!0),i||this.bind("parsleyFieldMultiple")},bind:function(t,i){var n;switch(t){case"parsleyForm":n=e.extend(new w(this.element,this.domOptions,this.options),new l,window.ParsleyExtend)._bindFields();break;case"parsleyField":n=e.extend(new x(this.element,this.domOptions,this.options,this.parent),new l,window.ParsleyExtend);break;case"parsleyFieldMultiple":n=e.extend(new x(this.element,this.domOptions,this.options,this.parent),new $,new l,window.ParsleyExtend)._init();break;default:throw new Error(t+"is not a supported Parsley type")}return this.options.multiple&&a.setAttr(this.element,this.options.namespace,"multiple",this.options.multiple),"undefined"!=typeof i?(this.$element.data("FieldMultiple",n),n):(this.$element.data("Parsley",n),n._actualizeTriggers(),n._trigger("init"),n)}};var V=e.fn.jquery.split(".");if(parseInt(V[0])<=1&&parseInt(V[1])<8)throw"The loaded version of jQuery is too old. Please upgrade to 1.8.x or better.";V.forEach||a.warn("Parsley requires ES5 to run properly. Please include https://github.com/es-shims/es5-shim");var T=_extends(new l,{element:document,$element:e(document),actualizeOptions:null,_resetOptions:null,Factory:P,version:"2.8.1"});_extends(x.prototype,y.Field,l.prototype),_extends(w.prototype,y.Form,l.prototype),_extends(P.prototype,l.prototype),e.fn.parsley=e.fn.psly=function(t){if(this.length>1){var i=[];return this.each(function(){i.push(e(this).parsley(t))}),i}if(0!=this.length)return new P(this[0],t)},"undefined"==typeof window.ParsleyExtend&&(window.ParsleyExtend={}),T.options=_extends(a.objectCreate(o),window.ParsleyConfig),window.ParsleyConfig=T.options,window.Parsley=window.psly=T,T.Utils=a,window.ParsleyUtils={},e.each(a,function(e,t){"function"==typeof t&&(window.ParsleyUtils[e]=function(){return a.warnOnce("Accessing `window.ParsleyUtils` is deprecated. Use `window.Parsley.Utils` instead."),a[e].apply(a,arguments)})});var O=window.Parsley._validatorRegistry=new p(window.ParsleyConfig.validators,window.ParsleyConfig.i18n);window.ParsleyValidator={},e.each("setLocale addCatalog addMessage addMessages getErrorMessage formatMessage addValidator updateValidator removeValidator hasValidator".split(" "),function(e,t){window.Parsley[t]=function(){return O[t].apply(O,arguments)},window.ParsleyValidator[t]=function(){var e;return a.warnOnce("Accessing the method '"+t+"' through Validator is deprecated. Simply call 'window.Parsley."+t+"(...)'"),(e=window.Parsley)[t].apply(e,arguments)}}),window.Parsley.UI=y,window.ParsleyUI={removeError:function(e,t,i){var n=!0!==i;return a.warnOnce("Accessing UI is deprecated. Call 'removeError' on the instance directly. Please comment in issue 1073 as to your need to call this method."),e.removeError(t,{updateClass:n})},getErrorsMessages:function(e){return a.warnOnce("Accessing UI is deprecated. Call 'getErrorsMessages' on the instance directly."),e.getErrorsMessages()}},e.each("addError updateError".split(" "),function(e,t){window.ParsleyUI[t]=function(e,i,n,r,s){var o=!0!==s;return a.warnOnce("Accessing UI is deprecated. Call '"+t+"' on the instance directly. Please comment in issue 1073 as to your need to call this method."),e[t](i,{message:n,assert:r,updateClass:o})}}),!1!==window.ParsleyConfig.autoBind&&e(function(){e("[data-parsley-validate]").length&&e("[data-parsley-validate]").parsley()});var M=e({}),R=function(){a.warnOnce("Parsley's pubsub module is deprecated; use the 'on' and 'off' methods on parsley instances or window.Parsley")},D="parsley:";e.listen=function(e,n){var r;if(R(),"object"==typeof arguments[1]&&"function"==typeof arguments[2]&&(r=arguments[1],n=arguments[2]),"function"!=typeof n)throw new Error("Wrong parameters");window.Parsley.on(i(e),t(n,r))},e.listenTo=function(e,n,r){if(R(),!(e instanceof x||e instanceof w))throw new Error("Must give Parsley instance");if("string"!=typeof n||"function"!=typeof r)throw new Error("Wrong parameters");e.on(i(n),t(r))},e.unsubscribe=function(e,t){if(R(),"string"!=typeof e||"function"!=typeof t)throw new Error("Wrong arguments");window.Parsley.off(i(e),t.parsleyAdaptedCallback)},e.unsubscribeTo=function(e,t){if(R(),!(e instanceof x||e instanceof w))throw new Error("Must give Parsley instance");e.off(i(t))},e.unsubscribeAll=function(t){R(),window.Parsley.off(i(t)),e("form,input,textarea,select").each(function(){var n=e(this).data("Parsley");n&&n.off(i(t))})},e.emit=function(e,t){var n;R();var r=t instanceof x||t instanceof w,s=Array.prototype.slice.call(arguments,r?2:1);s.unshift(i(e)),r||(t=window.Parsley),(n=t).trigger.apply(n,_toConsumableArray(s))};e.extend(!0,T,{asyncValidators:{"default":{fn:function(e){return e.status>=200&&e.status<300},url:!1},reverse:{fn:function(e){return e.status<200||e.status>=300},url:!1}},addAsyncValidator:function(e,t,i,n){return T.asyncValidators[e]={fn:t,url:i||!1,options:n||{}},this}}),T.addValidator("remote",{requirementType:{"":"string",validator:"string",reverse:"boolean",options:"object"},validateString:function(t,i,n,r){var s,a,o={},l=n.validator||(!0===n.reverse?"reverse":"default");if("undefined"==typeof T.asyncValidators[l])throw new Error("Calling an undefined async validator: `"+l+"`");i=T.asyncValidators[l].url||i,i.indexOf("{value}")>-1?i=i.replace("{value}",encodeURIComponent(t)):o[r.element.getAttribute("name")||r.element.getAttribute("id")]=t;var u=e.extend(!0,n.options||{},T.asyncValidators[l].options);s=e.extend(!0,{},{url:i,data:o,type:"GET"},u),r.trigger("field:ajaxoptions",r,s),a=e.param(s),"undefined"==typeof T._remoteCache&&(T._remoteCache={});var d=T._remoteCache[a]=T._remoteCache[a]||e.ajax(s),h=function(){var t=T.asyncValidators[l].fn.call(r,d,i,n);return t||(t=e.Deferred().reject()),e.when(t)};return d.then(h,h)},priority:-1}),T.on("form:submit",function(){T._remoteCache={}}),l.prototype.addAsyncValidator=function(){return a.warnOnce("Accessing the method `addAsyncValidator` through an instance is deprecated. Simply call `Parsley.addAsyncValidator(...)`"),T.addAsyncValidator.apply(T,arguments)},T.addMessages("en",{defaultMessage:"This value seems to be invalid.",type:{email:"This value should be a valid email.",url:"This value should be a valid url.",number:"This value should be a valid number.",integer:"This value should be a valid integer.",digits:"This value should be digits.",alphanum:"This value should be alphanumeric."},notblank:"This value should not be blank.",required:"This value is required.",pattern:"This value seems to be invalid.",min:"This value should be greater than or equal to %s.",max:"This value should be lower than or equal to %s.",range:"This value should be between %s and %s.",minlength:"This value is too short. It should have %s characters or more.",maxlength:"This value is too long. It should have %s characters or fewer.",length:"This value length is invalid. It should be between %s and %s characters long.",mincheck:"You must select at least %s choices.",maxcheck:"You must select %s choices or fewer.",check:"You must select between %s and %s choices.",equalto:"This value should be the same."}),T.setLocale("en");var I=new n;I.install();var q=T;return q});
//# sourceMappingURL=parsley.min.js.map


/*********************/
/****** 	lazyload.min.js	 ***********/
/*********************/
/*! Lazy Load 1.9.7 - MIT license - Copyright 2010-2015 Mika Tuupola */
!function(a,b,c,d){var e=a(b);a.fn.lazyload=function(f){function g(){var b=0;i.each(function(){var c=a(this);if(!j.skip_invisible||c.is(":visible"))if(a.abovethetop(this,j)||a.leftofbegin(this,j));else if(a.belowthefold(this,j)||a.rightoffold(this,j)){if(++b>j.failure_limit)return!1}else c.trigger("appear"),b=0})}var h,i=this,j={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:b,data_attribute:"original",skip_invisible:!1,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return f&&(d!==f.failurelimit&&(f.failure_limit=f.failurelimit,delete f.failurelimit),d!==f.effectspeed&&(f.effect_speed=f.effectspeed,delete f.effectspeed),a.extend(j,f)),h=j.container===d||j.container===b?e:a(j.container),0===j.event.indexOf("scroll")&&h.bind(j.event,function(){return g()}),this.each(function(){var b=this,c=a(b);b.loaded=!1,(c.attr("src")===d||c.attr("src")===!1)&&c.is("img")&&c.attr("src",j.placeholder),c.one("appear",function(){if(!this.loaded){if(j.appear){var d=i.length;j.appear.call(b,d,j)}a("<img />").bind("load",function(){var d=c.attr("data-"+j.data_attribute);c.hide(),c.is("img")?c.attr("src",d):c.css("background-image","url('"+d+"')"),c[j.effect](j.effect_speed),b.loaded=!0;var e=a.grep(i,function(a){return!a.loaded});if(i=a(e),j.load){var f=i.length;j.load.call(b,f,j)}}).attr("src",c.attr("data-"+j.data_attribute))}}),0!==j.event.indexOf("scroll")&&c.bind(j.event,function(){b.loaded||c.trigger("appear")})}),e.bind("resize",function(){g()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&e.bind("pageshow",function(b){b.originalEvent&&b.originalEvent.persisted&&i.each(function(){a(this).trigger("appear")})}),a(c).ready(function(){g()}),this},a.belowthefold=function(c,f){var g;return g=f.container===d||f.container===b?(b.innerHeight?b.innerHeight:e.height())+e.scrollTop():a(f.container).offset().top+a(f.container).height(),g<=a(c).offset().top-f.threshold},a.rightoffold=function(c,f){var g;return g=f.container===d||f.container===b?e.width()+e.scrollLeft():a(f.container).offset().left+a(f.container).width(),g<=a(c).offset().left-f.threshold},a.abovethetop=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollTop():a(f.container).offset().top,g>=a(c).offset().top+f.threshold+a(c).height()},a.leftofbegin=function(c,f){var g;return g=f.container===d||f.container===b?e.scrollLeft():a(f.container).offset().left,g>=a(c).offset().left+f.threshold+a(c).width()},a.inviewport=function(b,c){return!(a.rightoffold(b,c)||a.leftofbegin(b,c)||a.belowthefold(b,c)||a.abovethetop(b,c))},a.extend(a.expr[":"],{"below-the-fold":function(b){return a.belowthefold(b,{threshold:0})},"above-the-top":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-screen":function(b){return a.rightoffold(b,{threshold:0})},"left-of-screen":function(b){return!a.rightoffold(b,{threshold:0})},"in-viewport":function(b){return a.inviewport(b,{threshold:0})},"above-the-fold":function(b){return!a.belowthefold(b,{threshold:0})},"right-of-fold":function(b){return a.rightoffold(b,{threshold:0})},"left-of-fold":function(b){return!a.rightoffold(b,{threshold:0})}})}(jQuery,window,document);

/*********************/
/****** 	polyfills.js	 ***********/
/*********************/
/**
 * Array.findIndex polyfill
 */
if (!Array.prototype.findIndex) {
    Array.prototype.findIndex = function (predicate) {
        if (this == null) {
            throw new TypeError('Array.prototype.findIndex called on null or undefined');
        }
        if (typeof predicate !== 'function') {
            throw new TypeError('predicate must be a function');
        }
        var list = Object(this);
        var length = list.length >>> 0;
        var thisArg = arguments[1];
        var value;

        for (var i = 0; i < length; i++) {
            value = list[i];
            if (predicate.call(thisArg, value, i, list)) {
                return i;
            }
        }
        return -1;
    };
}

/**
 * CustomEvent polyfill
 */
if (typeof window.CustomEvent !== 'function') {

    function CustomEvent(event, params) {
        params = params || {bubbles: false, cancelable: false, detail: undefined};
        var evt = document.createEvent('CustomEvent');
        evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
        return evt;
    }

    CustomEvent.prototype = window.Event.prototype;

    window.CustomEvent = CustomEvent;
}

/*********************/
/****** 	settings.js	 ***********/
/*********************/
/**
 * Init global object
 */
var otpMain = {};

/**
 * Settings object
 */

(function($, o){

    var settings = function() {
        this.keys = [
            'osLang',
            'osTargetBlank',
            'osTourTargetBlank',
            'osContainer',
            'osTourContainer',
            'osTarget',
            'osGeo',
            'osOrderUrl',
            'osGeoS',
            'osDefaultDeparture',
            'osDefaultDuration',
            'osRegion',
            'osCurrency',
            'osQueryPreset',
            'osInstallments',
            'hotelNameUnderButton'
        ];
        this.store = {
            'osLang': 'rus',
            'osSearchPlan': 'free'
        };

        this.init();
    };

    /**
     * Init store
     */
    settings.prototype.init = function() {
        /* Load account settings */
        if('api_settings' in window && 'object' === typeof window.api_settings) {
            this.load(window.api_settings);
        }
        if('api_modules' in window && 'tours' in window.api_modules) {
            this.store.osSearchPlan = window.api_modules['tours'];
        }

        /* Load global settings */
        this.load(window);
    };

    /**
     * Read settings object for values
     */
    settings.prototype.load = function(object) {
        this.keys.map((function (setting) {
            if(setting in object) {
                this.set(setting, object[setting]);
            }

            return setting;
        }).bind(this));
    };

    /**
     * Get value
     *
     * @param key
     * @param optional
     * @returns {*}
     */
    settings.prototype.get = function(key, optional) {
        if(key in this.store) {
            return this.store[key];
        }

        return 'undefined' !== typeof optional ? optional : null;
    };

    /**
     * Set value
     *
     * @param key
     * @param value
     * @returns {settings}
     */
    settings.prototype.set = function (key, value) {
        switch (key) {
            case 'osLang':
                if(['ru', 'rus', 'ua', 'ukr'].indexOf(value) !== -1) {
                    value = value.replace('rus', 'ru').replace('ru', 'rus').replace('ua', 'ukr');
                    this.store['osLang'] = value;
                }
                break;
            case 'osCurrency':
                if(['converted', 'uah', 'грн'].indexOf(value) !== -1) {
                    this.store[key] = 'uah';
                }
                else {
                    this.store[key] = 'cur';
                }
                break;
            case 'osGeoS':
                this.store['osGeo'] = value;
                break;
            default:
                this.store[key] = value;
                break;
        }

        return this;
    };

    o.settings = new settings();

})(jQuery, otpMain);


/*********************/
/****** 	locale.js	 ***********/
/*********************/
/**
 * Created by vshevtsov on 20.09.16.
 */


(function($, o){

    o.ua = {
        /* JSAPI translation*/
        'Январь': 'Сiчень',
        'Февраль': 'Лютий',
        'Март': 'Березень',
        'Апрель': 'Квiтень',
        'Май': 'Травень',
        'Июнь': 'Червень',
        'Июль': 'Липень',
        'Август': 'Серпень',
        'Сентябрь': 'Вересень',
        'Октябрь': 'Жовтень',
        'Ноябрь': 'Листопад',
        'Декабрь': 'Грудень',
        'января': 'сiчня',
        'февраля': 'лютого',
        'марта': 'березня',
        'апреля': 'квiтня',
        'мая': 'травня',
        'июня': 'червня',
        'июля': 'липня',
        'августа': 'серпня',
        'сентября': 'вересня',
        'октября': 'жовтня',
        'ноября': 'листопада',
        'декабря': 'грудня',
        'янв': 'сiч',
        'фев': 'лют',
        'мар': 'бер',
        'апр': 'квi',
        'май': 'тра',
        'июн': 'чер',
        'июл': 'лип',
        'авг': 'сер',
        'сен': 'вер',
        'окт': 'жов',
        'ноя': 'лис',
        'дек': 'гру',
        'вс': 'нд',
        'Вс': 'Нд',
        'дней': 'днiв',
        'дня': 'днi',
        'ночь': 'нiч',
        'ночи': 'ночі',
        'без питания': 'без харчування',
        'завтрак': 'сніданок',
        'завтрак и ужин': 'сніданок і вечеря',
        'полный пансион': 'повний пансіон',
        'Авиаперелет': 'Авіапереліт',
        'с авиаперелетом': 'з авіаперельотом',
        'переезд на автобусе включен': 'переїзд на автобусі включений',
        'Поезд': 'Потяг',
        'переезд на ж/д включен': 'переїзд на ж/д включений',
        'переезд на ж/д и автобусе включен': 'переїзд на ж/д і автобусі включений',
        'Паром': 'Пором',
        'переезд на пароме включен': 'переїзд на поромі включений',
        'Без транспорта': 'Без транспорту',
        'без транспорта': 'без транспорту',
        'анимация': 'анімація',
        'бесплатный Wi-Fi': 'безкоштовний Wi-Fi',
        'водные виды спорта на пляже': 'водні види спорту на пляжі',
        'дайвинг': 'дайвінг',
        'детский бассейн': 'дитячий басейн',
        'дискотека в отеле': 'дискотека в готелі',
        'крытый бассейн': 'критий басейн',
        'мини-клуб / детская комната': 'міні-клуб / дитяча кімната',
        'организация экскурсий': 'організація екскурсій',
        'открытый бассейн': 'відкритий басейн',
        'прокат автомобилей': 'прокат автомобілів',
        'фитнес-центр / тренажерный зал': 'фітнес-центр / тренажерний зал',
        '1-я пляжная линия': '1-ша пляжна лінія',
        '2-я пляжная линия': '2-а пляжна лінія',
        'песчаный пляж': 'піщаний пляж',
        'галечный пляж': 'гальковий пляж',
        'Любой город': 'Будь-яке місто',
        'Киев': 'Київ',
        'Киева': 'Києва',
        'Харьков': 'Харків',
        'Харькова': 'Харкова',
        'Днепр': 'Дніпро',
        'Днепра': 'Дніпра',
        'Одесса': 'Одеса',
        'Одессы': 'Одеси',
        'Львов': 'Львів',
        'Винница': 'Вінниця',
        'Винницы': 'Вінниці',
        'Луцк': 'Луцьк',
        'Луцка': 'Луцька',
        'Запорожье': 'Запоріжжя',
        'Запорожья': 'Запоріжжя',
        'Ивано-Франковск': 'Івано-Франківськ',
        'Ив.-Франковска': 'Ів.-Франківська',
        'Черновцы': 'Чернівці',
        'Черновцов': 'Чернівців',
        'евро': 'євро',
        'или': 'або',
        'свяжитесь с нами': 'зв\'яжіться з нами',
        'и мы поможем найти то, что вы ищете': 'і ми допоможемо знайти те, що ви шукаєте',
        'Попробуйте': 'Спробуйте',
        'вернуться к поиску': 'повернутися до пошуку',
        'По вашему запросу туры не найдены': 'По вашому запиту тури не знайдені',
        'или напишите нам и мы поможем найти то, что вы ищете': 'або напишіть нам і ми допоможемо знайти те, що ви шукаєте',
        'Мы устали ждать некоторых туроператоров, и отображаем цены тех кто успел. Повторите поиск через время чтобы увидеть все цены...': 'Ми втомилися чекати деяких туроператорів, і відображаємо ціни тих хто встиг. Повторіть пошук через час і подивіться всі ціни...',
        'Фильтры в поиске': 'Фільтри в пошуку',
        'Стоимость от': 'Вартість від',
        'Стоимость до': 'Вартість до',
        'Отель': 'Готель',
        'По вашему запросу туры не найдены. Попробуйте изменить критерии поиска.': 'По вашому запиту тури не знайдені. Спробуйте змінити критерії пошуку.',
        'По вашему запросу туры': 'По вашому запиту тури',
        'не найдены': 'не знайдені',
        'Поищите туры': 'Пошукайте тури',
        'или измените другие критерии поиска': 'або змініть інші критерії пошуку',
        'До конца опроса ': 'До кінця опитування ',
        'Почему так долго': 'Чому так довго',
        'Когда вы задаёте поиск или открываете тур, мы делаем аналогичный запрос к базе данных всех основных операторов Украины (которые работают по выбранной вами стране). Обычно серверы туроператоров отвечают за 5-10 секунд. Но иногда, особенно в рабочее время или в высокий сезон, системы могут быть перегружены, и время ответа может составлять до 30 и даже до 60 секунд.<br><br>В любом случае, вы экономите уйму времени, т.к. мы показываем актуальные цены всех туроператоров одновременно, и адреса турагентств в вашем городе и районе.': 'Коли ви шукаєте або відкриваєте тури, ми робимо аналогічний запит до баз даних всіх основних операторів України які працюють за обраною вами країною. Зазвичай сервери туроператорів відповідають за 5-10 секунд. Але іноді, особливо в робочий час або у високий сезон, системи можуть бути перевантажені, і час відповіді може становити до 30-40 секунд. <br> <br> У будь-якому випадку, ви економите багато часу, тому що ми показуємо актуальні ціни всіх туроператорів одночасно, і адреси турагенцій в вашому місті та районі.',
        'Время вышло. Сервер туроператор': 'Час вийшов. сервер туроператор',
        'ов': 'iв',
        ' не ответил в отведенное время. Попробуйте обновить страницу через несколько секунд.': ' не відповів у відведений час. Спробуйте оновити сторінку через кілька секунд.',
        'Нам неизвестно о турах в ': 'Нам невідомо про тури в',
        'Курорты': 'Курорти',
        'Страны': 'Країни',
        'Отели': 'Готелі',
        'неизвестно': 'невідомо',
        'Нет туров в ': 'Немає турів в ',
        'нет туров': 'немає турів',
        'вдвоем': 'удвох',
        'втроем': 'втрьох',
        'вчетвером': 'вчотирьох',
        'без детей': 'без дітей',
        '-е детей': '-є дітей',
        'Стоимость тура для ': 'Вартість туру для ',
        'одного взрослого': 'одного дорослого',
        'взрослый': 'дорослий',
        'взрослых': 'дорослих',
        'и': 'та',
        'ребенок': 'дитина',
        'ребенка': 'дитини',
        'детей': 'дітей',
        'Туры': 'Тури',
        'Экскурсии': 'Екскурсії',
        'Уточнить': 'Уточнити',
        ' категорию отеля, питание, вид транспорта?': ' категорію готелю, харчування, вид транспорту?',
        'Расширенный поиск': 'Розширений пошук',
        'Категория отеля и питание': 'Категорія готелю та харчування',
        'Оценка': 'Оцінка',
        'по отзывам': 'за відгуками',
        'Цена': 'Ціна',
        'за всех туристов': 'за всіх туристів',
        'Услуга': 'Послуга',
        'Услуги': 'Послуги',
        'Услуг': 'Послуг',
        'В отеле': 'В готелі',
        'Найти туры': 'Знайти тури',
        'Выберите страну, курорт или отель': 'Виберіть країну, курорт і готель',
        'из': 'з',
        'Вылет из': 'Виліт з',
        'Страна, курорт, отель': 'Країна, курорт, готель',
        'Я хочу в': 'Я хочу до',
        'Нас будет': 'Нас буде',
        'Взрослых и детей': 'Дорослих і дітей',
        'Возраст детей': 'Вік дітей',
        'лет': 'рокiв',
        'от': 'вiд',
        'Длительность': 'Тривалість',
        'Ищем туры по вашим параметрам': 'Шукаємо тури по вашим параметрам',
        'Все фотографии': 'Всі фотографії',
        'отзыв': 'відгук',
        'отзыва': 'відгука',
        'отзывов': 'відгуків',
        'Посмотреть на карте': 'Подивитись на карті',
        'Полное описание отеля →': 'Повний опис готелю →',
        'питание': 'харчування',
        'Питание': 'Харчування',
        'Другие варианты в этом отеле': 'Інші варіанти в цьому готелі',
        'выбрать': 'вибрати',
        'Количество взрослых': 'Кількість дорослих',
        'Количество детей': 'Кількість дітей',
        'Расположение': 'Розташування',
        'Адрес': 'Адреса',
        'Телефоны': 'Телефони',
        'Сайт отеля': 'Сайт готелю',
        'В отеле': 'В готелі',
        'Для детей': 'Для дітей',
        'Развлечение и спорт': 'Розваги та спорт',
        'Номера': 'Кiмнати',
        'Номер': 'Кiмната',
        'номер': 'кiмната',
        'Туры в отель': 'Тури в готель',
        'Описание': 'Опис',
        'Фотографии': 'Фото',
        'Карта': 'Мапа',
        'Отзывы': 'Відгуки',
        'Вернуться к просмотру результатов': 'Повернутися до перегляду результатів',
        'Общая оценка ': 'Загальна оцінка ',
        'На основании ': 'На підставі ',
        ' пользователей': '  користувачів',
        'ТурПравды': 'ТурПравди',
        'сервис': 'сервіс',
        'инфраструктура': 'інфраструктура',
        'Оценки отеля по критериям': 'Оцінки готелю за критеріями',
        'На указанные даты нет туров в этот отель': 'На зазначені дати немає турів в цей готель',
        'Выберите другие даты в таблице внизу.': 'Виберіть інші дати в таблиці внизу.',
        'Указанный тур уже недоступен': 'Вказаного тура вже нема',
        'Выберите другой тур в таблице внизу.': 'Оберіть інший тур у таблиці нижче.',
        'Туристы': 'Туристи',
        'Итого:': 'Разом:',
        'Заказать тур': 'Замовити тур',
        'или в рассрочку': 'або в розстрочку',
        'Заявка на рассрочку': 'Заявка на розстрочку',
        'Условия оформления тура в рассрочку': 'Умови оформлення туру в розстрочку',
        'Вы подписываете в турагентстве турдоговор с рассрочкой оплаты и оплачиваете удобный первый взнос. Остальные платежи вы оплачиваете начиная со следующего месяца в срок до 20-го числа.': 'Ви підписуєте в турагентстві турдоговор з розстрочкою оплати і оплачуєте зручний перший внесок. Решту платежів ви оплачуєте починаючи з наступного місяця в термін до 20-го числа.',
        'Цена тура': 'Ціна туру',
        'Выберите ваш вариант рассрочки': 'Оберіть ваш варіант розстрочки',
        'Укажите удобный первый платеж:': 'Вкажіть зручний перший платіж:',
        'Выберите количество последующих платежей:': 'Виберіть кількість наступних платежів:',
        'Нажимая кнопку Отправить заявку я даю согласие на обработку своих личных данных.': 'Натискаючи кнопку Надіслати заявку я даю згоду на обробку своїх персональних даних.',
        'Внимание!': 'Увага!',
        'Оформление рассрочки возможно только для граждан Украины.': 'Оформлення розстрочки можливо тільки для громадян України.',
        'Еще ': 'Ще ',
        'Отправить заявку': 'Відправити заявку',
        ' платежей': ' платежів',
        ' платежа': ' платежі',
        'Всего ': 'Всього ',
        'Данные покупателя': 'Дані покупця',
        'Все поля формы обязательны для заполнения': 'Всі поля форми обов\'язкові для заповнення',
        'ФИО': 'ПІБ',
        'ИНН': 'ІПН',
        'Закрыть': 'Закрити',
        'заполните поле': 'заповніть поле',
        'Ближайший офис': 'Найближчий офіс',
        'Выберите офис': 'Оберіть офіс',
        'Вернуться': 'Повернутися',
        'Контактный телефон': 'Контактний телефон',
        'При нажатии на кнопку ОТПРАВИТЬ ЗАЯВКУ ваша заявка передается в сервис': 'При натисканні на кнопку ВІДПРАВИТИ ЗАЯВКУ ваша заявка передається в сервіс',
        'Плати позже': 'Плати пізніше',
        'Рассрочку предоставляет сервис «Плати позже»': 'Розстрочку надає сервіс «Плати пізніше»',
        'Благодарим Вас за оформление заявки. Через некоторое время с Вами свяжется наш менеджер для уточнения условий рассрочки.': 'Ми вдячні вам за оформлення заявки. Через деякий час з Вами зв\'яжеться наш менеджер для уточнення умов розстрочки. ',
        'Всю информацию Вы можете получить по телефонам': 'Всю інформацію Ви можете отримати за телефонами',
        'Как с вами связаться?': 'Як з вами зв\'язатися?',
        'По электронной почте': 'По електронній пошті',
        'Ваше имя': 'Ваше ім\'я',
        'Комментарии:': 'Коментарі:',
        'Выберите город': 'Виберіть місто',
        'Отправить заявку в офис:': 'Надіслати заявку в офіс:',
        'Укажите ваш телефон или е-мейл': 'Вкажіть ваш телефон або емейл',
        'Укажите телефон': 'Не вказаний телефон',
        'Неверно указан е-мейл': 'Невірно вказаний емейл',
        'Выберите офис для отправки заказа': 'Виберіть офіс для відправки замовлення',
        'Спасибо за ваш заказ': 'Дякуємо за Ваше замовлення',
        'В ближайшее время с вами свяжется один из наших менеджеров, чтобы подтвердить ваше бронирование и уточнить детали.': 'Найближчим часом з вами зв\'яжеться один з наших менеджерів, щоб підтвердити своє бронювання і уточнити деталі.',
        'Вы можете позвонить нам в любой момент': 'Ви можете зателефонувати нам в будь-який момент',
        'Отправить': 'Відправити',
        'ночь': 'ніч',
        'ночи': 'ночі',
        'Дата отправления и длительность тура': 'Дата відправлення і тривалість туру',
        'изменить': 'змінити',
        'Тип номера и питание': 'Тип кiмнати і харчування',
        'Виза': 'Вiза',
        'Тип номера': 'Тип кiмнати',
        'описание номера': 'опис кiмнати',
        'Модуль поиска туров отключен': 'Модуль пошуку турів відключений',
        'Найти туры всегда можно на ': 'Знайти тури завжди можна на ',
        'Для восстановления работы модуля обратитесь в ': 'Для відновлення роботи модуля зверніться в ',
        'поддержку': 'підтримку',
        'Детали тура': 'Деталі туру',
        'Начало тура': 'Початок туру',
        'Заказать онлайн': 'Купити тур онлайн',
        'Выбрать турагентство': 'Придбати тур в турагентстві',
        'Поиск тура': 'Пошук туру',
        'Сначала заполните поле «Страна, курорт, отель»': 'Спочатку заповніть поле «Країна, курорт, готель»',
        'Из': 'З',
        'Все курорты': 'Всі курорти',
        'ов ': 'iв ',
        'курортов': 'курортів',
        'Найти': 'Знайти',
        'Фильтры': 'Фільтри',
        'Сбросить фильтры': 'Скинути фільтри',
        'Очистить фильтры': 'Очистити фільтри',
        'Отмена': 'Відміна',
        'Куда': 'Куди',
        'Применить': 'Застосувати',
        'Отправление из': 'Відправлення з',
        'Выберите даты начала тура': 'Виберіть дати початку туру',
        'с': 'з',
        'Даты начала тура': 'Дати початку туру',
        'Выберите конец интервала дат': 'Виберіть кінець інтервалу дат',
        'Количество взрослых:': 'Кількість дорослих:',
        'Дети:': 'Діти:',
        'Добавить ребёнка': 'Додати дитину',
        'год': 'рік',
        'года': 'рокiв',
        '2 взрослых': '2 дорослих',
        ', без детей': ', без дітей',
        'Категория отеля': 'Категорія готелю',
        'Оценки отеля': 'Оцінки готелю',
        'по отзывам на Турправде': 'за відгуками на Турправдi',
        'Цена, грн': 'Ціна, грн',
        '2 взр.': '2 дор.',
        'взр.': 'дор.',
        ' + 0 дет.': ' + 0 дiт.',
        ' + 1 дет.': ' + 1 дит.',
        ' + 1 ребенок': '+ 1 дитина',
        '3 взр.': '3 дор.',
        'Найти и показать еще...': 'Знайти і показати ще ...',
        'Ожидайте несколько секунд...': 'Чекайте кілька секунд ...',
        'Опрашиваем туроператоров ': 'Опитуємо туроператорів ',
        'отзывов нет': 'без вiдгукiв',
        'Вернуться к результатам поиска': 'Повернутися до результатів пошуку',
        'Даты и длительность': 'Дати та тривалість',
        'Вернуться в поиск': 'Повернутися в пошук',
        'Дата отправления': 'Дата відправлення',
        ' и длительность тура': ' і тривалість туру',
        'Ещё': 'Ще',
        ' и питание': ' і харчування',
        'Номер и питание': 'Номер і харчування',
        'В номере:': 'У номері:',
        'Указанный тур уже недоступен. Выберите другие даты в форме поиска': 'Зазначений тур став недоступним. Виберіть інші дати в формі пошуку',
        'Отель на карте': 'Готель на карті',
        'Рейтинг отеля ': 'Рейтинг готелю ',
        'Сервис': 'Сервiс',
        'Инфраструктура': 'Iнфраструктура',
        'Найдено ': 'Знайдено ',
        'цена': 'ціна',
        'цены': 'ціни',
        'цен': 'цін',
        ' и ': ' та ',
        'новый отель': 'новий готель',
        'новых отеля': 'нових готелі',
        'новых отелей': 'нових готелів',
        'Похожие отели с высшим рейтингом': 'Схожі готелі з вищим рейтингом',
        'Просмотренные туры': 'Переглянуті тури',
        'В этом отеле нет предложений для заданного числа туристов': 'У цьому готелі немає пропозицій для заданого числа туристів',
        'Поищите': 'Пошукайте',
        'другие отели': 'інші готелі',
        'для такой компании': 'для такої компанії',
        'за одного': 'за одного',
        'за двоих': 'за двох',
        'за троих': 'за трьох',
        'за четверых': 'за чотирьох',
        'за пятерых': 'за п\'ятьох',
        'за шестерых': 'за шістьох',
        'Отели с рекомендацией': 'Готелі з рекомендацією',
        'Хит продаж\' 2018': 'Хіт продажу\' 2018',
        'Для молодежи': 'Для молоді',
        'Семейный отдых': 'Сімейний відпочинок',
        'Спокойный отдых': 'Спокійний відпочинок',
        'Хорошее питание': 'Хороше харчування',
        'TEZ TOUR рекомендует': 'TEZ TOUR рекомендує',
        'VIP отель': 'VIP готель',
        'Выбранный тур больше не актуален. Ищем альтернативы...': 'Обраний тур більше не актуальний. Шукаємо альтернативу...',
        'Тур по этой ссылке уже устарел. Показан ближайший похожий тур.': 'Тур по цьому посиланню вже застарів. Показаний найближчий схожий тур.',

        'Возможна доплата за вечерний обратный рейс $25 за каждого туриста.': 'Можлива доплата за вечірній зворотний рейс $25 за кожного туриста.',
        'Возможна доплата за вечерний обратный рейс 25 евро за каждого туриста.': 'Можлива доплата за вечірній зворотний рейс 25 евро за кожного туриста.',
        'Возможна доплата за утренний рейс туда $25 за каждого туриста.': 'Можлива доплата за ранковий рейс туди $25 за кожного туриста.',
        'Возможна доплата за утренний рейс туда 25 евро за каждого туриста.': 'Можлива доплата за ранковий рейс туди 25 евро за кожного туриста.',
        'Наличие мест на рейсе и окончательную стоимость тура запрашивайте у турагента.': 'Наявність місць на рейсі та остаточну вартість туру запитуйте у турагента.',

    };

    // #9930
    o._ = function(from_text) {
        if(typeof o.lang === 'undefined' || !o.lang) {
            o.lang = o.settings.get('osLang', 'rus'); // rus - default language
        }

        switch(o.lang) {
            case 'ukr':

                // if(typeof o.ua[from_text] === 'undefined') {
                //     console.log(from_text);
                // }

                return typeof o.ua[from_text] !== 'undefined'? o.ua[from_text]: from_text;
                break;
            default:
                return from_text;
        }
    };

    o.osTarget = typeof osTarget !== 'undefined'? osTarget: '';

})(jQuery,otpMain);


/*********************/
/****** 	storage.js	 ***********/
/*********************/
/**
 * Created by vshevtsov on 01.11.16.
 */

(function($, o){

    /**
     * local && session storage
     */
    o.storage = new function(){
        var self = this;

        /**
         * Is supported local storage
         * @returns {boolean}
         */
        this.is_support = function(){
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                return true;
            } catch(e) {
                return false;
            }
        };

        /**
         * Get object from storage
         * @param key
         * @param type (dict || list)
         * @param ts
         * @param cached_days
         * @param cached_hours
         * @returns {*}
         *
         * @example o.storage.get('key', '{}', 'session', 7)
         */
        this.get = function(key, type, ts, cached_days, cached_hours) {
            type = type || []; // list type default
            if(self.is_support() && key) {
                if(ts === 'session') {
                    return JSON.parse(sessionStorage.getItem(key) || type);
                } else {

                    // cached
                    var now = new Date();
                    if(localStorage.getItem(key +'-date') && +localStorage.getItem(key +'-date') < now.getTime()) {

                        var days = +cached_days? cached_days: (+cached_hours? 0: 2); // 2 day default
                        var hours = +cached_hours? cached_hours: 0;

                        if(days) { // cached days
                            self.set(key +'-date', now.getTime()+(+days*24*60*60*1000));
                        } else { // cached hours
                            self.set(key +'-date', now.getTime()+(+hours*60*60*1000));
                        }

                        // remove cache
                        localStorage.removeItem(key);
                    }

                    return JSON.parse(localStorage.getItem(key) || type);
                }
            }
        };

        /**
         * Set object to storage
         * @param key
         * @param value
         * @param ts
         *
         * @example o.storage.set('key', 123)
         */
        this.set = function(key, value, ts){
            if(self.is_support() && key && value) {
                if(ts === 'session') {
                    sessionStorage.setItem(key, JSON.stringify(value));
                } else {
                    localStorage.setItem(key, JSON.stringify(value));
                }
            }
        };

        /**
         * Append item to obj in storage
         * @param key
         * @param data_key
         * @param value
         * @param ts
         *
         * @example o.storage.append('key', 'id', 123)
         */
        this.append = function(key, data_key, value, ts){
            if(self.is_support() && key && data_key && value) {
                var data = self.get(key, '{}', ts);
                data[data_key] = value;
                self.set(key, data, ts);
            }
        };

        /**
         * Delete item from obj in storage
         * @param key
         * @param data_key
         * @param ts
         *
         * @example o.storage.remove('key', 'id')
         */
        this.remove = function(key, data_key, ts){
            if(self.is_support() && key && data_key) {
                var data = self.get(key, '{}', ts);
                delete data[data_key];
                self.set(key, data, ts);
            }
        };

        /**
         * Add offer data #14326 Limit 25 hotels by 5 offers
         * @param hotel
         * @param offer
         */
        this.addOffer = function(hotel, offer){

            if(!$.isEmptyObject(hotel) && hotel.i && !$.isEmptyObject(offer) && offer.i) {

                var now = new Date();
                var hotels = self.get('os-offers', '{}', 'local', 7);

                delete hotel.a;
                delete hotel.e;

                // update the hotel info
                if($.isEmptyObject(hotels[hotel.i])) {
                    hotels[+hotel.i] = $.extend(hotel, {
                        'offers': [],
                        'created': now.getTime()
                    });
                }

                hotels[+hotel.i]['updated'] = now.getTime();

                // update the hotel offers
                var offers_exists = false;
                $.each(hotels[+hotel.i]['offers'], function(i, item){
                    if(String(offer.i) === String(item.i)) {
                        offers_exists = true;
                        hotels[+hotel.i]['offers'][i] = $.extend(hotels[+hotel.i]['offers'][i], offer, {updated: now.getTime()});
                    }
                });

                // append offer if not exists
                if(!offers_exists) {
                    offer.created = now.getTime();
                    offer.updated = now.getTime();
                    hotels[+hotel.i]['offers'].push(offer);
                }

                // check offers limit
                if(hotels[+hotel.i]['offers'].length >= o.config.cached_offers) {
                    // sorting by last update and slice
                    hotels[+hotel.i]['offers'] = hotels[+hotel.i]['offers'].sort(function(a, b){
                        return b.updated - a.updated;
                    }).slice(0, o.config.cached_offers);
                }

                // check hotels limit
                if(Object.keys(hotels).length > o.config.cached_hotels) {

                    // sorting by last update and slice
                    var sorted_hotels = Object.keys(hotels).sort(function(a, b){
                        return hotels[b].updated - hotels[a].updated;
                    }).slice(0, o.config.cached_hotels);

                    // remove old hotels
                    $.each(hotels, function(hid, item){
                        if(sorted_hotels.indexOf(+hid) === -1 && +hid !== hotel.i) {
                            delete hotels[+hid];
                        }
                    });
                }

                self.append('os-offers', hotel.i, hotels[hotel.i]);
            }
        };

        /**
         * Load offer(s) from cache #14326
         * @param hid
         * @param oid
         */
        this.getOffers = function(hid, oid){
            var offers = self.get('os-offers', '{}', 'local', 7); // cache life 7 days

            // get all
            if(!+hid && !+oid) {
                return offers;
            }

            // get by hotel
            if(+hid && !+oid) {
                return offers[+hid];
            }

            // get by offer
            if(+hid && +oid) {
                var offer = {};
                if(!$.isEmptyObject(offers[+hid])) {
                    $.each(offers[+hid]['offers'], function(i, item){
                        if(+item.i === +oid) {
                            offer = item;
                            return false;
                        }
                    });
                }
                return offer;
            }
        }

        /* Clear clients cache */
        var lastCleanTimestamp = (new Date('2019-06-20')).valueOf();
        if(self.is_support() && self.get('killtime', lastCleanTimestamp) <= lastCleanTimestamp) {
            localStorage.clear();
            self.set('killtime', Date.now());
        }
    };

})(jQuery, otpMain);


/*********************/
/****** 	obj.js	 ***********/
/*********************/
/**
 * Main object
 * @type {{config: {}}}
 */

(function($, o){

    o = $.extend(o, {
        page: 'form',
        popupTrigger: false,
        linkClick: function (e) {
            this.hash.stop();
            window.location.href = jQuery(e).attr('href');
            window.location.reload();
        },
        /**
         * @type {{prefix: string, searchLink: string, suggestLink: string}}
         */
        config: {
            baseUrl: 'https://export.otpusk.com',
            prefix: (typeof osPrefix !== 'undefined' && osPrefix) ? osPrefix : 'new_',
            reviewsLink: 'https://www.turpravda.com/informers/hotel/',
            //votesLink: 'https://www.turpravda.com/hotels/votes/', #deprecate

            suggestLink: 'https://export.otpusk.com/api/tours/suggests/',
            regionsLink: 'https://export.otpusk.com/api/tours/regions/',
            deptCitiesLink: 'https://export.otpusk.com/api/tours/deptCities',
            searchLink: 'https://export.otpusk.com/api/tours/search/',
            offerLink: 'https://export.otpusk.com/api/tours/offer/',
            offerActualLink: 'https://export.otpusk.com/api/tours/actual/',
            datesLink: 'https://export.otpusk.com/api/tours/dates/',
            tourLink: 'https://export.otpusk.com/api/tours/hotel/',
            orderLink: 'https://export.otpusk.com/api/tours/order/',
            citiesLink: 'https://export.otpusk.com/api/tours/cities',
            hotelsLink: 'https://export.otpusk.com/api/tours/hotels',
            servicesLink: 'https://export.otpusk.com/api/tours/services',
            agenciesLink: 'https://export.otpusk.com/api/tours/agency',
            graphLink: 'https://export.otpusk.com/api/tours/graph',
            otpOrderLink: 'https://www.otpusk.com/tour/order',
            hotelDescriptionLink: 'https://export.otpusk.com/js/hotel/',
            officesLink: 'https://export.otpusk.com/api/tours/offices',

            fromCity: [
                {label: o._('Киев'), value: 1},
                {label: o._('Днепр'), value: 2}
            ],
            duration: [
                {label: '2-3 '+ o._('дня'), rel: '1-2 '+ o._('ночи'), value: 2},
                {label: '3-5 '+ o._('дней'), rel: '2-4 '+ o._('ночи'), value: 3},
                {label: '4-6 '+ o._('дней'), rel: '3-5 '+ 'ночей', value: 4},
                {label: '5-7 '+ o._('дней'), rel: '4-6 '+ 'ночей', value: 5},
                {label: '6-8 '+ o._('дней'), rel: '5-7 '+ 'ночей', value: 6},
                {label: '7-9 '+ o._('дней'), rel: '6-8 '+ 'ночей', value: 7},
                {label: '8-10 '+ o._('дней'), rel: '7-9 '+ 'ночей', value: 8},
                {label: '9-11 '+ o._('дней'), rel: '8-10 '+ 'ночей', value: 9},
                {label: '10-12 '+ o._('дней'), rel: '9-11 '+ 'ночей', value: 10},
                {label: '11-13 '+ o._('дней'), rel: '10-12 '+ 'ночей', value: 11},
                {label: '12-14 '+ o._('дней'), rel: '11-13 '+ 'ночей', value: 12},
                {label: '13-15 '+ o._('дней'), rel: '12-14 '+ 'ночей', value: 13},
                {label: '14-16 '+ o._('дней'), rel: '13-15 '+ 'ночей', value: 14},
                {label: '15-17 '+ o._('дней'), rel: '14-16 '+ 'ночей', value: 15},
                {label: '16-18 '+ o._('дней'), rel: '15-17 '+ 'ночей', value: 16},
                {label: '17-19 '+ o._('дней'), rel: '16-18 '+ 'ночей', value: 17},
                {label: '18-20 '+ o._('дней'), rel: '17-19 '+ 'ночей', value: 18},
                {label: '19-21 '+ o._('дней'), rel: '18-20 '+ 'ночей', value: 19},
                {label: '20-22 '+ o._('дней'), rel: '19-21 '+ 'ночей', value: 20},
                {label: '21-23 '+ o._('дней'), rel: '20-22 '+ 'ночей', value: 21},
                {label: '22-24 '+ o._('дня'), rel: '21-23 '+ 'ночей', value: 22},
                {label: '23-25 '+ o._('дней'), rel: '22-24 '+ 'ночей', value: 23},
                {label: '24-26 '+ o._('дней'), rel: '23-25 '+ 'ночей', value: 24},
                {label: '25-26 '+ o._('дней'), rel: '24-26 '+ 'ночей', value: 25},
                {label: '26-26 '+ o._('дней'), rel: '25-26 '+ 'ночей', value: 26}
            ],
            category: [
                {label: '1', value: 1},
                {label: '2', value: 2},
                {label: '3', value: 3},
                {label: '4', value: 4},
                {label: '5', value: 5}
            ],
            food: [
                {label: 'OB', value: 'ob', description: o._('без питания')},
                {label: 'BB',value: 'bb', description: o._('завтрак')},
                {label: 'HB', value: 'hb', description: o._('завтрак и ужин')},
                {label: 'FB',value: 'fb', description: o._('полный пансион')},
                {label: 'AI', value: 'ai', description: 'все включено'},
                {label: 'UAI',value: 'uai',description: 'ультра все включено'}
            ],
            transport: [
                {label: o._('Авиаперелет'), value: 'air'},
                {label: 'Автобус', value: 'bus'},
                {label: o._('Без транспорта'), value: 'no'}
            ],
            service: {
                'mainService': {
                    'spa': 'spa-центр / Wellness-центр',
                    'aquapark': 'аквапарк',
                    'animation': o._('анимация'),
                    'wifi': o._('бесплатный Wi-Fi'),
                    'water_sports': o._('водные виды спорта на пляже'),
                    'diving': o._('дайвинг'),
                    'pool': o._('детский бассейн'),
                    'discotheque': o._('дискотека в отеле'),
                    'indoor_pool': o._('крытый бассейн'),
                    'club': o._('мини-клуб / детская комната'),
                    'non_smoking': 'номера для некурящих',
                    'excursions': o._('организация экскурсий'),
                    'outdoor_pool': o._('открытый бассейн'),
                    'rent_car': o._('прокат автомобилей'),
                    'fitness': o._('фитнес-центр / тренажерный зал'),
                    'one_line_beach': o._('1-я пляжная линия'),
                    'two_line_beach': o._('2-я пляжная линия'),
                    'sandy': o._('песчаный пляж'),
                    'pebble': o._('галечный пляж')
                }
            },
            serviceLabels: {
                'beachService': 'Пляж',
                'childService': o._('Для детей'),
                'mainService': o._('В отеле'),
                'roomService': o._('Номера'),
                'sportService': o._('Спорт'),
                'promoService': o._(''),
                'recommendService': o._('Отели с рекомендацией')
            },
            hotelRating: [
                {label: '4', value: 4},
                {label: '5', value: 5},
                {label: '6', value: 6},
                {label: '7', value: 7},
                {label: '8', value: 8},
                {label: '9', value: 9},
                {label: '10', value: 10}
            ],
            priceRange: {ua: [500, 100000]},
            defaultPeople: 2,
            citiesFrom: {
                '0': {'name': o._('Любой город') +' ('+ o._('без транспорта')+')', 'rel': o._('Любой город'), 'id': 0},
                '1': {'name': o._('Киев'), 'rel': o._('Киева'), 'id': 1544},
                '2': {'name': o._('Харьков'), 'rel': o._('Харькова'), 'id': 1880},
                '3': {'name': o._('Днепр'), 'rel': o._('Днепра'), 'id': 1874},
                '4': {'name': o._('Одесса'), 'rel': o._('Одессы'), 'id': 1358},
                '5': {'name': o._('Львов'), 'rel': 'Львова', 'id': 1397},
                '1012': {'name': o._('Винница'), 'rel': o._('Винницы'), 'id': 1934},
                '1117': {'name': o._('Луцк'), 'rel': o._('Луцка'), 'id': 2024},
                '1519': {'name': 'Ужгород', 'rel': 'Ужгорода', 'id': 1398},
                '1614': {'name': o._('Запорожье'), 'rel': o._('Запорожья'), 'id': 1875},
                '1714': {'name': o._('Ивано-Франковск'), 'rel': o._('Ив.-Франковска'), 'id': 1760},
                '3421': {'name': o._('Черновцы'), 'rel': o._('Черновцов'), 'id': 1708},
                '1231': {'name': o._('Кривой Рог'), 'rel': o._('Кривого Рога'), 'id': 1883},
                '2622': {'name': o._('Ровно'), 'rel': o._('Ровно'), 'id': 1981},
                '3023': {'name': o._('Херсон'), 'rel': o._('Херсона'), 'id': 2012},
                '1415': {'name': o._('Житомир'), 'rel': o._('Житомира'), 'id': 2056},
                '3117': {'name': o._('Каменец-Подольский'), 'rel': o._('Каменец-Подольска'), 'id': 1395},
                '1716': {'name': o._('Коломыя'), 'rel': o._('Коломия'), 'id': 1666},
                '3576': {'name': o._('Мелитополь'), 'rel': o._('Мелитополя'), 'id': 2166},
                '2319': {'name': o._('Николаев'), 'rel': o._('Николаева'), 'id': 1963},
                '3126': {'name': o._('Хмельницкий'), 'rel': o._('Хмельницкого'), 'id': 2025},
            },
            cached_hotels: 15, // max hotels in local storage
            cached_offers: 3,  // max offers of one hotel in storage
            operators: {
                '1':    {'vendor': 'tess', 'name': 'Turtess'},
                '2':    {'vendor': 'tztr', 'name': 'TEZ'},
                '3':    {'vendor': 'oasi', 'name': 'Oasis'},
                '237':  {'vendor': 'orbt', 'name': 'Orbita'},
                '269':  {'vendor': 'pega', 'name': 'Pegas'},
                '281':  {'vendor': null, 'name': 'Pan Ukraine'},
                '358':  {'vendor': 'sist', 'name': 'Siesta'},
                '520':  {'vendor': 'tcc', 'name': 'TCC'},
                '594':  {'vendor': 'tui', 'name': 'TUI'},
                '717':  {'vendor': 'anex', 'name': 'Anextour'},
                '759':  {'vendor': 'alf', 'name': 'Alf'},
                '852':  {'vendor': 'nwtr', 'name': 'News Travel Online'},
                '856':  {'vendor': 'mznd', 'name': 'Mouzenidis'},
                '1389': {'vendor': 'idsa', 'name': 'IdrisKa'},
                '1416': {'vendor': 'corl', 'name': 'Coral'},
                '1897': {'vendor': 'lbst', 'name': 'Lyubosvit'},
                '2700': {'vendor': 'tpg', 'name': 'TPG'},
                '2835': {'vendor': 'join', 'name': 'JoinUP!'},
                '3019': {'vendor': 'adry', 'name': 'AdriaHit'},
                '3021': {'vendor': 'gto', 'name': 'Kompas'},
                '3061': {'vendor': 'ntle', 'name': 'Natalie'},
                '3066': {'vendor': 'kndg', 'name': 'Kandagar'},
                '3237': {'vendor': 'zeus', 'name': 'Zeus'},
                '3251': {'vendor': 'vilr', 'name': 'Vilar'},
                '3266': {'vendor': 'tlid', 'name': 'Tour Leader'},
                '3276': {'vendor': 'drem', 'name': 'DreamTravel'},
                '3291': {'vendor': 'aris', 'name': 'Аристея Тур'},
                '3296': {'vendor': 'aris', 'name': 'Аристея Тур'},
                '3301': {'vendor': 'aris', 'name': 'Аристея Тур'},
                '3306': {'vendor': 'aris', 'name': 'Aristeya'},
                '3311': {'vendor': 'snta', 'name': 'Sonata'},
                '3316': {'vendor': 'west', 'name': 'West Travel'},
                '3321': {'vendor': 'ugc', 'name': 'UGC'},
                '3326': {'vendor': 'tgaw', 'name': 'Tour-Group'},
                '3331': {'vendor': 'tui2', 'name': 'TUI'},
                '3336': {'vendor': 'fira', 'name': 'Feeria'},
                '3341': {'vendor': 'vedi', 'name': 'VediTour'},
                '3342': {'vendor': null, 'name': 'Центр'}
            }
        }
    });
})(jQuery, otpMain);


/*********************/
/****** 	hashlink.js	 ***********/
/*********************/
(function($,obj){

    var hash = function(){
        var self = this;
        self.delimaterVars = '&';
        self.delimaterVal = '=';
        self.store = {};
        self.expectedHash = '';
        self.prefix = '!';
        self.triggers = [];
        self.stop = true;
        self.autostartTimeout = 500;

        this.start = function(){
            self.stop = true;
        };

        this.is_valid = false;
        this.callback = {};

        /**
         * Bind the callbacks
         * @param n
         * @param f
         * @returns {f}
         */
        this.bind = function(n,f){
            if(this.callback[n] === undefined){
                this.callback[n] = [];
            }
            this.callback[n].push(f);
            return this;
        };

        /**
         * Run the binding callbacks
         * @param n
         * @param a
         * @param b
         * @param c
         * @returns {boolean}
         */
        this.call = function(n,a,b,c){

            if(this.callback[n] && this.callback[n].length){
                for(var i in this.callback[n]){
                    if(typeof this.callback[n][i] === 'function' && this.callback[n].hasOwnProperty(i)){
                        this.callback[n][i](a,b,c);
                    }
                }
                return true;
            }
            return false;
        };

        /**
         * аппендим элемент
         * @param string key
         * @param string val
         */
        this.add = function(key,val,isCompile){
            if(key&&val !== undefined){
                isCompile = isCompile || false;
                self.store[key] = val;
                if(isCompile){
                    return this.compile(self.store)
                }
            }
        };

        /**
         * Add hash change trigger
         * @param f callback
         * @param p priority
         * @param g page
         * @param a module_type
         * @param key key
         */
        this.addTrigger = function (f, p, g, a, key) {
            var module_type = 'tours' in api_modules && api_modules['tours'] ? api_modules['tours'] : null;

            if (typeof f === 'function' && (!a || (a.indexOf(module_type) !== -1))) {
                p = p || 0;
                self.triggers.push([p, f, g, key]);
                self.triggers.sort(function (a, b) {
                    return a[0] - b[0];
                })
            }
        };

        this.removeTrigger = function (key) {
            self.triggers = self.triggers.filter(function (f) {
                return f[3] !== key;
            });
        };

        /**
         * удаляем по ключу
         * @param key
         */
        this.rm = function(key){
            if(self.store[key]){
                delete self.store[key];
                this.compile();
            }
        };

        this.rmAll = function(){
            self.store = [];
            var loc = window.location.href,
                index = loc.indexOf('#');

            if (index > 0) {
                window.location = loc.substring(0, index);
            }
        };

        /**
         * getter
         * @param key
         * @param defVal
         */
        this.get = function(key, defVal){
            defVal = typeof defVal !== 'undefined' ? defVal : false;

            //TMP
            if(!key){
                return self.store;
            }
            //TMP

//            var realHashKey = obj.contsself.Store.getHashKey(key);
//            if( realHashKey!==false&&self.store[realHashKey]!==undefined ){ // find as alias
//                return self.store[realHashKey];
//            }else
            if(self.store[key]!==undefined){ // find as real key
                return self.store[key];
            }else{
                return defVal;
            }
        };

        /**
         * собираем хеш-линк и устанавливаем в url
         *
         * @param forceData {}
         * @param isString bool
         * @return {String} bool
         */
        this.compile = function(forceData,isString){
            var isForceTrueKeys = forceData===undefined||forceData===false;
            forceData = forceData || self.store;
            isString = isString || false;
            var h=[];

            var allowedQ = obj.search.getQuery();
            var allowed = {
                'ol': null,
                'od': null,
                'oid': null,
                'tr': null,
                'ts': null,
                'hnm': null,
                'hid': null,
                'page': null,
                'transp': null,
                'hotelId': null,
                'offerId': null,
                'length': null,
                'fd': null,
                'rmT': null,
                'rm': null,
                'checkIn': null,
                'operatorId': null,
                'cntDay': null,
                'lnFrom': null,
                'tab': null,
                'dptCt': null,
                'toCities': null,
                'people': null,
                'type': null,
                'id': null,
                'to': null,
                'from': null,
                'curr': null,
                'referer': null,
                'ref': null
            };

            for(var i in forceData){
                if(!!forceData[i] && forceData.hasOwnProperty(i) && (allowedQ.hasOwnProperty(i) || allowed.hasOwnProperty(i))) {
                    h.push( i + self.delimaterVal + encodeURIComponent(forceData[i]));
                }
            }

            self.prefix = obj.prefix==undefined? self.prefix: obj.prefix;

            if(isString){
                return self.prefix+h.join(self.delimaterVars);
            }else{
                window.location.hash = self.prefix+h.join(self.delimaterVars);
            }
        };

        /**
         * парсим хеш-линк и запоминаем
         */
        this.parse = function(h){
            if(!h) h = window.location.hash;

            if(!h){
                return this;
            }

            self.prefix = obj.prefix===undefined? self.prefix: obj.prefix;

            var e = [];
            try {
                e = decodeURI(h).substr(self.prefix.length+1).split(self.delimaterVars);
            } catch(e) {
                console.log(e);
            }
            var query = obj.search.getQuery();
            var queryOld = {'oid': 0, 'hid': 0, 'ts': 0, 'from':1, 'to':1, 'lnFrom':1, 'cntDay': 1};

            self.store = {};
            for(var i in e){
                if(e.hasOwnProperty(i)){
                    var zn = e[i].split(self.delimaterVal);

                    self.store[zn[0]] = decodeURIComponent(zn[1]);
                }
            }

            // is local hash
            $.each(self.store, function(k,v){
                if(typeof query[k] !== 'undefined' || typeof queryOld[k] !== 'undefined') {
                    self.is_valid = true;
                    return false;
                }
            });
            return this;
        };


        /**
         * отрабатываем изменение хеш-линка
         *  если изменение
         */
        this.onHashChange = function(){
            if (window.location.hash && this.check() && (self.expectedHash !== encodeURIComponent(decodeURIComponent(window.location.hash))) && self.stop) {
                self.expectedHash = window.location.hash;
                // #6667
                if(typeof otpMain.osTarget === 'string' && otpMain.osTarget) {
                    var localUri = window.location.hostname+window.location.pathname+window.location.search;
                    var osTargetD = otpMain.osTarget.replace(window.location.protocol + '//' , '');
                    if(localUri.indexOf(osTargetD) < 0 && self.get('page') !== 'hotel') {
                        return false;
                    }
                }

                this.parse();

                if(this.is_valid) {
                    // call self.triggers
                    var i;
                    for(i in self.triggers){
                        if(self.triggers.hasOwnProperty(i) && (self.triggers[i][2] === obj.page || !self.triggers[i][2]) && self.stop){
                            self.triggers[i][1]();
                        }
                    }

                    if(obj.hash.get('page') === 'form') {
                        obj.search.hashChange();
                    }
                }
            }

            this.call('onHashChange', self.store);
        };

        /**
         * Проверка хешлинка на наличие префикса
         * @returns {boolean}
         */
        this.check = function() {
            var h = window.location.hash.substr(0, 3);

            self.prefix = obj.prefix===undefined? self.prefix: obj.prefix;
            if(h.indexOf('#'+ self.prefix) > -1) {
                return true;
            }
            return false;
        }
    };

    obj.hash = new hash();

    // binding hash change
    $(window).bind('hashchange', function(e) {
        obj.hash.onHashChange(e);
    });

    // trigger "hashchange" on load the page
    $(function(){
        setTimeout(function(){
            if(typeof obj.form.view.$ !== 'undefined') {
                obj.hash.onHashChange();
            }
        }, obj.hash.autostartTimeout);
    });

})(jQuery,otpMain);



/*********************/
/****** 	fn.js	 ***********/
/*********************/
/**
 * Created by mtoy on 4/23/14.
 */

(function($,o){

    var f = function(){

        var self = this;

        /**
         * Return currency name
         * @param currency
         * @param cls
         * @returns {string}
         */
        this.currencyName = function(currency, cls) {
            var currencies = {
                    'uah': ['грн', 'грн'],
                    'usd': ['дол.', '$'],
                    'eur': [o._('евро'), '€']
                };

            return ' <span class="'+ (cls || 'currency') +'">' + currencies[currency][1]+ '</span>';
        };

        /**
         * Print the offer price
         * @param price
         * @param currency
         * @param cls
         * @returns {string}
         */
        this.priceEcho = function(price, currency, cls) {
            var value = Math.round(price).toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g, '$1&thinsp;');
            return value +' '+ self.currencyName(currency, cls);
        };

        this.onlyPriceEcho = function(price, format) {
            var res = Math.round(price).toString();

            if(format) {
                res = res.replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g, '$1&thinsp;');
            }
            return res;
        };

        this.onlyCurEcho = function(currency) {
            var currencies = {
                    'uah': ['грн', 'грн'],
                    'usd': ['дол.', '$'],
                    'eur': [o._('евро'), '€']
                };

            return currency in currencies
                ? currencies[currency][1]
                : '';
        };

        /**
         * 1,2,5
         * @param number
         * @param titles
         * @param with_number
         * @returns {*}
         */
        this.suffixForNumber = function(number, titles, with_number) {
            var cases = [2, 0, 1, 1, 1, 2];
            return (with_number? number +' ':'') + titles[ (number%100>4 && number%100<20)? 2 : cases[(number%10<5)?number%10:5] ];
        };

        /**
         * Return prefix
         * @param name
         * @param p
         * @returns {*}
         */
        this.prefix = function(name,p){
            p = p || '';
            return p+o.config.prefix+name;
        };

        /**
         * Find item in array
         * @param needle
         * @param haystack
         * @param strict
         * @returns {boolean}
         */
        this.in_array = function(needle, haystack, strict) {
            var found = false, key, strict = !!strict;

            for (key in haystack) {

                    if ((strict && haystack[key] === needle) || (!strict && haystack[key] == needle)) {
                        found = true;
                        break;
                }
            }

            return found;
        };

        /**
         * Remove item from array
         * @param needle
         * @param haystack
         * @returns {*}
         */
        this.rm_in_array = function(needle, haystack) {
            $.each(haystack, function(k, v){
                if(needle === v) haystack.splice(k, 1);
            });
            return haystack;
        };

        /**
         * Format date as YYYY-MM-DD
         * @param d
         * @returns {string}
         */
        this.formatDate = function(d) {
            return d.getFullYear() +'-'+ ("0" + (d.getMonth() + 1)).slice(-2) +'-'+ ("0" + d.getDate()).slice(-2)
        };

        /**
         * Parse datetime string 'YYYY-MM-DD HH:MM'
         *
         * @param str
         * @returns {Date}
         */
        this.parseDateTimeString = function(str) {
            var date = null,
                time = null;

            if(str.indexOf(' ')) {
                date = str.split(' ')[0];
                time = str.split(' ')[1];
            }
            else {
                date = str;
                time = [0,0];
            }

            date = date.split('-');
            time = time.split(':');

            return new Date(+date[0], +date[1] -1 , +date[2], +time[0], +time[1]);
        };

        /**
         * Modify date
         *
         * @param base
         * @param value
         * @param format
         * @returns {Date}
         */
        this.modifyDate = function (base, value, format) {
            if (typeof base === 'string') {
                base = new Date(base);
            }

            var result = new Date(base);
            result.setHours(0, 0, 0);

            switch (format) {
                case 'day':
                case 'days':
                    result.setDate(result.getDate() + value);
                    break;
                case 'month':
                case 'months':
                    result.setMonth(result.getMonth() + value);
                    break;
            }

            return result;
        };

        /**
         * Return list range [from,2,3,4,5..(+to)]
         * @param from
         * @param to
         * @returns {*}
         */
        this.range = function(from, to) {
            return Array.apply(from, Array(+to)).map(function (element, index) {return index + from;});
        };

        /**
         * Return a current cookies by key
         * @param name
         * @returns {*}
         */
        this.getCookie = function(name) {
            var matches = document.cookie.match(new RegExp(
                "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
            ));
            return matches ? decodeURIComponent(matches[1]) : undefined;
        };

        /**
         * Get first item from array
         * @param d
         * @returns {*}
         */
        this.getFirst = function(d) {
            var i;
            for(i in d) {
                if(d.hasOwnProperty(i)) {
                    if(d[i]) return d[i];
                }
            }
            return null;
        };

        /**
         * Return title format
         * @param str
         * @returns {*}
         */
        this.ucFirst = function(str) {
            if(str.length) {
                str = str.charAt(0).toUpperCase() + str.slice(1);
            }
            return str;
        };

        /**
         * test
         */
        this.durationFunc = function() {
            if ($('.new_t-container').length) {
                if ($('.new_check-mobile').is(':hidden')) {
                    var durWidth = $('.new_t-duration-container').width();
                    var durParentWidth = $('.new_t-duration-col').width();
                    if (durWidth > durParentWidth - 80) {
                        $('.new_t-tour-tab-table.date-table').addClass('vertical-table');
                    }
                    $('.new_t-date-table').css('opacity','1');
                }
            }
        };

        /**
         * Dropdown
         * @param container
         */
        this.dropdown = function(container){

            this.container = container;
            this.button = this.container.find('[data-role=button]');

            this.button.on('click', (function(e) {
                if (!this.visible) {
                    this.open();
                } else {
                    this.close();
                    //this.removeAttr('data-active');
                }
            }).bind(this));

            this.refresh();
        };

        this.dropdown.prototype = {
            'visible': false,
            /**
             * Open dropdown
             */
            'open': function() {
                if (!this.body.closest(o.fn.prefix('f-dropdown-container','.')).hasClass(o.fn.prefix('os-date-check'))) {
                    $('html').addClass(o.fn.prefix('layer-open'));
                }
                this.body.show();
                this.visible = true;
                var just = true;
                $(document).on('click.dropdown' + this.container.attr('id'), (function(e) {
                    if (!just && !$(e.target).closest(this.body).length) {
                        this.close();
                    }
                    just = false;
                }).bind(this));

                this.button.attr('data-active','true');

                this.container.trigger('dd.open', [this]);
            },
            /**
             * Close dropdown
             */
            'close': function() {
                if (!this.body.closest(o.fn.prefix('f-dropdown-container','.')).hasClass(o.fn.prefix('os-date-check'))) {
                    $('html').removeClass(o.fn.prefix('layer-open'));
                }
                $('html').removeClass(o.fn.prefix('date-open'));
                this.body.hide();
                this.visible = false;
                $(document).off('click.dropdown' + this.container.attr('id'));

                this.button.removeAttr('data-active');
            },
            /**
             * Refresh dropdown
             */
            'refresh': function(){
                this.body = this.container.find('[data-role=body]');
                this.items = this.container.find('[data-role=item]');
                this.closeBtn = this.container.find('[data-role=close]');

                this.items.on('click', $.proxy(this.close, this));

                // update label
                this.items.on('click', function(e){

                    e.stopPropagation();
                    e.preventDefault();

                    var drpParent = $(this).closest(o.fn.prefix('f-dropdown-container', '.'));
                    drpParent.find(o.fn.prefix('f-dropdown-item','.')).removeClass('selected');
                    $(this).addClass('selected');
                    if(!$(this).hasClass(o.fn.prefix('not-label-change'))) {
                        drpParent.find(o.fn.prefix('f-dropdown-btn-text','.')).html($(this).html());
                    }

                    //14991#note-3
                    if ($(this).closest('.new_f-form-field').hasClass('from') && $('.new_f-title').text() == 'Пошук туру') {

                        if ($('.new_f-dropdown-container.from div[data-value="1397"]').hasClass('selected')) {
                            $('.new_f-dropdown-container.from .new_f-dropdown-btn span:eq(0)').html('зі&nbsp;');
                        } else {
                            $('.new_f-dropdown-container.from .new_f-dropdown-btn span:eq(0)').html('з&nbsp;');
                        }
                    }
                });

                // assign events
                this.items.on('click', (function(e) { this.container.trigger('dd.select', [this, $(e.target)]); }).bind(this));
                this.closeBtn.on('click', (function() {
                    this.close();
                    this.container.trigger('dd.cancel', [this]);
                }).bind(this));
            },
            /**
             * Set dropdown body
             * @param body
             */
            'setBody': function(body) {
                this.body.empty().append(body);
                this.refresh();

            },
            /**
             * Add event listener
             * @param event
             * @param callback
             */
            'on': function(event, callback) {
                this.container.on(event, callback);
            },
            /**
             * Remove event listener
             * @param event
             * @param callback
             */
            'off': function(event, callback) {
                this.container.off(event, callback);
            }
        };

        /**
         * Is mobile screen
         */
        this.isMobile = function() {
            return $('.new_check-mobile').is(':visible');
        };

        /**
         * Is visible
         * @param el
         */
        this.isVisible = function(el) {
            return el.is(':visible') && !el.is(':empty');
        };

        /**
         * Is results page
         */
        this.isResultsPage = function() {
            var localUri = window.location.hostname + window.location.pathname + window.location.search;
            var resultsUri = o.osTarget ? o.osTarget.replace(window.location.protocol + '//', '') : '';

            return !o.osTarget || localUri.indexOf(resultsUri) !== -1;
        };

        /**
         * Smooth checkboxes group values
         *
         * @param checkboxes
         * @param type
         */
        this.combineCheckboxesGroup = function(checkboxes, type) {
            var sequences = {
                'valleys': [],
                'peaks': []
            };

            /* Arrange groups of values into sequences */
            var state = null;
            checkboxes.map(function(i, input) {
                var type = input.checked ? 'peaks' : 'valleys';
                if(!state || state !== type) {
                    state = type;
                    sequences[type].push([]);
                }

                var sequence = sequences[state][sequences[state].length - 1];
                sequence.push(i);
            });

            switch (type) {
                case 'down':
                    var peaks = sequences.peaks;
                    if(peaks.length > 1) {
                        /* Sort by length */
                        peaks = peaks.sort(function (a, b) {
                            return a.length - b.length;
                        });
                        /* Floor minor part */
                        peaks[0].map(function (index) {
                            checkboxes.eq(index).prop('checked', false);
                        });
                    }
                    break;
                case 'up':
                    var peaks = sequences.peaks;
                    if(peaks.length > 1) {
                        /* Detect hill bounds */
                        var hill = peaks.map(function(peak) {
                            return peak[peak.length -1];
                        }).sort();

                        var hillStart = hill[0],
                            hillEnd = hill[1];

                        /* Grow up hill inputs  */
                        checkboxes.slice(hillStart, hillEnd).map(function(index, input) {
                            $(input).prop('checked', true);
                        });
                    }
                    break;
            }
        };

        /**
         * Check API response
         * @param d
         */
        this.checkError = function(d) {
            if(d.error) {
                var type = 'critical';
                var message = typeof d.error === 'string' ? d.error : (d.message ? d.message : '');

                switch (message) {
                    case 'Old key':
                        location.reload();
                        break;
                    case '429 Too Many Requests':
                        type = 'warning';
                        break;
                    case 'Task is already running, please try again in a few seconds!':
                        type = 'warning';
                        break;
                    default:
                        if(message.indexOf('No valid hash') > -1) {
                            // load new apiKey #5508
                            $.ajax({
                                type: "GET",
                                url: 'https://export.otpusk.com/api/init?access_token='+ osApiId,
                                dataType: 'jsonp',
                                timeout: 25000, // 25 sec
                                success: function (resp) {
                                    console.log('got new apiKey');
                                    otpMain.apiKey = resp.apiKey;
                                    o.form.location.setStore('--', undefined);
                                }
                            });
                        }
                        console.error(message);
                }

                return {
                    type: type,
                    message: message
                };
            }

            return null;
        };

        /**
         * Show error page
         * @param code
         */
        this.errorPage = function(code) {
            switch(code) {
                default:
                    o.view.$.html(
                        $('<div>').addClass(o.fn.prefix('form-wrap desktop'))
                            .html('<p class="nonactive_big">'+ o._('Модуль поиска туров отключен') +'.</p> <p class="nonactive_big">'+ o._('Найти туры всегда можно на ') +
                                '<a href="https://www.otpusk.com/">www.otpusk.com</a>.</p> ' +
                                '<p class="nonactive_sm"> '+ o._('Для восстановления работы модуля обратитесь в ') +
                                '<a href="http://help.otpusk.com/">'+ o._('поддержку') +'</a>.</p>')
                    );
                    break;
            }

            throw {
                name: 'Error',
                message: 'Something went badly wrong'
            };
        };

        /**
         * Get Month name by number
         * @param month
         * @returns {*}
         */
        this.getMonthName = function(month){
            return [o._("январь"),o._("февраль"),o._("март"),o._("апрель"),o._("май"),o._("июнь"),o._("июль"),
                o._("август"),o._("сентябрь"),o._("октябрь"),o._("ноябрь"),o._("декабрь")][month];
        };

        this.formatPeriodDate = function(type, format, date) {
            var days = {
                left: ['с воскресенья', 'с понедельника', 'со вторника', 'со среды', 'с четверга', 'с пятницы', 'с субботы'],
                right: ['по воскресенье', 'по понедельник', 'по вторник', 'по среду', 'по четверг', 'по пятницу', 'по субботу']
            };

            var monthes = ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'];

            return format
                .split(' ')
                .map(function (part) {
                    switch (part) {
                        case 'DD':
                            return days[type][date.getDay()];
                        case 'MM':
                            return monthes[date.getMonth()];
                        default:
                            return $.datepicker.formatDate(part, date)
                    }
                })
                .join(' ');
        };

        /**
         * Get dates diff
         * @param one
         * @param two
         * @param format
         * @returns {*}
         */
        this.getDatesDiff = function(one, two, format) {
            one = this.cloneDate(one);
            two = this.cloneDate(two);
            var diff = null;

            switch (format) {
                case 'M':
                    diff = (one.getFullYear() - two.getFullYear()) * 12;
                    diff += one.getMonth() - two.getMonth();
                    break;
                case 'D':
                    one.setHours(0,0,0);
                    two.setHours(0,0,0);
                    var timeDiff = Math.abs(one.getTime() - two.getTime());
                    diff = Math.floor(timeDiff / (1000 * 3600 * 24));
                    break;
            }

            return diff;
        };

        /**
         * Perform post request to url
         *
         * @param path
         * @param params
         */
        this.performPostRequest = function(path, params) {
            var form = $("<form>", {
                attr: {
                    'method': 'post',
                    'action': path
                }
            });

            var appendInput = function(key, value) {
                if(typeof value === 'object') {
                    for(var prop in value) {
                        if(value.hasOwnProperty(prop)) {
                            appendInput(key + '[' + prop + ']', value[prop]);
                        }
                    }
                }
                else {
                    $('<input>', {
                        attr: {
                            type: 'hidden',
                            name: key,
                            value: value
                        }
                    }).appendTo(form);
                }
            };

            appendInput('offer', params);

            $('body').append(form);
            form.get(0).submit();
        };

        /**
         * Swap object key values
         * @param source
         */
        this.swapObjectKeyVals = function (source) {
            var target = {};
            for (var key in source) {
                target[source[key]] = key;
            }
            return target;
        }

        /**
         * Get otpusk image url
         *
         * @param part
         * @param size
         * @returns {string}
         */
        this.getOtpImageUrl = function(part, size) {
            size = size || '3/400x300';

            return 'https://newimg.otpusk.com/'+ size + '/' + part;
        }

        /**
         * Parse hotel category
         *
         * @param category
         * @returns {number}
         */
        this.parseHotelCategory = function(category) {
            category = typeof category === 'object' ? category.n : category;

            switch (String(category).toLowerCase()) {
                case 'hv1':
                case '4+':
                    return 4;
                case 'hv2':
                case '5+':
                    return 5;
                default:
                    return parseInt(category);
            }
        }

        /**
         * Copy specific props from one object to another
         *
         * @param toObject
         * @param fromObject
         * @param props
         */
        this.copyProps = function (toObject, fromObject, props) {
            $.each(props, function (k, v) {
                var prop = typeof k === 'number' ? v : k;
                var pseudonim = v;

                toObject[pseudonim] = prop in fromObject ? fromObject[prop] : null;
            });
        };

        /**
         * Wait for var in global scope and perform action
         * @param name
         * @param callback
         * @param time
         */
        this.waitGlobalVar = function(name, callback, time) {
            var listener, hunter;

            listener = setInterval(function() {
                if(typeof window[name] !== 'undefined') {
                    clearTimeout(hunter);
                    clearInterval(listener);

                    callback(window[name]);
                }
            }, 300);

            hunter = setTimeout(function() {
                clearInterval(listener);
            }, time || 3000);
        };

        /**
         * Clone date object
         *
         * @param e
         * @returns {Date}
         */
        this.cloneDate = function(e) {
            return new Date(e.getTime());
        };

        /**
         * Apply hours offset to date
         *
         * @param e
         * @returns {any}
         */
        this.normalizeDateTimezone = function(e) {
            var date = typeof e === 'string'
                ? new Date(e)
                : this.cloneDate(e);

            var offset = date.getTimezoneOffset() / 60;
            date.setHours(date.getHours() + offset);

            return date;
        }

    };

    o.fn = new f;

})(jQuery,otpMain);

(function($){

    var resizeFunc = function() {
        //form
        if ($('.new_f-container').parent().length && $('.new_f-container').parent().width() < 911) {
            $('body').addClass('new_m-mobile-form');
            if ($('.new_f-container').parent().width() >= 540) {
                $('body').removeClass('new_mobile-form');
            }
            if ($('.new_f-container').parent().width() < 540) {
                $('body').addClass('new_mobile-form');
            }
        } else {
            $('body').removeClass('new_m-mobile-form new_mobile-form');
        }
        //results
        if ($('.new_r-container').parent().length && $('.new_r-container').parent().width() < 1196) {
            $('body').addClass('new_res-two-col');
            if ($('.new_r-container').parent().width() >= 600) {
                $('body').removeClass('new_res-one-col');
            }
            if ($('.new_r-container').parent().width() < 600) {
                $('body').addClass('new_res-one-col');
            }
            if ($('.new_r-container').parent().width() >= 600 && $('.new_r-container').parent().width() < 814 ||
                $('.new_r-container').parent().width() < 400) {
                $('body').addClass('new_res-price-down');
            } else {
                $('body').removeClass('new_res-price-down');
            }
        } else {
            $('body').removeClass('new_res-one-col new_res-two-col');
            $('body').removeClass('new_res-price-down');
        }
        //tour
        if ($('.new_t-container').parent().length && $('.new_t-container').parent().width() < 700) {
            $('body').addClass('new_tour-one-col');
            if ($('.new_t-container').parent().width() >= 481) {
                $('body').removeClass('new_tour-one-col-sm');
                if ($('.new_t-container').parent().width() >= 601) {
                    $('body').removeClass('new_tour-rat-under-photo');
                }
            }
            if ($('.new_t-header-gallery-mobile').parent().width() < 600) {
                $('body').addClass('new_tour-rat-under-photo');
                if ($('.new_t-container').parent().width() < 480) {
                    $('body').addClass('new_tour-one-col-sm');
                }
            }
        } else {
            $('body').removeClass('new_tour-one-col new_tour-one-col-sm new_tour-rat-under-photo');
        }
    };

    //resize
    $(document).ready(function(){
        resizeFunc();
    });

    if ($('.new_t-menu-wrap').length) {
        $('.new_t-menu-wrap').animate({'scrollLeft': 0}, 1);
    }

    $(window).load(function() {
        resizeFunc();
    });

    $(window).resize(function() {
        resizeFunc();
        durationFunc();
    });
    window.onorientationchange = function() {
        var orientation = window.orientation;
        if (orientation === 0) {
            resizeFunc();
            durationFunc();
        } else if (orientation === 90) {
            resizeFunc();
            durationFunc();
        } else if (orientation === -90) {
            resizeFunc();
            durationFunc();
        }
    }

    //change date/duration table structure (horizontal/vertical)
    var durationFunc = function() {
        if ($('.new_t-container').length) {
            if ($('.new_check-mobile').is(':hidden')) {
                var durWidth = $('.new_t-duration-container').width();
                var durParentWidth = $('.new_t-duration-col').width();
                if (durWidth > durParentWidth - 80) {
                    $('.new_t-tour-tab-table.date-table').addClass('vertical-table');
                }
                $('.new_t-date-table').css('opacity','1');
            }
        }
    };

    // animation for submit btns
    var $btn = $('.new_os .new_f-form-submit, .new_os .new_f-dropdown-btn-apply, .new_t-order-btn');
    $btn.on('click', function(){
		
        $(this).addClass('hvr-ripple-out').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd', function () {
            $(this).removeClass('hvr-ripple-out');
		
        });
		
    });
	
	
	
})(jQuery);

// fix "Object has not attribute keys"
if (!Object.keys) {
    Object.keys = (function() {
        'use strict';
        var hasOwnProperty = Object.prototype.hasOwnProperty,
            hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'),
            dontEnums = [
                'toString',
                'toLocaleString',
                'valueOf',
                'hasOwnProperty',
                'isPrototypeOf',
                'propertyIsEnumerable',
                'constructor'
            ],
            dontEnumsLength = dontEnums.length;

        return function(obj) {
            if (typeof obj !== 'object' && (typeof obj !== 'function' || obj === null)) {
                throw new TypeError('Object.keys called on non-object');
            }

            var result = [], prop, i;

            for (prop in obj) {
                if (hasOwnProperty.call(obj, prop)) {
                    result.push(prop);
                }
            }

            if (hasDontEnumBug) {
                for (i = 0; i < dontEnumsLength; i++) {
                    if (hasOwnProperty.call(obj, dontEnums[i])) {
                        result.push(dontEnums[i]);
                    }
                }
            }
            return result;
        };
    }());
}



/*********************/
/****** 	search.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 30/09/17.
 */

(function($,o){
    var self = this;

    /**
     * Query object
     */
    var query = function(){
        this.f = 0; //from, depends on base country
        this.i = 0; //geo id
        this.c = ''; //check in from
        this.v = ''; //check in to
        this.l = 8; //length
        this.lt = ''; //lengthTo
        this.p = 2; //people 21008 (2+2 child, 10 and 8 age of childs)
        this.tc = []; //to cities, array of city id's
        this.n = 0; //number of query
        this.g = 1; //page
        this.d = 0; //city "deptCity"
        this.o = []; //food
        this.st = []; //stars
        this.pf = 0; //price from
        this.pt = 0; //price to
        this.rt = []; //hotel rating
        this.th = []; //to hotels
        this.e = []; // services
        this.sr = ''; //result sort
        this.r = ''; //transport
        this.w = ''; //first result rendered,
        this.ex = 1; // with excursion
        // this.toString = function(){
        //     return JSON.stringify(this);
        // }
    };

    var f = function(){

        this.callback = {};
        this.query = false;
        this.first = false;

        var self = this,
            firstTime = 3000,
            nextTime = 6000,
            maxQueries = 10,
            request = false,
            timeout = false;

        /**
         * @returns {query}
         */
        this.getQuery = function(){
            return new query();
        };

        /**
         * Get default query param or params
         * @param param - name or list of params
         * @returns {*}
         */
        this.getQueryDefaults = function(param) {
            var defaults = {
                'o': [],
                'r': ['air', 'bus'],
                'st': [],
                'rt': [0,10],
                'e': [],
                'pf': 500,
                'pt': 100000
            };

            if('string' === typeof param && param in defaults) {
                return defaults[param];
            }
            else if(Array.isArray(param)) {
                var selected = {};
                for(var i in defaults) {
                    if(param.indexOf(i) !== -1) {
                        selected[i] = defaults[i];
                    }
                }

                return selected;
            }

            return defaults;
        }

        /**
         * Compare queries and return list of params, which differs from base
         * @param base
         * @param target
         * @param params
         * @returns {*}
         */
        this.compareQueries = function(base, target, params) {

            if('object' !== typeof base || 'object' !== typeof target) {
                console.error('Wrong params passed to compare queries method.');
                return null;
            }

            var diff = [];
            for(var param in target) {
                var notExists = !(param in base);
                var isForce = 'array' === typeof params && params.indexOf(param) !== -1;
                var isDiffers = param in base && JSON.stringify(base[param]) !== JSON.stringify(target[param]);

                if(notExists || isDiffers) {
                    diff.push(param);
                }
            }

            return diff;
        }

        /**
         * Bind the callbacks
         * @param n
         * @param f
         * @returns {f}
         */
        this.bind = function(n,f){
            if(this.callback[n] === undefined){
                this.callback[n] = [];
            }
            this.callback[n].push(f);
            return this;
        };

        /**
         * Run the binding callbacks
         * @param n
         * @param a
         * @param b
         * @param c
         * @returns {boolean}
         */
        var call = function(n,a,b,c){
            if(self.callback[n] && self.callback[n].length){
                for(var i in self.callback[n]){
                    if(typeof self.callback[n][i] === 'function' && self.callback[n].hasOwnProperty(i)){
                        self.callback[n][i](a,b,c);
                    }
                }
                return true;
            }
            return false;
        };

        /**
         * @param query
         * @param c call after every answer
         * @param c1 call after first result
         * @param c2 call after last result
         * @returns {f}
         */
        this.getData = function(query,c,c1,c2){

            var firstResult = false,
                lastResult = false,
                fr = false;

            self.first = true;

            call('getData', query);

            // correct params
            if((typeof(query.rt) === 'object' && query.rt.join(',').indexOf('undefined') > -1) ||
                typeof(query.rt) === 'string' && query.rt === 'undefined') {
                query.rt = '';
            }

            var getData = function(query,c,c1,c2){

                if(timeout){
                    clearTimeout(timeout);
                }
                if(request){
                    request.abort();
                }

                var minDate = new Date(query.c);
                var maxDate = new Date(query.v);

                if((maxDate.valueOf() - minDate.valueOf()) > 1209600000) { // 14 days
                    maxDate = new Date();
                    maxDate.setDate(minDate.getDate()+7);// +7 day

                    query.v = o.fn.formatDate(maxDate);
                    o.hash.add('v', o.fn.formatDate(maxDate), true);
                }

                self.query = query; //store current query

                // New API format

                // force transport for free modules
                if(o.settings.get('osSearchPlan', 'free') === 'free') {
                    query.r = ['air', 'bus'];
                }

                var newQuery = {
                    'from': query.f,
                    'to': query.i,
                    'checkIn': query.c,
                    'checkTo': query.v,
                    'length': query.l,
                    'lengthTo': query.lt,
                    'people': query.p,
                    'food': typeof query.o === 'object'? query.o.join(','): '',
                    'transport': typeof query.r === 'object'? query.r.join(','): '',
                    'stars': typeof query.st === 'object'? query.st.join(','): '',
                    'services': typeof query.e === 'object'? query.e.join(','): '',
                    'rate': typeof query.rt === 'object'? query.rt.join('-'): '',
                    'price': query.pf,
                    'priceTo': query.pt,
                    'number': query.n,
                    'page': query.g,
                    'show': query.w,
                    'returnNow': query.now,
                    'offers': query.ofs,
                    'toCities': query.tc,
                    'toHotels': query.th,
                    'toOperators': query.to,
                    'deptCity': query.d,
                    'offerId': query.oid,
                    'lang': o.lang
                };

                request = $.ajax({
                    url: o.config.searchLink,
                    type: 'GET',
                    dataType: 'jsonp',
                    data: $.extend(newQuery, o.apiToken),
                    success: function(d) {
                        var error = o.fn.checkError(d);
                        var next = function () {
                            // make a next query
                            if (!lastResult && query.n < maxQueries) {
                                timeout = setTimeout(function () {
                                    if (!$.isEmptyObject(d.hotels)) {
                                        query.w = true;
                                    }

                                    getData(query, c, c1, c2);

                                }, (query.n === 0 ? firstTime : nextTime));

                            } else if (query.n >= maxQueries && typeof c2 === 'function') {
                                c2(d);
                            }
                        };

                        if(!error && d){

                            call('process_data', d, query);

                            if(d.lastResult){
                                lastResult = true;
                            }

                            if(!firstResult && typeof c1 === 'function') {
                                firstResult = true;
                                c1(d);
                            }

                            if(typeof c === 'function'){
                                c(d);
                            }

                            if(typeof c2 === 'function' && lastResult){
                                c2(d);
                            }

                            next();
                        }
                        else {
                            switch (error.type) {
                                case 'warning':
                                    next();
                                    break;
                            }
                        }

                        query.n++;
                    }
                });
            };

            getData(query,c,c1,c2);

            return this;
        };

        /**
         * Return query object for hash
         * @param query
         * @returns {{}}
         */
        this.getSearchQueryForHash = function(query){
            var i, m = {};
            for(i in query){
                if((typeof query[i] !== 'function') && query.hasOwnProperty(i)){
                    m[i] = query[i];
                }
            }
            return m;
        };

        /**
         * Set data into hash
         * @param query
         * @returns {f}
         */
        this.setHash = function(query){
            var i;
            for(i in query){
                if((typeof query[i] !== 'function') && query.hasOwnProperty(i)){
                    o.hash.add(i,query[i]);
                }
            }
            o.hash.add('page', 'form');
            o.hash.compile();
            return this;
        };

        /**
         * Callback on hash change
         */
        this.hashChange = function(){
            if(o.hash.get('page') === 'form') {
                this.submit();
            }
        };

        /**
         * Submit the form
         */
        this.submit = function(){
            // scroll to results container
            o.result.view.scrollToResults();

            // hide the tour page
            o.tour.view.$.fadeOut(o.tour.view.$.is(':visible') ? 100 : 0, function(){
                // reset the spinner and results
                o.result.view.reset();
                o.spinner.view.reset();

                // remove markers
                o.map.resetMarkers();

                // set hash data into the form
                self.query = o.form.parse();
                o.search.setHash(self.query);

                // make a search queries
                self.process();
            });
        };

        /**
         * Submit process
         */
        this.process = function(){

            // store search query to history
            o.search.history.set('i', this.query.i);
            o.search.history.set('c', this.query.c);
            o.search.history.set('v', this.query.v);
            o.search.history.set('d', this.query.d);
            o.search.history.set('l', this.query.l);
            o.search.history.set('p', this.query.p);

            // dispatch event
            o.dispatcher.dispatch('search.start', {query: this.query});

            // mark as date of start search for info in console (see result.view -> search.bind)
            o.result.view.start_search = new Date();

            // make search if (country|city|hotel) is selected
            if(this.query.i) {

                call('process', this.query);

                o.spinner.view.refresh({});

                self.getData(self.query,
                    function(e){ // call on every response

                        call('response', e);

                        if(!$.isEmptyObject(e.hotels)) {

                            o.result.resultSet(function(hotels, last_page){

                                o.result.view.refresh(hotels, last_page); // update results

                            }, e.hotels);

                            call('process_set', e);
                        }

                        // update the spinner
                        o.spinner.view.refresh(e.progress);
                    },
                    function(e){ // call on first response

                        // update the current country
                        if(e.cnt) {
                            o.form.location.updateCurrentGeo(e.cnt);
                        }
                    },
                    function(e){ // call on last response

                        // reset the spinner
                        o.spinner.view.reset();

                        // show message if no results
                        var firstPage = !('g' in self.query && +self.query.g !== 1);
                        var resultsPage = !('oid' in self.query && +self.query.oid);
                        var someHotelsRendered = !!o.result.hotelIds.length;
                        var emptyResult = !e.total;

                        if(emptyResult && resultsPage && firstPage) {
                            o.result.view.$.addClass(o.fn.prefix('show-message'));
                            if(someHotelsRendered) {
                                o.result.view.showMessage(o._('Мы устали ждать некоторых туроператоров, и отображаем цены тех кто успел. Повторите поиск через время чтобы увидеть все цены...'), false);
                            }
                            else {
                                o.result.view.showMessage();
                            }

                        }

                        call('process_last', e);
                    }
                );
            }
        };
    };

    o.search = new f();

    // trigger on load the page
    // o.hash.addTrigger(function(){
    //     otpMain.search.hashChange();
    // }, 50, 'form');

})(jQuery,otpMain);


/**
* Global events dispatcher
*/
(function ($, o) {
    var f = function() {};

    f.prototype.dispatch = function(name, data) {
        var event = new window.CustomEvent('os.' + name, {detail: data});
        document.dispatchEvent(event);
    };

    o.dispatcher = new f();

})(jQuery, otpMain);


/*
* History store based on document.cookies
*/
(function ($, o) {

    var f = function () {
        this.store = this.read();
    };

    /**
     * Get value from store
     *
     * @param key
     * @param optional
     *
     * @return value
     */
    f.prototype.get = function (key, optional) {
        if(key in this.store) {
            return this.store[key];
        }
        else {
            return 'undefined' !== typeof optional ? optional : null;
        }
    };

    /**
     * Save value to store
     *
     * @param key
     * @param value
     *
     * @return this
     */
    f.prototype.set = function (key, value) {
        this.store[key] = value;
        this.write();

        return this;
    };

    f.prototype.read = function() {
        var cookies = $.cookie('os-search');

        return cookies ? JSON.parse(cookies) : {};
    };

    /**
     * Save store to cookies
     */
    f.prototype.write = function() {
        $.cookie('os-search', JSON.stringify(this.store), { expires: 7, path: '/' });
    };

    o.search.history = new f();

})(jQuery, otpMain);



/*********************/
/****** 	form/otpautocomplete.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 30/09/17.
 */

(function($,o){
    // li labels
    var names = {
        city: o._('Курорты'),
        country: o._('Страны'),
        hotel: o._('Отели')
    };

    // init the widget
    $.widget( "ui.otpautocomplete", $.ui.autocomplete, {
        _suggest: function( items ) {

            var ul = this.menu.element
                .empty()
                .zIndex( this.element.zIndex() + 1 );

            this._renderMenu( ul, items );
            this.menu.refresh();

            // size and position menu
            ul.show();
            this._resizeMenu();

            //scroll default list to top
            if(o.form.location.selectType === 3) {
                $('.ui-autocomplete').scrollTop(0);
            }
            ul.position( $.extend({
                of: this.element
            }, this.options.position ));
        },
        _renderMenu: function( ul, items ) {
            var that = this;
            var type = null;
            var i = 1;

            // #14342 / 3
            if($(ul).parent().attr('id') === 'cntList') {
                $(ul).parent().find('svg').remove();
            }

            // append li labels and render each item
            $.each( items, function( index, item ) {

                if(type !== item.type && item.type){
                    $( '<li>' )
                        .addClass('type-item')
                        .text(names[item.type])
                        .appendTo( ul );

                } else if(item.cnt && !item.type && !index) {
                    $( '<li>' )
                        .addClass('type-item')
                        .text(names['city'])
                        .appendTo( ul );
                }

                type = item.type;

                // render item
                that._renderItemData( ul, item );
            });
        },
        _renderItem: function(ul, item) {

            // show the info if do not found any geo
            if(item.is_empty) {
                return $('<li></li>')
                    .addClass('ui-menu-item')
                    .addClass(o.fn.prefix('suggest-no-results'))
                    .append(
                        $('<span></span>').addClass('noplace').text(item.label)
                    )
                    .appendTo( ul );
            }

            // render price info
            var $s = $('<span>')
                .addClass('price-from')
                .text(o._('нет туров'));

            if(item.price > 0){
                $s.html(' '+ o._('от') +' '+ o.fn.priceEcho(item.uah, 'uah', true, false))
            }

            var $item = $('<li>')
                .attr('data-type', item.type)
                .append(
                    $('<a>')
                        .append($s)
                        .append(
                            $('<span>')
                                .addClass('label')
                                .html(+item.bold && item.type === 'country' ? '<b>'+ item.name +'</b>': item.name)

                        ).append(
                            $('<div>')
                                .addClass('clear')
                        )
                ).on('click', function(){

                    $('.new_f-form-field.to .new_f-dropdown-body').addClass('preventBounceHack');

                    setTimeout(function() {
                        $('.new_f-form-field.to .new_f-dropdown-body').removeClass('preventBounceHack');
                    }, 100);

                    // toggle active style
                    if($(this).attr('data-type') === 'country') {

                        if ($('.new_check-mobile').is(':visible')) {
                            $('.new_f-form .listsWrap').animate({
                                left: -$('html').width()
                            }, 301);
                            $('body').addClass('resort-visible');
                        }

                        $(this).parent().find('li').removeClass('active');
                        $(this).addClass('active');

                    } else {
                        o.form.location.view.$.trigger('close'); // close dropdown if not country selected
                    }

                    setTimeout(function() {
                        $('#location').blur();
                    }, 100);
                });

            // #13822
            if(item.type === 'country' && +item.id === +o.form.location.currentCountry.id) {
                $item.addClass('active');
            }

            // Catch drag and click on locations list
            $(ul).data("drag", false);
            $item.bind({
                "mousedown": $.proxy(function (ul, e) { $(ul).data("drag", false); }, this, ul),
                "mousemove": $.proxy(function (ul, e) { $(ul).data("drag", true); }, this, ul),
                "mouseup":   $.proxy(function (ul, item, e) {
                    if ($(ul).data("drag")) {
                        item.trigger("click");
                        $(ul).data("drag", false)
                    }
                }, this, ul, $item)
            });

            return $item.appendTo( ul );
        }
    })

})(jQuery,otpMain);

/*********************/
/****** 	form/form.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 01/10/17.
 */

(function($,o){

    var f = function(){

        var input = {};
        var callback = {};
        var self = this;
        
        /**
         * Set input values
         * @param n
         * @param $o
         * @param f
         */
        this.setInput = function(n, $o, f){
            input[n] = $o;
            callback[n] = f;
        };

        /**
         * Parse each field of the form
         * @returns {query}
         */
        this.parse = function(){
            var query = o.search.getQuery();
            var baseQuery = o.search.getQuery();
            var presets = o.settings.get('osQueryPreset', {});

            for(var i in input){
                if(input.hasOwnProperty(i)) {

                    if(callback[i] && typeof callback[i] === 'function'){
                        callback[i](input[i], query);
                    } else {
                        query[i] = input[i].val();
                    }

                    var isDefault = JSON.stringify(baseQuery[i]) === JSON.stringify(query[i]);
                    var hasPreset = i in presets;
                    if(isDefault && hasPreset) {
                        query[i] = presets[i];
                    }
                }
            }

            return query;
        };

        /**
         * Bind the callbacks
         * @param n
         * @param f
         * @returns {f}
         */
        this.bind = function(n,f){
            if(callback[n] === undefined){
                callback[n] = [];
            }
            callback[n].push(f);
            return this;
        };

        /**
         * Run the binding callbacks
         * @param n
         * @param a
         * @param b
         * @param c
         * @returns {boolean}
         */
        this.call = function(n,a,b,c){
            if(callback[n] && callback[n].length){
                for(var i in callback[n]){
                    if(typeof callback[n][i] === 'function' && callback[n].hasOwnProperty(i)){
                        callback[n][i](a,b,c);
                    }
                }
                return true;
            }
            return false;
        };
    };

    o.form = new f();

})(jQuery,otpMain);


/*********************/
/****** 	form/fromCity.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($,o){

    o.form.fromCity = new function(){

        var self = this;
        var cities = [];

        /**
         * Get cities list
         * @returns {{}}
         */
        this.get = function() {
            return cities;
        };

        /**
         * Set cities list
         * @param data
         */
        this.set = function(data) {
            cities = data;
        };

        /**
         * Load cities from cache
         * @param geoId
         * @param f
         */
        this.getCities = function(geoId, f){

            // load dept cities
            var load = function(geoId, f2){
                $.ajax({
                    url: o.config.deptCitiesLink,
                    type: 'GET',
                    dataType: 'jsonp',
                    data:  $.extend({
                        'lang': o.lang,
                        'geoId': +geoId
                    }, o.apiToken),
                    success: function (resp) {
                        f2(resp.deptCities);
                    }
                });
            };

            // get dept cities from storage (only for default geoId == 0)
            //cities = !+geoId? o.storage.get(o.fn.prefix('cities-'+ o.lang), '[]', 'local', 0, 1): [];
            cities = []; // #13054

            if($.isEmptyObject(cities) || !cities.length) {
                load(geoId, function(cities){

                    if(!+geoId) o.storage.set(o.fn.prefix('cities-'+ o.lang), cities); // cache only for default geoId == 0
                    self.set(cities);
                    f(cities);

                });
            } else {
                self.set(cities);
                f(cities);
            }
        };

        /**
         * Refresh from cities
         * @param item
         */
        this.updateCities = function(item, selectPriorityCities) {

            self.getCities(item.id, function(cities){

                if($.isEmptyObject(cities) && item.id !== 0) {
                    self.updateCities({'id': 0}, selectPriorityCities);
                } else {
                    o.form.fromCity.view.refresh(cities);
                    if(selectPriorityCities && !o.hash.get('d', null) && !o.search.history.get('d', null)) {
                        o.form.fromCity.view.selectPriorityCity();
                    }
                }
            });
        };
    };

    // trigger on load the page
    o.hash.addTrigger(function(){
        o.form.fromCity.view.setValue(o.hash.get('d', new String('')));
    }, 40);

})(jQuery,otpMain);

/*********************/
/****** 	form/city.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 30/09/17.
 */

(function($,o){

    var f = function(){

        var self = this;
        this.store = {
            'yes': {},
            'no': {}
        };
        this.callback = {};

        /**
         * Bind the callbacks
         * @param n
         * @param f
         * @returns {f}
         */
        this.bind = function(n,f){
            if(this.callback[n] === undefined){
                this.callback[n] = [];
            }
            this.callback[n].push(f);
            return this;
        };

        /**
         * Run the binding callbacks
         * @param n
         * @param a
         * @param b
         * @param c
         * @returns {boolean}
         */
        this.call = function(n,a,b,c){
            if(self.callback[n] && self.callback[n].length){
                for(var i in self.callback[n]){
                    if(typeof self.callback[n][i] === 'function' && self.callback[n].hasOwnProperty(i)){
                        self.callback[n][i](a,b,c);
                    }
                }
                return true;
            }
            return false;
        };

        /**
         * Load cities by country
         * @param countryId
         * @param with_price
         * @param f
         */
        this.loadCities = function(f, countryId, with_price) {

            with_price = with_price? 'yes':'no';

            if(countryId && typeof self.store[with_price][countryId] !== 'undefined') {
                f(self.store[with_price][countryId]);
                return this;
            }

            var params = {
                'countryId': countryId,
                'lang': o.lang
            };
            if(with_price === 'yes') params['with'] = 'price';

            $.ajax({
                url: o.config.citiesLink,
                type: 'GET',
                dataType: 'jsonp',
                data:  $.extend(params, o.apiToken),
                success: function(d) {
                    o.fn.checkError(d);

                    if(countryId) {
                        self.store[with_price][countryId] = d.cities;
                    }

                    f(d.cities);
                }
            });
        };

        return this;
    };

    o.form.city = new f();

    // trigger on load the page
    o.hash.addTrigger(function(){
        var value = o.hash.get('tc', '')
            .toString()
            .split(',')
            .map(Number)
            .filter(Boolean);

        o.form.city.view.setValue(value);
    }, 40);

})(jQuery,otpMain);



/*********************/
/****** 	form/regions.js	 ***********/
/*********************/
/**
 * Created by vshevtsov on 27.10.16.
 */

(function($, o){

    o.form.regions = new function() {

        var self = this;

        /**
         * Load regions
         * @param f
         */
        this.loadData = function(f){

            // load regions
            var load = function(f2){
                $.ajax({
                    url: o.config.regionsLink,
                    type: 'GET',
                    dataType: 'jsonp',
                    data: $.extend({'lang': o.lang}, o.apiToken),
                    success: function (resp) {
                        f2(resp.regions);
                    }
                });
            };

            // get regions from storage
            var regions = o.storage.get(o.fn.prefix('regions-'+ o.lang), '[]');

            if($.isEmptyObject(regions) || !regions.length || typeof regions === 'string') {
                load(function(regions){

                    o.storage.set(o.fn.prefix('regions-'+ o.lang), regions);

                    f(regions);

                });
            } else {
                f(regions);
            }
        }
    };

})(jQuery, otpMain);

/*********************/
/****** 	form/hotelsearch.js	 ***********/
/*********************/
/**
 * Created by vshevtsov on 10.11.16.
 */

(function($, o){

    var f = function(){

        var self = this;
        var store = {};
        this.autocompleteType = 'autocomplete';
        this.callback = {};
        this.selectedSuggest = {};
        this.selectType = 1;
        this.geo_list = [];

        this.bind = function(n,f){
            if(this.callback[n] == undefined){
                this.callback[n] = [];
            }
            this.callback[n].push(f);
            return this;
        };

        var call = function(n,a,b,c){
            if(self.callback[n] && self.callback[n].length){
                for(var i in self.callback[n]){
                    if(typeof self.callback[n][i] == 'function' && self.callback[n].hasOwnProperty(i)){
                        self.callback[n][i](a,b,c);
                    }
                }
                return true;
            }
            return false;
        };

        /**
         * Save results to store
         * @param k
         * @param v
         */
        this.setStore = function(k,v) {
            store[k] = v;
        };

        /**
         * Get results from store
         * @param k
         * @returns {boolean}
         */
        this.getStore = function(k) {
            return store[k]? store[k]: false;
        };

        /**
         * Make search
         * @param search
         * @param f
         */
        this.geoSuggest = function(search, f) {

            search = JSON.parse(search);
            search.lang = o.lang;
            search.text = search.t;
            search['filter'] = o.form.location.currentCountry.id;
            search['type'] = 'hotel';

            $.ajax({
                url: o.config.suggestLink,
                type: 'GET',
                dataType: 'jsonp',
                data:  $.extend(search, o.apiToken),
                success: function(d) {
                    o.fn.checkError(d);

                    if($.isEmptyObject(d.response) && search.text) {
                        d.data = [{label: 'Отель «'+ $.trim(search.text) +'»'+ (o.form.location.currentCountry.namePr? 'в '+ o.form.location.currentCountry.namePr :'') +' не найден', value: search.text, is_empty: true}];
                    }

                    if(d && d.response){
                        if(!$.isEmptyObject(d.response)){
                            if(!search.text) search.text = '--';
                            store[search.text] = d.response;
                        }
                    }
                    f(d);
                },
                error: function(d){
                    f(d);
                }
            });
        };

        /**
         * Init autocomplete for search hotel field
         * @param opt
         */
        this.init = function(opt){
            opt = opt || {};
            opt.autoFocus = opt.autoFocus || true;
            opt.appendTo = opt.appendTo || false;

            this.object = this.view.$[this.autocompleteType]({
                autoFocus: opt.autoFocus,
                appendTo: opt.appendTo,

                source: function(request, response) {
                    store = {}; // not cache

                    self.request = request;

                    var key;
                    if($.trim(request.term).length === 0){
                        key = '{empty_key}';
                        self.selectType = 2;
                    }else{
                        key = request.term;
                        if(key=='--') {
                            self.selectType = 3;
                        } else {
                            self.selectType = 1;
                        }
                    }

                    if(store[key] !== undefined){
                        if(!call('source', store[key], response)){
                            response(store[key]);
                        }
                        return;
                    }

                    var search = JSON.stringify({t:request.term});

                    if(key == '--') {
                        search = '{}';
                    }

                    self.geoSuggest(search, function(d){
                        if(d && d.data) {
                            if(!call('source', store[key], response)){
                                response(store[key]);
                            }
                        }
                    });
                },
                select: function(h,v){
                    self.selectedSuggest = v.item;
                    call('select',h,v);
                },
                response: function(event,ui) {

                    if(self.selectedSuggest.value!==self.object.val()
                        && self.selectedSuggest.label!==self.object.val()) {
                        self.selectedSuggest = {};
                    }

                    call('response', event, ui);
                },
                open: function(){
                    o.form.hotelsearch.view.is_open = true;
                    call('open');
                },
                close: function(h){

                    if(!self.selectedSuggest.value) {
                        var rq = self.request.term;
                        var rs = store[rq];

                        store = {}; // not cache

                        if(rs && rs[0]) {
                            var val = rs[0].value;

                            if(rs && rs[0] && /*val != rq &&*/ rq != '--') {
                                self.request.term = rq;
                                var s = JSON.stringify({t:val});

                                $.each(o.form.hotelsearch.geo_list, function(k,v){
                                    if(v.label === val || v.value === val) {
                                        s = false;
                                        return false;
                                    }
                                });

                                if(s) {
                                    self.geoSuggest(s, function(d){
                                        if(d.data) {
                                            $.each(d.data, function(i, item){

                                                self.selectedSuggest = item;

                                                call('select', h, {'item': item});
                                                return false;
                                            });
                                        }
                                    });

                                    $(this).val(val);
                                }
                            }
                        }
                    }

                    call('close');

                    setTimeout(function() {
                        o.form.hotelsearch.view.is_open = false;
                    }, 300);
                },
                minLength: 2,
                delay: 500
            });
        }

        /**
         * Load hotels by country, city or hotel ids
         * @param countryId
         * @param cityId
         * @param hotelId
         * @param with_price
         * @param f
         */
        this.loadHotels = function(f, countryId, cityId, hotelId, with_price) {

            if(!countryId && !cityId && !hotelId) {
                f({});
                return this;
            }

            var params = {};
            if(!isNaN(countryId)) params['countryId'] = countryId;
            if(cityId) params['cityId'] = cityId;
            if(hotelId) params['hotelId'] = hotelId;
            if(with_price === 'yes') params['with'] = 'price';

            $.ajax({
                url: o.config.hotelsLink,
                type: 'GET',
                dataType: 'jsonp',
                data:  $.extend(params, o.apiToken),
                success: function(d) {
                    o.fn.checkError(d);

                    f(d.hotels);
                }
            });
        };

        return this;
    };

    o.form.hotelsearch = new f();

})(jQuery, otpMain);

/*********************/
/****** 	form/tourDuration.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */
(function($, o){

    o.form.duration = {};

    // trigger on load the page
    o.hash.addTrigger(function(){
        o.form.duration.view.setValue(o.hash.get('l',7));
    },40, null, null, 'duration');

})(jQuery, otpMain);

/*********************/
/****** 	form/hotelCategory.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */
(function($, o){

    var f = function() {
        this.callback = {};

        /**
         * Bind the callbacks
         * @param n
         * @param f
         * @returns {f}
         */
        this.bind = function(n,f){
            if(this.callback[n] === undefined){
                this.callback[n] = [];
            }
            this.callback[n].push(f);
            return this;
        };

        /**
         * Run the binding callbacks
         * @param n
         * @param a
         * @param b
         * @param c
         * @returns {boolean}
         */
        this.call = function(n,a,b,c){
            if(this.callback[n] && this.callback[n].length){
                for(var i in this.callback[n]){
                    if(typeof this.callback[n][i] === 'function' && this.callback[n].hasOwnProperty(i)){
                        this.callback[n][i](a,b,c);
                    }
                }
                return true;
            }
            return false;
        };
    };

    o.form.category = new f();

    // trigger on load the page
    o.hash.addTrigger(function(){
        o.form.category.view.setValue(o.hash.get('st', '').split(','));
    }, 40, null, ['full']);

})(jQuery, otpMain);


/*********************/
/****** 	form/food.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17
 */

(function($,o){

    o.form.food = {};

    // trigger on load the page
    o.hash.addTrigger(function(){
        o.form.food.view.setValue(o.hash.get('o','').split(','));
    }, 40, null, ['full']);

})(jQuery, otpMain);

/*********************/
/****** 	form/transport.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($, o){

    o.form.transport = {};

    // trigger on load the page
    o.hash.addTrigger(function(){
        o.form.transport.view.setValue(o.hash.get('r','air').split(','));
    }, 40, null, ['full']);

})(jQuery, otpMain);

/*********************/
/****** 	form/service.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($, o){

    o.form.service = new function(){

        var self = this;

        /**
         * Load services from cache #10360
         * @param countryId
         * @param f
         */
        this.getServices = function(countryId, f){

            // default services for unknown country
            if(!+countryId || +countryId > 500) {
                f(o.config.service);
                return false;
            }

            // load services
            var load = function(countryId, f2){
                $.ajax({
                    url: o.config.servicesLink,
                    type: 'GET',
                    dataType: 'jsonp',
                    data:  $.extend({
                        'lang': o.lang,
                        'countryId': +countryId
                    }, o.apiToken),
                    success: function (resp) {
                        f2(resp);
                    }
                });
            };

            var services = o.storage.get(o.fn.prefix('services-'+ o.lang), '{}');

            if(!services || !services[countryId]) {

                load(countryId, function(services){
                    o.storage.append(o.fn.prefix('services-'+ o.lang), countryId, services);
                    f(services);
                });

            } else {
                f(services[countryId]);
            }
        }
    };

    // trigger on load the page
    o.hash.addTrigger(function(){
        var value = o.hash.get('e', null);
        o.form.service.view.setValue(value ? value.split(',') : []);
    }, 40, null, ['full']);

})(jQuery, otpMain);

/*********************/
/****** 	form/hotelRating.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($,o){

    o.form.hotelRating = {};

    // trigger on load the page
    o.hash.addTrigger(function(){
        o.form.hotelRating.view.setValue(o.hash.get('rt',new String('')).split(','));
    }, 40, null, ['full']);

})(jQuery, otpMain);

/*********************/
/****** 	form/datepicker.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($,o){

    o.form.datepicker = new function(){

        this.mounth = [o._('января'),o._('февраля'),o._('марта'),o._('апреля'),o._('мая'),o._('июня'),o._('июля'),o._('августа'),o._('сентября'),o._('октября'),o._('ноября'),o._('декабря')];
        this.mounth_short = [o._('янв'),o._('фев'),o._('мар'),o._('апр'),o._('мая'),o._('июн'),o._('июл'),o._('авг'),o._('сен'),o._('окт'),o._('ноя'),o._('дек')];
        this.day = [o._('Вс'),'Пн','Вт','Ср','Чт','Пт','Сб'];

        var self = this;
        var data = {},
            dates = [];

        /**
         * Set values
         * @param d
         */
        this.setDates = function(d){

            if(!$.isEmptyObject(d.dates)) {
                data = d.dates;
                dates = Object.keys(d.dates);
                dates.sort(function(d1, d2){
                    if(self.parseISO8601(d1).getTime() > self.parseISO8601(d2).getTime())
                        return 1;
                    return -1;
                });

            } else {
                this.defaultDates();
            }
        };

        /**
         * Get values
         * @returns {Array}
         */
        this.getDates = function(){
            return dates;
        };

        /**
         * Return a default dates
         */
        this.defaultDates = function() {
            var now = new Date();
            var dateFrom = new Date(now.getTime()); // today
            var dateTo = new Date(now.getTime()+31536000000); // +365 days

            dates = [
                dateFrom.getFullYear() +'-'+ ("0" + (dateFrom.getMonth() + 1)).slice(-2) +'-'+ dateFrom.getDate(),
                dateTo.getFullYear() +'-'+ ("0" + (dateTo.getMonth() + 1)).slice(-2) +'-'+ dateTo.getDate()
            ];
        };

        /**
         * Get all durations from selected dates diff
         * @param dateFrom
         * @param dateTo
         * @returns {Array}
         */
        this.getDurationNew = function(dateFrom, dateTo) {

            var dates = Object.keys(data);

            dateFrom = dateFrom || new Date(dates[0]);
            dateTo = dateTo || new Date(dates[dates.length-1]);

            var durations = [];
            var diffDays = Math.round((dateTo.getTime() - dateFrom.getTime()) / (1000*60*60*24));

            if(diffDays > -1) {
                durations = data[o.fn.formatDate(dateFrom)] || [];

                durations = typeof durations === 'string'? durations.split(','): durations;

                $.each(o.fn.range(0, diffDays), function(i){
                    durations = durations.concat(data[o.fn.formatDate(
                        new Date(dateFrom.getTime() +  ((i+1) * 86400000)) // ++ 1 day
                    )]).filter(function(v,i,self){
                        return self.indexOf(v) === i;
                    });
                });
            }

            return durations;
        };

        /**Parses string formatted as YYYY-MM-DD to a Date object.
         * If the supplied string does not match the format, an
         * invalid Date (value NaN) is returned.
         * @param {string} dateStringInRange format YYYY-MM-DD, with year in
         * range of 0000-9999, inclusive.
         * @return {Date} Date object representing the string.
         */
        this.parseISO8601 = function(dateStringInRange) {
            var isoExp = /^\s*(\d{4})-(\d\d)-(\d\d)\s*$/,
                date = new Date(NaN), month,
                parts = isoExp.exec(dateStringInRange);

            if(parts) {
                month = +parts[2];
                date.setFullYear(parts[1], month - 1, parts[3]);
                if(month !== date.getMonth() + 1) {
                    date.setTime(NaN);
                }
            }
            return date;
        };

        /**
         * Return date in custom format
         * @param date
         * @param format
         * @param separator
         * @returns {string|*}
         */
        this.getTextDate = function (date, format, separator) {

            if (typeof date === 'string') {
                date = self.parseISO8601(date);
            }

            var dateArr = [],
                str;
            for (var i = 0; i < format.parts.length; i++) {
                switch (format.parts[i]) {
                    case 'D':
                        dateArr[i] = self.day[date.getDay()];
                        break;
                    case 'd':
                        dateArr[i] = date.getDate();
                        break;
                    case 'm':
                        dateArr[i] = self.mounth_short[date.getMonth()];
                        break;
                    case 'M':
                        dateArr[i] = self.mounth[date.getMonth()];
                        break;
                    case 'dd':
                        dateArr[i] = (date.getDate() < 10 ? '0' : '') + date.getDate();
                        break;
                    case 'mm':
                        dateArr[i] = (date.getMonth() + 1 < 10 ? '0' : '') + (date.getMonth() + 1);
                        break;
                    case 'hh':
                        dateArr[i] = (date.getHours() + 1 < 10 ? '0' : '') + (date.getHours() + 1);
                        break;
                    case 'yyyy':
                        dateArr[i] = date.getFullYear();
                        break;
                }
            }
            str = dateArr.join(separator);

            return str;
        };

        /**
         * Refresh dates by selected location
         * @param item
         * @param f
         */
        this.updateDates = function(item, f) {
            if(!item.id || !item.type) {
                var dates = o.form.datepicker.getDates();
                if(typeof f === 'function') {
                    f({}, dates);
                }
                return;
            }

            $.ajax({
                url: o.config.datesLink,
                type: 'GET',
                dataType: 'jsonp',
                data:  $.extend({
                    'to': item.id
                }, o.apiToken),
                success: function(d) {

                    o.fn.checkError(d);

                    o.form.datepicker.setDates(d);
                    
                    if(typeof f === 'function') {
                        f(d, dates);
                    }
                }
            });
        };
    };

    o.form.datepicker.defaultDates();

    // trigger on load page
    o.hash.addTrigger(function(){
        o.form.datepicker.view.setValue([o.hash.get('c'), o.hash.get('v')]);
    }, 40, null, null, 'datepicker');

})(jQuery, otpMain);


/*********************/
/****** 	form/price.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */
(function($, o){

    o.form.price = {};

    // trigger on load the page
    o.hash.addTrigger(function(){
        o.form.price.view.setValue([o.hash.get('pf',''), o.hash.get('pt','')]);
    }, 40, null, ['full']);

})(jQuery, otpMain);

/*********************/
/****** 	form/people.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($, o){

    var f = function(){

    };

    o.form.people = new f;

    // trigger on load the page
    o.hash.addTrigger(function(){
        o.form.people.view.setValue(o.hash.get('p', o.hash.get('people',2)));
    }, 40);

})(jQuery, otpMain);


/*********************/
/****** 	form/location.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($,o){

    var f = function(){

        var self = this;
        var store = {};
        this.selectType = 1;
        this.request = '';
        this.response = {};
        this.autocompleteType = 'autocomplete';
        this.object = false;
        this.callback = {};
        this.selectedSuggest = {};
        this.geo_list = [];
        this.current_geo = undefined;

        this.currentCountry = {};
        this.currentCity = {};
        this.currentHotel = {};

        /**
         * Bind the callbacks
         * @param n
         * @param f
         * @returns {f}
         */
        this.bind = function(n,f){
            if(this.callback[n] === undefined){
                this.callback[n] = [];
            }
            this.callback[n].push(f);
            return this;
        };

        /**
         * Run the binding callbacks
         * @param n
         * @param a
         * @param b
         * @param c
         * @returns {boolean}
         */
        var call = function(n,a,b,c){
            if(self.callback[n] && self.callback[n].length){
                for(var i in self.callback[n]){
                    if(typeof self.callback[n][i] === 'function' && self.callback[n].hasOwnProperty(i)){
                        self.callback[n][i](a,b,c);
                    }
                }
                return true;
            }
            return false;
        };

        /**
         * Proxy for local function
         */
        this.call = function(n,a,b,c){
            call(n,a,b,c);
        };

        /**
         * Set local store
         * @param k
         * @param v
         */
        this.setStore = function(k,v) {
            store[k] = v;
        };

        /**
         * Get local store
         * @param k
         * @returns {boolean}
         */
        this.getStore = function(k) {
            return store[k]? store[k]: false;
        };

        /**
         * Get suggested geo
         * @param search
         * @param f
         */
        this.geoSuggest = function(search, f) {

            search['lang'] = o.lang;
            search['with'] = 'price';

            $.ajax({
                url: o.config.suggestLink,
                type: 'GET',
                dataType: 'jsonp',
                data:  $.extend(search, o.apiToken),
                success: function(d) {
                    o.fn.checkError(d);

                    if($.isEmptyObject(d.response)) {
                        d.response = [{label: o._('Нам неизвестно о турах в ')+ '«'+ search.text +'»', value: search.text, is_empty: true}];
                    }

                    if(d && d.response){
                        if(!$.isEmptyObject(d.response)){
                            if(!search.text) search.text = '--';
                            store[search.text] = d.response;
                        }
                    }
                    f(d);
                },
                error: function(d){
                    f(d);
                }
            });
        };

        /**
         * Init the autocomplete
         * @param opt
         */
        this.init = function(opt){
            opt = opt || {};
            opt.autoFocus = opt.autoFocus || true;
            opt.appendTo = opt.appendTo || false;

            this.object = this.view.$[this.autocompleteType]({
                autoFocus: opt.autoFocus,
                appendTo: opt.appendTo,

                source: function(request, response) {

                    self.request = request;
                    var key;
                    if($.trim(request.term).length === 0){
                        key = '{empty_key}';
                        self.selectType = 2;
                    } else {
                        key = request.term;
                        if(key === '--') {
                            self.selectType = 3;
                        } else {
                            self.selectType = 1;
                        }
                    }

                    if(store[key] !== undefined){
                        if(!call('source', store[key], response)){
                            response(store[key]);
                        }
                        return;
                    }

                    var search = {text:request.term};

                    if(key === '--') {
                        search = {};
                    }

                    self.geoSuggest(search, function(d){
                        if(d && d.response) {
                            if(!call('source', store[key], response)){
                                response(store[key]);
                            }
                        }
                    });
                },
                select: function(h,v){
                    self.selectedSuggest = v.item;
                    call('select',h,v);
                },
                response: function(event,ui) {

                    // if(self.selectedSuggest.value !== self.object.val()
                    //     && self.selectedSuggest.label !== self.object.val()) {
                    //     self.selectedSuggest = {};
                    // }

                    call('response',event,ui);
                },
                open: function(){
                    //o.form.location.view.is_open = true;
                    call('open');
                },
                close: function(h){

                    if(!self.selectedSuggest.name ||
                        (self.selectedSuggest.name && o.form.location.view.$.val() && self.selectedSuggest.name.indexOf(o.form.location.view.$.val()) === -1)) {
                        var rq = self.request.term;
                        var rs = store[rq];

                        if(rs && rs[0]) {
                            var val = rs[0].value;

                            if(rs && rs[0] && /*val != rq &&*/ rq !== '--') {
                                self.request.term = rq;

                                if(val) {
                                    self.geoSuggest({text: val}, function(d){
                                        if(d.response) {
                                            self.selectedSuggest = d.response[0];

                                            o.form.datepicker.updateDates(d.response[0]);
                                            o.form.fromCity.updateCities(d.response[0], true);

                                            call('select', h, {'item':d.response[0]});
                                        }
                                    });

                                    $(this).val(val);
                                }
                            }
                        }
                    }

                    call('close');
                },
                minLength: 1,
                delay: 500
            });

            //o.settings.get('osGeo') = 'Тунис';
            if(o.settings.get('osGeo')) {

                self.geoSuggest({text:o.settings.get('osGeo')}, function(d){

                    if(d.response) {
                        self.selectedSuggest = d.response[0];

                        o.form.datepicker.updateDates(d.response[0]);
                        o.form.fromCity.updateCities(d.response[0], true);

                        call('select', null, {'item':d.response[0]});
                    }
                });

                this.object.val(o.settings.get('osGeo'));
            }
            /* Check search history for initial value */
            else if(!o.hash.get('i')) {
                var historyGeoId = +o.search.history.get("i", null);
                if(historyGeoId) {
                    this.selectLocationByGeoId(historyGeoId);
                }
            }
        };

        /**
         * Update current country and city
         */
        this.updateCurrentGeo = function(item, cty){

            // country
            if(isNaN(+item.id) || +item.id < 500) {
                self.currentCountry = {
                    'id': +item.id,
                    'name': item.name,
                    'namePr': item.namePr,
                    'nameVn': item.nameVn,
                    'nameDt': item.nameDt
                }
            } else {
                self.currentCountry = {
                    'id': item.countryId,
                    'name': item.countryName,
                    'namePr': item.countryNamePr,
                    'nameVn': item.countryNameVn,
                    'nameDt': item.countryNameDt
                }
            }

            // city
            if(item.type === 'city') {
                self.currentCity = {
                    'id': item.id,
                    'name': item.value,
                    'namePr': item.namePr,
                    'nameVn': item.nameVn
                }
            } else if(item.type === 'hotel') {
                self.currentCity = {
                    'id': item.cityId,
                    'name': item.cityName,
                    'namePr': item.cityNamePr,
                    'nameVn': item.cityNameVn
                }
            } else if(cty) {
                self.currentCity = {
                    'id': cty.id,
                    'name': cty.name,
                    'namePr': cty.namePr,
                    'nameVn': cty.nameVn
                }
            } else {
                self.currentCity = {};
            }
        }

        /**
         * Load location form value by geoId
         *
         * @param geoId
         */
        this.selectLocationByGeoId = function (geoId) {
            if(geoId && !isNaN(geoId)) {
                var alreadySelected = o.form.location.selectedSuggest && Number(o.form.location.selectedSuggest.id) === Number(geoId);
                var updatedButNotLoaded = o.form.location.current_geo !== geoId && !alreadySelected;

                if(updatedButNotLoaded) {
                    o.form.location.selectedSuggest.id = geoId.toString();

                    o.form.location.geoSuggest({text: geoId}, function (d) {

                        $.each(d.response, function (i, item) {
                            if (+item.id === geoId) {

                                // trigger autocomplete select
                                item.first = true; // mark as first loaded
                                o.form.location.selectedSuggest = item;
                                o.form.location.view.$.val(item.value);
                                o.form.location.call('select', null, {'item': item});
                                return false;
                            }
                        });
                    });

                    o.form.location.current_geo = geoId;
                }
            }
        }
    };

    o.form.location = new f;

    // trigger on load the page
    o.hash.addTrigger(function(){

        var geoId = +o.hash.get('i', 0);
        o.form.location.selectLocationByGeoId(geoId);

    }, 40);

})(jQuery,otpMain);


/*********************/
/****** 	form/currencySwitch.js	 ***********/
/*********************/

(function($,o){

    var f = function(){

        var self = this;

        return this;
    };

    o.form.currencySwitch = new f();

})(jQuery,otpMain);



/*********************/
/****** 	map.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 23/10/17.
 */

(function($,o){

    o.map = new function(){

        var self = this;
        var maps = {};
        var icons = {};
        var info_windows = {};
        var markers = {};

        this.obj = undefined; // gMap object
        this.vendor = 'Google';
        this.loading_status = false;
        this.callbacks = [];


        /**
         * Reset the markers
         * @param name
         */
        this.resetMarkers = function(name){
            if(!name) {
                markers = {};
            } else if(typeof markers[name] !== 'undefined') {
                markers[name] = {};
            }
        };

        /**
         * Reset the maps
         * @param name
         */
        this.resetMaps = function(name){
            if(!name) {
                maps = {};
            } else if(typeof maps[name] !== 'undefined') {
                maps[name] = undefined;
            }
        };


        /**
         * Get initialized map object by name
         * @param name
         * @returns {*}
         */
        this.getMap = function(name){
            return maps[name];
        };

        /**
         * Set map center
         * @param name
         * @param lat
         * @param lng
         */
        this.setCenter = function (name, lat, lng) {
            if(self.getMap(name)) {
                self.getMap(name).setCenter(new self.obj.LatLng(lat, lng));
            }
        };

        this.refresh = function(name) {
            if(self.getMap(name)) {
                self.obj.event.trigger(self.getMap(name), 'resize');
            }
        };

        /**
         * Set map zoom
         * @param name
         * @param zoom
         */
        this.setZoom = function(name, zoom) {
            if(self.getMap(name)) {
                self.getMap(name).setZoom(zoom);
            }
        };

        /**
         * Resize the map
         * @param name
         */
        this.resize = function(name){
            if(self.getMap(name)) {
                self.obj.event.trigger(self.getMap(name), 'resize');
            }
        };


        /**
         * Set center by existing markers
         * @param name
         */
        this.fit = function(name){
            if(this.getMap(name)) {

                var bounds = new self.obj.LatLngBounds();

                $.each(markers[name], function(i, item){
                    var ll = new self.obj.LatLng(
                        item.marker.position.lat(),
                        item.marker.position.lng()
                    );
                    bounds.extend(ll);
                });

                self.getMap(name).fitBounds(bounds);
            }
        };


        /**
         * Add hotel marker
         *
         * @param name
         * @param hotel
         * @param offer
         * @param options
         */
        this.addHotelMarker = function(name, hotel, offer, options){

            offer = (offer || {}) || hotel.offers[0];

            if(typeof markers[name] === 'undefined') {
                markers[name] = {};
            }

            self.addMarker(name, +hotel.i, $.extend({
                'lat':      hotel.g.a,
                'lng':      hotel.g.o,
                'title':    hotel.n + (typeof hotel.s === 'string' ? ' ' + hotel.s + '*' : ''),
                'subtitle': hotel.t.n + ', ' + hotel.c.n,
                'image':    'https://newimg.otpusk.com/2/140x100/' + (typeof hotel.f === 'object' ? hotel.f[0] : hotel.f),
                'rating':   hotel.r,
                'reviews':  hotel.v,
                'price':    (!$.isEmptyObject(offer) && offer.pl ? o.fn.priceEcho(offer.pl, 'uah', 'currency-uah') + (offer.u && offer.u !== 'uah' ? ' ' + o.fn.priceEcho(offer.p, offer.u) : '') : ''),
                'link':     o.tour.getLink(offer, 'tour', hotel) + '&ref=map'
            }, options));
        };

        /**
         * Add marker
         *
         * @param name
         * @param item
         */
        this.addMarker = function(name, key, item) {
            if(!(key in markers[name])) {
                markers[name][key] = item;
            }
        };

        /**
         * Remove marker
         *
         * @param name
         * @param key
         */
        this.removeMarker = function(name, key) {
            delete markers[name][key];
        };

        /**
         * Show infowindow by lat and lng values
         * @param name
         * @param lat
         * @param lng
         */
        this.openMarker = function(name, lat, lng) {
            if(name in markers) {
                $.each(markers[name], function (i, item) {
                    if(item.lat == lat && item.lng == lng) {
                        self.obj.event.trigger(item.marker, 'click');
                        self.obj.event.trigger(self.getMap(name), 'resize');
                    }
                });
            }
        };


        /**
         * Remove all markers from a map
         * @param name
         */
        this.cleanMarkers = function(name){
            if(typeof markers[name] === 'object') {
                $.each(markers[name], function(i, item){
                    if(item.marker) {
                        item.marker.setMap(null);
                    }
                });
            }
        };

        /**
         * Render markers on map
         * @param name
         */
        this.renderMarkers = function(name) {
            $.each(markers[name], function(i, item){
                // skip if exists
                if(item.marker) { return 0; }

                // create marker
                var marker = new self.obj.Marker({
                    position: new self.obj.LatLng(item.lat, item.lng),
                    icon: ['main', 'important'].indexOf(item.type) !== -1 ? icons.x2: icons.orig
                });

                var open = function(e) {
                    info_windows[name].setOptions({
                        pixelOffset: new self.obj.Size(['main', 'important'].indexOf(item.type) !== -1 ? -2 : -5, 2)
                    });
                    info_windows[name].setContent(self.getHotelInfowindowContent(item).get(0));
                    info_windows[name].open(maps[name], this);
                };

                self.obj.event.addListener(marker, 'click', open);

                // append the marker to current map
                marker.setMap(maps[name]);

                // open info-window by default
                if(item.type === 'main') {
                    setTimeout(function(){
                        self.obj.event.trigger(marker, 'click');
                    }, 500);
                }

                markers[name][i].marker = marker;
            });
        };

        /**
         * Get Hotel infowindow content
         *
         * @param item
         * @returns {*}
         */
        this.getHotelInfowindowContent = function (item) {
            return $('<div>')
                .append(
                    $('<div>')
                        .addClass(o.fn.prefix('map-infowindow-wrap'))
                        .append(
                            $('<div>')
                                .addClass(o.fn.prefix('map-infowindow-image'))
                                .append(
                                    $('<img>').attr('src', item.image)
                                )
                        ).append(
                            $('<div>')
                                .addClass(o.fn.prefix('map-infowindow-title'))
                                .append(item.title)
                        ).append(
                            $('<div>')
                                .addClass(o.fn.prefix('map-infowindow-subtitle'))
                                .append(item.subtitle)
                        ).append(
                            item.price && $('<div>')
                                .addClass(o.fn.prefix('map-infowindow-price'))
                                .append(
                                    $('<a>')
                                        .attr('href', item.link)
                                        .attr('target', '_blank')
                                        .addClass(o.fn.prefix('order-button'))
                                        .on('click', function() {
                                            if(o.tour.hotelMap.view.$close) {
                                                o.tour.hotelMap.view.$close.trigger('click');
                                            }
                                            if(o.result.view.$mapContainer.is(':visible')) {
                                                o.result.view.$mapContainer.trigger('close');
                                            }
                                        })
                                        .html(item.price)
                                )
                        ).append(
                            $('<div>')
                                .addClass(o.fn.prefix('map-infowindow-rating'))
                                .append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('r-item-rating-container'))
                                        .addClass(o.fn.prefix('r-p' + parseInt(item.rating)))
                                        .append(
                                            $('<span>')
                                                .addClass(o.fn.prefix('r-item-rating-value'))
                                                .text(item.rating ? item.rating.toString().replace('.', ',') : '')
                                        ).append(
                                            +item.reviews > 0 && $('<span>')
                                                .addClass(o.fn.prefix('r-item-rating-rev'))
                                                .append($('<span>').text(item.reviews))
                                                .append(o.fn.suffixForNumber(item.reviews, [o._('отзыв'), o._('отзыва'), [o._('отзывов')]]))
                                    ).append(
                                        $('<span>')
                                            .addClass('slice')
                                            .append($('<div>').addClass('bar'))
                                            .append($('<div>').addClass('fill'))
                                    )
                                )
                        )
                );
        };

        /**
         * init map, must coll after view map
         * @param f
         * @param name
         * @param options
         */
        this.initMap = function(f, name, options){
            options = options || {};

            // load the map
            this.loadMap(function(){

                var latLng = new self.obj.LatLng(50.45, 30.5); // default lat&lng

                options = $.extend({
                    zoom: 5,
                    draggable: true,
                    scrollwheel: false,
                    scaleControl: true,
                    streetViewControl: false,
                    zoomControl: true,
                    navigationControl: true,
                    disableDoubleClickZoom:false,
                    center: latLng,
                    mapTypeId: self.obj.MapTypeId.HYBRID,
                    maxZoom: 18,
                    styles: [
                        {
                            "featureType": "poi",
                            "elementType": "labels",
                            "stylers": [
                                { "visibility": "off" }
                            ]
                        },{
                            "featureType": "landscape",
                            "elementType": "labels",
                            "stylers": [
                                { "visibility": "off" }
                            ]
                        },{
                            "featureType": "transit",
                            "stylers": [
                                { "visibility": "off" }
                            ]
                        }
                    ]
                }, options);

                // set icons
                icons.orig = {
                    url: options.icons_orig || 'https://export.otpusk.com/os/onsite/marker_new.png',
                    size: new self.obj.Size(24,24),
                    origin: new self.obj.Point(0,0),
                    anchor: new self.obj.Point(7,7)
                };

                icons.x2 = {
                    url: options.icons_x2 || 'https://export.otpusk.com/os/onsite/marker_select.png',
                    size: new self.obj.Size(20, 20),
                    origin: new self.obj.Point(0,0),
                    anchor: new self.obj.Point(10, 10)
                };

                if(self.getMap(name)){
                    maps[name] = self.getMap(name);

                    // close info window
                    info_windows[name].close();

                } else {

                    // init the map
                    maps[name] = new self.obj.Map(document.getElementById(name), options);
                    if(!markers[name]) {
                        markers[name] = [];
                    }

                    // init info-window
                    info_windows[name] = new self.obj.InfoWindow({
                        content: '',
                        pixelOffset: new self.obj.Size(0, 2)
                    });
                }

                // render markers
                self.renderMarkers(name);

                self.obj.event.addListenerOnce(maps[name], 'idle', function() {
                    self.obj.event.trigger(maps[name], 'resize');
                });

                if(typeof f === 'function') {
                    f(maps[name]);
                }
            });
        };


        /**
         * Load the google maps
         * @param f
         */
        this.loadMap = function(f){
            if(o.map.loading_status === 'loaded') {
                if(typeof f === 'function') {
                    f(o.map.obj);
                }
            } else if(o.map.loading_status === 'pending') {
                self.callbacks.push(f);
            } else {
                // set script loading status
                o.map.loading_status = 'pending';
                // store callback
                self.callbacks.push(f);
                // callback when running after gmap loaded
                window.osMapsCallback = self.onMapLoad;

                // load google maps a library
                var script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = 'https://maps.google.com/maps/api/js?'+ [
                    (typeof gmapkey !== 'undefined'? 'key='+ gmapkey : ''),
                    'libraries=geometry',
                    'language=ru',
                    'callback=osMapsCallback'
                ].join('&');
                document.body.appendChild(script);
            }
        };

        /**
         * After google map script loading
         */
        this.onMapLoad = function() {
            o.map.loading_status = 'loaded';
            o.map.obj = google.maps;

            self.callbacks.map(function(f) {
                f(o.map.obj);
                return f;
            });
        };
    };

})(jQuery,otpMain);

/*********************/
/****** 	result/result.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 03/10/17.
 */

(function($,o){

    var f = function(){

        var self = this;

        this.hotelIds = [];
        this.hotelsNew = {};
        this.minPrice = {}; // searched min price

        this.callback = [];

        /**
         * Bind the callbacks
         * @param n
         * @param f
         * @returns {f}
         */
        self.bind = function(n,f) {
            self.callback[n] = f;
            return this;
        };

        /**
         * Run the binding callbacks
         * @param n
         * @param p
         * @returns {boolean}
         */
        var call = function(n,p) {
            if(self.callback[n]){
                if(typeof self.callback[n] === 'function'){
                    self.callback[n](p);
                    return true;
                }
            }
            return false;
        };

        /**
         * Parse and sorting hotels
         * @param f
         * @param hotels
         * @param hotelId
         */
        self.resultSet = function(f, hotels, hotelId){

            // append hotels to "self.hotels" and "self.hotelIds"
            var i, j, hotel;
            for(i in hotels){
                if(hotels.hasOwnProperty(i)) {
                    for(j in hotels[i]){
                        if(hotels[i].hasOwnProperty(j)) {

                            hotel = hotels[i][j];

                            // convert offers to list and get ids
                            hotel.offerIds = [];
                            hotel.offers = $.map(hotel.offers, function(offer){
                                hotel.offerIds.push(offer.i);
                                return offer;
                            });

                            if(self.hotelIds.indexOf(j) === -1) { // add hotel

                                // sort offers by price
                                hotel.offers.sort(function(a,b){
                                    return a.pl - b.pl;
                                });

                                self.hotelIds.push(j);
                                self.hotelsNew[j] = hotels[i][j];

                            } else { // update hotel offers

                                $.each(hotel.offers, function(k,v){

                                    if(self.hotelsNew[j].offerIds.indexOf(v.i) === -1) {
                                        self.hotelsNew[j].offerIds.push(v.i);
                                        self.hotelsNew[j].offers.push(v);
                                    }
                                });

                                // sort offers by price
                                self.hotelsNew[j].offers.sort(function(a,b){
                                    return a.pl - b.pl;
                                });
                            }

                            // add markers for gMap
                            if(!$.isEmptyObject(hotel.g) && hotel.g.a && hotel.g.o && hotel.g.a !== '0.00000') {
                                o.map.addHotelMarker(o.fn.prefix('os-map'), hotel, hotel.offers[0], { type: 'important' });
                            }
                        }
                    }
                }
            }

            // return offers for once hotel
            if(+hotelId > 0) {
                f(self.hotelsNew[hotelId].offers);
                return;
            }

            // convert hotels to list
            var hotelList = $.map(self.hotelsNew, function(hotel){
                return hotel;
            });

            // sort hotels by offer min price
            hotelList.sort(function(a,b){
                return a.offers[0].pl - b.offers[0].pl;
            });

            // save a min price
            if(typeof hotelList[0] !== 'undefined' && typeof hotelList[0].offers[0] !== 'undefined') {
                self.minPrice = {
                    'mp': hotelList[0].offers[0].p,
                    'mc': hotelList[0].offers[0].u
                };
            }

            f(hotelList, $.isEmptyObject(o.fn.getFirst(hotels || {}))); // render hotels
        };

        self.FoodTransportDaysMatrix = function (offers) {
            var fn = this;

            var foods = fn.groupBy('f', offers);
            var transports = fn.groupBy('t', offers);

            var rows = [];

            for(var f in foods) {
                for (var t in transports) {
                    rows.push({
                        food: f,
                        transport: t,
                        cols: fn.distinct('l', fn.getIntersection(transports[t], foods[f]))
                    });
                }
            }

            rows.sort(function(a, b) {
                var min = function(col) {
                    col.sort(function(a, b) {
                        return a.pl - b.pl
                    });

                    return col[0];
                };

                return min(b.cols) - min(a.cols);
            });

            var template = {};
            var nights = +o.hash.get('l', 7);
            template[nights] = [];
            template[nights+1] = [];
            template[nights+2] = [];

            rows = rows.map(function(row) {
                row.cols = fn.groupBy('l', row.cols, template);
                return row;
            });

            return rows;
        };

        self.FoodTransportDaysMatrix.prototype = {
            'groupBy': function (field, offers, body) {
                return offers.reduce(function (matrix, offer) {
                    var value = offer[field];
                    if (value) {
                        if (!(value in matrix)) {
                            matrix[value] = [];
                        }
                        matrix[value].push(offer);
                    }

                    return matrix;
                }, body ? jQuery.extend(true, {}, body) : {})
            },
            'distinct': function (field, offers) {
                var keys = [];

                return offers.sort(function (a, b) {
                    return a.pl - b.pl;
                }).filter(function (o) {
                    if (keys.indexOf(o[field]) === -1) {
                        keys.push(o[field]);
                        return true;
                    }

                    return false;
                });
            },
            'getIntersection': function (a, b) {
                var flatten = function (o) {
                    return o.i;
                };
                return a.filter(function (o) {
                    return b.map(flatten).indexOf(o.i) !== -1;
                })
            }
        };
    };

    o.result = new f();

})(jQuery,otpMain);


/*********************/
/****** 	result/hotel.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 03/10/17.
 */

(function($,o){

    o.result.hotel = function(hotel, parent){

        var self = this;

        this.object = hotel;
        this.parent = parent;
        this.view = new o.result.hotelView(this);
    };

})(jQuery,otpMain);

/*********************/
/****** 	tour/tour.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 04/10/17.
 */

(function($,o){

    var f = function(){

        this.callback = {};
        this.hotel = {};
        this.hotels = {};
        this.offer = {};
        this.offers = {};
        this.days = [];
        this.months = [];
        this.rooms = {};
        this.foods = {};
        this.matrixLen = {
            'y': 5, // vertical (dates, 3,5,7...)
            'x': 5  // horizontal (length, 3,5,7...)
        };
        this.longToShortPropsMap = {
            'vendor':           'v',
            'id':               'i',
            'variantId':        'vid',
            'operatorId':       'oi',
            'tourId':           'ti',
            'tourOptions':      'o',
            'tourStatus':       's',
            'fromCity':         'c',
            'checkIn':          'd',
            'type':             'y',
            'adult':            'a',
            'child':            'h',
            'childAges':        'ha',
            'length':           'l',
            'food':             'f',
            'roomId':           'ri',
            'room':             'r',
            'price':            'p',
            'priceUah':         'pl',
            'currencyRate':     'ur',
            'currency':         'u',
            'transport':        't',
            'transportOptions': 'to',
            'stopSale':         'ss'
        };

        var self = this;

        /**
         * Bind the callbacks
         * @param n
         * @param f
         * @returns {f}
         */
        this.bind = function(n,f){
            if(this.callback[n] === undefined){
                this.callback[n] = [];
            }
            this.callback[n].push(f);
            return this;
        };

        /**
         * Run the binding callbacks
         * @param n
         * @param a
         * @param b
         * @param c
         * @returns {boolean}
         */
        this.call = function(n,a,b,c){
            if(self.callback[n] && self.callback[n].length){
                for(var i in self.callback[n]){
                    if(typeof self.callback[n][i] === 'function' && self.callback[n].hasOwnProperty(i)){
                        self.callback[n][i](a,b,c);
                    }
                }
                return true;
            }
            return false;
        };

        /**
         * Init the hotel data from hash
         * @returns {f}
         */
        this.init = function(){

            o.hash.parse();

            this.hotel.id = o.hash.get('hid');
            this.hotel.ln = o.hash.get('hnm');

            this.offer.id = o.hash.get('oid');
            this.offer.od = o.hash.get('od');
            this.offer.ol = o.hash.get('ol');

            self.call('init', this.hotel, this.offer);

            // redirect to form page if do not have a hotel id
            if(!this.hotel.id){
                var hash = o.hash.get();
                hash.page = 'form';

                window.location.href = '#'+ o.hash.compile(hash, true);
            }

            // is matrix for mobile version
            if(o.view.$.parent().width() < 421) {
                self.matrixLen.x = 3;
                self.matrixLen.y = 5;
            }

            // is matrix for tablet version
            if(o.view.$.parent().width() < 801 && o.view.$.parent().width() >=421) {
                self.matrixLen.x = 3;
                self.matrixLen.y = 5;
            }

            return this;
        };

        /**
         * Init hotel and load data
         * @param f
         */
        this.getData = function(f){

            // init the hotel by hash data
            this.init();

            this.getHotel(self.hotel.id, function(hotel) {
                self.hotel = hotel;

                self.hotel.rooms = {};
                if(hotel.o.r) {
                    $.each(hotel.o.r, function(k, v){
                        self.hotel.rooms[v.id] = v;
                    });
                }

                f(hotel);
            });
        };

        /**
         * Load hotel data
         * @param id
         * @param f
         */
        this.getHotel = function(id, f) {
            if(typeof self.hotels[id] !== 'undefined') {

                if(typeof f === 'function'){
                    f(self.hotels[id]);
                }

            } else {
                $.ajax({
                    type: "GET",
                    url: o.config.tourLink,
                    dataType: 'jsonp',
                    data: $.extend({
                        'hotelId': id,
                        'lang': o.lang
                    }, o.apiToken),
                    success: function(result) {

                        o.fn.checkError(result);

                        if(typeof f === 'function'){

                            self.hotels[id] = result.hotel;

                            f(result.hotel);
                        }
                    },
                    error: function(x, t, m) {
                        console.log(x, t, m);
                    }
                });
            }
        };

        /**
         * Return the link of tour page
         * @param offer
         * @param page
         * @param hotel
         * @returns {string}
         */
        this.getLink = function(offer, page, hotel){

            var hash = $.extend($.extend({}, o.search.query), o.hash.get());

            hash.tc = o.hash.get('tc'); // fix to cities preload

            hotel = hotel || this.hotel;

            hash.page = page || 'tour';
            hash.hid = hotel.i;
            hash.hnm = hotel.h;

            if(offer){
                hash.oid = offer.i;
                hash.od = offer.d;
                hash.ol = offer.l;
                hash.tr = offer.t;
            }

            var params = {
                'url': window.location.protocol +'//'+ window.location.hostname + window.location.pathname + window.location.search +'#'+ o.hash.compile(hash, true),
                'hash': hash
            };

            self.call('getLink', params, hotel);

            return params['url'];
        };

        /**
         * Run on offer was changed, click in search results or on load the tour page
         * @param oid
         * @param ol
         * @param od
         */
        this.changeOffer = function(oid, ol, od){
            if((oid && !isNaN(+ol) && od && String(o.tour.offer.i) !== String(oid)) || (o.hash.get('hid') && !o.tour.offer.i)) {
                if(oid) {
                    o.tour.view.render(oid);
                }
            }
        };

        /**
         * Get offers
         * @param f
         * @param params
         */
        this.getOffers = function(f, params){
            params.c = typeof params.c === 'string'? new Date(params.c): params.c;
            params.v = typeof params.v === 'string'? new Date(params.v): params.v;

            var nowDate = new Date();
            var minDate = params.c || new Date(nowDate.getDate() + 7); // +7 days
            var maxDate = params.v || new Date(nowDate.getDate() + 14);// + 14 days

            // create params
            var query = {};
            query.n = 0; // number query
            query.d = params.d; // city from
            query.i = params.i; // hotel id
            query.y = params.y; // geo type
            query.c = o.fn.formatDate(minDate); // checkIn
            query.v = o.fn.formatDate(maxDate); // checkInTo
            query.l = params.l; // length
            query.lt = params.lt; // lengthTo
            query.p = params.p; // peoples
            query.r = params.r ? (typeof params.r === 'string' ? params.r.split(',') : params.r) : ''; // transport
            query.o = params.o ? (typeof params.o === 'string' ? params.o.split(',') : params.o) : ''; // food
            query.oid = params.oid;
            if(params.ofs) {
                query.ofs = 1;
                query.now = 1;
            }
            if(query.oid) query.now = 1;

            self.offers = [];
            self.hotel.offers = [];

            // load offer from cache #14326
            var cached_offer = +query.oid && +query.i > 5000? self.getOfferFromStorage(query.i, query.oid): false;
            if(cached_offer) {
                self.offers = [cached_offer];
                self.offer = cached_offer;
                f();
                return;
            }

            // make a search
            o.search.getData(query,
                function(e){ // call on every response

                    self.call('response', e);

                    // update the spinner
                    o.spinner.view.refresh(e.progress);

                    if($.isEmptyObject(e.hotels)) {
                        return;
                    }

                    self.call('process_set', e);

                    //o.hash.parse();
                    var i, j, k;
                    if(e.hotels){
                        for(i in e.hotels){ //array of vendor data
                            if(e.hotels.hasOwnProperty(i)) {

                                for(j in e.hotels[i]){ //array of hotels
                                    if(e.hotels[i].hasOwnProperty(j)) {

                                        for(k in e.hotels[i][j].offers) {
                                            if(e.hotels[i][j].offers.hasOwnProperty(k)) {
                                                self.hotel.offers.push(e.hotels[i][j].offers[k]);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                function(e){

                    // reset the spinner
                    o.spinner.view.reset();
                },
                function(e){ // call on last response

                    // reset the spinner
                    o.tour.view.$matrix.hide();
                    o.spinner.view.reset(function(){
                        o.tour.view.$matrix.fadeIn(300);
                    });

                    self.days = [];
                    for(var i=query.l; i<(+query.l+self.matrixLen['x']); i++) {
                        self.days.push(i);
                    }

                    self.months = [];
                    for(i=0; i<self.matrixLen['y']; i++) {
                        var fd = o.fn.formatDate(minDate);
                        minDate.setDate(minDate.getDate()+1);
                        self.months.push(fd);
                    }

                    if($.isEmptyObject(self.hotel.offers)) {
                        f(self.days, self.months);
                        return;
                    }

                    // group offers by offer.date + offer.length
                    var offers = {};
                    for(i in self.hotel.offers) {
                        if(self.hotel.offers.hasOwnProperty(i)) {

                            var offer = self.hotel.offers[i],
                                key = offer.d + offer.l;

                            if(!(key in offers)) {
                                offers[key] = [];
                            }

                            if(o.hash.get('page') === 'tour') {
                                offer.link = self.getLink(offer);
                            }

                            offers[key].push(offer);
                        }
                    }

                    self.hotel.offers = [];
                    e = null;

                    // sort offers by price
                    for(i in offers){
                        if(offers.hasOwnProperty(i)) {
                            offers[i].sort(function(a,b){
                                return a.pl - b.pl;
                            });
                            // fix offers transport
                            offers[i] = offers[i].map(function(offer) {
                                if(offer.to && 'from' in offer.to && 'to' in offer.to) {
                                    offer.to.from = $.map(offer.to.from, function(f) {return f;});
                                    offer.to.to = $.map(offer.to.to, function(f) {return f;});
                                }

                                return offer;
                            });
                        }
                    }

                    console.log(offers);

                    // reset selected offer to current offer
                    if(self.offer.i) {
                        self.offer.od = self.offer.d;
                        self.offer.ol = self.offer.l;
                    }

                    if(self.offer && self.offer.od && self.offer.ol) {

                        var result = self.getRooms(offers[self.offer.od + self.offer.ol], self.offer.id);

                        // set current offer
                        if(!self.offer.i) {
                            self.offer = result[0];
                        }

                        self.rooms = result[1];
                        self.foods = result[2];
                        result = null;
                    }

                    self.offers = offers;

                    self.call('process_last', e);

                    f(self.days, self.months);
                }
            );
        };

        this.getOfferFromStorage = function(hid, oid) {
            var cached_offer = o.storage.getOffers(hid, oid);

            if(!$.isEmptyObject(cached_offer)) {
                // check is not expired date
                var cached_update = new Date(cached_offer.updated);
                var actualMinDate = new Date(Date.now() - (10*60*1000)); // offer actual is 10 minutes

                if(cached_update.getTime() > actualMinDate.getTime()) {
                    return cached_offer;
                }
            }

            return null;
        };

        this.convertOfferKeysToFormat = function(offer, format) {
            var map = format === 'short' ? self.longToShortPropsMap : o.fn.swapObjectKeyVals(self.longToShortPropsMap);
            var formatted = {};

            for (var field in offer) {
                if (field in map) {
                    formatted[map[field]] = offer[field];
                }
            }

            return formatted;
        };

        this.formatOfferObject = function(hotel, offer) {
            offer = self.convertOfferKeysToFormat(offer, 'long');

            return $.extend(
                {},
                offer,
                {
                    country: hotel.t,
                    city: hotel.c,
                    hotel: {
                        n: hotel.nm,
                        c: hotel.s.n,
                        photo: Array.isArray(hotel.f) ? o.fn.getFirst(hotel.f) : hotel.f
                    },
                    fromCity: o.form.fromCity.view.getCityFromId(offer.fromCity),
                    operator: offer.operatorId in o.config.operators ? o.config.operators[offer.operatorId] : offer.vendor,
                    tourId: null,
                    roomId: null,
                    operatorId: null,
                    vendor: null
                }
            );
        };

        /**
         * Get offer by id
         * @param oid
         * @param callback
         */
        this.getOffer = function(hid, oid, callback) {

            /* check cache with rules */
            var cached = self.getOfferFromStorage(hid, oid);
            if(cached) {
                callback(cached);
            }
            /* search offer */
            else {
                $.ajax({
                    type:     "GET",
                    url:      o.config.offerLink,
                    dataType: 'jsonp',
                    data:     $.extend({
                        'offerId': oid,
                        'lang':    o.lang
                    }, o.apiToken),
                    success:  function (result) {
                        var error = o.fn.checkError(result);
                        if(error) {
                            callback(null);
                            return 0;
                        }

                        var offer = self.convertOfferKeysToFormat(result.offer, 'short');
                        if (typeof callback === 'function') {
                            /* Fix offers transport format */
                            if (offer.to && 'from' in offer.to && 'to' in offer.to) {
                                offer.to.from = $.map(offer.to.from, function (f) {
                                    return f;
                                });
                                offer.to.to = $.map(offer.to.to, function (f) {
                                    return f;
                                });
                            }

                            callback(offer);
                        }
                    },
                    error:    function (x, t, m) {
                        console.log(x, t, m);
                    }
                });
            }
        };

        /**
         * Group offers by food and room
         * @param offers
         * @param id
         * @returns {[null,null,null]}
         */
        this.getRooms = function(offers, id) {
            var curOffer,
                rooms = {},
                foods = [];

            for(i in offers) {
                if(offers.hasOwnProperty(i)) {

                    var offer = offers[i];

                    if(id) {
                        if(String(offer.i) === String(id)) {
                            curOffer = offer;
                        }
                    } else {
                        if(i < 1) curOffer = offer;
                    }

                    if(!(offer.ri in rooms)) {
                        rooms[offer.ri] = {
                            'label': offer.r,
                            'type': offer.y
                        };
                    }

                    if(!(offer.f in rooms[offer.ri])) {
                        rooms[offer.ri][offer.f] = offer;
                    }

                    if(!o.fn.in_array(offer.f, foods)) {
                        foods.push(offer.f);
                    }

                    if(!rooms[offer.ri] || !rooms[offer.ri][offer.f]) {
                        rooms[offer.ri][offer.f] = offer;
                    }
                }
            }

            return [curOffer, rooms, foods];
        };

        /**
         * Load hotel description
         * @param f
         * @param hotelId
         * @returns {boolean}
         */
        this.loadHotelDescription = function(f, hotelId) {
            if(+hotelId < 5000) {
                return false;
            }

            $.ajax({
                url: o.config.hotelDescriptionLink,
                type: 'GET',
                dataType: 'jsonp',
                data:  {
                    'id': hotelId,
                    'k': osApiId
                },
                success: function(d) {
                    f(d);
                }
            });
        };
    };

    o.tour = new f;

    // trigger on load the page
    o.hash.addTrigger(function(){
        if(['tour', 'hotelInfo','photo','reviews','map'].indexOf(o.hash.get('page')) !== -1) {
            if(o.hash.get('oid')) {
                o.tour.changeOffer(o.hash.get('oid'), o.hash.get('ol'), o.hash.get('od'));
            }
            else {
                o.tour.view.render();
            }
        }
    }, 40, null, null, 'tour-page');

})(jQuery,otpMain);



/*********************/
/****** 	tour/hotelInfo.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 04/10/17.
 */

(function($,o){

    o.tour.hotelInfo = new function(){

    };

})(jQuery, otpMain);


/*********************/
/****** 	tour/photo.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 04/10/17.
 */

(function($,o){

    o.tour.photo = new function(){

    };

})(jQuery, otpMain);

/*********************/
/****** 	tour/hotelMap.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 04/10/17.
 */

(function ($, o) {

    var f = function () {

        var self = this;
        self.store = {};

        this.loadHotels = function (countryId, cityId, center, radius, callback) {

            var key = ('' + countryId + center.lat + center.lng + radius).replace(/\D/g, '');

            /* Check store */
            if (key in self.store) {
                callback(self.store[key]);
            }
            else {
                $.ajax({
                    url:      o.config.hotelsLink,
                    type:     'GET',
                    dataType: 'jsonp',
                    data:     $.extend({
                        'countryId': countryId,
                        'cityId':    cityId,
                        'geo':       center.lat + ',' + center.lng,
                        'rad':       Math.min(radius, 100),
                        'with':      'price'
                    }, o.apiToken),
                    success:  function (data) {
                        if ('hotels' in data && Array.isArray(data.hotels) && data.hotels.length) {
                            self.store[key] = data.hotels;
                            callback(data.hotels);
                        }
                    }
                });
            }
        };

    };

    o.tour.hotelMap = new f();

})(jQuery, otpMain);


/*********************/
/****** 	tour/reviews.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 04/10/17.
 */

(function($,o){

    o.tour.reviews = new function() {
        /**
         * Load reviews from TP
         * @param f
         * @param hotelId
         */
        this.load = function(f, hotelId) {
            $.ajax({
                type: "GET",
                url: o.config.reviewsLink,
                dataType: 'html',
                timeout: 25000, // 25 sec
                data: {'htl': hotelId, 'tp': 9, 'skin':1,'count':10},
                success: function (data) {
                    if(typeof f === 'function'){
                        f(data);
                    }
                },
                error: function(x, t, m) {
                    console.log('Error:', x, t, m);
                }
            });
        };
    };

})(jQuery, otpMain);


/*********************/
/****** 	tour/creditModal.js	 ***********/
/*********************/
(function ($, o) {
    var f = function () {
        this.officeList = null;
    };

    f.prototype.sendData = function (data, onSuccess, onError) {
       if (data.officeId === 0) {
           delete data.officeId;
       }

      $.ajax({
          type: 'GET',
          url: o.config.orderLink,
          dataType: 'jsonp',
          data: $.extend({
              offerId: otpMain.tour.offer.i,
              installments: 1
          }, data, o.apiToken),
          success: onSuccess,
          error: onError
      })
    };

    f.prototype.getOffices = function (onSuccess) {
        var _this = this;

        $.ajax({
            url: o.config.officesLink,
            type: 'GET',
            dataType: 'jsonp',
            data: $.extend({}, o.apiToken),
            success: function(response) {
                if (response.data) {
                    var officeByCity = {};

                    $.each(response.data, function(id, office) {
                        if (!(office.city in officeByCity)) {
                            officeByCity[office.city] = [];
                        }

                        officeByCity[office.city].push({
                            id: id,
                            cityName: {'default': office.city, ua: office.cityUkr},
                            email: office.email,
                            address: {'default': office.address, ua: office.addressUkr}
                        });
                    });

                    _this.officeList = officeByCity;
                    onSuccess(_this.officeList);
                }
            }
        });
    };


    o.tour.creditModal = new f;
}(jQuery, otpMain));

/*********************/
/****** 	view/form/form.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 27/09/17.
 */

(function($, o){

    var f = function(){

        this.$ = undefined;
        this.$button = undefined;
        this.$form = undefined;

        var self = this,
            $location,
            $from,
            $date,
            $duration,
            $people,
            $category,
            $food,
            $rating,
            $price,
            $transport,
            $services,
            $recommendations,
            $regions,
            $spinner;

        /**
         * Init the form
         */
        this.init = function(){

            this.$ = $('<div>')
                .addClass(o.fn.prefix('f-container'))
                .append(
                    $('<div>')
                        .addClass(o.fn.prefix('f-wrapper-bg-imgs'))
                ).append(
                    $('<div>')
                        .addClass(o.fn.prefix('f-wrapper'))
                        .append(
                            $('<div>')
                                .addClass(o.fn.prefix('f-title'))
                                .text(o._('Поиск тура'))
                        ).append(
                        self.$form = $('<form>')
                            .addClass(o.fn.prefix('f-form'))
                            .addClass('clearfix')
                            .append(
                                $('<div>')
                                    .addClass('clearfix')
                                    .append(
                                        $location = $('<div>')
                                            .addClass(o.fn.prefix('f-form-field'))
                                            .addClass(o.fn.prefix('f-dropdown-container to'))
                                            .attr('id', o.fn.prefix('os-to'))
                                    ).append(
                                        $from = $('<div>')
                                            .addClass(o.fn.prefix('f-form-field'))
                                            .addClass(o.fn.prefix('f-dropdown-container from'))
                                            .attr('id', o.fn.prefix('os-from'))
                                    ).append(
                                        $date = $('<div>')
                                            .addClass(o.fn.prefix('f-form-field date'))
                                    ).append(
                                        $duration = $('<div>')
                                            .addClass(o.fn.prefix('f-form-field'))
                                            .addClass(o.fn.prefix('f-dropdown-container duration'))
                                            .attr('id', o.fn.prefix('os-duration'))
                                    ).append(
                                        $people = $('<div>')
                                            .addClass(o.fn.prefix('f-form-field'))
                                            .addClass(o.fn.prefix('f-dropdown-container people'))
                                            .attr('id', o.fn.prefix('os-people'))
                                    ).append(
                                        self.$button = $('<button>')
                                            .addClass(o.fn.prefix('f-form-submit'))
                                            .attr('type', 'submit')
                                            .text(o._('Найти'))
                                            // submit the form
                                            .on('click', function(){
                                                if(!+o.form.location.selectedSuggest.id) {
                                                    alert(o._('Выберите страну, курорт или отель'));
                                                    return false;
                                                } else {
                                                    $(o.fn.prefix('f-container','.')).removeClass('ext-opened');
                                                    $('html').removeClass(o.fn.prefix('layer-open-ext')).removeClass('nk_search-menu-active');
                                                }

                                                // ga tracker
                                                if(o.tracker) {
                                                    o.tracker.send('event', 'Отпуск.НаСайт Поиск', 'Нажата кнопка Найти', o.form.location.currentCountry.name);
                                                }

                                                // hide all popup
                                                $(o.fn.prefix('f-dropdown-body','.')).fadeOut(200);

                                                // is open new window
                                                if(typeof o.osTarget !== 'undefined' && o.osTarget) {

                                                    if(typeof o.osTarget !== 'string') {
                                                        window.location.reload();
                                                    }

                                                    var localUri = window.location.hostname+window.location.pathname;
                                                    var osTargetCheck = new RegExp(o.osTarget.replace(new RegExp('[^/]*//'), '') + '/?$');

                                                    if(!localUri.match(osTargetCheck)) {
                                                        var query = o.form.parse();
                                                        query.page = 'form';
                                                        var hash = o.hash.compile(query, true); // parse the form
                                                        var link = o.osTarget +'#'+ hash;

                                                        if(o.settings.get('osTargetBlank')) {
                                                            window.open(link, '_blank');
                                                        } else {
                                                            window.location.href = link;
                                                        }
                                                        return false;
                                                    }
                                                }

                                                // set hash data into the form
                                                o.search.query = o.form.parse();
                                                o.search.setHash(o.search.query);

                                                return false;
                                            })
                                    )
                                ).append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('f-ext-btn-container'))
                                        .append(
                                            $('<div>')
                                                .addClass(o.fn.prefix('f-ext-btn'))
                                                .css('display', !o.apiType || o.apiType !== 'full'? 'none': '')
                                                .append(
                                                    $('<span>')
                                                        .addClass(o.fn.prefix('f-ext-btn-text'))
                                                        .html(o._('Расширенный поиск'))
                                                ).append(
                                                    $('<span>')
                                                        .addClass(o.fn.prefix('f-ext-btn-filters-num'))
                                                ).on('click', function(){
                                                    $(this).trigger('os.action', ['toggle']);

                                                    // #14359
                                                    if(o.settings.get('osGeo') && !o.form.location.currentCountry.id && o.form.location.selectedSuggest.id) {
                                                        o.form.location.call('select', null, {'item': o.form.location.selectedSuggest});
                                                    }
                                                })
                                                .on('os.action', function(e, action) {
                                                    switch(action) {
                                                        case 'open':
                                                            self.$.addClass('ext-opened');
                                                            $('html').addClass(o.fn.prefix('layer-open-ext'));
                                                            break;
                                                        case 'close':
                                                            self.$.removeClass('ext-opened');
                                                            $('html').removeClass(o.fn.prefix('layer-open-ext'));
                                                            break;
                                                        case 'toggle':
                                                            self.$.toggleClass('ext-opened');
                                                            $('html').toggleClass(o.fn.prefix('layer-open-ext'));
                                                        default:
                                                            break;
                                                    }
                                                })
                                        )
                                ).append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('f-ext-container'))
                                        .append(
                                            $('<div>')
                                                .addClass(o.fn.prefix('f-dropdown-body-top'))
                                                .text(o._('Расширенный поиск'))
                                                .append(
                                                    $('<div>')
                                                        .addClass(o.fn.prefix('f-dropdown-body-close'))
                                                        .html('&times')
                                                        .click(function () {
                                                            self.$.find(o.fn.prefix('f-ext-btn', '.')).trigger('os.action', ['toggle']);
                                                        })
                                                )
                                        ).append(
                                            $('<div>')
                                                .addClass(o.fn.prefix('f-ext-body'))
                                                .append(
                                                    $('<div>')
                                                        .addClass('clearfix')
                                                        .append(
                                                            $('<div>')
                                                                .addClass(o.fn.prefix('f-ext-col'))
                                                                .append(
                                                                    $category = $('<div>')
                                                                        .addClass(o.fn.prefix('f-ext-bl'))
                                                                        .addClass(o.fn.prefix('f-ext-bl-cat'))

                                                                ).append(
                                                                    $food = $('<div>')
                                                                        .addClass(o.fn.prefix('f-ext-bl'))
                                                                        .addClass(o.fn.prefix('f-ext-bl-food'))
                                                            )
                                                        ).append(
                                                        $('<div>')
                                                            .addClass(o.fn.prefix('f-ext-col'))
                                                            .append(
                                                                $rating = $('<div>')
                                                                    .addClass(o.fn.prefix('f-ext-bl'))
                                                                    .addClass(o.fn.prefix('f-ext-bl-rat'))
                                                            ).append(
                                                                $price = $('<div>')
                                                                    .addClass(o.fn.prefix('f-ext-bl'))
                                                                    .addClass(o.fn.prefix('f-ext-bl-price'))
                                                        )
                                                    ).append(
                                                        $('<div>')
                                                            .addClass(o.fn.prefix('f-ext-col'))
                                                            .append(
                                                                $transport = $('<div>')
                                                                    .addClass(o.fn.prefix('f-ext-bl'))
                                                                    .addClass(o.fn.prefix('f-ext-bl-transp'))
                                                            )
                                                    ).append(
                                                        $('<div>')
                                                            .addClass(o.fn.prefix('f-ext-col'))
                                                            .addClass(o.fn.prefix('f-ext-col-recommend'))
                                                            .append(
                                                                $recommendations = $('<div>')
                                                                    .addClass(o.fn.prefix('f-ext-bl'))
                                                                    .addClass(o.fn.prefix('f-ext-bl-recommend'))
                                                            )
                                                    ).append(
                                                        $('<div>')
                                                            .addClass(o.fn.prefix('f-ext-col'))
                                                            .addClass(o.fn.prefix('f-ext-col-serv'))
                                                            .append(
                                                                $services = $('<div>')
                                                                    .addClass(o.fn.prefix('f-ext-bl'))
                                                            ).append(
                                                                $regions = $('<div>').css('display', 'none')
                                                            )
                                                    ).append(
                                                            $('<div>')
                                                                .addClass(o.fn.prefix('f-ext-clear-btn'))
                                                                .text(o._('Очистить фильтры'))
                                                                .on('click', function(){
                                                                    self.$form.trigger('os.reset');
                                                                })
                                                        )
                                                )
                                        ).append(
                                            $('<div>')
                                                .addClass(o.fn.prefix('f-dropdown-body-bottom'))
                                                .addClass('clearfix')
                                                .append(
                                                    $('<div>')
                                                        .addClass(o.fn.prefix('f-dropdown-bottom-btn'))
                                                        .addClass(o.fn.prefix('f-dropdown-btn-cancel'))
                                                        .text(o._('Отмена'))
                                                        .click(function () {
                                                            self.$.find(o.fn.prefix('f-ext-btn', '.')).trigger('os.action', ['toggle']);
                                                        })
                                                )
                                                .append(
                                                    $('<div>')
                                                        .addClass(o.fn.prefix('f-dropdown-bottom-btn'))
                                                        .addClass(o.fn.prefix('f-dropdown-btn-apply'))
                                                        .text(o._('Найти туры'))
                                                        .on('click', function(){
                                                            setTimeout(function(){
                                                                self.$button.trigger('click');
                                                                return false;
                                                            }, 700);

                                                        })
                                                )
                                        )
                                )
                        )
                );

            /* Add event listeners */
            self.$form.on('os.reset', function () {
                o.form.category.view.setValue([]);
                o.form.food.view.setValue([]);
                o.form.hotelRating.view.setValue([0,10]);
                o.form.transport.view.setValue(['air']);
                o.form.price.view.setValue([500, 100000]);
                o.form.service.view.setValue([]);
            });

            self.$form.on('os.refreshFiltersCount', function(e, controls) {
                var targetParams = controls.reduce(function(params, control) {
                    params = params.concat(control.param);
                    return params;
                }, []);

                /* Count filters */
                var diff = o.search.compareQueries(
                    o.form.parse(),
                    o.search.getQueryDefaults(targetParams)
                );

                /* Render counter */
                $(o.fn.prefix('f-ext-btn-filters-num', '.')).html(diff && diff.length ? ' <span>(</span>' + diff.length + '<span>)</span>' : '');
            });

            /* Run after view init callback */
            o.form.call('afterViewInit', self);
        };

        /**
         * run on document ready
         */
        this.render = function(container){

            self.init();

            if(typeof osFormContainer != 'undefined') {
                if(typeof osFormContainer === 'string') {
                    osFormContainer = document.getElementById(osFormContainer);
                }
                if($(osFormContainer).is('div')) {
                    container = $(osFormContainer);
                }
            }

            container = container || o.view.$;

            o.form.location.view.render($location);
            o.form.city.view.render(o.form.location.view.$cities);
            o.form.fromCity.view.render($from);
            o.form.datepicker.view.render($date);
            o.form.duration.view.render($duration);
            o.form.people.view.render($people);
            o.form.regions.view.render($regions);

            if(o.apiType && o.apiType === 'full') {
                o.form.category.view.render($category);
                o.form.food.view.render($food);
                o.form.hotelRating.view.render($rating);
                o.form.price.view.render($price);
                o.form.transport.view.render($transport);
                o.form.service.view.render($services, $recommendations);

                var controls = [
                    o.form.category.view,
                    o.form.food.view,
                    o.form.hotelRating.view,
                    o.form.price.view,
                    o.form.transport.view,
                    o.form.service.view,
                ];

                /* Listen extended filters for changes */
                controls.map(function(control) {
                    if('$' in control && control.$) {
                        control.$.on('os.change', function (e, param, value) {
                            self.$form.trigger('os.refreshFiltersCount', [controls]);
                        });
                    }
                });

            }

            // form container
            container.append(this.$);

            // map container
            container.append(
                $('<div>').attr('id', o.fn.prefix('os-map'))
            );


            // results container
            var result_container = container;

            var osContainer = o.settings.get('osContainer');
            var findContainer = function(container) {
                if(typeof container === 'string') {
                    var target = null;
                    if(['#','.'].indexOf(container[0]) !== -1) {
                        target = $(container);
                    } else {
                        target = $('#'+ container);
                    }

                    return target.length ? target : null;
                } else if(container instanceof jQuery) {
                    return container;
                }
            };

            if(osContainer) {
                result_container = findContainer(osContainer);
                if(result_container) {
                    o.result.view.render(result_container);
                }
                else {
                    $(function () {
                        result_container = findContainer(osContainer) || $('<div>');
                        o.result.view.render(result_container);
                    });
                }
            } else {
                o.result.view.render(result_container);
            }

            // container for tour page
            var tour_container = container;
            var osTourContainer = o.settings.get('osTourContainer');
            if(osTourContainer) {
                $(function(){
                    if(typeof osTourContainer === 'string') {
                        if(['#','.'].indexOf(osTourContainer[0]) === -1) {
                            osTourContainer = '#' + osTourContainer;
                        }
                        if($(osTourContainer).length) {
                            tour_container = $(osTourContainer);
                        }
                    } else if(osTourContainer instanceof jQuery) {
                        tour_container = osTourContainer;
                    }
                    tour_container.append(o.tour.view.$);
                });
            } else {
                tour_container.append(o.tour.view.$);
            }

            // init autocomplete #14263
            $(function(){
                o.form.location.autocompleteType = 'otpautocomplete';
                o.form.location.init({
                    'appendTo': o.form.location.view.$countryList
                });
            });
        };

        /**
         * Scroll to form container
         */
        this.scrollToForm = function(offset) {
            offset = offset || 20;

            if (self.$) {
                $('html, body').animate({
                    scrollTop: self.$.offset().top - offset
                }, 1000);
            }
        };
    };

    o.form.view = new f();

})(jQuery, otpMain);


/*********************/
/****** 	view/form/location.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 27/09/17.
 */

(function($,o){

    var f = function(){

        this.$ = undefined;
        this.$el = undefined;
        this.$dropdown = undefined;
        this.$cities = undefined;
        this.$inputMaskLabel = undefined;
        this.$countryList = undefined;

        var self = this,
            $maskCountry,
            $maskCities,
            $cities;

        // this.is_open=false;

        /**
         * Init the field
         * @param $el
         * @returns {f}
         */
        this.init = function($el){

            self.$el = $el;

            self.$el.append(
                $('<div>')
                    .addClass(o.fn.prefix('f-to-mobile-shield'))
                    .click(function() {
                        $('html')
                            .addClass(o.fn.prefix('layer-open'))
                            .addClass(o.fn.prefix('layer-open-to'));
                        $('.new_f-dropdown-container.to .new_f-dropdown-body').show();
                        $('.new_f-dropdown-container.to .new_f-autocomplete-input').otpautocomplete("search", '--');
                    })
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('f-dropdown-btn'))
                    .append(
                        self.$ = $('<input>')
                            .attr('type', 'text')
                            .attr('spellcheck', false)
                            .attr('autocomplete', 'off')
                            .attr('onwebkitspeechchange', 'onChange()')
                            .attr('speech', 'speech')
                            .attr('x-webkit-speech', 'x-webkit-speech')
                            .attr('placeholder', o._('Страна, курорт, отель'))
                            .attr('maxlength', 80)
                            .attr('id', 'location')
                            .addClass(o.fn.prefix('f-autocomplete-input'))
                            .on({
                                click: function(e){

                                    e.stopPropagation();

                                    self.$dropdown.removeClass('popup');
                                    self.$el.trigger('open');

                                    if(!$(this).val()) {
                                        $(this).otpautocomplete("search", '--');
                                    } else {
                                        $(this).otpautocomplete("search", $(this).val());
                                    }
                                },
                                keyup: function(){
                                    // o.form.location.selectedSuggest.name = '';
                                    //
                                    // if(!$(this).val()) {
                                    //     $(this).otpautocomplete("search", '--');
                                    // }
                                    $(this).trigger('click'); //#20556
                                },
                                focus: function(){
                                    // $dropdown.removeClass('popup').show();
                                    // $el.show();
                                },
                                blur: function() {

                                    //self.$inputMaskLabel.trigger('show');

                                    //$('.ui-autocomplete').removeClass('default-list');
                                }
                            })
                    ).append(
                        self.$inputMaskLabel = $('<div>')
                            .addClass(o.fn.prefix('input-mask'))
                            .append(
                                $maskCountry = $('<span>')
                                    .addClass(o.fn.prefix('input-mask-country'))
                            ).append(
                                $maskCities = $('<span>')
                                    .addClass(o.fn.prefix('input-mask-cities'))

                            )
                            // hide input mask and show input original
                            .on('click', function(){

                                if (self.$dropdown.is(':visible')) {
                                    self.$el.trigger('list_move');
                                }

                                $(this).hide();

                                var strLength = self.$.val().length * 2;
                                self.$.show().focus();
                                self.$.click();

                                self.$[0].setSelectionRange(strLength, strLength);

                                return false;
                            })
                            // show mask (only country selected) and hide input original
                            .on('refresh', function(){

                                if(+o.form.location.selectedSuggest.id > 0 && +o.form.location.selectedSuggest.id < 500) {

                                    self.$.fadeOut(200);
                                    $(this).fadeIn(200);

                                    // update cities mask
                                    $maskCities.empty();

                                    var selected_cities = 'object' === typeof o.form.city.view ? o.form.city.view.getValue() : [];

                                    if(selected_cities.length) {
                                        $maskCities.text(o.fn.suffixForNumber(selected_cities.length, [o._('курорт'),o._('курорта'),o._('курортов')], true));
                                    }

                                    // update country mask
                                    $maskCountry.text(o.form.location.currentCountry.name + ($maskCities.text().length? ':':''));
                                }
                                else {
                                    $(this).fadeOut(50, function() {
                                        self.$.fadeIn(50);
                                    });
                                }
                            })
                    ).append(
                        $('<div>')
                            .addClass('cnt')
                            .on('click', function(){

                                self.$dropdown.addClass('popup');
                                if (self.$dropdown.is(':visible')) {
                                    if ($('body').hasClass('resort-visible')) {
                                        self.$el.trigger('list_move');
                                    } else {
                                        self.$el.trigger('close');
                                    }
                                } else {
                                    self.$el.trigger('open');
                                }

                                self.$.otpautocomplete("search", '--');
                            })
                    )
            ).append(
                self.$dropdown = $('<div>')
                    .addClass(o.fn.prefix('f-dropdown-body'))
                    .append(
                        $('<div>')
                            .addClass(o.fn.prefix('f-dropdown-body-top'))
                            .append(o._('Куда'))
                            .append(
                                $('<div>')
                                    .addClass(o.fn.prefix('f-dropdown-body-close'))
                                    .addClass(o.fn.prefix('f-close-to'))
                                    .html('&times;')
                            )
                    ).append(
                        $('<div>')
                            .addClass('listsWrap')
                            .append(
                                // countries container and spinner
                                self.$countryList = $('<div>')
                                    .attr('id', 'cntList')
                                    .html('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100px" height="100px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve"><path opacity="0.2" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946 s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634 c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"></path><path d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0 C22.32,8.481,24.301,9.057,26.013,10.047z" transform="rotate(174.18 20 20)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 20 20" to="360 20 20" dur="1s" repeatCount="indefinite"></animateTransform></path></svg>')
                            ).append(
                                // cities container and spinner
                                self.$cities = $('<div>')
                                    .attr('id', 'ctyList')
                                    .html('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100px" height="100px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve"><path opacity="0.2" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946 s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634 c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"></path><path d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0 C22.32,8.481,24.301,9.057,26.013,10.047z" transform="rotate(174.18 20 20)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 20 20" to="360 20 20" dur="1s" repeatCount="indefinite"></animateTransform></path></svg>')
                            )
                    )
            // open autocomplete container
            ).on('open', function() {

                self.$dropdown.fadeIn(200);

                $('html')
                    .addClass(o.fn.prefix('layer-open'))
                    .addClass(o.fn.prefix('layer-open-to'));

            // close autocomplete container
            }).on('close', function() {

                if ($('html').hasClass(o.fn.prefix('layer-open-to'))) {
                    $('html')
                        .removeClass(o.fn.prefix('layer-open'))
                        .removeClass(o.fn.prefix('layer-open-to'));
                }

                self.$dropdown.hide();

            // move to cities list for mobile
            }).on('list_move', function(){

                $('.new_f-form .listsWrap').animate({
                    left: 0
                }, 301);
                $('body').removeClass('resort-visible');

            }).on('init', function(){

                var that = this;
                $(document).click(function (e) {
                    if(!$(e.target).hasClass('cnt') && $(e.target).attr('id') !== 'cntList' && $(e.target).attr('id') !== 'ctyList' && $(e.target).attr('id') !== 'location') {
                        if( !$(e.target).hasClass(o.fn.prefix('f-dropdown-body')) &&
                            !$(e.target).hasClass(o.fn.prefix('f-dropdown-body-top')) &&
                            !$(e.target).hasClass('listsWrap') &&
                            !$(e.target).hasClass('ui-autocomplete') &&
                            !$(e.target).hasClass('ui-menu-item') &&
                            !$(e.target).hasClass('type-item') &&
                            !$(e.target).hasClass('ui-corner-all') &&
                            !$(e.target).hasClass('price-from') &&
                            !$(e.target).hasClass('label') &&
                            !$(e.target).hasClass('clear') &&
                            !$(e.target).hasClass('ctyLists-wrapper') &&
                            !$(e.target).hasClass('resorts') &&
                            !$(e.target).hasClass('labelName') &&
                            !$(e.target).hasClass('itemPrice') &&
                            !$(e.target).hasClass('new_f-to-mobile-shield') &&
                            !$(e.target).hasClass('city-marker-input') &&
                            !$(e.target).hasClass('_select-all-cities') &&
                            !$(e.target).hasClass(o.fn.prefix('f-dropdown-body-bottom')) &&
                            !$(e.target).is('ul') &&
                            !$(e.target).is('li') &&
                            !$(e.target).is('input[type=checkbox]') &&
                            !$(e.target).is('label') &&
                            !$(e.target).is('b') )
                        {
                            $(that).trigger('close');

                            if ($(e.target).hasClass(o.fn.prefix('f-close-to'))) {
                                $(that).trigger('list_move');
                            }
                        }
                    }
                });

            }).trigger('init');

            return this;
        };

        /**
         * Render the field
         */
        this.render = function($el){

            this.init($el);

            // location parse
            o.form.setInput('t', this.$, function($o,q){
                q.i = o.form.location.selectedSuggest.id || o.hash.get('i');
            });

            return this;
        };
    };

    // Bind callback on autocomplete select
    o.form.location.bind('select',function(h,v){

        // enable datepicker
        o.form.datepicker.view.$check.hide();

        // update current geo (currentCountry, currentCity)
        o.form.location.updateCurrentGeo(v.item);

        // reset cities and show loader
        o.form.location.view.$cities.trigger('reset');

        // show cities container and loader is country selected
        if(v.item.type === 'country') {
            o.form.location.view.$cities.trigger('refresh', {'spinner': true, 'cities': []});
        }

        // load and render cities
        o.form.city.loadCities(function(cities){

            // refresh cities, hide loader and show input mask
            o.form.location.view.$cities.trigger('refresh', {'spinner': false, 'cities': cities, 'country': v.item});

            // show cities block is country selected
            if(v.item.type === 'country') {
                o.form.location.view.$.otpautocomplete("search", '--');
                o.form.location.view.$dropdown.addClass('popup');
            }

        }, (!isNaN(+o.form.location.currentCountry.id)? o.form.location.currentCountry.id: o.form.location.currentCity.id), true);

        // refresh services
        if(+o.form.location.currentCountry.id) {
            if(o.form.service.view.$) {
                o.form.service.view.refresh(o.form.location.currentCountry.id);
            }
        }

        // update available dates
        o.form.datepicker.updateDates(v.item);

        // update from cities
        o.form.fromCity.updateCities(v.item, true);

        // update transport
        var geoTransport = Boolean(v.item.transport) ? v.item.transport : null;
        geoTransport && o.form.transport.view.setValue([geoTransport]);
    });

    o.form.location.view = new f();

})(jQuery,otpMain);


/*********************/
/****** 	view/form/city.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($, o){

    var f = function() {

        this.$ = undefined;
        var self = this,
            count;

        self.selected = {
            cities: [],
            country: null,
            prev: null
        };
        self.cities = null;

        /**
         * Init the field
         * @returns {f}
         */
        this.init = function($el){
            self.$container = $el;
            $el.append(
                $('<div>')
                    .addClass('ctyLists-wrapper')
                    .append(
                        self.$ = $('<ul>')
                    )
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('f-dropdown-body-bottom'))
                    .append(
                        $('<div>')
                            .addClass(o.fn.prefix('f-dropdown-bottom-btn'))
                            .addClass(o.fn.prefix('f-dropdown-btn-cancel'))
                            .attr('data-role', 'item')
                            .text(o._('Отмена'))
                            .on('click', function(){
                                $('.new_f-form .listsWrap').animate({
                                    left: 0
                                }, 301);
                                $('body').removeClass('resort-visible');

                                // return to prev values
                                if(self.selected.prev) {
                                    self.setValue(self.selected.prev.cities);
                                }
                            })
                    ).append(
                        $('<div>')
                            .addClass(o.fn.prefix('f-dropdown-bottom-btn'))
                            .addClass(o.fn.prefix('f-dropdown-btn-apply'))
                            .attr('data-role', 'item')
                            .append(
                                $('<span>').text('ок')
                            ).append(
                                $('<span>').text(o._('Применить'))
                            ).on('click', function(){
                                $('.new_f-form .listsWrap').animate({
                                    left: 0
                                }, 301);
                                $('body').removeClass('resort-visible');

                                self.$.trigger('os.apply');
                            })
                    )
            )
            // refresh the cities and hide loader
            .on('refresh', function() {
                self.refresh.apply(this, arguments);
            })
            // reset the data and show loader
            .on('reset', function(){
                $(this).hide();
                $(this).removeClass('no-loader');
            });

            return this;
        };

        /**
         * Refresh control
         *
         * @param e
         * @param data
         */
        this.refresh = function(e, data){
            self.cities = data['cities'].filter(function(c) { return !$.isEmptyObject(c); });

            var cities = data['cities'];
            var country = data['country'];

            if(country) {
                var isNewCountry = self.selected.country && country.id !== self.selected.country.id;
                var isNoCities = !self.selected.cities;
                var isNoCountry = !self.selected.country;
                var isSelectedCitiesInNextCountry = self.selected.cities && self.selected.cities.reduce(function (result, selected) {
                    return result || cities.findIndex(function (city) {
                        return +city.id === +selected;
                    }) !== -1;
                }, false);

                self.selected.country = country;
                if(isNoCities || ((isNoCountry || isNewCountry) && !isSelectedCitiesInNextCountry)) {
                    self.selected.cities = $.map(cities, function(city) { return +city.id; }).filter(function(v) { return !!v; });
                }
            }

            /*$(this).fadeIn(200);*/
            $(this).css('display', 'block');
            $(this).animate({
                left: '253px'
            }, 200);
            $(this).addClass('no-loader');

            if(!$.isEmptyObject(cities[0])) {
                cities.unshift({}); // append first element as "select all"
            }

            count = (cities.length-1);

            var $li;
            var selected = self.selected.cities.map(function(c) { return +c; } );
            // save previous choice
            self.selected.prev = {
                country: $.extend({}, self.selected.country),
                cities: $.merge([], self.selected.cities)
            };

            self.$.empty();

            var is = true;

            // #14259 set as checked only selected city
            if(+o.form.location.selectedSuggest.id > 500 && +o.form.location.selectedSuggest.id < 5000) {
                is = false;
            }

            $.each(cities, function(i, city){

                // render first element "Select ALL"
                if(!i) {
                    $li = $('<li>').addClass('no-li-bg').append(
                        $('<label>').append(
                            $('<input>')
                                .addClass(o.fn.prefix('select-all'))
                                .attr('type', 'checkbox')
                                .prop('checked', selected.length === 0 || selected.length === count)
                                .on('change', function() {
                                    self.$.find('input').not(this).prop('checked', this.checked);
                                    if(this.checked) {
                                        self.selected.cities = $.map(cities, function(city) { return +city.id; }).filter(function(v) { return !!v; });
                                    } else {
                                        self.selected.cities = [];
                                    }

                                    // show input mask (ignore is not country selected)
                                    o.form.location.view.$inputMaskLabel.trigger('refresh');
                                })
                        ).append(
                            $('<div>')
                                .addClass('resorts clearfix')
                                .append(
                                    $('<span>')
                                        .addClass('labelName')
                                        .text(o._('Все курорты'))
                                )
                        )
                    );

                    // render city element
                } else {

                    $li = $('<li>').append(
                        $('<label>').append(
                            $('<input>')
                                .attr('type', 'checkbox')
                                .attr('value', city.id)
                                .attr('checked', selected.length === 0 || selected.length === count || selected.indexOf(+city.id) !== -1)
                                .on('change', function(e) {
                                    var city = +this.value;
                                    if(this.checked) {
                                        self.selected.cities.push(+city);
                                    }
                                    else {
                                        self.selected.cities = self.selected.cities.filter(function(value) {
                                            return value !== city;
                                        });
                                    }

                                    self.$.find('li').first().find('input').prop('checked', count === self.selected.cities.length);

                                    // show input mask (ignore is not country selected)
                                    o.form.location.view.$inputMaskLabel.trigger('refresh');
                                })
                        ).append(
                            $('<div>')
                                .addClass('resorts clearfix')
                                .append(
                                    $('<span>')
                                        .addClass('labelName')
                                        .text(city.name)
                                ).append(
                                $('<span>')
                                    .addClass('itemPrice')
                                    .html(o.fn.priceEcho(city.uah, 'uah', true, false))
                            )
                        )
                    );
                }

                // render city element
                self.$.append($li);
            });

            // toggle spinner
            if(data.spinner) {
                self.$container.find('svg').fadeIn(200);
            } else {
                self.$container.find('svg').fadeOut(100);
            }

            // show input mask (ignore is not country selected)
            o.form.location.view.$inputMaskLabel.trigger('refresh');
        };

        /**
         * Get values
         */
        this.getValue = function(as_string){
            return as_string? self.selected.cities.join(','): self.selected.cities;
        };

        /**
         * Set values
         * @param data
         */
        this.setValue = function(data){
            self.selected.cities = Array.isArray(data) ? data.map(Number) : data;
            if(typeof data === 'object' && +data[0]) {
                var $cities = self.$.find('input').not(o.fn.prefix('select-all', '.'));

                $cities.prop('checked', false).each(function (n, e) {
                    $.each(data, function (k, item) {
                        if (+$(e).val() === +item) {
                            $(e).prop('checked', true);
                        }
                    });
                });

                // update input mask
                o.form.location.view.$inputMaskLabel.trigger('refresh');
            }
        };

        /**
         * Render the field
         * @param $el
         * @returns {f}
         */
        this.render = function($el){

            this.init($el);

            o.form.setInput('tc', this.$, function($o,q){
                var value = self.getValue(false, true);
                if(self.cities && self.cities.length === value.length) {
                    value = [];
                }

                q.tc = (o.form.location.selectedSuggest.id < 500 ? value : null);
            });

            return this;
        };
    };

    o.form.city.view = new f();

})(jQuery, otpMain);

/*********************/
/****** 	view/form/fromCity.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 27/09/17.
 */

(function($, o){

    var f = function(){

        this.$ = undefined;
        this.$dropdown = undefined;
        var self = this;
        var preselectedCity = o.settings.get('osDefaultDeparture');
        var defaultCity = 1544;
        var selectedCity = null;

        /**
         * Init dept city field
         * @returns {f}
         */
        this.init = function($el){

            $el.append(
                $('<div>')
                    .addClass(o.fn.prefix('f-dropdown-btn'))
                    .attr('data-role', 'button')
                    .append(
                        $('<span>').html(o._('Из')+ '&nbsp;')
                    ).append(
                        $('<span>')
                            .addClass(o.fn.prefix('f-dropdown-btn-text'))
                            //.text('Киева')
                    ).on('click', function(){
                        $(this).show();
                    })
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('f-dropdown-body'))
                    .attr('data-role', 'body')
                    .append(
                        $('<div>')
                            .addClass(o.fn.prefix('f-dropdown-body-top'))
                            .text(o._('Отправление из'))
                            .append(
                                $('<div>')
                                    .addClass(o.fn.prefix('f-dropdown-body-close'))
                                    .attr('data-role', 'close')
                                    .html('&times;')
                            )
                    ).append(
                        self.$ = $('<div>')
                            .addClass(o.fn.prefix('f-dropdown-list'))
                    )
            );

            /*
             * Dropdown init with select callback
             */
            this.$dropdown = new o.fn.dropdown($el);

            return this;
        };

        /**
         * Refresh a field dept city
         * @param cities
         */
        this.refresh = function(cities) {
            self.$.empty();

            $.each(cities, function(k,v){
                var isSelected = selectedCity
                    ? +selectedCity === +v.id
                    : preselectedCity
                        ? +preselectedCity === +v.id || v.name === preselectedCity
                        : v.selected;

                $('<div>')
                    .addClass(o.fn.prefix('f-dropdown-item'))
                    .addClass(isSelected ? 'selected' : '')
                    .attr('data-role', 'item')
                    .attr('data-value', v.id)
                    .text(v.rel)
                    .appendTo(self.$);
            });

            // update dropdown list
            this.$dropdown.refresh();

            if(!self.$.find('div.selected').length) {
                self.setValue(defaultCity);
            }

            // update label for current city
            self.$.find('div.selected').trigger('click');
        };

        /**
         * Get current value
         * @returns {number}
         */
        this.getValue = function () {
            selectedCity = self.$.find('div.selected').length
                ? self.$.find('div.selected').attr('data-value')
                : o.hash.get('d', o.search.history.get('d', null));

            return selectedCity;
        };

        /**
         * Set values
         * @param data
         */
        this.setValue = function(data){

            self.$.find('div.selected').removeClass('selected');
            self.$.find('div[data-value="'+ data +'"]').addClass('selected');

            // update label for current city
            self.$.find('div.selected').trigger('click');
        };

        /**
         * Set region priority cities
         *
         * @param cities
         */
        this.setPriorityValues = function(cities) {
            self.$.data('priority-cities', cities);
        };

        /**
         * Set value from priorit cities
         */
        this.selectPriorityCity = function() {
            var priorityCities = self.$.data('priority-cities');
            for(var index in priorityCities) {
                var city = priorityCities[index];
                self.setValue(city);
                if(city === +self.getValue()) {
                    break;
                }
            }
        };

        /**
         * Return city info by cityId
         * @param cityId
         * @returns {{}}
         */
        this.getCityFromId = function(cityId){
            var city = {};
            $.each(o.config.citiesFrom, function(i, item){
                if(+cityId === item.id) {
                    city = item;
                    return false;
                }
            });
            return city;
        };

        /**
         * Get default city
         *
         * @returns {{}}
         */
        this.getDefault = function() {
            return this.getCityFromId(defaultCity);
        };

        /**
         * Render the field
         */
        this.render = function($el){

            this.init($el);
            o.form.fromCity.updateCities({"id": o.hash.get("i", 0)});

            o.form.setInput('d', this.$, function($o,q){
                q.d = self.getValue();
            });

            return this;
        };
    };

    o.form.fromCity.view = new f();

})(jQuery,otpMain);

/*********************/
/****** 	view/form/regions.js	 ***********/
/*********************/
/**
 * Created by vshevtsov on 27.10.16.
 */

(function($, o){

    o.form.regions.view = new function(){

        var self = this;

        /**
         * Init a field regions
         */
        this.init = function($el) {

            self.$ = $('<select>')
                .css('display', 'none')
                .appendTo($el);

            self.refresh();
        };

        /**
         * Refresh a field regions
         */
        this.refresh = function() {

            // get regions from cache
            o.form.regions.loadData(function(regions){

                self.$.empty();

                // render regions
                $.each(regions, function(i, item){

                    self.$.append(
                        $('<option>')
                            .text(item.name)
                            .val(item.id)
                            .data('dept', item.deptCities)
                            .attr('selected', item.IPselected)
                    );

                })
            });
        };

        /**
         * Render a field regions
         * @param $el
         */
        this.render = function($el) {

            self.init($el);

            o.form.setInput('f', this.$, function($o,q){
                q.f = 1; //$o.val();
            });
        }
    };

})(jQuery, otpMain);

/*********************/
/****** 	view/form/tourDuration.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 27/09/17.
 */

(function($, o) {
    var f = function() {

        this.$ = undefined;
        this.$dropdown = undefined;
        var defaultValue = o.settings.get('osDefaultDuration',7);
        var self = this;

        /**
         * Init the field
         * @param $el
         * @returns {f}
         */
        this.init = function($el) {

            $el.append(
                $('<div>')
                    .addClass(o.fn.prefix('f-dropdown-btn'))
                    .attr('data-role', 'button')
                    .append('на ')
                    .append(
                        $('<span>')
                            .addClass(o.fn.prefix('f-dropdown-btn-text'))
                    )
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('f-dropdown-body'))
                    .attr('data-role', 'body')
                    .append(
                        $('<div>')
                            .addClass('new_f-dropdown-body-top')
                            .text('Длительность')
                            .append(
                                $('<div>')
                                    .addClass(o.fn.prefix('f-dropdown-body-close'))
                                    .attr('data-role', 'close')
                                    .html('&times;')
                            )
                    ).append(
                        self.$ = $('<div>')
                            .addClass(o.fn.prefix('f-dropdown-list'))
                    )
            );

            /*
             * Dropdown init with select callback
             */
            this.$dropdown = new o.fn.dropdown($el);

            self.refresh();

            return this;
        };

        /**
         * Refresh a field
         * @param duration
         */
        this.refresh = function(duration) {

            var curPeriod = +self.getValue();
            self.$.empty();

            var options = {},
                selected = false;

            for(var i in o.config.duration) {
                if(o.config.duration.hasOwnProperty(i)) {

                    var val = o.config.duration[i].value;

                    if(!$.isEmptyObject(duration) && !o.fn.in_array(val, duration)) {
                        continue;
                    }

                    var opt = $('<div>')
                        .addClass(o.fn.prefix('f-dropdown-item'))
                        .attr('data-role', 'item')
                        .attr('data-value', val)
                        .append(o.config.duration[i].rel)
                        .append(
                            $('<span>')
                                .addClass(o.fn.prefix('f-duration-days'))
                                .append(' / '+ o.config.duration[i].label)
                        );

                    if(curPeriod === val) {
                        selected = true;
                        opt.addClass('selected');
                    }

                    options[val] = opt;
                }
            }

            if(!selected) {
                if(options[8]) {
                    options[8].addClass('selected');
                } else if(options[6]) {
                    options[6].addClass('selected');
                } else {
                    var $last = o.fn.getFirst(options);
                    if($last) {
                        $last.addClass('selected');
                    }
                }
            }

            $.each(options, function(k,opt){
                opt.appendTo(self.$);
            });

            // update dropdown list
            this.$dropdown.refresh();
            
            // update label for current duration
            self.$.find('div.selected').trigger('click');
        };

        /**
         * Get current value
         * @returns {number}
         */
        this.getValue = function(){
            return self.$.find('div.selected').length
                ? self.$.find('div.selected').attr('data-value')
                : o.hash.get('l', o.search.history.get('l', defaultValue));
        };

        /**
         * Set values
         * @param data
         */
        this.setValue = function(data){
            self.$.find('div.selected').removeClass('selected');
            self.$.find('div[data-value="'+ data +'"]').addClass('selected');

            // update label for current duration
            self.$.find('div.selected').trigger('click');
        };

        /**
         * Set default selected value
         * @param val
         */
        this.setDefaultValue = function(val) {
            defaultValue = val
        };

        /**
         * Render the field
         * @param $el
         * @returns {f}
         */
        this.render = function($el){

            this.init($el);

            o.form.setInput('l', this.$, function($o,q){
                q.l = self.getValue();
            });

            return this;
        };
    };
    o.form.duration.view = new f();

})(jQuery, otpMain);

/*********************/
/****** 	view/form/hotelCategory.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($, o){
    var f = function() {

        this.$ = undefined;
        this.param = 'st';
        var self = this;

        /**
         * Init the field
         * @returns {f}
         */
        this.init = function($el){

            $el.append(
                $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-title'))
                    .text(o._('Категория отеля'))
            ).append(
                self.$ = $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-body'))
                    .on('init', function(){

                        var that = this;
                        $.each(o.config.category, function(i, item){

                            $(that).append(
                                $('<label>').append(
                                    $('<input>')
                                        .attr('type', 'checkbox')
                                        .attr('value', item.value)
                                        .on('change', function(e) { self.$.trigger('os.change', [ 'st', self.getValue()]); })
                                        .on('change', function(e) {
                                            var inputs = self.$.find('input[type=checkbox]');
                                            o.fn.combineCheckboxesGroup(inputs, this.checked ? 'up' : 'down');
                                            o.form.category.call('select', self.getValue());
                                        })
                                ).append(
                                    $('<span>').append(item.label +'*')
                                )
                            );
                        });

                    }).trigger('init')
            );

            return this;
        };

        /**
         * Get values
         */
        this.getValue = function(){
            return $.map(self.$.find('input:checkbox:checked'), function(item){
                return $(item).val();
            });
        };

        /**
         * Set values
         * @param data
         */
        this.setValue = function(data){
            if(typeof data === 'object') {
                self.$.find('input').prop('checked', false).each(function(i, item){
                    if(data.indexOf($(item).val()) !== -1) {
                        $(item).prop('checked', true);
                    }
                });

                self.$.trigger('os.change', ['st', data]);
            }
        };

        /**
         * Convert one to 1*, two to 2*...
         * @param starsRaw
         * @param flag
         * @returns {*}
         */
        this.printStars = function(starsRaw, flag){
            var stars = {
                '1': '1*',
                '2': '2*',
                '3': '3*',
                '4': '4*',
                '5': '5*',
                '4+': 'hv2',
                '5+': 'hv1',
                'one': '1*',
                'two': '2*',
                'three': '3*',
                'four': '4*',
                'five': '5*',
                'hv1': 'hv1',
                'hv2': 'hv2'
            };

            if(flag) {
                return stars[starsRaw.toString()].replace('*', '');
            }
            return stars[starsRaw.toString()].toUpperCase();
        };

        /**
         * Render the field
         * @param $el
         * @returns {f}
         */
        this.render = function($el){

            this.init($el);

            o.form.setInput('st',this.$,function($o,q){
                q.st = self.getValue();
            });

            return this;
        }
    };

    o.form.category.view = new f();

})(jQuery, otpMain);

/*********************/
/****** 	view/form/food.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($, o){

    var f = function() {

        this.$ = undefined;
        this.param = 'o';
        var self = this;

        /**
         * Init the field
         * @returns {f}
         */
        this.init = function($el){

            $el.append(
                $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-title'))
                    .text(o._('Питание'))
            ).append(
                self.$ = $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-body'))
                    .on('init', function(){

                        var that = this;
                        $.each(o.config.food, function(i, item){
                            $(that).append(
                                $('<label>').append(
                                    $('<input>')
                                        .attr('type', 'checkbox')
                                        .attr('value', item.value)
                                        .attr('title', item.description)
                                        .on('change', function(e) { self.$.trigger('os.change', [ 'o', self.getValue()]); })
                                        .on('change', function(e) {
                                            var inputs = self.$.find('input[type=checkbox]');
                                            o.fn.combineCheckboxesGroup(inputs, this.checked ? 'up' : 'down')
                                        })
                                ).append(
                                    $('<span>').append(item.label)
                                )
                            );
                        });

                    }).trigger('init')
            );

            return this;
        };

        /**
         * Get values
         */
        this.getValue = function(){
            return $.map(self.$.find('input:checkbox:checked'), function(item){
                return $(item).val();
            });
        };

        /**
         * Set values
         * @param data
         */
        this.setValue = function(data){
            if(typeof data === 'object') {
                self.$.find('input').prop('checked', false).each(function(i, item){
                    if(data.indexOf($(item).val()) !== -1) {
                        $(item).prop('checked', true);
                    }
                });

                self.$.trigger('os.change', ['o', data]);
            }
        };

        /**
         * Return food info (label,value,description)
         * @param food
         * @returns {{}}
         */
        this.getFoodInfo = function(food){
            var info = {};
            $.each(o.config.food, function(i, item){
                if(item.value === food.toLowerCase()) {
                    info = item;
                    return false;
                }
            });
            return info;
        };

        /**
         * Render the field
         * @param $el
         * @returns {f}
         */
        this.render = function($el){

            this.init($el);

            o.form.setInput('o', this.$, function($o,q){
                q.o = self.getValue();
            });

            return this;
        };
    };

    o.form.food.view = new f();

})(jQuery, otpMain);

/*********************/
/****** 	view/form/transport.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($, o){
    var f = function(){

        this.$ = undefined;
        this.param = 'r';
        var self = this;

        /**
         * Init the field
         * @returns {f}
         */
        this.init = function($el){

            $el.append(
                $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-title'))
                    .text('Транспорт')
            ).append(
                self.$ = $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-body'))
                    .on('init', function(){

                        var that = this;
                        $.each(o.config.transport, function(i, item){
                            $(that).append(
                                $('<label>').append(
                                    $('<input>')
                                        .attr('name', 'transport')
                                        .attr('type', 'radio')
                                        .attr('value', item.value)
                                        .on('change', function() {
                                            self.$.trigger('os.change', [ 'r', self.getValue()]);
                                        })
                                ).append(
                                    $('<span>').append(item.label)
                                )
                            );
                        });

                    }).trigger('init')
            );

            return this;
        };

        /**
         * Get values
         */
        this.getValue = function(){
            return $.map(self.$.find('input:radio:checked'), function(item){
                return $(item).val();
            });
        };

        /**
         * Set values
         * @param data
         */
        this.setValue = function (data) {
            var newValue = typeof data === 'object' ? o.fn.getFirst(data) : data;

            if (newValue && self.$) {
                self.$.find('input[value=' + newValue + ']').prop('checked', true);
                self.$.trigger('os.change', ['r', newValue]);
            }
        };

        /**
         * Return transport description
         * @param transport
         * @param flag
         * @returns {*}
         */
        this.getTransportText = function(transport, flag){
            if(!transport) transport = o.form.transport.view.getValue().toString();

            switch(transport) {
                case 'air':
                    if(flag) return o._('Авиаперелет');
                    return ', '+ o._('с авиаперелетом');
                    break;
                case 'bus':
                    if(flag) return 'Автобус';
                    return ', '+ o._('переезд на автобусе включен');
                    break;
                case 'train':
                    if(flag) return o._('Поезд');
                    return ', '+ o._('переезд на ж/д включен');
                    break;
                case 'trainbus':
                    if(flag) return o._('Поезд') +' + Автобус';
                    return ', '+ o._('переезд на ж/д и автобусе включен');
                    break;
                case 'ship':
                    if(flag) return o._('Паром');
                    return ', '+ o._('переезд на пароме включен');
                    break;
                case 'no':
                    if(flag) return o._('Без транспорта');
                    return ', '+ o._('без транспорта');
                    break;
            }
        };

        this.getTransportIcon = function (transport) {
            switch (transport) {
                case 'air':
                    return '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 489.6 310.93"><path d="M299.82,49.46l-95.06-5.06a6.08,6.08,0,0,0-3.19.72L149.21,73.37a6,6,0,0,0-1.79,9.16l26.94,32.59a6.5,6.5,0,0,1,.83-.55Zm0,0"></path><path d="M487.4,15.72l-.15-.3C483.49,8.39,475,0,455.9,0,435.81,0,414,9.12,413,9.51,360,30.62,110.67,161.85,110.67,161.85L50.95,129.67a6,6,0,0,0-5.66,0l-42,22a6,6,0,0,0-1.15,9.93l102.75,88.82a6,6,0,0,0,6.74.79l100.34-52.35,15.18,107a6,6,0,0,0,8.84,4.47c10.66-5.73,17.32-9.37,23.76-12.88S273,290.06,284,284.16a6.06,6.06,0,0,0,2.65-2.84l71.41-158.84,73.4-38.32c34.32-17.43,67-44.56,55.93-68.43Zm0,0"></path></svg>'
                case 'bus':
                    return '<svg class="new_r-item-icon" data-name="bus-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 344 410.4"><path d="M329.6,62.4q-4-16.8-13.6-25.6t-28-16q-18.4-8-52.8-14.4T172.4,0Q144,0,109.6,6.4T56.8,20.8q-18.4,7.2-28,16T16,62.4L0,190.4V368.8H24.8v16q0,16,10,22.4t20.4,0q10.4-6.4,10.4-22.4v-16H270.4v16q0,16,12.4,22.4t24.4,0q12-6.4,12-22.4v-16H344V190.4ZM87.2,30.8q3.2-6,11.2-6h152c5.94,0,12,4.18,12,8.51v8c0,4-5.27,7.49-12,7.49H98.4q-8,0-11.2-6a12.05,12.05,0,0,1,0-12h0ZM28.8,187.2L42.4,89.6q1.6-8,13.6-8H290.4q12,0,13.6,8l13.6,99.2a13.09,13.09,0,0,1,.8,3.2,11.81,11.81,0,0,1-4,9.2,14.93,14.93,0,0,1-10.4,3.6H42.4A13.72,13.72,0,0,1,28,190.4a7.08,7.08,0,0,1,.8-3.2h0ZM71.2,306.8a26.4,26.4,0,0,1-18.8,7.6,26.4,26.4,0,0,1-18.8-7.6,25.16,25.16,0,0,1,0-36.8,27,27,0,0,1,37.6,0,25.16,25.16,0,0,1,0,36.8h0Zm241.6,0a27.06,27.06,0,0,1-37.6,0,25.16,25.16,0,0,1,0-36.8,27.05,27.05,0,0,1,37.6,0,25.16,25.16,0,0,1,0,36.8h0Zm0,0"/></svg>';
                case 'train':
                    return '<svg class="new_r-item-icon" data-name="train-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 293.65 411.31"><path d="M272.52,455H83.38c-26.82,0-45.13,0-45.13,30.85V725c0,45.81,20.23,45.81,45.13,46.3H95l-66.3,95h35l47.57-64.71,130.53,0.07,46,64.64h34.56l-65.39-95h15.55c33,0,32-25,32-46.3V485.85c0-21.28-10.74-30.85-32-30.85h0ZM130.8,478.12a7.69,7.69,0,0,1,7.72-7.68h67.74a7.67,7.67,0,0,1,7.69,7.68v15.45a7.71,7.71,0,0,1-7.69,7.72H138.53a7.74,7.74,0,0,1-7.72-7.72V478.12Zm-54,57.34c0-17.78,8.91-18.77,21.68-18.77H253.08c12.81,0,16.61,3.59,16.61,18.77v81.68c0,29.61,1.1,37.15-16.61,37.15H101.5c-20.56.15-24.68,2-24.68-24.15V535.46Zm23.4,201.11a24.6,24.6,0,1,1,24.6-24.6,24.57,24.57,0,0,1-24.6,24.6h0Zm146.61,0a24.6,24.6,0,1,1,24.6-24.6,24.58,24.58,0,0,1-24.6,24.6h0Zm0,0" transform="translate(-28.72 -455)"/></svg>';
                case 'ship':
                    return '<svg xmlns="http://www.w3.org/2000/svg"><path d="M66.38,85.56H256.21a10.67,10.67,0,0,0,10.64-10.64V50.11a10.67,10.67,0,0,0-10.64-10.64H93.4c-5.85,0-12.89,4.23-15.64,9.39l-17,27.31c-2.75,5.16-.22,9.39,5.64,9.39Zm8.79-17.86,8.26-10.35a14.18,14.18,0,0,1,11.35-6.82H224.84a7.74,7.74,0,0,1,7.72,7.72v8.54a7.74,7.74,0,0,1-7.72,7.72H79.26c-4.25,0-6.09-3.06-4.09-6.81Zm0,0"/><path class="cls-1" d="M114.79,33.41h125a7,7,0,0,0,7-7V7a7,7,0,0,0-7-7H132.58a12.87,12.87,0,0,0-10.3,6.18l-11.21,21c-1.81,3.4-.14,6.18,3.71,6.18Zm0,0"/><path d="M285.89,92H8.83c-7.65,0-11,5.53-7.39,12.29l38,61.78c3.59,6.75,12.78,12.29,20.44,12.29H254.61c7.65,0,16-5.9,18.55-13.11l22-60.12c2.55-7.21-1.62-13.11-9.27-13.11Zm-197,45.07A13.11,13.11,0,1,1,102,124a13.11,13.11,0,0,1-13.11,13.11Zm38.6,0A13.11,13.11,0,1,1,140.59,124a13.11,13.11,0,0,1-13.12,13.11Zm38.6,0A13.11,13.11,0,1,1,179.19,124a13.12,13.12,0,0,1-13.12,13.11Zm38.6,0A13.11,13.11,0,1,1,217.79,124a13.11,13.11,0,0,1-13.11,13.11Zm38.6,0A13.11,13.11,0,1,1,256.39,124a13.11,13.11,0,0,1-13.12,13.11Zm0,0"/></svg>';
                default:
                    return '<svg class="new_r-item-icon" data-name="no-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 228.52 407.65"><path d="M540.8,507.08A36,36,0,1,1,587,528.42a36,36,0,0,1-46.2-21.34h0Zm0,0" transform="translate(-452.79 -458.66)"/><path class="cls-1" d="M469,838c-8.67,27.31,33.66,40.56,42.34,13.27,14.24-44.68,27.18-87.24,39-138.62,3.12,3.4,32.69,36.62,59.77,58.77,2.69,25.35,7.38,51.66,10,76.95,3,28.48,46.72,20.75,43.71-7.55q-4.18-39.83-8.4-79.69a23.23,23.23,0,0,0-1.63-6.2c-0.36-5.62-4.31-9.69-9.78-15-21-20.6-35-41.6-62.13-63.89,2.72-21.94,5.91-35.78,9.38-57.57,25.29,17,50.72,43.86,71.72,40.86,26.88-3.84,22.26-32-1.5-44.88-33.5-18.12-40.5-28.12-70.05-53.55-16-13.8-44.56-27.17-61.74-15.05-0.61.23-29.72,26.48-55.34,47.38-19.66,16-18.9,55.44-21.42,77-3.13,26.83,38.24,34.29,41.37,7.37q2.9-25.07,5.83-50.12c8.83-10.15,13.83-13.15,16.3-22.91-5.26,20.78-9.41,69.42-9.24,72.09C504.37,692.69,487.16,763.13,469,838h0Zm0,0M591.45,560.89c-16-13.8-35.45-29.58-61.74-15.05" transform="translate(-452.79 -458.66)"/></svg>';
            }
        };

        /**
         * Render the field
         * @param $el
         * @returns {f}
         */
        this.render = function($el){

            this.init($el);

            o.form.setInput('r',this.$,function($o,q){
                q.r = self.getValue();
            });

            return this;
        };
    };

    o.form.transport.view = new f();

})(jQuery, otpMain);

/*********************/
/****** 	view/form/service.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($, o){
    var f = function(){

        this.$ = undefined;
        this.param = 'e';
        var self = this;
        var _initialValues = null;
        var _$inputs = $([]);
        var forbiddenServices = ['tz'];

        /**
         * Init the field
         * @returns {f}
         */
        this.init = function($services, $recommendations){

            $services.append(
                $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-title'))
                    .text(o._('Услуги'))
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-body'))
                    .append(
                        self.$ = $('<div>')
                            .addClass(o.fn.prefix('f-services-label-wrap'))
                    )
            );

            $recommendations && $recommendations.append(
                $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-title'))
                    .text(o.config.serviceLabels['recommendService'])
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-body'))
                    .append(
                        self.$recommendations = $('<div>')
                            .addClass(o.fn.prefix('f-services-label-wrap'))
                    )
            );

            // refresh the services
            self.refresh();

            return this;
        };

        /**
         * Refresh services field #10360
         * @param countryId
         */
        this.refresh = function(countryId){

            // load services
            o.form.service.getServices(countryId, function(services){
                if(typeof o.form.service.view.$ !== 'undefined') {
                    if(!countryId || Object.keys(services).length == 2) { // only "api_version" and "time"
                        _initialValues = null;
                    }
                }

                var selection = self.getValue();

                self.$.empty();
                self.$recommendations.empty();
                _$inputs = $([]);

                $.each(services, function(name, items){
                    if(!(name in o.config.serviceLabels)) {
                        return;
                    }

                    var $container;
                    var type;
                    var $group;
                    switch (name) {
                        case 'promoService':
                        case 'recommendService':
                            $container = self.$recommendations;
                            type = 'checkbox';
                            $group = null;
                            break;
                        default:
                            $container = self.$;
                            type = 'checkbox';
                            $group = $('<div>')
                                .addClass(o.fn.prefix('f-services-label'))
                                .append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('f-label-name'))
                                        .text(o.config.serviceLabels[name])
                                );
                            break;
                    }

                    // render items
                    $.each(items, function (key, label) {
                        if(forbiddenServices.indexOf(key) !== -1) {
                            return 0;
                        }

                        var $input;

                        $('<label>')
                            .append(
                                $input = $('<input>')
                                    .attr('type', type)
                                    .attr('name', name)
                                    .attr('checked', selection.indexOf(key) != -1)
                                    .on('change', function(e) {
                                        self.$.trigger('os.change', [ 'e', self.getValue()]);
                                        if($(this).attr('name') == 'recommendService') {
                                            var checked = $(this).is(':checked');
                                            $("[name=recommendService]").prop('checked',false);
                                            if(checked) {
                                                $(this).prop('checked',true);
                                            }
                                        }
                                    })
                                    .val(key)
                            ).append(
                            $('<span>').text(label)
                        ).appendTo($group || $container);

                        _$inputs = _$inputs.add($input);
                    });

                    $container.append($group);
                });

                $.each([self.$recommendations, self.$], function(index, $container) {
                    $container.children().length === 0
                        ? $container.closest(o.fn.prefix('f-ext-bl', '.')).hide()
                        : $container.closest(o.fn.prefix('f-ext-bl', '.')).show();
                });
            });
        };

        /**
         * Get values
         */
        this.getValue = function(){
            return $.merge(self.getChecked(), self.getInitial());
        };

        this.getInitial = function() {
            if(_initialValues) {
                var checked = self.getChecked();

                _initialValues = _initialValues.filter(function (s) { return checked.indexOf(s) === -1; })
            }

            return _initialValues || [];
        };

        this.getChecked = function() {
            return $.map(_$inputs.filter(':checked'), function(item){
                return $(item).val();
            });
        };

        /**
         * Set values
         * @param data
         */
        this.setValue = function(data){
            if(typeof data === 'object') {
                _$inputs.prop('checked', false).each(function(i, item){
                    if(data.indexOf($(item).val()) != -1) {
                        $(item).prop('checked', true);
                    }
                });

                if(!_initialValues) {
                    _initialValues = data;
                }

                self.$.trigger('os.change', ['e', data]);
            }
        };

        /**
         * Hide specific service
         * @param services
         */
        this.hideService = function(service) {
            forbiddenServices.push(service);
        };

        /**
         * Allow specific services
         * @param service
         */
        this.allowService = function(service) {
            forbiddenServices = forbiddenServices.filter(function(s) {
                return s !== service;
            });
        };

        /**
         * Get forbidden services
         * @returns {string[]}
         */
        this.getForbiddenServices = function() {
            return forbiddenServices;
        };

        /**
         * Render the services field
         * @param $services
         * @param $recommendations
         * @returns {f}
         */
        this.render = function($services, $recommendations){

            this.init($services, $recommendations);

            o.form.setInput('e', this.$, function($o,q){
                q.e = self.getValue();
            });

            return this;
        };
    };

    o.form.service.view = new f();

})(jQuery, otpMain);


/*********************/
/****** 	view/form/hotelRating.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($, o){
    var f = function(){

        this.$ = undefined;
        this.param = 'rt';
        var self = this,
            $rangeFrom,
            $rangeTo,
            $rangeSlider;

        /**
         * Init slider
         * @param sl
         * @param a
         */
        this.slide = function(sl, a) {

            sl.eSlider.slider({
                orientation: "horizontal",
                range: 'min',
                value: +a[0],
                min: 4,
                max: 10,
                step: 1,
                slide: function( event, ui ) {

                    sl.rangeFrom.val(ui.value);
                    sl.rangeTo.val(10);

                    self.$.trigger('os.change', ['rt', ui.value]);

                    //self.selectData([ui.value, 10]);
                },
                stop: function( event, ui){}
            }).draggable();

            sl.rangeFrom.val(+a[0]);
            sl.rangeTo.val(+a[1]);

            //this.selectData(a);
        };

        /**
         * Init the field
         * @returns {f}
         */
        this.init = function($el){

            $el.append(
                $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-title'))
                    .append(o._('Оценки отеля'))
                    .append(
                        $('<span>').text(o._('по отзывам на Турправде'))
                    )
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-body'))
                    .append(
                        self.$ = $('<div>')
                            .addClass('slider-container')
                            .append(
                                $rangeFrom = $('<input>')
                                    .attr('type', 'hidden')
                                    .attr('value', 4)
                            ).append(
                                $rangeTo = $('<input>')
                                    .attr('type', 'hidden')
                                    .attr('value', 10)
                            ).append(
                                $rangeSlider = $('<div>')
                            ).append(
                                $('<div>')
                                    .attr('style', 'clear: both;')
                            ).append(
                                $('<div>')
                                    .addClass(o.fn.prefix('f-ext-scale clearfix'))
                                    .on('init', function(){

                                        var that = this;
                                        $.each(o.config.hotelRating, function(i, item){
                                            $(that).append(
                                                $('<div>')
                                                    .addClass(o.fn.prefix('f-ext-scale-item'))
                                                    .append(item.label)
                                            );
                                        });

                                    }).trigger('init')
                            )
                    )
            );

            // init the slider
            self.slide({
                eSlider: $rangeSlider,
                rangeFrom: $rangeFrom,
                rangeTo: $rangeTo
            }, [4, 10]);

            return this;
        };

        /**
         * get range Values
         * @returns {Array}
         */
        this.getValue = function() {
            var a = [$rangeFrom.val(), $rangeTo.val()];
            var ret = [];
            if(+a[0] === o.config.hotelRating[0].value){
                ret[0] = 0
            } else {
                ret[0] = +a[0];
            }
            ret[1] = +a[1];
            return ret;
        };

        /**
         * Set values
         * @param a
         */
        this.setValue = function(a) {

            if(isNaN(+a[0]) || +a[0] > 10) {
                a[0] = 0;
            }

            if(isNaN(a[1]) || +a[1] > 10) {
                a[1] = 10;
            }

            this.slide({
                eSlider: $rangeSlider,
                rangeFrom: $rangeFrom,
                rangeTo: $rangeTo
            }, a);

            self.$.trigger('os.change', ['rt', a]);
        };

        /**
         * Render the field
         * @param $el
         * @returns {f}
         */
        this.render = function($el){

            this.init($el);

            o.form.setInput('rf',this.$,function($o,q){
                q.rt = self.getValue();
            });

            return this;
        };
    };

    o.form.hotelRating.view = new f();

})(jQuery, otpMain);

/*********************/
/****** 	view/form/price.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($, o){

    var f = function(){

        this.$ = undefined;
        this.param = ['pf', 'pt']
        this.defaultpriceRange = o.config.priceRange.ua;
        var self = this,
            $priceFrom,
            $priceTo,
            $priceSlider,
            $priceRange = [o.config.priceRange.ua[0], o.config.priceRange.ua[1]];

        /**
         * Init slider
         * @param m
         * @param a
         */
        this.slide = function(m, a) {
            m.eSlider.slider({
                orientation: "horizontal",
                range: true,
                values: a,
                min: o.config.priceRange.ua[0],
                max: o.config.priceRange.ua[1],
                step: 100,
                slide: function( event, ui ) {
                    m.priceFrom.val(ui.values[0]);
                    m.priceTo.val(ui.values[1]);

                    $priceRange = ui.values;

                    self.$.trigger('os.change', ['pf', ui.values]);
                }
            });

            m.priceFrom.val(a[0]);
            m.priceTo.val(a[1]);
        };

        /**
         * set price value after input value changes
         */
        var selectValueFromInput = function(){
            var val1, val2;

            var from = parseInt($priceFrom.val());
            var to = parseInt($priceTo.val());
            if(!from) {
                from = self.defaultpriceRange[0]
            }
            if(!to) {
                to = self.defaultpriceRange[1]
            }
            if(from >= to){
                if(to === 0) {
                    val2 = self.defaultpriceRange[1];
                } else {
                    val1 = to;
                    val2 = from;
                }
            } else {
                val1 = from;
                val2 = to;
            }
            if(val1 <= self.defaultpriceRange[0]) {
                val1 = self.defaultpriceRange[0];
            }
            if(val2 >= self.defaultpriceRange[1]) {
                val2 = self.defaultpriceRange[1]
            }

            $priceSlider.slider({ values: [ val1, val2] });
            $priceFrom.val(val1);
            $priceTo.val(val2);
            $priceRange = [val1, val2];
        };

        /**
         * Init the field
         * @returns {f}
         */
        this.init = function($el){

            $el.append(
                $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-title'))
                    .append(o._('Цена, грн'))
                    .append(
                        $('<span>')
                            .text(o._('за всех туристов'))
                    )
            ).append(
                self.$ = $('<div>')
                    .addClass(o.fn.prefix('f-ext-bl-body'))
                    .append(
                        $('<div>')
                            .addClass('slider-container')
                            .append(
                                $priceFrom = $('<input>')
                                    //.attr('type', 'hidden')
                                    .attr('readonly', 'readonly')
                                    .attr('value', 4)
                            ).append(
                                $priceTo = $('<input>')
                                    //.attr('type', 'hidden')
                                    .attr('readonly', 'readonly')
                                    .attr('value', 10)
                            ).append(
                                $priceSlider = $('<div>')
                            )
                    )
            );

            // init the slider
            this.slide({
                eSlider: $priceSlider,
                priceFrom: $priceFrom,
                priceTo: $priceTo
            }, $priceRange);

            //this.$.on('change', '#priceFrom, #priceTo', selectValueFromInput);

            return this;
        };

        /**
         * get price Values
         * @returns {Array}
         */
        this.getValue = function() {
            var a =[];
            if($priceRange[0] === o.form.price.view.defaultpriceRange[0]){
                a[0] = o.form.price.view.defaultpriceRange[0];
            } else {
                a[0] = $priceRange[0];
            }

            if($priceRange[1] === o.form.price.view.defaultpriceRange[1]){
                a[1] = o.form.price.view.defaultpriceRange[1];
            } else {
                a[1] = $priceRange[1];
            }

            return a;
        };

        /**
         * Set values
         * @param a
         * @returns {boolean}
         */
        this.setValue = function(a){

            for(var i in a) {
                if(a.hasOwnProperty(i)) {

                    if(!a[i]||!(a[i]>=this.defaultpriceRange[0] && a[i]<=this.defaultpriceRange[1])) {
                        a[i] = this.defaultpriceRange[i];
                    }
                }
            }

            a = a.sort(function(a,b){return a - b});

            this.slide({
                eSlider: $priceSlider,
                priceFrom: $priceFrom,
                priceTo: $priceTo
            }, a);

            selectValueFromInput();

            self.$.trigger('os.change', ['pf', a]);
        };

        /**
         * Render the field
         * @param $el
         * @returns {f}
         */
        this.render = function($el){

            this.init($el);

            o.form.setInput('pf', this.$, function($o,q){
                var a = self.getValue();

                q.pf = a[0];
                q.pt = a[1];
            });

            return this;
        }
    };

    o.form.price.view = new f();

})(jQuery, otpMain);

/*********************/
/****** 	view/form/datepicker.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 27/09/17.
 */

(function($, o){
    var f = function(){

        this.$ = undefined;
        this.$check = undefined;
        this.$dateFirst = undefined;
        this.$dateSecond = undefined;
        this.$dateFirstLabel = undefined;
        this.$dateSecondLabel = undefined;
        this.$dropdown = undefined;
        this.$info = undefined;
        this.dateFirst = undefined;
        this.dateSecond = undefined;
        this.max_rendered_day = false;
        this.min_rendered_day = false;
        this.min_length = 0;

        var now = new Date();
        var defaultMin = new Date(now.getTime() + (1*24*60*60*1000)); // +1 day
        var defaultFrom = new Date(now.getTime() + (7*24*60*60*1000)); // +7 days
        var defaultTo = new Date(defaultFrom.getTime() + (14*24*60*60*1000)); // default to (from +14 days)

        var self = this,
            $container,
            $datepicker;

        /**
         * get the datepicker values
         * @returns {Array}
         */
        this.getValue = function(){

            if(!self.dateFirst.date) {
                self.dateFirst.date = o.hash.get('c')? new Date(o.hash.get('c')): defaultFrom;
            } else if(self.dateFirst.date.valueOf() < now.valueOf()) {
                self.dateFirst.date = defaultFrom;
            }

            if(!self.dateSecond.date || o.fn.getDatesDiff(self.dateSecond.date, self.dateFirst.date, 'D') > 14) {
                if(o.hash.get('v')){
                    self.dateSecond.date = new Date(o.hash.get('v'));
                } else if(self.dateFirst.date){
                    self.dateSecond.date = defaultTo;
                }
            }

            self.checkSecondDate(self.dateSecond.date);

            // #12635
            if(!self.$dateFirst.datepicker('getDate') || o.form.datepicker.getTextDate(self.$dateFirst.datepicker('getDate'), {parts:['yyyy', 'mm', 'dd']}, '-') !== o.form.datepicker.getTextDate(self.dateFirst.date, {parts:['yyyy', 'mm', 'dd']}, '-')) {
                self.$dateFirst.datepicker('setDate', self.dateFirst.date);
            }
            if(!self.$dateSecond.datepicker('getDate') || o.form.datepicker.getTextDate(self.$dateSecond.datepicker('getDate'), {parts:['yyyy', 'mm', 'dd']}, '-') !== o.form.datepicker.getTextDate(self.dateSecond.date, {parts:['yyyy', 'mm', 'dd']}, '-')) {
                self.$dateSecond.datepicker('setDate', self.dateSecond.date);
            }

            return [o.form.datepicker.getTextDate(self.dateFirst.date, {parts:['yyyy', 'mm', 'dd']}, '-'),
                o.form.datepicker.getTextDate(self.dateSecond.date, {parts:['yyyy', 'mm', 'dd']}, '-')];
        };

        /**
         * Set values
         * @param dates
         */
        this.setValue = function(dates){
            if(self.dateFirst && self.dateSecond){

                var dateFrom = new Date(dates[0]);
                var secondDate = new Date(dates[1]);

                dateFrom = o.fn.normalizeDateTimezone(dateFrom);
                secondDate = o.fn.normalizeDateTimezone(secondDate);

                if(secondDate.valueOf() < dateFrom.valueOf()) {
                    secondDate = defaultTo;
                }

                self.$dateFirst.datepicker('setDate', dateFrom);
                self.$dateFirst.next().text($.datepicker.formatDate('d M', dateFrom));
                self.dateFirst.date = dateFrom;

                self.$dateSecond.datepicker('setDate', secondDate);
                self.$dateSecond.next().text($.datepicker.formatDate('d M', secondDate));
                self.dateSecond.date = secondDate;
            }
        };

        this.settings = {
            dateFirst: {
                dateFormat: 'yy-mm-dd',
                minDate: +1,
                showOn: 'button',
                buttonText: o._('с'),
                numberOfMonths: [ 1, 2 ],
                stepMonths: 1,
                rangeSelect: true,
                beforeShow: function(input, inst) {

                    $('#new_os-to .new_f-dropdown-body').hide();

                    $('html').addClass(o.fn.prefix('layer-open')).addClass(o.fn.prefix('date-open'));

                    self.$dateFirst.datepicker('option', 'showCurrentAtPos', 0);

                    var dates = o.form.datepicker.getDates(),
                        nowDate = new Date(),
                        minDate = new Date(dates[0]);

                    self.max_rendered_day = false;
                    self.min_rendered_day= false;

                    if(minDate.valueOf() > nowDate.valueOf()) {
                        self.$dateFirst.datepicker("option", "minDate", minDate); // #6659
                    }

                    $datepicker = self.$dateFirst.datepicker( "widget" );

                    /* Prepare datepicker dialog for mobile screens */
                    if(o.fn.isMobile() && $datepicker.length) {
                        var dates = o.form.datepicker.getDates();
                        var firstAvailableDate, lastAvailableDate;
                        var selectedDate = self.dateFirst && self.dateFirst.date ? self.dateFirst.date : minDate;

                        if(dates.length) {
                            firstAvailableDate = new Date(dates[0]);
                            lastAvailableDate = new Date(dates[dates.length - 1]);
                        }
                        else {
                            firstAvailableDate = new Date();
                            lastAvailableDate = new Date();
                            lastAvailableDate.setMonth(lastAvailableDate.getMonth() + 12);
                        }
                        var dpPosition = o.fn.getDatesDiff(selectedDate, firstAvailableDate, 'M');

                        o.form.datepicker.view.$dateFirst.datepicker('option', 'numberOfMonths', [Math.max(2, o.fn.getDatesDiff(lastAvailableDate, firstAvailableDate, 'M') + 1), 1]);
                        o.form.datepicker.view.$dateFirst.datepicker('option', 'showCurrentAtPos', dpPosition);

                        /* Scroll to target position */
                        if (dpPosition) {
                            $datepicker.off('os.rendered');
                            $datepicker.on('os.rendered', function() {
                                var currentDpMonth = $datepicker.find('.ui-datepicker-group').eq(dpPosition);
                                if (currentDpMonth.length) {
                                    var dpHeaderOffset = 0;
                                    dpHeaderOffset += $(document).scrollTop();
                                    dpHeaderOffset += +self.$.find(o.fn.prefix('f-dropdown-body-top', '.')).height();
                                    dpHeaderOffset += +self.$.find('.mobile-calendar-days').height();

                                    $datepicker.scrollTop(currentDpMonth.offset().top - dpHeaderOffset);
                                }
                            });
                        }
                    }

                    $container.fadeIn(100, function() {
                        $datepicker.trigger('os.rendered');
                    });
                    self.$dropdown
                        .fadeIn(100)
                        .removeClass(o.fn.prefix('second_calendar_open'))
                        .addClass(o.fn.prefix('first_calendar_open'));
                    self.$dropdown
                        .append($datepicker)
                        .append(self.$info);

                    self.$dateFirst.datepicker("option", "defaultDate", self.dateFirst.date);
                    self.$dateFirst.next().text($.datepicker.formatDate('d M', self.$dateFirst.datepicker('getDate')));

                    if(!o.fn.isMobile()) {
                        self.$dropdown
                            .off('mouseenter')
                            .on('mouseenter', 'td[data-year]', function () {
                                var dateFirst = o.form.datepicker.view.dateFirst.date;
                                var dateSecond = o.form.datepicker.view.dateSecond.date;

                                if (dateSecond) {
                                    var from = Date.UTC($(this).data('year'), $(this).data('month'), $(this).text());
                                    var to = dateSecond ? Date.UTC(dateSecond.getFullYear(), dateSecond.getMonth(), dateSecond.getDate()) : null;

                                    self.$dropdown.find('td[data-year]')
                                        .removeClass('ui-datepicker-current-day')
                                        .removeClass('ui-state-active')
                                        .removeClass('ui-state-highlight');

                                    $.each(self.$dropdown.find('td[data-year]'), function (k, v) {
                                        var cell = Date.UTC($(v).data('year'), $(v).data('month'), $(v).text());

                                        if (from <= cell && cell <= to && from < to) {
                                            if (cell === from) {
                                                $(v)
                                                    .addClass('ui-state-active')
                                                    .addClass('ui-state-highlight-left');
                                            }
                                            if (cell === to) {
                                                $(v)
                                                    .addClass('ui-state-highlight')
                                                    .addClass('ui-state-active')
                                                    .addClass('ui-state-highlight-right');
                                            }
                                            else {
                                                $(v).addClass('ui-state-highlight');
                                            }
                                        }
                                    });

                                    // update info text
                                    self.$info && self.$info.trigger('refresh', [new Date(from), dateSecond]);
                                }
                            })
                            .off('mouseleave')
                            .on('mouseleave', self.resetDatepickerDatesTable);
                    }
                },
                beforeShowDay: function(date) {

                    var dates = o.form.datepicker.getDates(),
                        curFrom = self.dateFirst.date && o.fn.cloneDate(self.dateFirst.date),
                        curTo = self.dateSecond.date && o.fn.cloneDate(self.dateSecond.date),
                        minDate = new Date(dates[0]),
                        maxDate = new Date(dates[dates.length-1]);

                    if(!self.min_rendered_day) {
                        self.min_rendered_day = date.getTime();
                    }
                    self.max_rendered_day = date.getTime();

                    curFrom = curFrom? curFrom.setHours(0,0,0,0): false;
                    curTo = curTo? curTo.setHours(0,0,0,0): false;
                    minDate.setHours(0,0,0,0);
                    maxDate.setHours(0,0,0,0);

                    if (date.valueOf() < minDate.valueOf() || date.valueOf() > maxDate.valueOf()) {
                        return [false];
                    }

                    var cls = 'ceil';

                    if(curFrom && curFrom.valueOf() === date.valueOf()) {
                        cls+= ' ui-state-active';
                    }

                    if(curTo && curTo.valueOf() === date.valueOf()) {
                        cls+= ' ui-state-active';
                    }

                    if(curTo && curFrom && date.valueOf() >= curFrom.valueOf()
                        && date.valueOf() <= curTo.valueOf()) {
                        cls+= ' ui-state-highlight';
                    }

                    // mark as yes/no tours
                    if($.inArray(o.fn.formatDate(date), dates) !== -1) {
                        cls+= o.fn.prefix('ceil-tours-exists',' ');
                    } else {
                        cls+= o.fn.prefix('ceil-no-tours',' ');
                    }

                    return [true, cls];
                },
                onSelect: function(d) {
                    var selectedDate = new Date(d);

                    if ( $(o.fn.prefix('check-mobile','.')).is(':visible') ) {  // #13994
                        $('#ui-datepicker-div').scrollTop(5);
                    }

                    var dates = o.form.datepicker.getDates();
                    var curTo = self.dateSecond.date;
                    var secondDate = new Date(selectedDate.getTime()+(14*24*60*60*1000)); // +14 days
                    var newSecondDate = false;

                    self.dateFirst.date = selectedDate;
                    self.$dateFirst.next().text($.datepicker.formatDate('d M', selectedDate));

                    // set second date
                    if(curTo && (curTo.valueOf() > secondDate.valueOf()
                        || curTo.valueOf() < selectedDate.valueOf())) {
                        newSecondDate = secondDate;
                    }

                    // check if second date is available
                    self.checkSecondDate(secondDate);

                    //self.$dateFirst[0].setSelectionRange(0,0);
                    //self.$dateSecond[0].setSelectionRange(0,0);

                    var duration = o.form.datepicker.getDurationNew(self.dateFirst.date, self.dateSecond.date);

                    o.form.duration.view.refresh(duration);

                    self.$dateSecond.datepicker("option", "minDate", selectedDate);
                    //self.$dateSecond.datepicker("option", "dateFormat", "yy-mm-dd");

                    // show the second date
                    setTimeout(function(){
                        if(newSecondDate) {
                            self.$dateSecond.datepicker('setDate', secondDate);
                            self.$dateSecond.next().text($.datepicker.formatDate('d M', secondDate));
                            self.dateSecond.date = secondDate;
                        }

                        self.$dateSecond.datepicker('show');

                        jQuery('.calendar-tip').slideDown(1000);
                    }, 150);

                    $('html').addClass(o.fn.prefix('layer-open')).addClass(o.fn.prefix('date-open'));

                    self.$info && self.$info.trigger('refresh', [selectedDate, self.dateSecond.date]);
                }
            },
            dateSecond: {
                dateFormat:'yy-mm-dd',
                numberOfMonths: [ 1, 2 ], // 1 ряд по 2 мес.
                stepMonths: 1.5,
                showOn: 'button',
                buttonText: 'по',
                rangeSelect: true,
                beforeShow: function(input, inst) {

                    $('#new_os-to .new_f-dropdown-body').hide();

                    $('html').addClass(o.fn.prefix('layer-open')).addClass(o.fn.prefix('date-open'));

                    var dateNow = new Date();
                    if(self.dateFirst.date && self.dateFirst.date.valueOf() > dateNow.valueOf()) {
                        self.$dateSecond.datepicker("option", "minDate", self.dateFirst.date);
                    }
                    var maxDate = new Date(self.dateFirst.date);
                    maxDate.setDate(maxDate.getDate() + 14);
                    var selectedDate = self.$dateSecond.datepicker('getDate');
                    if (selectedDate > maxDate) {
                        self.dateSecond.date = maxDate;
                        selectedDate = maxDate;
                    }
                    self.dateSecond.date = selectedDate;
                    self.$dateSecond.next().text($.datepicker.formatDate('d M', selectedDate));

                    $datepicker = self.$dateSecond.datepicker( "widget" );

                    $container.fadeIn(100);
                    self.$dropdown
                        .fadeIn(100)
                        .removeClass(o.fn.prefix('first_calendar_open'))
                        .addClass(o.fn.prefix('second_calendar_open'));
                    self.$dropdown.append($datepicker).append(self.$info);

                    /* Show always whole range on second datepicker */
                    if(self.dateFirst.date && self.dateSecond.date) {
                        o.form.datepicker.view.$dateSecond.datepicker('option', 'showCurrentAtPos', o.fn.getDatesDiff(self.dateSecond.date, self.dateFirst.date, 'M'));
                    }

                    if(!o.fn.isMobile()) {
                        self.$dropdown
                            .off('mouseenter')
                            .on('mouseenter', 'td[data-year], td.ui-state-disabled', function () {
                                var dateFirst = o.form.datepicker.view.dateFirst.date;

                                if (dateFirst) {
                                    var current = $(this).data('year') ? Date.UTC($(this).data('year'), $(this).data('month'), $(this).text()) : null;
                                    var max = Date.UTC(maxDate.getFullYear(), maxDate.getMonth(), maxDate.getDate()).valueOf();

                                    var from = dateFirst ? Date.UTC(dateFirst.getFullYear(), dateFirst.getMonth(), dateFirst.getDate()) : null;
                                    var to = current ? current : max;

                                    self.$dropdown.find('td[data-year]')
                                        .removeClass('ui-datepicker-current-day')
                                        .removeClass('ui-state-active')
                                        .removeClass('ui-state-highlight');

                                    $.each(self.$dropdown.find('td[data-year]'), function (k, v) {
                                        var cell = Date.UTC($(v).data('year'), $(v).data('month'), $(v).text());

                                        if (from <= cell && cell <= to) {
                                            if (cell === from) {
                                                $(v).addClass('ui-state-active');
                                            }
                                            if (cell === to) {
                                                $(v)
                                                    .addClass('ui-state-highlight')
                                                    .addClass('ui-state-active')
                                                    .addClass('ui-datepicker-current-day');
                                            }
                                            else {
                                                $(v).addClass('ui-state-highlight');
                                            }
                                        }

                                    });

                                    // update info text
                                    self.$info && self.$info.trigger('refresh', [dateFirst, new Date(to)]);
                                }
                            })
                            .off('mouseleave')
                            .on('mouseleave', self.resetDatepickerDatesTable);
                    }
                },
                beforeShowDay: function(date) {
                    var dates = o.form.datepicker.getDates(),
                        curFrom = self.dateFirst.date && o.fn.cloneDate(self.dateFirst.date),
                        curTo = self.dateSecond.date && o.fn.cloneDate(self.dateSecond.date),
                        minDate = new Date(dates[0]),
                        maxDate = new Date(dates[dates.length-1]);
                    curFrom = curFrom? curFrom.setHours(0,0,0,0): false;
                    curTo = curTo? curTo.setHours(0,0,0,0): false;
                    minDate.setHours(0,0,0,0);
                    maxDate.setHours(0,0,0,0);

                    var dateTo;
                    if(curFrom) {
                        dateTo = new Date(curFrom.valueOf()); // +14 days
                        dateTo.setDate(dateTo.getDate() + 15);
                    } else {
                        curFrom = minDate;
                        dateTo = maxDate;
                    }
                    if(date.valueOf() < curFrom.valueOf() || date.valueOf() >= dateTo.valueOf() || date.valueOf() > maxDate.valueOf()) {
                        return [false, 'ceil-max-date'];
                    }

                    var cls = 'ceil';

                    if(curFrom && curFrom.valueOf() === date.valueOf()) {
                        cls+= ' ui-state-active ui-current-from';
                    }

                    if(curTo && curTo.valueOf() === date.valueOf()) {
                        cls+= ' ui-state-active';
                    }

                    if(curTo && curFrom && date.valueOf() >= curFrom.valueOf()
                        && date.valueOf() <= curTo.valueOf()) {
                        cls+= ' ui-state-highlight';
                    }

                    if(curFrom && o.fn.getDatesDiff(date, new Date(curFrom), 'D') < self.min_length) {
                        return [false, cls];
                    }

                    // mark as yes/no tours
                    if($.inArray(o.fn.formatDate(date), dates) !== -1) {
                        cls+= o.fn.prefix('ceil-tours-exists',' ');
                    } else {
                        cls+= o.fn.prefix('ceil-no-tours',' ');
                    }

                    return [true, cls];
                },
                onSelect: function(d) {
                    var selectedDate = new Date(d);
                    var firstPlusTwoWeeks = new Date(self.dateFirst.date);
                    firstPlusTwoWeeks.setDate(firstPlusTwoWeeks.getDate() + 14);
                    if ( $('.new_check-mobile').is(':visible') ) { // #13994
                        $('#ui-datepicker-div').scrollTop(5);
                    }
                    if (selectedDate.getTime() > firstPlusTwoWeeks.getTime()) {
                        selectedDate = firstPlusTwoWeeks;
                    }
                    self.dateSecond.date = selectedDate;
                    self.$dateSecond.next().text($.datepicker.formatDate('d M', selectedDate));

                    var duration = o.form.datepicker.getDurationNew(self.dateFirst.date, self.dateSecond.date);
                    o.form.duration.view.refresh(duration);

                    $('html').addClass(o.fn.prefix('layer-open')).addClass(o.fn.prefix('date-open'));

                    self.$info && self.$info.trigger('refresh', [self.dateFirst.date, selectedDate]);
                },
                onClose: function() {
                    self.$dropdown.fadeOut(50);
                    $container.fadeOut(50);
                    $('html').removeClass(o.fn.prefix('layer-open')).removeClass(o.fn.prefix('date-open'))
                }
            }
        };

        /**
         * Init the field
         * @returns {f}
         */
        this.init = function($el){

            $el.append(
                self.$ = $('<div>')
                    .addClass(o.fn.prefix('f-dates-container'))
                    .addClass(o.fn.prefix('f-dropdown-container'))
                    .attr('id', o.fn.prefix('f-dates-container'))
                    .append(
                        $('<span>')
                            .addClass(o.fn.prefix('f-search-dates-popup'))
                            .addClass(o.fn.prefix('f-tip-active'))
                            .text(o._('Начало тура'))
                    ).append(
                        $('<div>')
                            .addClass(o.fn.prefix('f-search-dates-wrap clearfix'))
                            .append(
                                '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 381.86 390.52"><g><path d="M138,215.45a8.86,8.86,0,0,0-8.86-8.86H98.16a8.86,8.86,0,0,0-8.86,8.86v30.92a8.86,8.86,0,0,0,8.86,8.86h30.93a8.86,8.86,0,0,0,8.86-8.86Zm0,0"></path><path d="M215.26,215.45a8.86,8.86,0,0,0-8.86-8.86H175.46a8.86,8.86,0,0,0-8.86,8.86v30.92a8.86,8.86,0,0,0,8.86,8.86H206.4a8.86,8.86,0,0,0,8.86-8.86Zm0,0"></path><path d="M292.57,215.45a8.86,8.86,0,0,0-8.86-8.86H252.77a8.86,8.86,0,0,0-8.86,8.86v30.92a8.86,8.86,0,0,0,8.86,8.86h30.93a8.86,8.86,0,0,0,8.86-8.86Zm0,0"></path><path d="M138,292.76a8.86,8.86,0,0,0-8.86-8.86H98.16a8.86,8.86,0,0,0-8.86,8.86v30.92a8.86,8.86,0,0,0,8.86,8.86h30.93a8.86,8.86,0,0,0,8.86-8.86Zm0,0"></path><path d="M215.26,292.76a8.86,8.86,0,0,0-8.86-8.86H175.46a8.86,8.86,0,0,0-8.86,8.86v30.92a8.86,8.86,0,0,0,8.86,8.86H206.4a8.86,8.86,0,0,0,8.86-8.86Zm0,0"></path><path d="M292.57,292.76a8.86,8.86,0,0,0-8.86-8.86H252.77a8.86,8.86,0,0,0-8.86,8.86v30.92a8.86,8.86,0,0,0,8.86,8.86h30.94a8.86,8.86,0,0,0,8.86-8.86Zm0,0"></path><path d="M347.88,43.48V90.72a38.59,38.59,0,0,1-38.67,38.56H284.81a38.78,38.78,0,0,1-38.9-38.56V43.31H136V90.72a38.78,38.78,0,0,1-38.9,38.56H72.66A38.58,38.58,0,0,1,34,90.72V43.48a35.16,35.16,0,0,0-34,35V355.31a35.18,35.18,0,0,0,35,35.21H346.86a35.22,35.22,0,0,0,35-35.21V78.46a35.16,35.16,0,0,0-34-35ZM336.54,338.07a15.13,15.13,0,0,1-15.13,15.13H59.78a15.14,15.14,0,0,1-15.13-15.13v-143a15.14,15.14,0,0,1,15.13-15.14H321.41a15.14,15.14,0,0,1,15.13,15.14Zm0,0"></path><path d="M72.57,104H96.7A13.25,13.25,0,0,0,110,90.7V13.26A13.26,13.26,0,0,0,96.7,0H72.57A13.26,13.26,0,0,0,59.31,13.26V90.7A13.25,13.25,0,0,0,72.57,104Zm0,0"></path><path d="M284.5,104h24.13A13.25,13.25,0,0,0,321.89,90.7V13.26A13.26,13.26,0,0,0,308.63,0H284.5a13.26,13.26,0,0,0-13.26,13.26V90.7A13.25,13.25,0,0,0,284.5,104Zm0,0"></path></g></svg>'
                            ).append(
                                $('<div>')
                                    .addClass(o.fn.prefix('f-datepicker-wrap'))
                                    .addClass(o.fn.prefix('f-datepicker-wrap-1'))
                                    .append(
                                        self.$dateFirst = $('<input>')
                                            .css('display', 'none')
                                    )
                            ).append(
                                $('<div>')
                                    .addClass(o.fn.prefix('f-datepicker-wrap'))
                                    .addClass(o.fn.prefix('f-datepicker-wrap-2'))
                                    .append(
                                        self.$dateSecond = $('<input>')
                                            .css('display', 'none')
                                    )
                            )
                    ).append(
                        $container = $('<div>')
                            .addClass(o.fn.prefix('f-dropdown-body'))
                            .addClass(o.fn.prefix('f-dropdown-body-date'))
                            .append(
                                $('<div>')
                                    .addClass(o.fn.prefix('f-dropdown-body-top'))
                                    .text(o._('Начало тура'))
                                    .append(
                                        $('<div>')
                                            .addClass(o.fn.prefix('f-dropdown-body-close'))
                                            .attr('data-role', 'close')
                                            .html('&times;')
                                            .on('click', function(){
                                                self.$dropdown.fadeOut(50);
                                                $container.fadeOut(50);
                                                $('html').removeClass(o.fn.prefix('layer-open')).removeClass(o.fn.prefix('date-open'));
                                            })
                                    )
                            ).append(
                                self.$dropdown = $('<div>')
                                    .addClass('dp-container clearfix')
                            ).append(
                                $('<div>')
                                    .addClass('mobile-calendar-days')
                                    .append(
                                        $('<div>')
                                            .addClass('calendar-tip')
                                            .text(o._('Выберите конец интервала дат'))
                                    )
                                    .append($('<div>').addClass('mobile-calendar-day').text('Пн'))
                                    .append($('<div>').addClass('mobile-calendar-day').text('Вт'))
                                    .append($('<div>').addClass('mobile-calendar-day').text('Ср'))
                                    .append($('<div>').addClass('mobile-calendar-day').text('Чт'))
                                    .append($('<div>').addClass('mobile-calendar-day').text('Пт'))
                                    .append($('<div>').addClass('mobile-calendar-day').text('Сб'))
                                    .append($('<div>').addClass('mobile-calendar-day').text(o._('Вс')))
                                    .hide()
                            )
                    )
            ).append(
                self.$check = $('<div>')
                    .addClass(o.fn.prefix('os-date-check'))
                    .addClass(o.fn.prefix('f-dropdown-container'))
                    .attr('id', o.fn.prefix('os-date-check'))
                    .css('display', o.settings.get('osGeo') && o.settings.get('osGeo').length > 2? 'none': '') // #14318
                    .append(
                        $('<div>')
                            .addClass(o.fn.prefix('f-dropdown-btn'))
                            .attr('data-role', 'button')
                    ).append(
                        $('<div>')
                            .addClass(o.fn.prefix('f-dropdown-body'))
                            .attr('data-role', 'body')
                            .text(o._('Сначала заполните поле «Страна, курорт, отель»'))
                    )
            );

            self.$info = self.getSelectedDatesAndDurationInfo();

            /**
             * Init the first date
             * @type {*|{version}}
             */
            self.dateFirst = self.$dateFirst.datepicker(self.settings.dateFirst);

            /**
             * Init the second date
             * @type {*|{version}}
             */
            self.dateSecond = self.$dateSecond.datepicker(self.settings.dateSecond);


            /**
             * Process dom ready actions
             */
            $(function() {

                /* Set jquery datepicker locales on dom ready */
                var locale = $.datepicker.regional[''];
                switch (o.lang) {
                    case "ukr":
                    case "ua":
                        if('uk' in $.datepicker.regional) {
                            locale = $.datepicker.regional['uk'];
                        }
                        break;
                    case "rus":
                    case "ru":
                        if('ru' in $.datepicker.regional) {
                            locale = $.datepicker.regional['ru'];
                        }
                    default:
                }

                $.datepicker.setDefaults(locale);
                /* Refresh text */
                self.refresh();

                /* Add dropdown event listeners */
                $(window).click(function(e) {
                    var container = $('.new_f-dropdown-body.new_f-dropdown-body-date');

                    if(container.get(0).contains(e.target) || e.target.hasAttribute('data-handler')) {
                        e.stopPropagation(); e.preventDefault();
                    }
                    else {
                        container.hide();
                    }
                })
            });

            /*
             * Dropdown init with select callback
             */
            var $dropdown = new o.fn.dropdown($el);

            return this;
        };

        /**
         * Render the field
         * @param $el
         * @returns {f}
         */
        this.render = function($el){

            this.init($el);

            /* Check search history */
            if(o.search.history.get('c', '') && o.search.history.get('v', '')) {
                o.form.datepicker.view.setValue([o.search.history.get('c'), o.search.history.get('v')]);
            }

            o.form.setInput('c',this.$,function($o,q){
                q.c = self.getValue()[0];
                q.v = self.getValue()[1];
            });

            return this;
        };

        /**
         * Check second date and interval max+14 days
         * @param secondDate
         */
        this.checkSecondDate = function(secondDate) {
            var dates = o.form.datepicker.getDates();
            if(self.dateSecond.date && dates.length > 2 && $.inArray(o.fn.formatDate(self.dateSecond.date), dates) === -1) {
                var i;
                for(i=0; i<15; i++) {
                    var nextDate = new Date(secondDate.valueOf() - (86400000 * i));
                    if($.inArray(o.fn.formatDate(nextDate), dates) !== -1) {
                        self.$dateSecond.datepicker('setDate', nextDate);
                        self.dateSecond.date = nextDate;
                        break;
                    }
                }
            }
        };

        this.getSelectedDatesAndDurationInfo = function() {
            return null
        };

        this.resetDatepickerDatesTable = function() {
            var dateFirst = o.form.datepicker.view.dateFirst.date;
            var dateSecond = o.form.datepicker.view.dateSecond.date;

            if(dateFirst) {
                var maxDate = new Date(dateFirst.valueOf());
                maxDate.setDate(dateFirst.getDate() + 14);

                var from = Date.UTC(dateFirst.getFullYear(), dateFirst.getMonth(), dateFirst.getDate());
                var to = dateSecond ? dateSecond : maxDate;
                to = Date.UTC(to.getFullYear(), to.getMonth(), to.getDate());

                self.$dropdown.find('td[data-year]')
                    .removeClass('ui-state-active')
                    .removeClass('ui-state-highlight');

                $.each(self.$dropdown.find('td[data-year]'), function (k, v) {
                    var cell = Date.UTC($(v).data('year'), $(v).data('month'), $(v).text());

                    if (from <= cell && cell <= to) {
                        if (cell === from) {
                            $(v)
                                .addClass('ui-state-active')
                                .addClass('ui-state-highlight')
                                .addClass('ui-state-highlight-left');
                        }
                        else if (cell === to) {
                            $(v)
                                .addClass('ui-state-active')
                                .addClass('ui-state-highlight')
                                .addClass('ui-state-highlight-right')
                                .addClass('ui-datepicker-current-day');
                        }
                        else {
                            $(v).addClass('ui-state-highlight');
                        }
                    }
                });

                // update info text
                self.$info && self.$info.trigger('refresh', [dateFirst, dateSecond]);
            }
        };

        /**
         * Refresh dates
         */
        this.refresh = function() {
            if(this.dateFirst.date && this.dateSecond.date) {
                this.setValue(this.getValue());
            }
        }
    };

    o.form.datepicker.view = new f();

})(jQuery, otpMain);

/*********************/
/****** 	view/form/people.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 28/09/17.
 */

(function($,o){

    var f = function(){

        this.$ = undefined;
        var self = this,
            $label,
            $peoples,
            $childrens,
            $childrenContainer,
            $buttonChildren,

            maxPeople = 9,
            maxAdults = 8,
            maxChildren = 4,
            maxChildAge = 18;

        /**
         * Init the field
         */
        this.init = function($el){

            $el.append(
                $('<div>')
                    .addClass(o.fn.prefix('f-dropdown-btn'))
                    .attr('data-role', 'button')
                    .append(
                        $label = $('<span>')
                            .addClass(o.fn.prefix('f-dropdown-btn-text'))
                    )
            ).append(
                self.getPeopleSelectDropdownBody()
                    .addClass(o.fn.prefix('f-dropdown-body'))
                    .attr('data-role', 'body')
            ).append(
                self.$ = $('<input>')
                    .attr('type', 'hidden')
                    .attr('name','people')
                    .on('update', function(){

                        // get selected people & childrens
                        var peoples = self.getValue();

                        // update input value
                        $(this).val(peoples);

                        // update label
                        $label.html(self.getText(peoples));

                        // update buttons
                        adults = +$peoples.attr('data-value');
                        children = +$childrens.attr('data-count');

                        var currentMaxChildren =  Math.min(maxChildren, maxPeople - adults);
                        var currentMaxAdults = Math.min(maxAdults, maxPeople - children);

                        currentMaxChildren <= children
                            ? $buttonChildren.addClass('disabled')
                            : $buttonChildren.removeClass('disabled');

                        $peoples
                            .find('[data-value]')
                            .show()
                            .filter(function (i, el) { return el.dataset.value > currentMaxAdults; })
                            .hide();
                    })
            );

            /*
             * Dropdown init with select callback
             */
            this.$dropdown = new o.fn.dropdown($el);

            return this;
        };

        this.getPeopleSelectDropdownBody = function () {
            var $el,
                _$people,
                _$buttonChildren,
                _$childrenContainer,
                _$children;

            $el = $('<div>')
                .append(
                    $('<div>').addClass(o.fn.prefix('f-dropdown-body-wrap'))
                        .append(
                            $('<div>')
                                .addClass(o.fn.prefix('f-dropdown-body-top'))
                                .text(o._('Туристы'))
                                .append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('f-dropdown-body-close'))
                                        .attr('data-role', 'close')
                                        .html('&times;')
                                )
                        ).append(
                        $('<div>')
                            .addClass(o.fn.prefix('f-dropdown-list'))
                            .append(
                                $('<div>')
                                    .addClass(o.fn.prefix('f-people-container'))
                                    .append(
                                        $('<div>')
                                            .addClass(o.fn.prefix('f-people-title'))
                                            .text(o._('Количество взрослых:'))
                                    ).append(
                                    _$people = $('<div>')
                                        .addClass(o.fn.prefix('f-people-list clearfix'))
                                        .append(o.fn.range(1, maxAdults).map(function (v) {
                                            return $('<div>').attr('data-value', v).addClass(o.fn.prefix('f-people-item people-' + v)).text(v);
                                        }))
                                        .on('click', '*', function () {
                                            var adults = $(this).data('value');
                                            $peoples.find('div').removeClass('active');
                                            $peoples.find('div[data-value=' + adults + ']').addClass('active');

                                            self.$.trigger('update');
                                        })
                                        .on('get_value', function () { // get peoples
                                            $peoples.attr('data-value', $peoples.find('div.active').attr('data-value'));
                                        })
                                    )
                            ).append(
                            $('<div>')
                                .addClass(o.fn.prefix('f-children-container'))
                                .append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('f-people-title'))
                                        .text(o._('Дети:'))
                                ).append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('f-children-accordion-wrap'))
                                        .append(
                                            _$buttonChildren = $('<div>')
                                                .addClass(o.fn.prefix('f-children-accordion-btn'))
                                                .text(o._('Добавить ребёнка'))
                                                .on('click', function () {
                                                    if ($(this).is(':not(.disabled)')) {
                                                        $(this).toggleClass('active');
                                                    }
                                                })
                                        ).append(
                                        _$childrenContainer = $('<div>')
                                            .addClass(o.fn.prefix('f-children-accordion-body clearfix'))
                                            .on('init', function () {

                                                var that = this;
                                                $.each(o.fn.range(1, maxChildAge), function (i) {
                                                    i++;
                                                    $(that).append(
                                                        $('<div>')
                                                            .addClass(o.fn.prefix('f-children-age-item'))
                                                            .addClass(o.fn.prefix('f-children-age-item-' + i))
                                                            .attr('data-value', i)
                                                            .append(i)
                                                            .append(
                                                                $('<div>').text(o.fn.suffixForNumber(i, [o._('год'), o._('года'), o._('лет')]))
                                                            ).on('click', function () {

                                                                $childrens.trigger('get_value');

                                                                if (+$childrens.attr('data-count') < maxChildren) {
                                                                    $childrens.append(
                                                                        $('<div>')
                                                                            .addClass(o.fn.prefix('f-children-list-item'))
                                                                            .addClass(o.fn.prefix('f-children-list-item-' + $(this).attr('data-value')))
                                                                            .attr('data-value', $(this).attr('data-value'))
                                                                            .attr('data-id', Date.now())
                                                                            .append($(this).html())
                                                                            .on('click', function () {
                                                                                $(this).fadeOut('fast', function () {
                                                                                    var id = $(this).attr('data-id');
                                                                                    $childrens.find('[data-id=' + id + ']').remove();
                                                                                    self.$.trigger('update');
                                                                                })
                                                                            })
                                                                    );
                                                                }

                                                                $buttonChildren.removeClass('active');
                                                                self.$.trigger('update');
                                                            })
                                                    )
                                                });

                                            }).trigger('init')
                                    )
                                ).append(
                                _$children = $('<div>')
                                    .addClass(o.fn.prefix('f-children-list clearfix'))
                                    .on('get_value', function () { // get children

                                        var children = '',
                                            count = 0;
                                        $.each($(this).find('div' + o.fn.prefix('f-children-list-item', '.')), function (i, item) {
                                            var age = $(item).attr('data-value');
                                            if (+age) {
                                                count += 1;
                                                if (age.toString().length === 1) {
                                                    children += '0' + age;
                                                } else {
                                                    children += age;
                                                }
                                            }
                                        });

                                        $childrens
                                            .attr('data-value', children)
                                            .attr('data-count', count);
                                    })
                            )
                        )
                    ).append(
                        $('<div>')
                            .addClass(o.fn.prefix('f-dropdown-body-bottom'))
                            .append(
                                $('<div>')
                                    .addClass(o.fn.prefix('f-dropdown-bottom-btn'))
                                    .addClass(o.fn.prefix('f-dropdown-btn-cancel'))
                                    .addClass(o.fn.prefix('not-label-change'))
                                    .attr('data-role', 'close')
                                    .text(o._('Отмена'))
                            ).append(
                            $('<div>')
                                .addClass(o.fn.prefix('f-dropdown-bottom-btn'))
                                .addClass(o.fn.prefix('f-dropdown-btn-apply'))
                                .addClass(o.fn.prefix('not-label-change'))
                                .attr('data-role', 'item')
                                .text(o._('Применить'))
                        )
                    )
                );

            $peoples = typeof $peoples === 'undefined' ? _$people : $peoples.add(_$people);
            $childrenContainer = typeof $childrenContainer === 'undefined' ? _$childrenContainer : $childrenContainer.add(_$childrenContainer);
            $buttonChildren = typeof $buttonChildren === 'undefined' ? _$buttonChildren : $buttonChildren.add(_$buttonChildren);
            $childrens = typeof $childrens === 'undefined' ? _$children : $childrens.add(_$children);

            return $el;
        };

        /**
         * parse string of children
         * @param {String} st
         * @return {Array}
         */
        this.parseChildren = function(st){
            var c = [];
            for(var i = 0; i < (st.length/2); i++){
                if(i >= maxChildren){
                    break;
                }
                var ct = parseInt(st.substr(i*2,2));
                if(ct){
                    c.push(ct);
                }
            }
            return c;
        };

        /**
         * Return peoples text
         * @param st
         * @param is_full
         * @returns {string}
         */
        this.getText = function(st, is_full, pre){

            if(st){
                st = st.toString();
                var people = +st.substr(0,1);
                var children = self.parseChildren(st.substr(1));
            } else {
                var people = $peoples.attr('data-value');
                var children = $childrens.attr('data-value');
            }

            var str,
                str_full = '',
                children = +$childrens.attr('data-count');

            var dict = {
                'long': [o._('взрослый'), o._('взрослых'), o._('взрослых')],
                'short': [o._('взр.'), o._('взр.'), o._('взр.')],
                'pre': [o._('взрослого'), o._('взрослых'), o._('взрослых')]
            };

            str = o.fn.suffixForNumber(
                +people,
                children
                    ? dict['short']
                    : pre ? dict['pre'] : dict['long'],
                true
            );
            switch (+people){
                case 1:
                    str_full += 'один';
                    break;
                case 2:
                    str_full += o._('вдвоем');
                    break;
                case 3:
                    str_full += o._('втроем');
                    break;
                default:
                    str_full += o._('вчетвером');
                    break;
            }

            switch (children){
                case 0:
                    str_full += o._(', без детей');
                    break;
                case 1:
                    str += o._(' + 1 дет.');
                    str_full += o._(' + 1 ребенок');
                    break;
                default:
                    str += ' + '+ children + o._(' дет.');
                    str_full += ' + '+ children + o._(' детей');
                    break;
            }

            if(is_full) return str_full;
            return str;
        };

        /**
         * Print peoples in tour page
         * @param st
         * @returns {string}
         */
        this.printPeoples = function(st){
            return this.format(st, ['AA', 'CC'], ', ');
        };

        /**
         * Format people string
         *
         * @param {string} str source string
         * @param {array} format
         *      a - adults count
         *      A - adults count noun
         *      AA - adults count with noun
         *      c - children count
         *      C - children count noun
         *      CC - children count with noun
         * @param {string} separator
         * @returns {string}
         */
        this.format = function(str, format, separator) {
            var adult = 0,
                children = 0;

            var appartments = {
                'sngl':      {'adult': 1, 'children': 0},
                'dbl':       {'adult': 2, 'children': 0},
                'trpl':      {'adult': 3, 'children': 0},
                'qdrpl':     {'adult': 4, 'children': 0},
                'sngl1chld': {'adult': 1, 'children': 1},
                'sngl2chld': {'adult': 1, 'children': 2},
                'sngl3chld': {'adult': 1, 'children': 3},
                'dbl1chld':  {'adult': 2, 'children': 1},
                'dbl2chld':  {'adult': 2, 'children': 2},
                'dbl3chld':  {'adult': 2, 'children': 3},
                'trpl1chld': {'adult': 3, 'children': 1}
            }

            if(str in appartments) {
                adult = appartments[str].adult;
                children = appartments[str].children;
            }
            else {
                var people = (o.hash.get('p', str)).toString();
                if(people){
                    adult = parseInt(people.substr(0,1));
                    children = this.parseChildren(people.substr(1)).length;
                }
            }

            var values = {
                'a': adult,
                'A': o.fn.suffixForNumber(adult, [o._('взрослый'), o._('взрослых'), o._('взрослых')]),
                'c': children,
                'C': o.fn.suffixForNumber(children, [o._('ребенок'), o._('детей'), o._('детей')])
            };

            var formats = {
                'a': values.a,
                'A': values.A,
                'AA' : values.a ? values.a + ' ' + values.A : '',
                'c': values.c,
                'C': values.C,
                'CC': values.c ? values.c + ' ' + values.C : ''
            };

            return format.map(function(part) {
                return part in formats ? formats[part] : '';
            }).filter(function(v) { return !!v; }).join(separator);
        };

        /**
         * get string of peoples
         * @return {String}
         */
        this.getValue = function(){

            $peoples.trigger('get_value');
            $childrens.trigger('get_value');

            return $peoples.attr('data-value') + $childrens.attr('data-value');
        };

        /**
         * init from string
         * @param {String} st
         */
        this.setValue = function(st){

            // reset selected
            $childrens.empty();

            var str = st.toString();

            if(str.length <= (1+(maxChildren*2))){
                var p = parseInt(str.substr(0,1));
                if(p > 0 && p <= maxPeople){

                    var c = this.parseChildren(str.substr(1));

                    // set people
                    $peoples.find('div[data-value="'+ p +'"]').trigger('click');

                    // set children
                    $.each(this.parseChildren(str.substr(1)), function(i, c){
                        $childrenContainer.find('div[data-value="'+ c +'"]').first().trigger('click');
                    });
                }
            }
        };

        /**
         * Render the field
         */
        this.render = function($el){

            this.init($el);

            self.setValue(o.hash.get('p', o.search.history.get('p', o.config.defaultPeople)));

            // set num of people
            o.form.setInput('p', this.$, function($o,q){
                q.p = self.getValue();
            });

            return this;
        };
    };

    o.form.people.view = new f();

})(jQuery,otpMain);

/*********************/
/****** 	view/form/currencySwitch.js	 ***********/
/*********************/
(function ($, o) {

    var f = function () {

        var self = this;

        self.$ = [];
        self.currencies = [{
            'value': 'uah',
            'label': 'грн'
        }, {
            'value': 'cur',
            'label': '$|&euro;'
        }];

        /**
         * Handle change
         *
         * @param e
         */
        this.onChange = function(e) {
            var value = e.target.value;

            self.setValue(value);

            // update values
            $(o.fn.prefix('price', '.')).trigger('render', [value]);

            // update other currency switches
            self.$.map((function (cs) {
                cs.find('input[type=radio]')
                    .not(this)
                    .prop('checked', false)
                    .filter('[value=' + value + ']')
                    .prop('checked', true);
            }).bind(this));
        };

        /**
         * Set value in cookie
         *
         * @param value
         */
        this.setValue = function(value) {
            // set cookie
            $.cookie('os-currency', value, {path: '/', expires: 30});
        };

        /**
         * Get value from cookie
         *
         * @returns {*|string}
         */
        this.getValue = function() {
            return $.cookie('os-currency') || o.settings.get('osCurrency', 'uah');
        };

        /**
         * Render switch
         * @param e
         */
        this.onRender = function(e) {
            var instance = $(this);
            var name = instance.data('name');
            var current = self.getValue();

            instance
                .empty()
                .append(self.currencies.map(function(currency) {
                    return $('<label>').append(
                        $('<input>')
                            .attr('type', 'radio')
                            .attr('name', name)
                            .attr('value', currency.value)
                            .prop('checked', current === currency.value || !(current === 'uah' && currency.value !== 'uah'))
                            .on('change', self.onChange.bind(instance))
                    ).append(
                        $('<span>')
                            .attr('data-cur', currency.label)
                            .html(currency.label)
                    );
                }));

            return false;
        };

        this.listenCurrencyChange = function() {
            o.form.location.bind('select',function(h,v) {
                if('item' in v && 'currency' in v.item) {
                    var currency = v.item.currency;
                    var labels = {
                        'usd': '$',
                        'eur': '&euro;',
                        'any': '$|&euro;'
                    };

                    self.currencies = [{
                        'value': 'uah',
                        'label': 'грн'
                    }, {
                        'value': currency,
                        'label':  currency in labels ? labels[currency] : labels['any']
                    }];
                }
            });

            o.search.bind('process_set', function(d){
                self.$.map(function(cs) {
                    cs.trigger('render');
                });
            });
        };

        /**
         * Create new instance
         *
         * @returns {void|*}
         */
        this.create = function () {
            var name = o.fn.prefix('exchange-') + Math.ceil(Math.random() * 1000);
            var classname = o.fn.prefix('r-currency-switch');

            var instance = $('<div>')
                .data('name', name)
                .addClass(classname);

            instance
                .on('render', self.onRender)
                .trigger('render');

            self.$.push(instance);

            return instance;
        };

        self.listenCurrencyChange();
        return this;
    };

    o.form.currencySwitch.view = new f();

})(jQuery, otpMain);



/*********************/
/****** 	view/result/spinner.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 03/10/17.
 */

(function($,o) {

    o.spinner = {};
    o.spinner.view = new function () {

        this.$ = undefined;
        this.$container = undefined;
        this.$progressbar = undefined;
        this.$spinner = undefined;
        this.$to = undefined;
        this.$progress = undefined;

        var self = this;

        /**
         * Init the spinner
         * @param $el
         */
        this.init = function($el){
            this.$container = $el;

            $el
                .addClass(o.fn.prefix('loading'))
                .append(
                    self.$ = $('<div>')
                    .css('display', 'none')
                    .addClass(o.fn.prefix('spinner-wrap'))
                    .append(
                        self.$progressbar = $('<div>')
                            .addClass(o.fn.prefix('progressbar'))
                            .append(
                                $('<div>')
                                    .addClass(o.fn.prefix('progressbar-text'))
                                    .append(o._('Ожидайте несколько секунд...'))
                                    .append($('<br>'))
                                    .append(o._('Опрашиваем туроператоров '))
                                    .append(
                                        self.$to = $('<span>')
                                            //.text('по Египту')
                                    )
                            ).append(

                                $('<div>')
                                    .addClass(o.fn.prefix('progress-container'))
                                    .append(
                                        self.$progress = $('<div>')
                                            .addClass(o.fn.prefix('progress-item'))
                                            //.attr('value', 0)
                                    )
                            )
                    ).append(
                         $('<div>')
                            .addClass(o.fn.prefix('spinner-container'))
                            .append(
                                self.$spinner = $('<div>')
                                    .addClass(o.fn.prefix('spinner-logos-wrap'))
                            )
                    )
            );
        };

        /**
         * Update the spinner progress
         * @param progress
         */
        this.refresh = function(progress){

            self.$.fadeIn(200);

            // update logos
            self.$container.addClass(o.fn.prefix('loading'));
            self.$spinner.empty();
            $.each(progress, function(ai, status){

                self.$spinner.append(
                    $('<div>')
                        .addClass(o.fn.prefix('logo-bl'))
                        .addClass(!status? o.fn.prefix('loading-logo'): '')
                        .append(
                            $('<div>')
                                .addClass(o.fn.prefix('logo-image-wrap'))
                                .css('background-image', 'url(https://export.otpusk.com/images/onsite/logo/logo-'+ ai +'.png)')
                        ).append(
                            $('<div>')
                                .addClass(o.fn.prefix('logo-loading-bl'))
                                .html('<svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" width="85px" height="4px" viewBox="0 0 128 6" xml:space="preserve"><rect x="0" y="0" width="100%" height="100%" fill="#FFFFFF"></rect><path fill="#d3e6f7" fill-opacity="0.7" d="M3.034,0.054H8.081A2.973,2.973,0,1,1,8.081,6H3.034A2.973,2.973,0,1,1,3.034.054Zm14.6,0h5.047a2.973,2.973,0,1,1,0,5.946H17.638A2.973,2.973,0,1,1,17.638.054Zm14.6,0h5.047a2.973,2.973,0,1,1,0,5.946H32.242A2.973,2.973,0,1,1,32.242.054Zm14.6,0h5.047a2.973,2.973,0,1,1,0,5.946H46.846A2.973,2.973,0,1,1,46.846.054Zm14.6,0H66.5A2.973,2.973,0,1,1,66.5,6H61.45A2.973,2.973,0,1,1,61.45.054Zm14.6,0H81.1A2.973,2.973,0,1,1,81.1,6H76.054A2.973,2.973,0,1,1,76.054.054Zm14.6,0H95.7A2.973,2.973,0,1,1,95.7,6H90.658A2.973,2.973,0,1,1,90.658.054Zm14.6,0h5.047a2.973,2.973,0,1,1,0,5.946h-5.047A2.973,2.973,0,1,1,105.262.054Zm14.6,0h5.047a2.973,2.973,0,1,1,0,5.946h-5.047A2.973,2.973,0,1,1,119.866.054Z"></path><g transform="translate(44.5 0)"><path fill="#4c9be0" fill-opacity="1" d="M-26.993,0H-7.235A3,3,0,0,1-4.228,3,3,3,0,0,1-7.235,6H-26.993A3,3,0,0,1-30,3,3,3,0,0,1-26.993,0Z"></path><animateTransform attributeName="transform" type="translate" values="16 0;30 0;44.5 0;59 0;74 0;88.5 0;103 0;117.5 0;132 0;147 0;160.5 0" calcMode="discrete" dur="1030ms" repeatCount="indefinite"></animateTransform></g></svg>')
                        )
                );
            });

            // update progressbar
            var total = Object.keys(progress).length;
            var processing = $.map(progress, function (status) {
                if (status) {
                    return true;
                }
            }).length;

            // get different
            var different = Math.round(processing / total * 100);

            if (+different > +self.$progress.attr('value')) {
                self.$progress.attr('value', different);
            }

            // update timer and text info
            if(o.form.location.currentCountry.nameDt && !self.$to.text()) {
                self.$to.text('по '+ o.form.location.currentCountry.nameDt);
            }
        };

        /**
         * Reset the spinner
         */
        this.reset = function(f){
            if(typeof self.$ !== 'undefined') {
                self.$.fadeOut(self.$.is(':visible') ? 200 : 0, function(){
                    self.$to.empty();
                    self.$spinner.empty();
                    self.$progress.attr('value', 10);
                    self.$container.removeClass(o.fn.prefix('loading'));

                    if(typeof f === 'function') {
                        f();
                    }
                });
            }
        };

        /**
         * Render the spinner
         * @param $el
         */
        this.render = function($el){

            self.reset();
            self.init($el);
        };
    };
})(jQuery,otpMain);

/*********************/
/****** 	view/result/result.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 03/10/17.
 */

(function($,o){

    o.result.view = new function(){

        this.$ = undefined;
        this.start_search = undefined;
        this.$mapContainer = undefined;
        this.$results = undefined;
        this.$messages = undefined;
        //this.$map = undefined;
        this.$more = undefined;
        this.$resultCount = undefined;
        this.result_info = {};

        var self = this,
            $hotel,
            $result_hotel,
            $selectedFilters,
            $currencySwitcher,
            $spinner_top,
            $spinner_bottom,
            is_move,
            count;

        /**
         * Init the results container
         * @param $el
         */
        this.init = function($el){

            $el.append(
                $spinner_top = $('<div>')
                    .addClass('loading-container')
                    .addClass('scroll-loading-container')
            ).append(
                self.$messages = $('<div>')
                    .addClass(o.fn.prefix('result-info'))
            ).append(
                self.$ = $('<div>')
                    .addClass(o.fn.prefix('r-container'))
                    .css('display', 'none')
                    .append(
                        this.getFiltersPanel()
                    )
                    .append(
                        self.$mapContainer = this.getHotelsMap()
                    ).append(
                        self.$results = $('<div>')
                            .addClass(o.fn.prefix('r-wrapper clearfix'))

                    ).append(
                        $spinner_bottom = $('<div>')
                            .addClass('loading-container')
                            .addClass('scroll-loading-container')

                    ).append(
                        self.$more = $('<div>')
                            .addClass(o.fn.prefix('r-show-more-results'))
                            .text(o._('Найти и показать еще...'))
                            .on('click', function(){
                                $(this).animate({opacity: 0}, 'fast', function(){

                                    // init spinner "bottom" for results
                                    o.spinner.view.render($spinner_bottom);

                                    $(this).css('visibility', 'hidden');
                                    o.search.query.oid = null;
                                    o.search.query.g = isNaN(+o.search.query.g)? 2: o.search.query.g;
                                    o.search.query.n = 0;
                                    o.search.query.g++;
                                    o.search.process();
                                });
                                return false;
                            })
                    ).append(
                        /*** Result count info ***/
                        self.$resultCount = $('<div>')
                            .addClass(o.fn.prefix('result-info-text'))
                            .on('refresh', function(){

                                $(this).css('visibility', 'visible');

                                var count = 0,
                                    hotels_old = $(this).attr('data-hotels'),
                                    hotels_new = Object.keys(o.result.hotelsNew).length;

                                $.each(o.result.hotelsNew, function(i, item){
                                    count+= item.offers.length;
                                });

                                $(this).text(count? (o._('Найдено ')+ o.fn.suffixForNumber(count, [o._('цена'),o._('цены'),o._('цен')], true)) +
                                    (+hotels_new !== +hotels_old? o._(' и ')+ o.fn.suffixForNumber((hotels_new-hotels_old), [o._('новый отель'),o._('новых отеля'),o._('новых отелей')], true): ''): '');

                                $(this).attr('data-hotels', hotels_new);

                            }).on('hide', function(){
                                $(this).attr('data-hotels', 0);
                                $(this).css('visibility', 'hidden');
                            })
                    )
            );
        };

        /**
         * Refresh the results
         * @param hotels
         * @param last_page
         */
        this.refresh = function(hotels, last_page){

            self.$.fadeIn(self.$.is(':hidden') ? 100 : 0);

            // render results to $result
            $.each(hotels, function(i, hotel){

                $result_hotel = new o.result.hotel(hotel, self);
                $hotel = self.$results.find('div[data-id='+ hotel.i +']');

                // #11418 replace hotel
                if($hotel.length) {

                    is_move = +$result_hotel.view.$.data('minprice') !== +hotel.offers[0].pl;
                    count = $hotel.data('count');

                    $hotel.replaceWith($result_hotel.view.$);

                    if(is_move || count !== +hotel.offers.length) {
                        $result_hotel.view.$.trigger('blink');
                    }

                } else { // append hotel

                    is_move = true;
                    $result_hotel.view.$
                        .appendTo(self.$results)
                        .hide()
                        .fadeIn(777)
                        .trigger('blink');
                }

                // move hotel if price was changed
                var minPrice = +$result_hotel.view.$.data('minprice');
                if (is_move && +$result_hotel.view.$.prev().data('minprice') && minPrice < +$result_hotel.view.$.prev().data('minprice')) {

                    $result_hotel.view.$.hide();
                    $.each(self.$results.find('div' + o.fn.prefix('r-item-wrap', '.')), function (i, item) {
                        if ($(item).data('minprice') >= minPrice) {
                            $result_hotel.view.$.insertBefore($(item));
                            $result_hotel.view.$.fadeIn(777);
                            return false;
                        }
                    });
                }

                // refresh hotel position
                $result_hotel.view.$.trigger('dom.mount');
            });

            self.$results.children().sort(function(a, b) {
                return a.dataset.minprice - b.dataset.minprice;
            }).appendTo(self.$results);

            // show/hide pagination
            if(last_page) {
                self.$more.fadeOut(200);

                self.$more.animate({opacity: 0}, 'fast', function(){
                    self.$more.css('visibility', 'hidden');
                });

            } else {
                self.$more.animate({opacity: 1}, 'fast', function(){
                    self.$more.css('visibility', 'visible');
                });
            }

            // run price exchanger
            $selectedFilters.trigger('os.refresh', [o.search.query]);
        };

        /**
         * Render selected filters panel
         */
        this.getFiltersPanel = function () {
            return $('<div>')
                .addClass(o.fn.prefix('r-panel clearfix'))
                .append(
                    $selectedFilters = $('<div>')
                        .addClass(o.fn.prefix('r-filters-container'))
                        .append(
                            $('<div>')
                                .addClass(o.fn.prefix('r-filters-title'))
                                .append(o._('Фильтры') + ': ')
                                .append($('<span>').addClass(o.fn.prefix('r-filters-count')))
                                .on('click', function() {
                                    $(this).toggleClass(o.fn.prefix('active'));
                                })
                        )
                        .append(
                            $('<div>')
                                .addClass(o.fn.prefix('r-filters-values'))
                        )
                        .hide()
                        .on('os.submit', function() {
                            setTimeout(function() {
                                $selectedFilters.fadeOut({
                                    'duration': 200,
                                    'complete': function() {
                                        o.search.submit();
                                    }
                                });
                            }, 200);
                        })
                        .on('os.refresh', function(e, query) {
                            if(o.apiType && o.apiType !== 'full') { return; }

                            query = query || o.search.query;

                            var $filters = $(this).find('.' + o.fn.prefix('r-filters-values'));

                            /* Filter default values */

                            var filters = [
                                o.form.category.view,
                                o.form.food.view,
                                o.form.hotelRating.view,
                                o.form.price.view,
                                o.form.transport.view,
                                o.form.service.view
                            ].filter(function(filter) {
                                var diff = o.search.compareQueries(
                                    query,
                                    o.search.getQueryDefaults(Array.isArray(filter.param) ? filter.param : [filter.param])
                                );

                                return diff && diff.length;
                            }).filter(function(filter) {
                                var param = filter.param;

                                return Array.isArray(query[param]) ? !!query[param].length : !!query[param];
                            });

                            $selectedFilters.hide();
                            $filters
                                .empty()
                                .append(
                                    /* Render labels */
                                    filters.map(function(filter) {
                                            var label = '';
                                            var value = filter.getValue();

                                            switch (filter.param) {
                                                /* Food */
                                                case o.form.food.view.param:
                                                    label = o._('Питание') + ':';
                                                    value = value.join(' + ').toUpperCase();
                                                    break;
                                                /* Transport */
                                                case o.form.transport.view.param:
                                                    label = o._('Транспорт') + ':';
                                                    value = value.map(function(transport) {
                                                        return o.form.transport.view.getTransportText(transport, true).toLowerCase();
                                                    }).join(', ');
                                                    break;
                                                /* Hotel rating */
                                                case o.form.hotelRating.view.param:
                                                    label = o._('Оценки отеля') + ':';
                                                    value = o._('от') + ' ' + value[0] + ' до ' + value[1];
                                                    break;
                                                /* Price */
                                                case o.form.price.view.param:
                                                    label = o._('Цена, грн') + ':';
                                                    value = value.join('-');
                                                    break;
                                                /* Services */
                                                case o.form.service.view.param:
                                                    label = '';
                                                    value = o.fn.suffixForNumber(value.length, [o._('Услуга'), o._('Услуги'), o._('Услуг')], true).toLowerCase();
                                                    break;
                                                /* Category */
                                                case o.form.category.view.param:
                                                    label = o._('Категория отеля') + ':';
                                                    value = value.reduce(function(ranges, number) {
                                                        if(ranges.length) {
                                                            var last_range_index = ranges.length - 1;
                                                            var last_element_index = ranges[last_range_index].length - 1;
                                                            if(ranges[last_range_index][last_element_index] + 1 === +number) {
                                                                ranges[last_range_index].push(+number);
                                                                return ranges;
                                                            }
                                                        }

                                                        ranges.push([+number]);
                                                        return ranges;
                                                    }, []).reduce(function(parts, range) {
                                                            if(range.length > 1) {
                                                                parts.push(range[0] + '-' + range[range.length - 1]);
                                                            }
                                                            else {
                                                                parts.push(range[0]);
                                                            }

                                                            return parts;
                                                        }, []).join('*, ') + '*';
                                                    break;
                                            }
                                            return $('<span>')
                                                .on('click', function() {
                                                    $('.' + o.fn.prefix('f-ext-btn')).trigger('os.action', ['open']);
                                                    return false;
                                                })
                                                .addClass(o.fn.prefix('r-filter'))
                                                .append($('<span>').addClass(o.fn.prefix('r-filter-label')).text(label))
                                                .append($('<span>').addClass(o.fn.prefix('r-filter-value')).text(value))
                                                .append(
                                                    $('<span>')
                                                        .addClass(o.fn.prefix('r-filter-reset'))
                                                        .html('&times;')
                                                        .on('click', function() {
                                                            var value = Array.isArray(filter.param) ? filter.param.map(function(param) {
                                                                return o.search.getQueryDefaults(param);
                                                            }) : o.search.getQueryDefaults(filter.param);
                                                            filter.setValue(value);
                                                            $('.' + o.fn.prefix('f-ext-btn')).trigger('os.action', ['close']);

                                                            $filters.trigger('os.refresh');
                                                            $filters.trigger('os.submit');
                                                            return false;
                                                        })
                                                );
                                    })
                                )
                                .append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('r-filters-reset'))
                                        .html(o._('Сбросить фильтры'))
                                        .on('click', function() {
                                            o.form.view.$form.trigger('os.reset');
                                            $filters.trigger('os.submit');
                                        })
                                );

                            $selectedFilters.find('.' + o.fn.prefix('r-filters-count')).text(filters.length);
                            if(filters.length) {
                                $selectedFilters.show();
                            }
                        })
                )
                .append(
                    o.form.currencySwitch.view.create()
                );
        };

        /**
         * Render price element
         */
        this.getPriceElement = function(offer, template) {
            if(typeof template === 'undefined') {
                template = '%price%';
            }

            return $('<span>')
                .addClass(o.fn.prefix('price'))
                .on('render', function (e, currency) {
                    e.stopPropagation();

                    var html = template;
                    var values = {
                        'price':  currency == 'uah' ? o.fn.priceEcho(offer.pl,  'uah') : o.fn.priceEcho(offer.p,  offer.u),
                        'inverted':  currency != 'uah' ? o.fn.priceEcho(offer.pl,  'uah') : o.fn.priceEcho(offer.p,  offer.u),
                        'discount': ('ur' in offer && 'po' in offer)
                            ? (currency == 'uah'
                                ? o.fn.priceEcho(Number(offer.po)  * Number(offer.ur) - Number(offer.pl), 'uah')
                                : o.fn.priceEcho(Number(offer.po) - Number(offer.p), offer.u))
                            : ''
                    };

                    $.each(values, function(code, value) {
                        html = html.replace('%' + code + '%', value);
                    });
                    $(this).html(html);
                    return false;
                })
                .trigger('render', o.form.currencySwitch.view.getValue());
        };

        this.getHotelsMap = function () {
            var $container = $('<div>')
                .addClass(o.fn.prefix('results-map-overlay'))
                .hide()
                .append(
                    $('<div>')
                        .addClass(o.fn.prefix('results-map-body'))
                        .append(
                            $('<div>')
                                .addClass(o.fn.prefix('t-tab-content-top'))
                                .append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('t-tab-content-close'))
                                        .html('&times;')
                                        .click(function () {
                                            $container.trigger('close');
                                        })
                                ).append(o._('Отель на карте'))
                        )
                ).on('locate', function(e, hotel) {
                    o.tour.hotelMap.view.renderNearestHotels(
                        o.fn.prefix('os-map'),
                        hotel,
                        true
                    );

                    o.map.setCenter(o.fn.prefix('os-map'), hotel.g.a, hotel.g.o);
                    o.map.setZoom(o.fn.prefix('os-map'), 15);
                    o.map.openMarker(o.fn.prefix('os-map'), hotel.g.a, hotel.g.o);

                    return false;
                }).on('show', function(e, hotel) {
                        // init map
                        o.map.initMap(function (gmap) {
                            var map = gmap.getDiv();
                            $('html').addClass(o.fn.prefix('layer-open-map'));
                            $container.show();
                            $container.find(o.fn.prefix('results-map-body', '.')).append(map);
                            $container.trigger('locate', [hotel]);

                            o.tracker && o.tracker.send('event', 'Разные', 'Maps (' + o.map.vendor + ')', 'Результаты поиска - отели на карте');
                        }, o.fn.prefix('os-map'), {});
                }).on('close', function() {
                    $('html').removeClass(o.fn.prefix('layer-open-map'));
                    $container.hide();
                });

            return $container;
        };

        /**
         * Reset the results container
         */
        this.reset = function(){

            // init spinner "top" for results
            o.spinner.view.render($spinner_top);

            self.$.fadeOut(50, function(){

                self.$results.empty();
                self.$resultCount.trigger('hide');
                o.result.view.hideMessage();

                self.hideMessage();

                o.result.hotelsNew = {};
                o.result.hotelIds = [];

                self.$.removeClass(o.fn.prefix('show-message'));
            });
        };

        /**
         * Scroll to result container
         */
        this.scrollToResults = function(){

            if (typeof EnableScrollToResults === 'undefined') {
                if ($('.scroll-loading-container').length) {
                    $('html, body').animate({
                        scrollTop: $('.scroll-loading-container').offset().top - 20
                    }, 1000);
                }
            }

        };

        /**
         * Show the results info message
         * @param text
         * @param withOrderForm
         */
        this.showMessage = function(text, withOrderForm){
            msg = this.getNoToursMessage(text, null, withOrderForm);

            /* Render message*/
            self.$messages.fadeIn(200, function () {
                $(this).empty().append(msg);
                msg.trigger('os.render');
            })
        };

        /**
         * Get No Tours Message
         */
        this.getNoToursMessage = function(alertText, actionText, withOrderForm) {
            var conditions = {
                notDefaultCityfrom: function() {
                    var fromCityId = o.form.fromCity.view.getValue();
                    var defaultCity = o.form.fromCity.view.getDefault();

                    return !fromCityId || +fromCityId !== +defaultCity.id;
                },
                notDefaultPeopleValue: function() {
                    return +o.hash.get('p', 2) !== 2;
                }
            };

            var defaultAlertText = o._('По вашему запросу туры не найдены') + '...';
            var defaultActionText = [o._('Попробуйте'), ' ', $('<a>')
                .addClass(o.fn.prefix('link'))
                .attr('href', '#')
                .html(o._('вернуться к поиску') + ' &uarr;')
                .on('click', function () {
                    o.form.view.scrollToForm();
                    return false;
                })];


            alertText = alertText || defaultAlertText;
            actionText = actionText || defaultActionText;
            withOrderForm = typeof withOrderForm === 'undefined' ? true : withOrderForm;

            if (conditions.notDefaultCityfrom()) {
                var fromCity = o.form.fromCity.view.getCityFromId(o.form.fromCity.view.getValue());
                var defaultCity = o.form.fromCity.view.getDefault();

                var defaultCitySearchLink = $('<a>', {
                    'attr': {'href': '#'},
                    'on':   {
                        'click': function () {
                            o.form.fromCity.view.setValue(defaultCity.id);
                            o.search.submit();

                            return false;
                        }
                    },
                    'text': o._('из') + ' ' + defaultCity['rel']
                });

                alertText = [o._('По вашему запросу туры'), o._('из'), fromCity['rel'], o._('не найдены') + '.'].join(' ');
                actionText = [o._('Поищите туры'), ' ', defaultCitySearchLink, ' ', o._('или измените другие критерии поиска')];
            }

            /* Render message */
            var $msg = $('<div>')
                .addClass(o.fn.prefix('not-found-message'))
                .append(
                    $('<div>')
                        .addClass(o.fn.prefix('not-found-text'))
                        .append(alertText)
                )
                .append(
                    withOrderForm && $('<div>')
                        .addClass(o.fn.prefix('column'))
                        .append(
                            $('<span>')
                                .addClass(o.fn.prefix('text'))
                                .append(actionText)
                        )
                )
                .append(
                    withOrderForm && $('<div>')
                        .addClass(o.fn.prefix('column'))
                        .append(
                            $('<span>')
                                .addClass(o.fn.prefix('text'))
                                .append([
                                    o._('или напишите нам и мы поможем найти то, что вы ищете') + '.'
                                ])
                        )
                        .append(
                            $('<div>')
                                .attr('id', o.fn.prefix('not-found-order-container'))
                                .data('title-text', '')
                        )
                );

            $msg.on('os.render', function() {
                var orderWidget = otpMainOrder;

                withOrderForm && orderWidget.showForm(null, {
                    container: o.fn.prefix('not-found-order-container', '#')
                }, {
                    'render': function($widget) {
                        if(orderWidget){
                            // Office
                            $widget.find('.os-order-input-office select').trigger('mouseenter');
                            // Geo
                            var geo = o.form.location.view.$.val();
                            if(geo){
                                $.ajax({
                                    url: o.config.suggestLink,
                                    type: 'GET',
                                    dataType: 'jsonp',
                                    data:  $.extend({
                                        text: geo,
                                        lang: o.lang
                                    }, o.apiToken),
                                    success: function(d) {
                                        if(d.response.length) {
                                            var geo = d.response[0];
                                            var countryName, cityName, hotelId;

                                            countryName = geo.type === 'country' ? geo.name : 'countryName' in geo ? geo.countryName : '';
                                            cityName = geo.type === 'city' ? geo.value : 'cityName' in geo ? geo.cityName : '';
                                            hotelId = geo.type === 'hotel' ? geo.id : '';

                                            if(countryName)
                                                $widget.find('.os-order-input-country select')
                                                    .empty()
                                                    .append($('<option>').val(countryName).text(countryName).attr('selected', true));
                                            if(cityName)
                                                $widget.find('.os-order-input-city select')
                                                    .empty()
                                                    .append($('<option>').val(cityName).text(cityName).attr('selected', true));
                                            if(hotelId) {
                                                $widget.find('[name="hotelId"]').val(hotelId);
                                            }
                                        }
                                    }
                                });
                            }

                            // City from
                            var fromCityId = o.form.fromCity.view.getValue();
                            if(fromCityId) {
                                var fromCity = o.form.fromCity.view.getCityFromId(fromCityId);
                                orderWidget.form.view.$deptCity.val(fromCity.rel);
                            }

                            // Date and duration
                            orderWidget.form.duration.view.$.el.val(+o.search.query.l+100);
                            if(o.search.query.c){
                                var newDate = new Date(o.search.query.c);
                                if(!isNaN(newDate.getTime())) {
                                    orderWidget.form.dates.view.$.el.data('date', newDate);
                                    orderWidget.form.dates.view.$.el.datepicker('setValue', newDate);
                                }
                            }

                            // People
                            if(o.search.query.p && parseInt(o.search.query.p)) {
                                orderWidget.form.people.view.setValue(o.search.query.p);
                            }
                        } else {
                            console.error('otpMain or otpMainOrder is undefined');
                        }
                        orderWidget.form.view.rendered = false;
                    },
                    'before_sent': function (query) {
                        var comments = [];

                        // Categories
                        if (o.search.query.st.length) {
                            var categories = o.config.category.filter(function (category) {
                                return o.search.query.st.indexOf(category.value.toString()) !== -1;
                            }).map(function (category) {
                                return category.label + '*';
                            }).join('+');

                            comments.push(o._('Отель') + ' ' + categories);
                        }

                        // Foods
                        if (o.search.query.o.length) {
                            var foods = o.config.food.filter(function (food) {
                                return o.search.query.o.indexOf(food.value) !== -1;
                            }).map(function (food) {
                                return food.label;
                            }).join(' + ');

                            comments.push(o._('Питание') + ' ' + foods);
                        }

                        // Services
                        if (o.search.query.e.length) {
                            var services = o.search.query.e.map(function (code) {
                                return code in o.config.service.mainService ? o.config.service.mainService[code] : code;
                            }).join(', ');

                            comments.push(o._('Услуги') + ' ' + services);
                        }

                        // Price
                        if (o.search.query.pf && o.search.query.pf != 500) {
                            comments.push(o._('Стоимость от') + ' ' + o.search.query.pf);
                        }
                        if (o.search.query.pt && o.search.query.pt != 100000) {
                            comments.push(o._('Стоимость до') + ' ' + o.search.query.pt);
                        }

                        if (query.comment.length) {
                            query.comment += ' | ';
                        }
                        query.comment += o._('Фильтры в поиске') + ': ';
                        query.comment += comments.join(', ');

                    }
                });
            });

            return $msg;
        };

        /**
         * Hide the results info message
         */
        this.hideMessage = function(){
            self.$messages.fadeOut(100, function(){
                $(this).empty();
            })
        };

        /**
         * Render the results
         * @param $el
         */
        this.render = function($el){
            this.init($el);
        };

        /**
         * Event on each searching response
         */
        o.search.bind('response', function(data){
            if(data.cnt && data.cnt.nameVn) {
                o.form.location.updateCurrentGeo(data.cnt, data.cty);
            }
        });

        /**
         * Event on results set
         */
        o.search.bind('process_set', function(d){

            var hotels = d.hotels,
                now,
                last,
                cur_last;

            if($.isEmptyObject(o.result.view.result_info)) {
                o.result.view.result_info = d.progress;
            }

            $.each(hotels, function(n, data){
                $.each(data, function(i, h){

                    // get result info #13032
                    $.each(h.offers, function(i, item){
                        if(typeof o.result.view.result_info[item.oi] !== 'object' || $.isEmptyObject(o.result.view.result_info[item.oi])) {
                            o.result.view.result_info[item.oi] = {
                                'hotels': {},
                                'first_response': 0,
                                'last_response': 0,
                                'recency': 0
                            };
                        }

                        if(typeof o.result.view.result_info[item.oi]['hotels'][h.i] === 'undefined') {
                            o.result.view.result_info[item.oi]['hotels'][h.i] = 0;
                        }

                        o.result.view.result_info[item.oi]['hotels'][h.i]+=1;

                        // get recency
                        if(item.last) {

                            last = new Date(item.last);
                            cur_last = last;

                            if(o.result.view.result_info[item.oi]['recency']) {
                                cur_last = last;
                            }

                            if(cur_last.getTime() <= last.getTime()) {
                                o.result.view.result_info[item.oi]['recency'] = last;
                            }
                        }

                        now = new Date();

                        // get first result (in seconds)
                        if(!o.result.view.result_info[item.oi]['first_response']) {
                            o.result.view.result_info[item.oi]['first_response'] = Math.abs((now.getTime() - o.result.view.start_search.getTime()) / 1000);
                        }

                        // get last result (in seconds)
                        o.result.view.result_info[item.oi]['last_response'] = Math.abs((now.getTime() - o.result.view.start_search.getTime()) / 1000);
                    });
                })
            });
        });

        /**
         * Event on last results
         */
        o.search.bind('process_last', function(data){

            // update results text info
            o.result.view.$resultCount.trigger('refresh');

            // print result info
            var operators = o.config.operators;

            var hotels_count, hotels = [], offers_count, total_offers = 0;
            $.each(o.result.view.result_info, function(i, to){

                // not results
                if(typeof to === 'boolean' && to){
                    to = {
                        'hotels': {},
                        'first_response': 0,
                        'last_response': 0,
                        'recency': 0
                    }
                }

                if(to){
                    hotels_count = Object.keys(to.hotels).length;
                    offers_count = Object.values(to.hotels).reduce(function(a,b){return a+b;}, 0);

                    total_offers+= offers_count;

                    hotels = hotels.concat(Object.keys(to.hotels));

                    console.info((typeof operators[i] !== 'undefined'? operators[i].name: i) +': '+ offers_count +' offers, '+ hotels_count +' hotels, '+ to.recency +' recency, '+ to.first_response +'s first result, '+ to.last_response +'s last result');
                } else {
                    console.info((typeof operators[i] !== 'undefined'? operators[i].name: i) +': Not response');
                }
            });

            hotels_count = hotels.filter(function(v,i,self){
                return self.indexOf(v) === i;
            });

            console.info('Totals: '+ total_offers +' offers, '+ hotels_count.length +' hotels');
            o.result.view.result_info = {};
        });
    };

})(jQuery,otpMain);


/*********************/
/****** 	view/result/hotel.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 03/10/17.
 */

(function($, o){

    o.result.hotelView = function(parent){

        o.osLargeImg = typeof osLargeImg !== 'undefined'? true: false;

        this.$ = undefined;
        this.parent = parent;

        var self = this,
            hotel,
            offer,
            offerDate,
            $discount;

        // sort offers by price
        this.parent.object.offers.sort(function(a,b){
            return a.pl - b.pl;
        });

        // get offer with min price
        offer = o.fn.getFirst(this.parent.object.offers);
        hotel = self.parent.object;

        var is_map_enable = (otpMain.apiType === 'full' && hotel.g && hotel.g.a && +hotel.g.a !== 0);

        this.$ = $('<div>')
            .addClass(o.fn.prefix('r-item-wrap'))
            .attr('data-id', this.parent.object.i)
            .attr('data-minprice', offer.pl)
            .attr('data-count', this.parent.object.offers.length)
            .append(
                $('<a>')
                    .attr('href', o.tour.getLink(offer, 'tour', this.parent.object))
                    .attr(typeof osTourTargetBlank !== 'undefined' && osTourTargetBlank? 'target': 'data-istarget', '_blank')
                    .addClass(o.fn.prefix('r-item'))
                    .on('click', function(){
                        // #14347
                        if(String(o.tour.offer.i) === String(offer.i)) {
                            o.tour.view.render(offer.i);
                        }

                        if ($('.scroll-loading-container').length) {
                            setTimeout(function () {
                                $('html, body').animate({
                                    scrollTop: $('.scroll-loading-container').offset().top - 20
                                }, 1000);
                            },1000);
                        }

                    })
                    .append(
                        $('<span>')
                            .addClass(o.fn.prefix('r-item-img'))
                            .addClass(o.fn.prefix('r-lazy-img'))
                            .attr('data-original', o.tour.photo.view.getLink(Array.isArray(hotel.f) ? o.fn.getFirst(hotel.f) : hotel.f, (o.osLargeImg)?'300x300':'200x150', '', 2))
                            .lazyload({threshold : 200, skip_invisible: true})
                            .append(o.tour.view.getHotelTag(hotel.e))
                            .append(
                                +hotel.v > 0 && $('<div>')
                                    .addClass(o.fn.prefix('r-item-rating-container'))
                                    .addClass(o.fn.prefix('r-p'+ parseInt(hotel.r)))
                                    .append(
                                        $('<span>')
                                            .addClass(o.fn.prefix('r-item-rating-value'))
                                            .append(+hotel.r > 0? parseFloat(hotel.r).toFixed(1): '')
                                    ).append(
                                    $('<span>')
                                        .addClass(o.fn.prefix('r-item-rating-rev'))
                                        .append(o.fn.suffixForNumber(hotel.v, [o._('отзыв'), o._('отзыва'), [o._('отзывов')]]))
                                        .append($('<span>').text(hotel.v))
                                ).append(
                                    $('<div>')
                                        .addClass('slice')
                                        .append($('<div>').addClass('bar'))
                                        .append($('<div>').addClass('fill'))
                                )
                            )
                    ).append(
                    $('<span>')
                        .addClass(o.fn.prefix('r-item-body'))
                        .attr('data-stars', typeof hotel.s === 'object' ? parseInt(hotel.s.n) : parseInt(hotel.s))
                        .append(
                            $('<span>')
                                .addClass(o.fn.prefix('r-item-hotel'))
                                .attr('title', hotel.n)
                                .append(
                                    $('<span>')
                                        .addClass(o.fn.prefix('r-item-stars'))
                                        .on('init', function(){
                                            var that = this;
                                            $.each(o.fn.range(1, o.fn.parseHotelCategory(hotel.s)), function(){
                                                $(that).append('<svg class="new_r-item-star" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 38.35 36.67"><g><path d="M21,1.15l4.32,8.77A2.06,2.06,0,0,0,26.91,11l9.67,1.41A2.06,2.06,0,0,1,37.73,16l-7,6.82a2.07,2.07,0,0,0-.59,1.83l1.65,9.63a2.06,2.06,0,0,1-3,2.18l-8.65-4.55a2.07,2.07,0,0,0-1.92,0L9.56,36.43a2.06,2.06,0,0,1-3-2.18l1.65-9.63a2.06,2.06,0,0,0-.59-1.83L.63,16a2.06,2.06,0,0,1,1.15-3.52L11.45,11A2.07,2.07,0,0,0,13,9.92l4.32-8.77a2.06,2.06,0,0,1,3.7,0Zm0,0"></path></g></svg>');
                                            });
                                        })
                                        .trigger('init')
                                )
                                .append(hotel.n)
                        ).append(
                        $('<span>')
                            .addClass(o.fn.prefix('r-item-info'))
                            .append(
                                $('<a>')
                                    .attr('href', o.tour.getLink(offer, is_map_enable? 'map': 'tour', this.parent.object))
                                    .attr(typeof osTourTargetBlank !== 'undefined' && osTourTargetBlank? 'target': 'data-istarget', '_blank')
                                    .addClass(o.fn.prefix('r-item-geo'))
                                    .append(is_map_enable? '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30.68 43.81"><path d="M26.19,4.49a15.35,15.35,0,0,0-21.7,0c-5.36,5.36-6,15.45-1.44,21.56L15.34,43.81,27.61,26.08c4.61-6.14,3.94-16.22-1.42-21.59ZM15.48,20.8a5.6,5.6,0,1,1,5.6-5.6,5.61,5.61,0,0,1-5.6,5.6Zm0,0"/></svg>': '')
                                    .append('<span>' + hotel.t.n +',<br style="display: none;" /> '+ hotel.c.n + '</span>')
                                    .append(is_map_enable? '<span style="display: none;">Показать на карте</span>': '')
                                    .on('click', function() {
                                        // show on results map
                                        if(is_map_enable && o.result.view.$mapContainer) {
                                            if (!$(this).parents().hasClass('new_t-similar-viewed-wrapper')) {
                                                o.result.view.$mapContainer.trigger('show', [hotel]);
                                                return false;
                                            }

                                        }
                                    })
                            )
                            .append(
                                $('<span>')
                                    .addClass(o.fn.prefix('r-item-food'))
                                    .attr('title', o.form.food.view.getFoodInfo(offer.f)['description'])
                                    //.append(o.form.food.view.getFoodInfo(offer.f)['label'])
                                    .append(o.form.food.view.getFoodInfo(offer.f)['description'])
                            )
                            //.append(', номер '+ offer.r)
                            .append(
                                $('<span>')
                                    .addClass(o.fn.prefix('r-item-table'))
                                    .append(
                                        $('<span>')
                                            .addClass(o.fn.prefix('r-item-col'))
                                            .append(
                                                $('<span>')
                                                    .addClass(o.fn.prefix('r-item-from'))
                                                    .append(
                                                        offer.t === 'air'?
                                                            '<svg class="new_r-item-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 489.6 310.93"><g><path d="M299.82,49.46l-95.06-5.06a6.08,6.08,0,0,0-3.19.72L149.21,73.37a6,6,0,0,0-1.79,9.16l26.94,32.59a6.5,6.5,0,0,1,.83-.55Zm0,0"></path><path d="M487.4,15.72l-.15-.3C483.49,8.39,475,0,455.9,0,435.81,0,414,9.12,413,9.51,360,30.62,110.67,161.85,110.67,161.85L50.95,129.67a6,6,0,0,0-5.66,0l-42,22a6,6,0,0,0-1.15,9.93l102.75,88.82a6,6,0,0,0,6.74.79l100.34-52.35,15.18,107a6,6,0,0,0,8.84,4.47c10.66-5.73,17.32-9.37,23.76-12.88S273,290.06,284,284.16a6.06,6.06,0,0,0,2.65-2.84l71.41-158.84,73.4-38.32c34.32-17.43,67-44.56,55.93-68.43Zm0,0"></path></g></svg>'
                                                            : (offer.t === 'bus'?
                                                            '<svg class="new_r-item-icon" data-name="bus-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 344 410.4"><path d="M329.6,62.4q-4-16.8-13.6-25.6t-28-16q-18.4-8-52.8-14.4T172.4,0Q144,0,109.6,6.4T56.8,20.8q-18.4,7.2-28,16T16,62.4L0,190.4V368.8H24.8v16q0,16,10,22.4t20.4,0q10.4-6.4,10.4-22.4v-16H270.4v16q0,16,12.4,22.4t24.4,0q12-6.4,12-22.4v-16H344V190.4ZM87.2,30.8q3.2-6,11.2-6h152c5.94,0,12,4.18,12,8.51v8c0,4-5.27,7.49-12,7.49H98.4q-8,0-11.2-6a12.05,12.05,0,0,1,0-12h0ZM28.8,187.2L42.4,89.6q1.6-8,13.6-8H290.4q12,0,13.6,8l13.6,99.2a13.09,13.09,0,0,1,.8,3.2,11.81,11.81,0,0,1-4,9.2,14.93,14.93,0,0,1-10.4,3.6H42.4A13.72,13.72,0,0,1,28,190.4a7.08,7.08,0,0,1,.8-3.2h0ZM71.2,306.8a26.4,26.4,0,0,1-18.8,7.6,26.4,26.4,0,0,1-18.8-7.6,25.16,25.16,0,0,1,0-36.8,27,27,0,0,1,37.6,0,25.16,25.16,0,0,1,0,36.8h0Zm241.6,0a27.06,27.06,0,0,1-37.6,0,25.16,25.16,0,0,1,0-36.8,27.05,27.05,0,0,1,37.6,0,25.16,25.16,0,0,1,0,36.8h0Zm0,0"/></svg>'
                                                            : (offer.t === 'train'?
                                                                '<svg class="new_r-item-icon" data-name="train-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 293.65 411.31"><path d="M272.52,455H83.38c-26.82,0-45.13,0-45.13,30.85V725c0,45.81,20.23,45.81,45.13,46.3H95l-66.3,95h35l47.57-64.71,130.53,0.07,46,64.64h34.56l-65.39-95h15.55c33,0,32-25,32-46.3V485.85c0-21.28-10.74-30.85-32-30.85h0ZM130.8,478.12a7.69,7.69,0,0,1,7.72-7.68h67.74a7.67,7.67,0,0,1,7.69,7.68v15.45a7.71,7.71,0,0,1-7.69,7.72H138.53a7.74,7.74,0,0,1-7.72-7.72V478.12Zm-54,57.34c0-17.78,8.91-18.77,21.68-18.77H253.08c12.81,0,16.61,3.59,16.61,18.77v81.68c0,29.61,1.1,37.15-16.61,37.15H101.5c-20.56.15-24.68,2-24.68-24.15V535.46Zm23.4,201.11a24.6,24.6,0,1,1,24.6-24.6,24.57,24.57,0,0,1-24.6,24.6h0Zm146.61,0a24.6,24.6,0,1,1,24.6-24.6,24.58,24.58,0,0,1-24.6,24.6h0Zm0,0" transform="translate(-28.72 -455)"/></svg>'
                                                                : '<svg class="new_r-item-icon" data-name="no-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 228.52 407.65"><path d="M540.8,507.08A36,36,0,1,1,587,528.42a36,36,0,0,1-46.2-21.34h0Zm0,0" transform="translate(-452.79 -458.66)"/><path class="cls-1" d="M469,838c-8.67,27.31,33.66,40.56,42.34,13.27,14.24-44.68,27.18-87.24,39-138.62,3.12,3.4,32.69,36.62,59.77,58.77,2.69,25.35,7.38,51.66,10,76.95,3,28.48,46.72,20.75,43.71-7.55q-4.18-39.83-8.4-79.69a23.23,23.23,0,0,0-1.63-6.2c-0.36-5.62-4.31-9.69-9.78-15-21-20.6-35-41.6-62.13-63.89,2.72-21.94,5.91-35.78,9.38-57.57,25.29,17,50.72,43.86,71.72,40.86,26.88-3.84,22.26-32-1.5-44.88-33.5-18.12-40.5-28.12-70.05-53.55-16-13.8-44.56-27.17-61.74-15.05-0.61.23-29.72,26.48-55.34,47.38-19.66,16-18.9,55.44-21.42,77-3.13,26.83,38.24,34.29,41.37,7.37q2.9-25.07,5.83-50.12c8.83-10.15,13.83-13.15,16.3-22.91-5.26,20.78-9.41,69.42-9.24,72.09C504.37,692.69,487.16,763.13,469,838h0Zm0,0M591.45,560.89c-16-13.8-35.45-29.58-61.74-15.05" transform="translate(-452.79 -458.66)"/></svg>'))
                                                    )
                                                    .append((($('.new_f-title').text() == 'Пошук туру' && o.form.fromCity.view.getCityFromId(offer.c)['rel'] == 'Львова')?'зі':o._('из')) +' '+ o.form.fromCity.view.getCityFromId(offer.c)['rel'])

                                            ).append(
                                            $('<span>')
                                                .addClass(o.fn.prefix('r-item-date'))
                                                .append('<svg class="new_r-item-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 391.2 391.2"><g><path d="M60.72,213.6V186.32A7.34,7.34,0,0,1,68.08,179H95.36a7.34,7.34,0,0,1,7.36,7.36V213.6A7.34,7.34,0,0,1,95.36,221H68.08a7.45,7.45,0,0,1-7.36-7.36Zm64.4,7.28H152.4a7.34,7.34,0,0,0,7.36-7.36V186.24a7.34,7.34,0,0,0-7.36-7.36H125.12a7.34,7.34,0,0,0-7.36,7.36v27.28a7.44,7.44,0,0,0,7.36,7.36Zm57,0h27.28a7.34,7.34,0,0,0,7.36-7.36V186.24a7.34,7.34,0,0,0-7.36-7.36H182.16a7.34,7.34,0,0,0-7.36,7.36v27.28a7.44,7.44,0,0,0,7.36,7.36Zm-57,55.6H152.4a7.34,7.34,0,0,0,7.36-7.36V241.84a7.34,7.34,0,0,0-7.36-7.36H125.12a7.34,7.34,0,0,0-7.36,7.36v27.28a7.44,7.44,0,0,0,7.36,7.36Zm57,0h27.28a7.34,7.34,0,0,0,7.36-7.36V241.84a7.34,7.34,0,0,0-7.36-7.36H182.16a7.34,7.34,0,0,0-7.36,7.36v27.28a7.44,7.44,0,0,0,7.36,7.36Zm57.12,0h27.28a7.34,7.34,0,0,0,7.36-7.36V241.84a7.34,7.34,0,0,0-7.36-7.36H239.28a7.34,7.34,0,0,0-7.36,7.36v27.28a7.34,7.34,0,0,0,7.36,7.36Zm-171.2,0H95.36a7.34,7.34,0,0,0,7.36-7.36V241.84a7.34,7.34,0,0,0-7.36-7.36H68.08a7.34,7.34,0,0,0-7.36,7.36v27.28a7.34,7.34,0,0,0,7.36,7.36ZM182.16,332h27.28a7.34,7.34,0,0,0,7.36-7.36V297.36a7.34,7.34,0,0,0-7.36-7.36H182.16a7.34,7.34,0,0,0-7.36,7.36v27.28a7.44,7.44,0,0,0,7.36,7.36Zm-57,0H152.4a7.34,7.34,0,0,0,7.36-7.36V297.36A7.34,7.34,0,0,0,152.4,290H125.12a7.34,7.34,0,0,0-7.36,7.36v27.28a7.44,7.44,0,0,0,7.36,7.36ZM239.28,220.88h27.28a7.34,7.34,0,0,0,7.36-7.36V186.24a7.34,7.34,0,0,0-7.36-7.36H239.28a7.34,7.34,0,0,0-7.36,7.36v27.28a7.34,7.34,0,0,0,7.36,7.36Zm57,55.6H323.6a7.34,7.34,0,0,0,7.36-7.36V241.84a7.34,7.34,0,0,0-7.36-7.36H296.32a7.34,7.34,0,0,0-7.36,7.36v27.28a7.44,7.44,0,0,0,7.36,7.36Zm-57,55.52h27.28a7.34,7.34,0,0,0,7.36-7.36V297.36a7.34,7.34,0,0,0-7.36-7.36H239.28a7.34,7.34,0,0,0-7.36,7.36v27.28a7.34,7.34,0,0,0,7.36,7.36ZM0,348.4V85a42.85,42.85,0,0,1,42.8-42.8h48V15.6A15.57,15.57,0,0,1,106.4,0h24.4a15.57,15.57,0,0,1,15.6,15.6V42.08h98.4V15.6A15.57,15.57,0,0,1,260.4,0h24.4a15.57,15.57,0,0,1,15.6,15.6V42.08h48a42.85,42.85,0,0,1,42.8,42.8V348.4a42.85,42.85,0,0,1-42.8,42.8H42.8A42.85,42.85,0,0,1,0,348.4Zm33.12,0a9.8,9.8,0,0,0,9.76,9.76H348.4a9.8,9.8,0,0,0,9.76-9.76V153.28h-325Zm0,0"></path></g></svg>')
                                                .append(o.form.datepicker.getTextDate(offer.d, {parts:['d', 'm']}, ' '))
                                                .append(' <span style="display: inline">на '+ (offer.l-1) + ' '+ o.fn.suffixForNumber((offer.l-1), [o._('ночь'), o._('ночи'), 'ночей'])+'</span>')
                                        )
                                    ).append(
                                    $('<span>')
                                        .addClass(o.fn.prefix('r-item-col'))
                                        .append(
                                            $('<span>')
                                                .addClass(o.fn.prefix('r-item-price'))
                                                .append(
                                                    $discount = $('<span>')
                                                        .addClass(o.fn.prefix('r-item-price-discount'))
                                                ).append(
                                                $('<span>')
                                                    .addClass(o.fn.prefix('price'))
                                                    .attr('data-uah', offer.pl)
                                                    .attr('data-orig', offer.p)
                                                    .attr('data-currency', offer.u)
                                                    .attr('data-adults', offer.a)
                                                    .attr('data-children', offer.h)
                                                    .on("render", function(e, currency) {
                                                        var value = "";
                                                        var descr = "";
                                                        var data = $(this).data();

                                                        switch(currency) {
                                                            case "uah":
                                                                value = o.fn.priceEcho(data.uah, 'uah');
                                                                break;
                                                            default:
                                                                value = o.fn.priceEcho(data.orig, data.currency);
                                                                break;
                                                        }
                                                        switch (+data.adults + data.children) {
                                                            case 1: descr = 'за одного'; break;
                                                            case 2: descr = 'за двоих'; break;
                                                            case 3: descr = 'за троих'; break;
                                                            case 4: descr = 'за четверых'; break;
                                                            case 5: descr = 'за пятерых'; break;
                                                            case 6: descr = 'за шестерых'; break;
                                                        }

                                                        $(this)
                                                            .empty()
                                                            .append(
                                                                $("<div>", {
                                                                    'class': o.fn.prefix('price-value'),
                                                                    'html': value
                                                                })
                                                            )
                                                            .append(
                                                                $("<div>", {
                                                                    'class': o.fn.prefix('price-desc'),
                                                                    'html': o._(descr)
                                                                })
                                                            );
                                                    })
                                                    .trigger("render", o.form.currencySwitch.view.getValue())

                                            )
                                        )
                                )
                            )

                    )
                )
                /* Animation on render or update the item */
            ).on('dom.mount', function(e) {
                $('body, html').trigger('scroll');
            })
            .on('blink', function(){
                $(this).addClass(o.fn.prefix('temp-anim'));
            });
    };

})(jQuery,otpMain);


/*********************/
/****** 	view/tour/tour.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 04/10/17.
 */

(function ($, o) {
    var f = function() {
        var self = this;

        this.$ = $('<div>').addClass(o.fn.prefix('t-container'));

        this.scrollToTour = true;
        this.defaultTab = 'tour';

        this.$matrix = undefined;
        this.$menu = undefined;
        this.$orderBlock = undefined;
        this.$modalDates = undefined;
        this.$modalFoods = undefined;
        this.$modalOrder = undefined;
        this.$modalTransport = undefined;
        this.$content = undefined;
        this.$message = undefined;
        this.$descPage = undefined;
        this.$photoPage = undefined;
        this.$mapPage = undefined;
        this.$reviewsPage = undefined;
        this.$spinner_matrix = undefined;
        this.$spinner_offer = undefined;
        this.$tr = undefined;

        var extraHotelName = o.settings.get('hotelNameUnderButton', false);

        /**
         * Init the tour page
         * @param hotel
         */
        this.init = function(hotel){
            o.osLargeImg = typeof osLargeImg !== 'undefined';

            this.$.empty();

            var is_map_enable = (otpMain.apiType === 'full' && hotel.g && hotel.g.a && +hotel.g.a !== 0);

            this.$.append(
                $('<div>')
                    .addClass(o.fn.prefix('t-menu-back'))
                    .append(
                        $('<a>')
                            .addClass(o.fn.prefix('t-menu-back-link'))
                            .attr('href', window.location.href.replace('page=tour','page=form'))
                            .append('<span>&larr;</span> '+ o._('Вернуться к результатам поиска'))
                            .on('click', self.goBack).trigger('init')
                    )
                    .append(
                        o.form.currencySwitch.view.create()
                    )
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('t-menu-wrap'))
                    .append(self.$menu = self.getTabs(hotel))
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('t-header'))
                    .append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-header-col'))
                            .append(
                                $('<div>')
                                    .addClass(o.fn.prefix('t-header-gallery-container'))
                                    .append('e' in hotel && 'e' in hotel.e ? o.tour.view.getHotelTag(hotel.e.e) : '')
                                    .append(
                                        $('<div>')
                                            .addClass(o.fn.prefix('t-header-desktop-img'))
                                            .css('background-image',
                                                o.osLargeImg
                                                    ?'url(' + o.tour.photo.view.getLink(Array.isArray(hotel.f) ? o.fn.getFirst(hotel.f) : hotel.f, '730x0', hotel.watermark ? hotel.watermark : '', 3) + ')'
                                                    :'url(' + o.tour.photo.view.getLink(Array.isArray(hotel.f) ? o.fn.getFirst(hotel.f) : hotel.f, '200x150', '', 2) + ')')
                                    ).append(
                                        $('<div>')
                                            .addClass(o.fn.prefix('t-header-gallery-mobile'))
                                            .append(
                                                $('<div>')
                                                    .addClass('owl-carousel')
                                                    .addClass(o.fn.prefix('t-header-gallery-slider-body'))
                                                    .on('init', function(){

                                                        if(o.fn.isMobile()) {
                                                            var that = this;
                                                            $.each(hotel.f, function(i, photo){
                                                                $(that).append(
                                                                    $('<div>')
                                                                        .addClass(o.fn.prefix('t-header-gallery-slider-item'))
                                                                        .css('background-image', 'url(https://newimg.otpusk.com/3'+ (hotel.watermark? '_'+ hotel.watermark:'') +'/730x0/'+ photo +')')
                                                                )
                                                            });
                                                        }

                                                        if(o.fn.isMobile()) {
                                                            $(that).owlCarousel({
                                                                nav: false,
                                                                dots: true,
                                                                items: 1,
                                                                loop: true
                                                            })
                                                        }

                                                    }).trigger('init')
                                            )
                                    )
                            )
                    ).append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-header-col'))
                            .append(
                                $('<div>')
                                    .addClass(o.fn.prefix('t-header-top'))
                                    .append(
                                        $('<div>')
                                            .addClass(o.fn.prefix('t-header-title'))
                                            .html(hotel.n + '<span style="display: none;" data-stars="' + hotel.s.n + '">' + hotel.nm + '<b></b><b></b><b></b><b></b><b></b></span>')
                                    ).append(
                                        $('<div>')
                                            .addClass(o.fn.prefix('t-header-geo'))
                                            .addClass(o.fn.prefix(is_map_enable ? 't-geo-with-map' : 't-geo-without-map'))
                                            .append('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30.68 43.81"><path d="M26.19,4.49a15.35,15.35,0,0,0-21.7,0c-5.36,5.36-6,15.45-1.44,21.56L15.34,43.81,27.61,26.08c4.61-6.14,3.94-16.22-1.42-21.59ZM15.48,20.8a5.6,5.6,0,1,1,5.6-5.6,5.61,5.61,0,0,1-5.6,5.6Zm0,0"></path></svg>')
                                            .append(
                                                $('<div>')
                                                    .addClass(o.fn.prefix('t-header-geo-icon'))
                                            ).append(hotel.t.n +', '+ hotel.c.n)
                                            .click(function(){
                                                if(is_map_enable) {
                                                    $('.new_t-menu-item[data-name = "map"]').trigger('click');
                                                    $('html').addClass(o.fn.prefix('layer-open-map'));
                                                }
                                            })
                                    ).append(
                                        +hotel.v > 0 && $('<div>')
                                            .addClass(o.fn.prefix('r-item-rating-container'))
                                            .addClass(o.fn.prefix('r-p'+ parseInt(hotel.r)))
                                            .append(
                                                $('<span>')
                                                    .addClass(o.fn.prefix('r-item-rating-value'))
                                                    .text(hotel.r? hotel.r.toString().replace('.',','): '')
                                            ).append(
                                                $('<span>')
                                                    .addClass(o.fn.prefix('r-item-rating-rev'))
                                                    .append($('<span>').text(hotel.v))
                                                    .append(o.fn.suffixForNumber(hotel.v, [o._('отзыв'), o._('отзыва'), [o._('отзывов')]]))
                                            ).append(
                                                $('<span>')
                                                    .addClass('slice')
                                                    .append($('<div>').addClass('bar'))
                                                    .append($('<div>').addClass('fill'))
                                            )
                                            .click(function(){
                                                if (+hotel.v > 0) {
                                                    $('.new_t-menu-item[data-name = "reviews"]').trigger('click');
                                                    if ($(o.fn.prefix('check-mobile','.')).is(':visible')) {
                                                        $('html').addClass(o.fn.prefix('modal-open'));
                                                    }
                                                }

                                            })
                                    ).append(
                                        $('<div>')
                                            .addClass(o.fn.prefix('t-header-desc'))
                                            .append(hotel.o.dc)
                                    )
                            )
                    )
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('t-content'))
                    .append(
                        self.$message = $('<div>')
                            .hide()
                            .addClass(o.fn.prefix('t-notice-msg'))
                            .on('show', function(e, msg) {
                                $(this).empty().append(msg).fadeIn(25);
                                return false;
                            })
                            .on('hide', function() {
                                $(this).fadeOut(25);
                                return false;
                            })
                    )
                    .append(
                        self.$spinner_offer = $('<div>')
                            .addClass(o.fn.prefix('loading-container'))
                    ).append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-modal-wrap'))
                            .append(
                                $('<div>')
                                    .addClass(o.fn.prefix('t-modal-body'))
                                    .append(
                                        $('<div>')
                                            .addClass(o.fn.prefix('t-modal-body-close'))
                                            .html('&times;')
                                            .on('click', function(){

                                                $(this).parent().find(o.fn.prefix('t-modal-body-item','.')).hide().fadeOut(100, function(){
                                                    $('html')
                                                        .removeClass(o.fn.prefix('modal-open-food'))
                                                        .removeClass(o.fn.prefix('modal-open'));
                                                });

                                                return false;
                                            })
                                    ).append(
                                        self.$modalDates = this.getDatesModal(hotel)
                                    ).append(
                                        self.$modalFoods = this.getFoodsModal(hotel)
                                    ).append(
                                        self.$modalTransport = this.getTransportModal(hotel)
                                    ).append(
                                        self.$modalOrder = this.getOrderModal()
                                    )
                            )
                    ).append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-content-table'))
                            .append(
                                self.$content = $('<div>')
                                    .addClass(o.fn.prefix('t-content-col'))
                                    .addClass(o.fn.prefix('t-tabs-content'))
                                    .append(
                                        self.$tourPage = $('<div>')
                                            .css('display', 'none')
                                            .addClass(o.fn.prefix('t-tab-content tour'))
                                    ).append(
                                        self.$descPage = $('<div>')
                                            .css('display', 'none')
                                            .addClass(o.fn.prefix('t-tab-content hotelInfo'))
                                    ).append(
                                        self.$photoPage = $('<div>')
                                            .css('display', 'none')
                                            .addClass(o.fn.prefix('t-tab-content photo'))
                                    ).append(
                                        self.$mapPage = $('<div>')
                                            .css('display', 'none')
                                            .addClass(o.fn.prefix('t-tab-content map'))
                                    ).append(
                                        self.$reviewsPage = $('<div>')
                                            .css('display', 'none')
                                            .addClass(o.fn.prefix('t-tab-content reviews'))
                                    )
                            ).append(
                                self.$orderBlock = self.renderOrderBlock(hotel)
                            ).append(
                                $('<div>')
                                    .addClass(o.fn.prefix('t-content-col'))
                                    .addClass(o.fn.prefix('t-order-content'))
                                    .addClass(o.fn.prefix('t-order-content-mobile'))
                                    .append(
                                        $('<div>')
                                            .addClass(o.fn.prefix('t-order-table'))
                                            .append(
                                                $('<div>')
                                                    .addClass(o.fn.prefix('t-order-col'))
                                                    .append(
                                                        $('<div>')
                                                            .addClass(o.fn.prefix('t-order-return'))
                                                            .append('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000"><path d="M787,702.7c-9.5-9.5-24.5-9.2-34.6,0L524.5,906.1V34.5c0-13.5-11-24.5-24.5-24.5s-24.5,11-24.5,24.5v871.6L247.7,703c-10.4-8.9-24.8-9.8-34.3-0.3c-9.5,9.5-10.1,26-0.3,34.9c0,0,266.4,242.5,269.5,245c3.1,2.4,8.6,7.3,17.5,7.3s15-4.9,17.5-7.3c2.5-2.5,269.5-245,269.5-245c4.6-4.6,7-11,7-17.5S791.6,707.6,787,702.7z"></path></svg>')
                                                            .append(o._('Вернуться в поиск'))
                                                            .click(function() {
                                                                $(o.fn.prefix('t-menu-back-link','.')).trigger('click');
                                                            })
                                                    )
                                            ).append(
                                                $('<div>')
                                                    .addClass(o.fn.prefix('t-order-col'))
                                                    .append(
                                                        $('<div>')
                                                            .addClass(o.fn.prefix('t-order-btn'))
                                                            .text(o._('Заказать тур'))
                                                            .click(function() {
                                                                $('.new_t-order-btn-true').trigger('click');
                                                            })
                                                    )
                                                    .append(
                                                        $('<span>')
                                                            .text('Код:')
                                                    )
                                                    .append(
                                                        $('<span>')
                                                            .addClass(o.fn.prefix('t-order-code'))
                                                    )
                                            )
                                    )
                            )
                    )
            ).append(
                self.renderSimilarHotels(hotel)
            );

            self.$.find(o.fn.prefix('r-lazy-img', '.')).trigger('dom.mount');

            // trigger click for load the current page content
            self.$menu.find('div[data-name="'+ o.hash.get('page', self.defaultTab) +'"]').trigger('click');

            // init spinner for offer
            o.spinner.view.render(self.$spinner_offer);

            //scroll to "back to results" onload
            if(self.scrollToTour) {
                if (typeof EnableScrollToResults === 'undefined') {
                    $('html, body').animate({
                        scrollTop: $(o.fn.prefix('t-menu-back-link', '.')).offset().top - 22
                    }, 1000);
                }
            }

            //viewed tours gallery
            if($(o.fn.prefix('t-similar-viewed-gallery','.')).html()) {
                //setTimeout(function() {
                    $(o.fn.prefix('t-similar-viewed-gallery','.')).owlCarousel({
                        items: $('.'+otpMain.fn.prefix('os')).parent().width() < 620 ? 1 : ($('.new_r-container').parent().width() < 1196 && $('.'+otpMain.fn.prefix('os')).parent().width() >= 620 ? 2 : 3),
                        nav: true,
                        dots: true
                    });
                //}, 1000);
            } else {
                $(o.fn.prefix('t-similar-viewed-gallery','.')).parent().hide();
            }
        };

        this.getTabs = function (hotel) {
            var is_map_enable = (otpMain.apiType === 'full' && hotel.g && hotel.g.a && +hotel.g.a !== 0);

            return $('<div>')
                .addClass(o.fn.prefix('t-menu'))
                .append(
                    $('<div>')
                        .addClass(o.fn.prefix('t-menu-item'))
                        .addClass(o.fn.prefix('t-tab-tour'))
                        .attr('data-name', 'tour')
                        .text('Тур')
                ).append(
                    $('<div>')
                        .addClass(o.fn.prefix('t-menu-item'))
                        .addClass(o.fn.prefix('t-tab-desc'))
                        .attr('data-name', 'hotelInfo')
                        .text(o._('Описание'))
                ).append(
                    $('<div>')
                        .addClass(o.fn.prefix('t-menu-item'))
                        .addClass(o.fn.prefix('t-tab-photos'))
                        .attr('data-name', 'photo')
                        .css('display', hotel.f && hotel.f.length > 0 ? '' : 'none')
                        .append(o._('Фотографии'))
                        .append(hotel.f ? ' <span>' + hotel.f.length + '</span>' : '')
                ).append(
                    $('<div>')
                        .addClass(o.fn.prefix('t-menu-item'))
                        .addClass(o.fn.prefix('t-tab-map'))
                        .attr('data-name', 'map')
                        .css('display', is_map_enable ? '' : 'none')
                        .text(o._('Карта'))
                ).append(
                    $('<div>')
                        .addClass(o.fn.prefix('t-menu-item'))
                        .addClass(o.fn.prefix('t-tab-rev'))
                        .attr('data-name', 'reviews')
                        .css('display', hotel.v && +hotel.v > 0 ? '' : 'none')
                        .append(o._('Отзывы'))
                        .append(+hotel.v ? ' <span>' + hotel.v + '</span>' : '')
                ).on('click', function (e) {

                    // #14168
                    if (['tour', 'hotelInfo', 'photo', 'map', 'reviews'].indexOf($(e.target).attr('data-name')) === -1) {
                        return false;
                    }

                    // switch active menu item
                    $(this).find('div.selected').removeClass('selected');
                    $(e.target).addClass('selected');

                    // switch active page container
                    self.$content.find('div' + o.fn.prefix('t-tab-content', '.')).fadeOut(100);
                    self.$content.find('div.' + $(e.target).attr('data-name')).fadeIn(200);

                    // render selected page
                    switch ($(e.target).attr('data-name')) {
                        case 'tour':
                            o.hash.add('page', 'tour');
                            o.hash.compile();

                            // o.tour.view.renderTour(self.$tourPage, hotel);
                            break;
                        case 'hotelInfo':
                            o.hash.add('page', 'hotelInfo');
                            o.hash.compile();

                            o.tour.hotelInfo.view.render(self.$descPage, hotel);
                            break;
                        case 'photo':
                            if (o.fn.isMobile()) {
                                o.hash.add('page', 'tour');
                                o.hash.compile();
                                $('html,body').animate({scrollTop: self.$.offset().top}, 200);
                                self.$menu.find('[data-name=tour]').trigger('click');
                            }
                            else {
                                o.hash.add('page', 'photo');
                                o.hash.compile();
                                o.tour.photo.view.render(self.$photoPage, hotel);
                            }
                            break;
                        case 'map':
                            o.hash.add('page', 'map');
                            o.hash.compile();

                            o.tour.hotelMap.view.render(self.$mapPage, hotel);

                            //#14292
                            if (!o.fn.isMobile()) {
                                $('html').addClass(o.fn.prefix('layer-open-map'));
                            }

                            break;
                        case 'reviews':
                            o.hash.add('page', 'reviews');
                            o.hash.compile();

                            o.tour.reviews.view.render(self.$reviewsPage, hotel);
                            break;
                    }

                    return false;
                });
        };

        /**
         * Render the tour page
         * @param $el
         * @param hotel
         */
        this.renderTour = function($el, hotel, offer){

            // update tour order block
            self.$orderBlock.trigger('refresh');

            // render the tour page
            $el.append(
                $('<div>')
                    .addClass(o.fn.prefix('t-tour-tab-table tourist-table'))
                    .append(this.renderPeopleValues(hotel, offer))
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('t-tour-tab-table date-table'))
                    .append(this.renderDatesValues(hotel, offer))
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('t-tour-tab-table food-table'))
                    .append(this.renderFoodValues(hotel, offer))
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('t-tour-tab-table services-table'))
                    .append(this.renderServiceValues(hotel, offer))
            );

            // init spinner for matrix
            o.spinner.view.render(self.$spinner_matrix);

            // ga tracker
            if(o.tracker) {
                o.tracker.send('event', 'Отпуск.НаСайт Поиск', 'Открыта страница тура', hotel.t.n +'+'+ hotel.c.n +'+'+ hotel.n +'+'+ offer.pl+' грн.');
            }
        };

        this.renderPeopleValues = function(hotel, offer) {
            return [
                $('<div>')
                    .addClass(o.fn.prefix('t-tour-tab-col'))
                    .addClass(o.fn.prefix('t-tour-tab-col-1'))
                    .append('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 98.16 98"><path d="M25.28,9.68A9.68,9.68,0,1,1,15.6,0a9.68,9.68,0,0,1,9.68,9.68Zm0,0"></path><path d="M4.8,53.28h1v19.2a4.81,4.81,0,0,0,4.8,4.8H20.64a4.81,4.81,0,0,0,4.8-4.8V71.36A12.09,12.09,0,0,1,24,65.76V40.64a12,12,0,0,1,7.2-11V27.76A4.81,4.81,0,0,0,26.4,23H4.8A4.81,4.81,0,0,0,0,27.76V48.48a4.76,4.76,0,0,0,4.8,4.8Zm0,0"></path><path d="M92.32,9.68A9.68,9.68,0,1,1,82.64,0a9.68,9.68,0,0,1,9.68,9.68Zm0,0"></path><path d="M67,27.68V29.6a12,12,0,0,1,7.2,11v25a11.21,11.21,0,0,1-1.44,5.6v1.12a4.81,4.81,0,0,0,4.8,4.8H87.6a4.81,4.81,0,0,0,4.8-4.8V53.12h1a4.81,4.81,0,0,0,4.8-4.8V27.68a4.81,4.81,0,0,0-4.8-4.8H71.76a4.81,4.81,0,0,0-4.8,4.8Zm0,0"></path><path d="M31.28,40.64V65.76a4.81,4.81,0,0,0,4.8,4.8h1.84V93.2a4.81,4.81,0,0,0,4.8,4.8H55.6a4.81,4.81,0,0,0,4.8-4.8V70.48h1.84a4.81,4.81,0,0,0,4.8-4.8v-25a4.81,4.81,0,0,0-4.8-4.8H36.08a4.76,4.76,0,0,0-4.8,4.8Zm0,0"></path><path d="M60.24,20.72A11.12,11.12,0,1,1,49.12,9.6,11.12,11.12,0,0,1,60.24,20.72Zm0,0"></path></svg>')
                    .append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-tour-tab-col-1-title'))
                            .append(o._('Туристы'))
                    ),
                $('<div>')
                    .addClass(o.fn.prefix('t-tour-tab-col'))
                    .addClass(o.fn.prefix('t-tour-tab-col-2'))
                    .append(
                        $('<span>')
                            .addClass(o.fn.prefix('weight-bold'))
                            .html(offer.i ? o.form.people.view.printPeoples(offer.y || o.hash.get('p')) : '')
                    )
                    .append(
                        self.$modalPeople = this.renderPeopleSelectDropdown(hotel)
                    )
            ];
        };

        this.renderDatesValues = function (hotel, offer) {
            return [
                $('<div>')
                    .addClass(o.fn.prefix('t-tour-tab-col'))
                    .addClass(o.fn.prefix('t-tour-tab-col-1'))
                    .append('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 381.86 390.52"><g><path d="M138,215.45a8.86,8.86,0,0,0-8.86-8.86H98.16a8.86,8.86,0,0,0-8.86,8.86v30.92a8.86,8.86,0,0,0,8.86,8.86h30.93a8.86,8.86,0,0,0,8.86-8.86Zm0,0"></path><path d="M215.26,215.45a8.86,8.86,0,0,0-8.86-8.86H175.46a8.86,8.86,0,0,0-8.86,8.86v30.92a8.86,8.86,0,0,0,8.86,8.86H206.4a8.86,8.86,0,0,0,8.86-8.86Zm0,0"></path><path d="M292.57,215.45a8.86,8.86,0,0,0-8.86-8.86H252.77a8.86,8.86,0,0,0-8.86,8.86v30.92a8.86,8.86,0,0,0,8.86,8.86h30.93a8.86,8.86,0,0,0,8.86-8.86Zm0,0"></path><path d="M138,292.76a8.86,8.86,0,0,0-8.86-8.86H98.16a8.86,8.86,0,0,0-8.86,8.86v30.92a8.86,8.86,0,0,0,8.86,8.86h30.93a8.86,8.86,0,0,0,8.86-8.86Zm0,0"></path><path d="M215.26,292.76a8.86,8.86,0,0,0-8.86-8.86H175.46a8.86,8.86,0,0,0-8.86,8.86v30.92a8.86,8.86,0,0,0,8.86,8.86H206.4a8.86,8.86,0,0,0,8.86-8.86Zm0,0"></path><path d="M292.57,292.76a8.86,8.86,0,0,0-8.86-8.86H252.77a8.86,8.86,0,0,0-8.86,8.86v30.92a8.86,8.86,0,0,0,8.86,8.86h30.94a8.86,8.86,0,0,0,8.86-8.86Zm0,0"></path><path d="M347.88,43.48V90.72a38.59,38.59,0,0,1-38.67,38.56H284.81a38.78,38.78,0,0,1-38.9-38.56V43.31H136V90.72a38.78,38.78,0,0,1-38.9,38.56H72.66A38.58,38.58,0,0,1,34,90.72V43.48a35.16,35.16,0,0,0-34,35V355.31a35.18,35.18,0,0,0,35,35.21H346.86a35.22,35.22,0,0,0,35-35.21V78.46a35.16,35.16,0,0,0-34-35ZM336.54,338.07a15.13,15.13,0,0,1-15.13,15.13H59.78a15.14,15.14,0,0,1-15.13-15.13v-143a15.14,15.14,0,0,1,15.13-15.14H321.41a15.14,15.14,0,0,1,15.13,15.14Zm0,0"></path><path d="M72.57,104H96.7A13.25,13.25,0,0,0,110,90.7V13.26A13.26,13.26,0,0,0,96.7,0H72.57A13.26,13.26,0,0,0,59.31,13.26V90.7A13.25,13.25,0,0,0,72.57,104Zm0,0"></path><path d="M284.5,104h24.13A13.25,13.25,0,0,0,321.89,90.7V13.26A13.26,13.26,0,0,0,308.63,0H284.5a13.26,13.26,0,0,0-13.26,13.26V90.7A13.25,13.25,0,0,0,284.5,104Zm0,0"></path></g></svg>')
                    .append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-tour-tab-col-1-title'))
                            .append(o._('Дата отправления'))
                            .append($('<br>'))
                            .append(o._(' и длительность тура'))
                    ),
                $('<div>')
                    .addClass(o.fn.prefix('t-tour-tab-col'))
                    .addClass(o.fn.prefix('t-tour-tab-col-2'))
                    .append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-date-table'))
                            .css('opacity', 1)
                            .append(
                                $('<div>')
                                    .addClass(o.fn.prefix('t-date-col'))
                                    .addClass(o.fn.prefix('t-nostretch'))
                                    .append(
                                        $('<div>')
                                            .addClass(o.fn.prefix('t-important'))
                                            .append(offer.i ? o.form.datepicker.getTextDate(offer.d, {parts: ['d', 'm', 'yyyy']}, ' ') : '')
                                            .append(offer.i ? ', ' + o.form.datepicker.getTextDate(offer.d, {parts: ['D']}).toLowerCase() : '')
                                    ).append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('weight-bold'))
                                        .append(
                                            $('<nobr>')
                                                .append(offer.i ?
                                                    (!$.isEmptyObject(offer.to) && !$.isEmptyObject(offer.to.from) ? offer.to.from[0]['portFr'] : o.form.fromCity.view.getCityFromId(offer.c)['name'])
                                                    : '')
                                                .append(offer.i ? ' &rarr; ' : '')
                                        ).append(offer.i ?
                                        (!$.isEmptyObject(offer.to) && !$.isEmptyObject(offer.to.from) ? offer.to.from[0]['portTo'] : hotel.t.n)
                                        : '')
                                ).append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('t-important'))
                                        .append(!$.isEmptyObject(offer.to) && !$.isEmptyObject(offer.to.from) ? (offer.to.from[0]['code'] + ' ' + offer.to.from[0]['begin'].split(' ')[1] || '') : '')
                                )
                            ).append(
                            $('<div>')
                                .addClass(o.fn.prefix('t-date-col'))
                                .addClass(o.fn.prefix('t-duration-col'))
                                .addClass(!$.isEmptyObject(offer.to) && !$.isEmptyObject(offer.to.to) ? '' : o.fn.prefix('t-no-3rd-row'))
                                .append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('t-duration-container'))
                                        .append(offer.i ?
                                            o.fn.suffixForNumber(+offer.l - 1, [o._('ночь'), o._('ночи'), 'ночей'], true) + ' / ' + o.fn.suffixForNumber(+offer.l, ['день', o._('дня'), o._('дней')], true)
                                            : '')
                                ).append(
                                $('<div>')
                                    .addClass(o.fn.prefix('t-duration-icons'))
                                    .append(
                                        $('<div>')
                                            .addClass(o.fn.prefix('t-duration-icon'))
                                            .addClass(o.fn.prefix('t-duration-icon-left'))
                                            .addClass(o.fn.prefix('t-' + offer.t))
                                            .append(o.form.transport.view.getTransportIcon(offer.t))
                                    ).append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('t-duration-icon'))
                                        .addClass(o.fn.prefix('t-duration-icon-right'))
                                        .addClass(o.fn.prefix('t-' + offer.t))
                                        .append(o.form.transport.view.getTransportIcon(offer.t))
                                )
                            ).append(
                                $('<div>')
                                    .addClass(o.fn.prefix('t-duration-text'))
                                    .append(o.form.transport.view.getTransportText(offer.t, true)).append(
                                    $('<span>')
                                        .text(offer.t === 'no' ? '' : ' (включен)')
                                )
                            )
                        ).append(
                            $('<div>')
                                .addClass(o.fn.prefix('t-date-col'))
                                .addClass(o.fn.prefix('t-nostretch'))
                                .append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('t-important'))
                                        .on('init', function () {
                                            if (offer.i) {

                                                var dateTo = o.form.datepicker.parseISO8601(offer.d);
                                                dateTo.setDate(dateTo.getDate() + (+offer.l - 1));

                                                $(this)
                                                    .append(o.form.datepicker.getTextDate(dateTo, {parts: ['d', 'm', 'yyyy']}, ' '))
                                                    .append(', ' + o.form.datepicker.getTextDate(dateTo, {parts: ['D']}).toLowerCase())
                                            }
                                        }).trigger('init')
                                ).append(
                                $('<div>')
                                    .addClass(o.fn.prefix('weight-bold'))
                                    .append(
                                        $('<nobr>')
                                            .append(!$.isEmptyObject(offer.to) && !$.isEmptyObject(offer.to.to) ? offer.to.to[0]['portFr'] : hotel.t.n)
                                            .append(offer.i ? ' &rarr; ' : '')
                                    ).append(!$.isEmptyObject(offer.to) && !$.isEmptyObject(offer.to.to) ? offer.to.to[0]['portTo'] : o.form.fromCity.view.getCityFromId(offer.c)['name'])
                            ).append(
                                $('<div>')
                                    .addClass(o.fn.prefix('t-important'))
                                    .append(!$.isEmptyObject(offer.to) && !$.isEmptyObject(offer.to.to) ? (offer.to.to[0]['code'] + ' ' + offer.to.to[0]['begin'].split(' ')[1] || '') : '')
                            )
                        )
                    ).append(
                    $('<span>')
                        .addClass(o.fn.prefix('t-change-btn'))
                        .addClass(o.fn.prefix('t-change-date'))
                        .append(
                            $('<span>')
                                .append(o._('Ещё'))
                                .append('<svg width="20" height="20" viewBox="0 0 2020 2020"><path d="M1331 672q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50 50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23 10l50 50q10 10 10 23z"></path></svg>')
                        ).on('click', function () {

                        $('html').addClass(o.fn.prefix('modal-open'));
                        var modalTitle = o._('Даты и длительность') + ' (' + o._('из') + ' ' + o.form.fromCity.view.getCityFromId(offer.c)['rel'] + ')';
                        self.$modalDates.find(o.fn.prefix('t-modal-body-top', '.')).text(modalTitle); // #14211#note-8

                        self.$modalDates.fadeIn(200, function () {
                            if (!self.$matrix.attr('data-refresh')) {
                                self.$modalDates.trigger('refresh');
                            }
                        });
                    })
                )
            ];
        };

        this.renderFoodValues = function (hotel, offer) {
            return [
                $('<div>')
                    .addClass(o.fn.prefix('t-tour-tab-col'))
                    .addClass(o.fn.prefix('t-tour-tab-col-1'))
                    .append('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 14.11"><path d="M3.09,11.83c0-.27,0-.55.07-.82a16.6,16.6,0,0,1,.35-2c.09-.32.19-.64.29-.94l.38-.89a7.67,7.67,0,0,1,1-1.55l.26-.34L5.72,5a7.13,7.13,0,0,1,.58-.53,7.76,7.76,0,0,1,1.13-.76,6.72,6.72,0,0,1,.93-.46l.84-.32-.71.54c-.23.15-.48.39-.77.64A12.27,12.27,0,0,0,6.8,5a6.58,6.58,0,0,0-.45.56l-.23.29-.2.33a9.21,9.21,0,0,0-.74,1.45c-.09.27-.18.54-.28.82s-.14.58-.22.86a16.32,16.32,0,0,0-.29,1.82c0,.23-.05.45-.07.68H18.43c0-.23,0-.47,0-.71A8.66,8.66,0,0,0,11,2.42a1.4,1.4,0,1,0-2.35-1,1.39,1.39,0,0,0,.44,1,8.66,8.66,0,0,0-7.51,8.71c0,.23,0,.47,0,.7Zm0,0"></path><rect y="12.35" width="20" height="1.77"></rect></svg>')
                    .append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-tour-tab-col-1-title'))
                            .append(o._('Тип номера'))
                            .append($('<br>'))
                            .append(o._(' и питание'))
                    ),
                $('<div>')
                    .addClass(o.fn.prefix('t-tour-tab-col'))
                    .addClass(o.fn.prefix('t-tour-tab-col-2'))
                    .append(
                        $('<div>').append(
                            $('<span>')
                                .addClass(o.fn.prefix('weight-bold'))
                                .text('Номер: ')
                        ).append(
                            $('<span>')
                                .addClass(o.fn.prefix('t-important'))
                                .html(offer.r)
                        )
                    ).append(
                    $('<div>').append(
                        $('<span>')
                            .addClass(o.fn.prefix('weight-bold'))
                            .text(o._('Питание') + ': ')
                    ).append(
                        $('<span>')
                            .addClass(o.fn.prefix('t-important'))
                            .text(offer.i ?
                                o.fn.ucFirst(o.form.food.view.getFoodInfo(offer.f)['description']) + ' (' + o.form.food.view.getFoodInfo(offer.f)['label'] + ')'
                                : '')
                    )
                ).append(
                    $('<span>')
                        .addClass(o.fn.prefix('t-change-btn'))
                        .addClass(o.fn.prefix('t-change-food'))
                        .attr('data-name', 'food')
                        .append(
                            $('<span>')
                                .append(o._('Ещё'))
                                .append('<svg width="20" height="20" viewBox="0 0 2020 2020"><path d="M1331 672q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50 50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23 10l50 50q10 10 10 23z"></path></svg>')
                        ).on('click', function () {

                        $('html')
                            .addClass(o.fn.prefix('modal-open'))
                            .addClass(o.fn.prefix('modal-open-food'));

                        self.$modalDates.find(o.fn.prefix('t-modal-body-top', '.')).text(o._('Номер и питание')); // #14211#note-8

                        // if rendered matrix
                        if (self.$matrix.attr('data-rendered')) {

                            // show modal foods
                            self.$modalFoods.fadeIn(200, function () {
                                if (!self.$modalFoods.html()) {
                                    self.$modalFoods.trigger('refresh');
                                }
                            });

                            // show matrix spinner and load offers
                        } else {

                            self.$modalDates.fadeIn(200, function () {
                                if (!self.$matrix.attr('data-refresh')) {
                                    self.$modalDates.trigger('refresh', {
                                        'callback': function () {

                                            // show modal foods after loaded offers
                                            if (self.$modalDates.is(':visible')) {
                                                self.$modalDates.fadeOut(200, function () {
                                                    self.$modalFoods.fadeIn(200, function () {
                                                        if (!self.$modalFoods.html()) {
                                                            self.$modalFoods.trigger('refresh');
                                                        }
                                                    });
                                                })
                                            }
                                        }
                                    })
                                }
                            });
                        }
                        return false;
                    })
                )
            ];
        };

        this.renderServiceValues = function(hotel, offer) {
            return [
                $('<div>')
                    .addClass(o.fn.prefix('t-tour-tab-col'))
                    .addClass(o.fn.prefix('t-tour-tab-col-1'))
                    .append('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 184.98 184.98"><path d="M184.4,82.23c-.29-2.6-3.32-4.56-5.94-4.56a20.42,20.42,0,0,1-14-35.54,5.14,5.14,0,0,0,.56-7,91.54,91.54,0,0,0-14.65-14.8,5.15,5.15,0,0,0-7,.57,21.32,21.32,0,0,1-23.07,5.18A20.55,20.55,0,0,1,107.8,6a5.13,5.13,0,0,0-4.54-5.4A92.26,92.26,0,0,0,82.45.56a5.16,5.16,0,0,0-4.58,5.29A20.58,20.58,0,0,1,65.2,25.59a21.38,21.38,0,0,1-22.9-5.21,5.15,5.15,0,0,0-7-.59,91.92,91.92,0,0,0-15,14.79,5.15,5.15,0,0,0,.55,7,20.49,20.49,0,0,1,5.17,23.08C22.9,72.29,15,77.19,6,77.19A5,5,0,0,0,.62,81.73a92.85,92.85,0,0,0,0,21c.29,2.61,3.41,4.55,6.07,4.55a20.28,20.28,0,0,1,19,12.67,20.58,20.58,0,0,1-5.17,22.88,5.13,5.13,0,0,0-.56,7,91.78,91.78,0,0,0,14.63,14.8,5.14,5.14,0,0,0,7-.56,21.29,21.29,0,0,1,23.06-5.18A20.52,20.52,0,0,1,77.19,179a5.13,5.13,0,0,0,4.53,5.4,92.51,92.51,0,0,0,20.81.06,5.15,5.15,0,0,0,4.57-5.3,20.57,20.57,0,0,1,12.66-19.73,21.36,21.36,0,0,1,22.91,5.21,5.17,5.17,0,0,0,7,.59,92.05,92.05,0,0,0,15-14.8,5.14,5.14,0,0,0-.55-7,20.5,20.5,0,0,1-5.18-23.07,20.71,20.71,0,0,1,18.92-12.54l1.14,0a5.15,5.15,0,0,0,5.41-4.54,92.28,92.28,0,0,0,0-21ZM92.49,145.82a53.32,53.32,0,1,1,45.78-26L114.92,96.48A32.71,32.71,0,0,0,76.2,52.18a3.71,3.71,0,0,0-2.56,2.58,3.62,3.62,0,0,0,1,3.54S86.19,69.91,90,73.77a2.39,2.39,0,0,1,.35,1.71l0,.25A74.1,74.1,0,0,1,88.6,87l-.25.24-.26.26A72.26,72.26,0,0,1,76.64,89.3v0l-.2.05h-.18a2.47,2.47,0,0,1-1.77-.75c-4-4-15.09-15-15.09-15a3.75,3.75,0,0,0-2.69-1.2,3.66,3.66,0,0,0-3.44,2.79,32.71,32.71,0,0,0,44.32,38.66l23.6,23.61a53.06,53.06,0,0,1-28.69,8.39Zm0,0"></path></svg>')
                    .append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-tour-tab-col-1-title'))
                            .text(o._('Услуги'))
                    ),
                $('<div>')
                    .addClass(o.fn.prefix('t-tour-tab-col'))
                    .addClass(o.fn.prefix('t-tour-tab-col-2'))
                    .append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-service-item ' + o.fn.prefix('transfer')))
                            .append('Трансфер')
                    ).append(
                    $('<div>')
                        .addClass(o.fn.prefix('t-service-item ' + o.fn.prefix('insurance')))
                        .append('Страховка')
                ).append(
                    $('<div>')
                        .addClass(o.fn.prefix('t-service-item ' + o.fn.prefix('visa')))
                        .append(o._('Виза'))
                ).on('set_icons', function () {

                    var that = this;
                    $.each(['transfer', 'insurance', 'visa'], function (i, item) {

                        // set yes
                        if (offer.o.indexOf(item) !== -1) {
                            $(that).find(o.fn.prefix(item, '.'))
                                .addClass(o.fn.prefix('t-service-item-yes'))
                                .append('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100.11 100.11"><path d="M93.4,24.93A49.84,49.84,0,0,0,75.18,6.71,49,49,0,0,0,50.06,0,49,49,0,0,0,24.93,6.71,49.8,49.8,0,0,0,6.71,24.93,49,49,0,0,0,0,50.06,49,49,0,0,0,6.71,75.18,49.82,49.82,0,0,0,24.93,93.4a49,49,0,0,0,25.13,6.71A49,49,0,0,0,75.18,93.4,49.83,49.83,0,0,0,93.4,75.18a49,49,0,0,0,6.71-25.13A49,49,0,0,0,93.4,24.93ZM82.52,42.43,47.12,77.82a4.09,4.09,0,0,1-3,1.24,4,4,0,0,1-2.93-1.24L17.6,54.23a4,4,0,0,1-1.17-2.93,4.06,4.06,0,0,1,1.17-3l5.93-5.87a4.1,4.1,0,0,1,5.87,0L44.12,57.16,70.72,30.63a4.09,4.09,0,0,1,5.87,0l5.93,5.87a4,4,0,0,1,1.18,3,4,4,0,0,1-1.18,2.93Zm0,0"></path></svg>');

                            // set no
                        } else {
                            $(that).find(o.fn.prefix(item, '.'))
                                .addClass(o.fn.prefix('t-service-item-no'))
                                .append('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100.11 100.11"><path d="M93.4,24.93A49.84,49.84,0,0,0,75.18,6.71,49,49,0,0,0,50.06,0,49,49,0,0,0,24.93,6.71,49.8,49.8,0,0,0,6.71,24.93,49,49,0,0,0,0,50.06,49,49,0,0,0,6.71,75.18,49.82,49.82,0,0,0,24.93,93.4a49,49,0,0,0,25.13,6.71A49,49,0,0,0,75.18,93.4,49.83,49.83,0,0,0,93.4,75.18a49,49,0,0,0,6.71-25.13A49,49,0,0,0,93.4,24.93ZM79.26,54.23a4.23,4.23,0,0,1-4.17,4.17H25a4.23,4.23,0,0,1-4.17-4.17V45.89A4.23,4.23,0,0,1,25,41.72H75.09a4.23,4.23,0,0,1,4.17,4.17Zm0,0"></path></svg>');
                        }
                    });

                }).trigger('set_icons')
            ];
        };

        this.renderOrderBlock = function(hotel) {
            return $('<div>')
                .addClass(o.fn.prefix('t-content-col'))
                .addClass(o.fn.prefix('t-order-content'))
                .css('display', 'none')
                .append(
                    $('<div>')
                        .addClass(o.fn.prefix('t-order-table'))
                        .append(
                            $('<div>')
                                .addClass(o.fn.prefix('t-order-col'))
                                .append(o._('Итого:'))
                                .append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('t-order-price'))
                                ).append(
                                $('<div>')
                                    .addClass(o.fn.prefix('t-order-price-descr'))
                                    .on('os.render', function(e, offer, hotel, flights) {
                                        $(this).empty().append(self.renderPriceDescription(offer, hotel, flights));
                                    })
                            )
                        ).append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-order-col'))
                            .append(
                                $('<div>')
                                    .addClass(o.fn.prefix('t-order-btn'))
                                    .addClass(o.fn.prefix('t-order-btn-true'))
                                    .text(o._('Заказать тур'))
                                    .on('click', function(){
                                        if(o.settings.get('osOrderUrl', null) !== null) {
                                            o.fn.performPostRequest(
                                                o.settings.get('osOrderUrl'),
                                                o.tour.formatOfferObject(o.tour.hotel, o.tour.offer)
                                            );
                                        }
                                        else {
                                            otpMainOrder.showForm(this, o.apiId, {
                                                'open':  function ($e) {

                                                    $('body').addClass(o.fn.prefix('t-order-form-open'));
                                                    $e.find('.os-order-top-part').hide();

                                                    // ga tracker
                                                    if (o.tracker && otpMain.tour.hotel) {
                                                        o.tracker.send('event', 'Отпуск.НаСайт Поиск', 'Открыта форма заказа', otpMain.tour.hotel.t.n + '+' + otpMain.tour.hotel.c.n + '+' + otpMain.tour.hotel.n + '+' + o.tour.offer.pl + ' грн.');
                                                    }
                                                },
                                                'sent':  function () {

                                                    // ga tracker
                                                    if (o.tracker && otpMain.tour.hotel) {
                                                        o.tracker.send('event', 'Отпуск.НаСайт Поиск', 'Отправлена форма заказа', otpMain.tour.hotel.t.n + '+' + otpMain.tour.hotel.c.n + '+' + otpMain.tour.hotel.n + '+' + o.tour.offer.pl + ' грн.');
                                                    }
                                                },
                                                'close': function ($e) {
                                                    $('body').removeClass(o.fn.prefix('t-order-form-open'));
                                                    $e.find('.os-order-top-part').show();
                                                }
                                            });
                                        }
                                        return false;
                                    })
                            )
                            .append(
                                $('<span>')
                                    .text('Код:')
                            )
                            .append(
                                $('<span>')
                                    .addClass(o.fn.prefix('t-order-code'))
                            )
                            .append(extraHotelName
                                ?
                                $('<div>')
                                    .addClass(o.fn.prefix('t-order-hotel-name'))
                                    .text(hotel.n)
                                :
                                ''
                            )
                    )
                )
                // refresh the block info
                .on('refresh', function(e){
                    if(o.tour.offer.i) {
                        $(this).fadeIn(200, function(){

                            // total price
                            $(this).find(o.fn.prefix('t-order-price','.'))
                                .empty()
                                .append(o.result.view.getPriceElement(o.tour.offer))
                                .append(function () {
                                    if (!o.settings.get('osInstallments')) {
                                        return null;
                                    }

                                    return ($('<a href="#">')
                                        .addClass(o.fn.prefix('t-order-price__getCredit'))
                                        .html( o._('или в рассрочку') + ' <nobr>' + '3 × ' + o.fn.onlyPriceEcho(o.tour.offer.pl * 1.15 / 3) + ' грн</nobr>')
                                        .on('click', function (e) {
                                            e.preventDefault();
                                            o.tour.creditModal.view.renderStep('first');
                                        }));
                                }); /*add open credit modal button*/

                            // price description
                            $(this).find(o.fn.prefix('t-order-price-descr', '.')).trigger('os.render', [o.tour.offer, o.tour.hotel, o.tour.offer.to]);

                            // order button (use our a super-widget)
                            $(this).find(o.fn.prefix('t-order-btn','.'))
                                .attr('data-country', hotel.t.n)
                                .attr('data-city', hotel.c.n)
                                .attr('data-date', o.tour.offer.d)
                                .attr('data-people', o.hash.get('p'))
                                .attr('data-len', o.tour.offer.l)
                                .attr('data-offerid', o.tour.offer.vid)
                                .attr('data-uri', window.location.href);

                            // order code
                            $(o.fn.prefix('t-order-code','.')).text(o.tour.offer.vid);
                        })
                    } else {
                        $(this).fadeOut(200);
                    }

                    /* Call post order refresh callback */
                    o.tour.call('refresh-order', self.$orderBlock, o.tour.offer);

                    return false;
                })
        };

        this.renderSimilarHotels = function (hotel) {
            return $('<div>')
                .addClass(o.fn.prefix('t-similar-viewed'))

                /*** Render the similar and viewed offers ***/
                .on('init', function () {

                    var $similar_items;
                    var $viewed_items;
                    var hotels = o.storage.getOffers();

                    if (!$.isEmptyObject(hotels) && Object.keys(hotels).length > 1) {

                        $(this).append(
                            $('<div>')
                                .addClass(o.fn.prefix('t-similar-viewed-wrapper'))
                                .append(
                                    $('<div>')
                                        .addClass(o.fn.prefix('t-header-title'))
                                        .text(o._('Просмотренные туры'))
                                ).append(
                                $viewed_items = $('<div>')
                                    .addClass(o.fn.prefix('t-similar-viewed-gallery'))
                                    .addClass('owl-carousel')
                            )
                        );

                        // sorting by last update
                        var sorted_hotels = Object.keys(hotels).sort(function (a, b) {
                            return hotels[b].updated - hotels[a].updated;
                        }).slice(0, 10);

                        // render the viewed last 10 hotels
                        $.each(sorted_hotels, function (i, hid) {

                            var offers = hotels[hid].offers;

                            if (hotels[hid] && hotels[hid].i && +hid !== +hotel.i) {

                                var $result_hotel = new o.result.hotel(hotels[hid], self);
                                $viewed_items.append($result_hotel.view.$);
                            }
                        });
                    }

                }).trigger('init')
        };

        /**
         * Render people select dropdown
         * @param hotel
         * @returns {*}
         */
        this.renderPeopleSelectDropdown = function (hotel, button) {
            if(typeof button === 'undefined') {
                button = $('<span>')
                    .append(o._('Ещё'))
                    .attr('data-role', 'button')
                    .append('<svg width="20" height="20" viewBox="0 0 2020 2020"><path d="M1331 672q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50 50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23 10l50 50q10 10 10 23z"></path></svg>');
            }


            return $('<span>')
                .addClass(o.fn.prefix('t-change-btn'))
                .addClass(o.fn.prefix('t-change-people'))
                .append(button)
                .append(
                    o.form.people.view.getPeopleSelectDropdownBody()
                        .addClass(o.fn.prefix('t-change-people-dropdown'))
                        .addClass(o.fn.prefix('f-dropdown-body'))
                        .css('display', 'none')
                        .attr('data-role', 'body')
                )
                .on('init', function () {
                    var people = o.hash.get('p');
                    if (people) {
                        o.form.people.view.setValue(people);
                    }
                    var dd = new o.fn.dropdown($(this));

                    var val = null;
                    dd.on('dd.open', function () {
                        val = o.form.people.view.getValue();
                    });
                    dd.on('dd.cancel', function () {
                        if (val) {
                            o.form.people.view.setValue(val);
                        }
                    });
                    dd.on('dd.select', function () {
                        var offer = o.tour.offer;
                        var people = o.form.people.view.getValue();
                        o.hash.add('p', people);
                        var query = {
                            'd':  offer.c,  // dept city
                            'i':  hotel.i,  // hotel id
                            'p':  people,   // peoples
                            'c':  offer.d,  // from date
                            'v':  offer.d,  // to date
                            'l':  offer.l,  // from length
                            'lt': offer.l   // to length
                        };

                        self.searchOffer(
                            query,
                            function(offer) {
                                /* render */
                                if(offer) {
                                    o.hash.add('oid', offer.i, true);
                                    self.renderTour(self.$tourPage, o.tour.hotel, offer)
                                }
                                /* render no tour message */
                                else {
                                    var msg = null,
                                        msgAlertText = null,
                                        msgActionText = null;

                                    /* Render people message*/
                                    if (+o.hash.get('p', 2) !== 2) {
                                        msgAlertText = o._('В этом отеле нет предложений для заданного числа туристов') + '. ';
                                        msgActionText = [o._('Поищите') + ' ',
                                            $('<a>')
                                                .attr('href', '')
                                                .text(o._('другие отели'))
                                                .on('click', function () {
                                                    $('html, body').animate({
                                                        scrollTop: o.form.view.$.offset().top
                                                    }, 200);
                                                    return false;
                                                }),
                                            o._('</a>'),
                                            ' ' + o._('для такой компании') + '.'];

                                        //#19685
                                        o.hash.add('p', 2);
                                    }

                                    self.$tourPage.append(
                                        msg = o.result.view.getNoToursMessage(msgAlertText, msgActionText)
                                    );
                                    msg.trigger('os.render');
                                }
                            }
                        );
                    });
                })
                .trigger('init');
        };

        /**
         * Render dates matrix modal
         * @param hotel
         * @returns {*|void|{click}}
         */
        this.getDatesModal = function (hotel) {
            var $modal = $('<div>')
                .addClass(o.fn.prefix('t-modal-body-item date'))
                .css('display', 'none')
                .append(
                    $('<div>')
                        .addClass(o.fn.prefix('t-modal-body-top'))
                        .text(o._('Даты и длительность'))
                ).append(
                    $('<div>')
                        .addClass(o.fn.prefix('t-modal-body-middle'))
                        .append(
                            self.$matrix = $('<div>')
                                .addClass(o.fn.prefix('t-date-modal-table-container'))
                                .append(
                                    self.$spinner_matrix = $('<div>')
                                        .addClass('loading-container')
                                )
                        )
                )
                .on('refresh', function (e, params) {

                    var dateFrom,
                        dateTo,
                        durationFrom,
                        durationTo;

                    self.$matrix.attr('data-refresh', 1);  // mark as refreshed
                    self.$matrix.attr('data-rendered', 0); // mark as no rendered

                    self.$matrix.children().not('div.loading-container').remove(); // reset the matrix

                    params = params || {};

                    // get dates for matrix
                    if (params.date_from && params.date_to) {

                        dateFrom = params.date_from;
                        dateTo = params.date_to;

                    } else {
                        // default dates offerDate +/- floor(matrixLen[y]/2) days
                        dateFrom = o.form.datepicker.parseISO8601(o.tour.offer.d);
                        dateFrom.setDate(dateFrom.getDate() - Math.floor(o.tour.matrixLen.y / 2));
                        dateTo = new Date(dateFrom.getTime());
                        dateTo.setDate(dateTo.getDate() + o.tour.matrixLen.y);
                    }

                    // get durations for matrix
                    if (params.duration_from && params.duration_to) {
                        durationFrom = params.duration_from;
                        durationTo = params.duration_to;

                    } else {
                        // default duration offerDuration +/- floor(matrixLen[x]/2) days
                        durationFrom = +o.tour.offer.l;
                        durationFrom = +o.tour.offer.l - Math.floor(o.tour.matrixLen.x / 2);
                        durationTo = +o.tour.offer.l + Math.floor(o.tour.matrixLen.x / 2);
                    }

                    // load offer
                    o.tour.getOffers(function (durations, dates) {

                        // render matrix
                        self.$matrix.append(
                            $('<div>')
                                .addClass(o.fn.prefix('t-date-change'))
                                .addClass(o.fn.prefix('t-date-change-top'))
                                .append('<svg width="20" height="20" viewBox="0 0 2020 2020"><path d="M1331 672q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50 50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23 10l50 50q10 10 10 23z"></path></svg>')
                                .on('click', function () { // dates descending

                                    var now = new Date();
                                    now.setHours(0, 0, 0, 0);

                                    var dateFrom = o.form.datepicker.parseISO8601(dates[0]);

                                    if (dateFrom.getTime() <= now.getTime()) {
                                        return false;
                                    }

                                    dateFrom.setDate(dateFrom.getDate() - o.tour.matrixLen.y);

                                    if (dateFrom.getTime() <= now.getTime()) {
                                        dateFrom = now;
                                    }

                                    var dateTo = new Date(dateFrom.getTime());
                                    dateTo.setDate(dateTo.getDate() + o.tour.matrixLen.y - 1);

                                    $modal.trigger('refresh', {
                                        'date_from':     dateFrom,
                                        'date_to':       dateTo,
                                        'duration_from': durations[0],
                                        'duration_to':   durations[durations.length - 1]
                                    });
                                    return false;
                                })
                        ).append(
                            $('<div>')
                                .addClass(o.fn.prefix('t-date-change'))
                                .addClass(o.fn.prefix('t-date-change-bottom'))
                                .append('<svg width="20" height="20" viewBox="0 0 2020 2020"><path d="M1331 672q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50 50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23 10l50 50q10 10 10 23z"></path></svg>')
                                .on('click', function () { // dates ascending

                                    var dateFrom = o.form.datepicker.parseISO8601(dates[0]);
                                    var dateTo = o.form.datepicker.parseISO8601(dates[dates.length - 1]);

                                    dateFrom.setDate(dateFrom.getDate() + o.tour.matrixLen.y);
                                    dateTo.setDate(dateTo.getDate() + o.tour.matrixLen.y);

                                    $modal.trigger('refresh', {
                                        'date_from':     dateFrom,
                                        'date_to':       dateTo,
                                        'duration_from': durations[0],
                                        'duration_to':   durations[durations.length - 1]
                                    });
                                    return false;
                                })
                        ).append(
                            $('<div>')
                                .addClass(o.fn.prefix('t-date-change'))
                                .addClass(o.fn.prefix('t-date-change-left'))
                                .append('<svg width="20" height="20" viewBox="0 0 2020 2020"><path d="M1331 672q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50 50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23 10l50 50q10 10 10 23z"></path></svg>')
                                .on('click', function () { // duration descending

                                    if (durations[0] === 1) {
                                        return false;
                                    }

                                    var duration_from = durations[0] - o.tour.matrixLen.x;
                                    if (duration_from < 1) {
                                        duration_from = 1;
                                    }

                                    var duration_to = duration_from + o.tour.matrixLen.x + 1;

                                    $modal.trigger('refresh', {
                                        'date_from':     dates[0],
                                        'date_to':       dates[dates.length - 1],
                                        'duration_from': duration_from,
                                        'duration_to':   duration_to
                                    });
                                    return false;
                                })
                        ).append(
                            $('<div>')
                                .addClass(o.fn.prefix('t-date-change'))
                                .addClass(o.fn.prefix('t-date-change-right'))
                                .append('<svg width="20" height="20" viewBox="0 0 2020 2020"><path d="M1331 672q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50 50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23 10l50 50q10 10 10 23z"></path></svg>')
                                .on('click', function () { // duration ascending

                                    if (durations[durations.length - 1] >= 26) {
                                        return false;
                                    }

                                    var duration_to = durations[durations.length - 1] + o.tour.matrixLen.x;

                                    if (duration_to > 26) {
                                        duration_to = 26;
                                    }

                                    var duration_from = duration_to - o.tour.matrixLen.x + 1;

                                    $modal.trigger('refresh', {
                                        'date_from':     dates[0],
                                        'date_to':       dates[dates.length - 1],
                                        'duration_from': duration_from,
                                        'duration_to':   duration_to
                                    });
                                    return false;
                                })
                        ).append(
                            $('<table>')
                                .addClass(o.fn.prefix('t-date-modal-table'))
                                .append(
                                    $('<thead>').on('init', function () {

                                        $(this).append(
                                            self.$tr = $('<tr>').append(
                                                $('<td>')
                                            )
                                        );

                                        var that = this;
                                        $.each(durations, function (i, len) {
                                            self.$tr.append(
                                                $('<td>')
                                                    .addClass(o.fn.prefix('t-date-modal-table-head'))
                                                    .addClass(+o.tour.offer.l === +len ? 'selected' : '')
                                                    .append(
                                                        $('<div>')
                                                            .addClass(o.fn.prefix('t-head-nights'))
                                                            .text('на ' + o.fn.suffixForNumber(len - 1, [o._('ночь'), o._('ночи'), 'ночей'], true))
                                                    ).append(
                                                    $('<div>')
                                                        .addClass(o.fn.prefix('t-head-days'))
                                                        .text('(' + o.fn.suffixForNumber(len, ['день', o._('дня'), o._('дней')], true) + ')')
                                                )
                                            );
                                        });

                                    }).trigger('init')
                                ).append(
                                $('<tbody>').on('init', function () {

                                    var that = this,
                                        offers;

                                    $.each(dates, function (i, date) {

                                        $(that).append(
                                            self.$tr = $('<tr>').append(
                                                $('<td>')
                                                    .addClass(o.tour.offer.d === date ? 'selected' : '')
                                                    .append('с ')
                                                    .append($('<span>').text(o.form.datepicker.getTextDate(date, {parts: ['d', 'm']}, ' ')))
                                                    .append('(' + o.form.datepicker.getTextDate(date, {parts: ['D']}, ' ') + ')')
                                            )
                                        );

                                        // render offer cell
                                        $.each(durations, function (i, len) {

                                            offers = o.tour.offers[date + len.toString()];
                                            var offer = offers ? offers[0] : false;

                                            self.$tr.append(
                                                $('<td>').append(!offer ? '&mdash;' :
                                                    $('<a>')
                                                        .addClass(o.fn.prefix('t-date_link'))
                                                        .addClass(String(o.tour.offer.i) === String(offer.i) ? o.fn.prefix('t-selected') : '')
                                                        .attr('href', o.tour.getLink(offer, 'tour', hotel))
                                                        .on('click', function () {
                                                            $modal.trigger('select', [offer]);
                                                        })
                                                        .append(
                                                            o.result.view.getPriceElement(offer, '<span class="uah">%price%</span><span class="usd">%inverted%</span>')
                                                        )
                                                )
                                            );
                                        });
                                    });

                                }).trigger('init')
                            )
                        );

                        self.$matrix.attr('data-rendered', 1); // mark as rendered

                        // run callback after rendered the matrix
                        if (typeof params.callback === 'function') {
                            params.callback();
                        }

                    }, {
                        'f':  1,                         // region
                        'd':  o.hash.get('d', 1544),     // dept city
                        'i':  hotel.i,                   // hotel id
                        'r':  o.hash.get('tr', 'air'),   // transport
                        'p':  o.hash.get('p', 2),        // peoples
                        'c':  dateFrom,                  // date from
                        'v':  dateTo,                    // date to
                        'l':  durationFrom,              // length from
                        'lt': durationTo                // length to
                    });
                });

            return $modal;
        };

        /**
         * Render food select modal
         * @param hotel
         * @returns {*|void|{click}}
         */
        this.getFoodsModal = function (hotel) {
            var $modal =  $('<div>')
                .addClass(o.fn.prefix('t-modal-body-item food'))
                .css('display', 'none')
                .on('refresh', function (e, params) {

                    $(this).empty();

                    $(this).append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-modal-body-top'))
                            .text(o._('Номер и питание'))
                    ).append(
                        $('<div>')
                        .addClass(o.fn.prefix('t-modal-body-middle'))
                        .append(
                            $('<div>')
                                .addClass(o.fn.prefix('t-modal-table-container'))
                                .append(
                                    $('<table>')
                                        .addClass(o.fn.prefix('t-modal-table'))
                                            .append(
                                                $('<tbody>').on('init', function () {

                                                    var that = this;

                                                    self.$tr = $('<tr>').appendTo($(this));

                                                    // render header (food info)
                                                    $.each(o.tour.foods, function (i, food) {
                                                        if (!i) {
                                                            self.$tr.append($('<td>'));
                                                        }

                                                        self.$tr.append(
                                                            $('<td>').append(
                                                                $('<div>')
                                                                    .addClass(o.fn.prefix('t-food-abbr'))
                                                                    .text(food)
                                                            ).append(
                                                                $('<span>').text(o.form.food.view.getFoodInfo(food)['description'])
                                                            )
                                                        );
                                                    });

                                                    // render rooms
                                                    $.each(o.tour.rooms, function (rid, item) {

                                                        $(that).append(
                                                            self.$tr = $('<tr>').append(
                                                                $('<td>').append(
                                                                    $('<div>')
                                                                        .addClass(o.fn.prefix('t-modal-room-title'))
                                                                        .append(item.label)
                                                                        .append(
                                                                            $('<span>').html(' (' + item.type.toUpperCase() + ')')
                                                                        )
                                                                ).on('init', function () {
                                                                    var that = this;
                                                                    if (o.tour.hotel.rooms[rid]) {
                                                                        // room description
                                                                        $(that).append(
                                                                            //#14465
                                                                            // $('<div>')
                                                                            //     .addClass(o.fn.prefix('t-modal-room-desc'))
                                                                            //     .append(o.tour.hotel.rooms[rid]? o.tour.hotel.rooms[rid].description: '')
                                                                        );

                                                                        // room services
                                                                        $(that).append(
                                                                            $('<div>')
                                                                                .addClass(o.fn.prefix('t-modal-room-list-title'))
                                                                                .text(o._('В номере:'))
                                                                        );

                                                                        var $services = $('<div>')
                                                                            .addClass(o.fn.prefix('t-modal-room-list'))
                                                                            .appendTo($(this));

                                                                        $.each(o.tour.hotel.rooms[rid].services, function (i, service) {
                                                                            $services.append(
                                                                                $('<div>')
                                                                                    .addClass(o.fn.prefix('t-modal-room-list-item'))
                                                                                    .html(service.text)
                                                                            );
                                                                        });
                                                                    }
                                                                }).trigger('init')
                                                            )
                                                        );

                                                        // render offers
                                                        $.each(o.tour.foods, function (i, food) {

                                                            var offer = item[food];

                                                            if (offer) {
                                                                self.$tr.append(
                                                                    $('<td>')
                                                                        .addClass(o.fn.prefix('t-room-price'))
                                                                        .addClass(o.tour.offer.f === offer.f && +o.tour.offer.ri === +offer.ri ? 'selected' : '')
                                                                        .append(
                                                                            $('<a>')
                                                                                .attr('href', o.tour.getLink(offer, 'tour', hotel))
                                                                                .append(
                                                                                    $('<span>')
                                                                                        .addClass(o.fn.prefix('t-room-desc'))
                                                                                        .attr('style','display: none')
                                                                                        .append(
                                                                                            $('<span>')
                                                                                                .text(food)
                                                                                        )
                                                                                        .append(
                                                                                            $('<span>')
                                                                                                .text(o.form.food.view.getFoodInfo(food)['description'])
                                                                                        )
                                                                                )
                                                                                .append(
                                                                                    $('<strong>').append(o.result.view.getPriceElement(offer))
                                                                                )
                                                                        )
                                                                        .on('click', function () {
                                                                            $modal.trigger('select', [offer]);
                                                                            $('html').removeClass(o.fn.prefix('modal-open-food'));
                                                                        })
                                                                );
                                                            } else {
                                                                self.$tr.append(
                                                                    $('<td>')
                                                                        .addClass(o.fn.prefix('t-room-price'))
                                                                        .append('&mdash;')
                                                                );
                                                            }
                                                        });
                                                    });

                                                }).trigger('init')
                                            )
                                    )
                            )
                    );


                    if(params && 'callback' in params) {
                        params.callback();
                    }
                });

            return $modal;
        };

        /**
         * Render transport select modal
         * @param hotel
         * @returns {*|void|{click}}
         */
        this.getTransportModal = function(hotel) {
            var $modal = $('<div>')
                .addClass(o.fn.prefix('t-modal-body-item transport'))
                .css('display', 'none')
                .on('hide', function() {
                    $(this).fadeOut(50, function() {
                        $('html')
                            .removeClass(o.fn.prefix('modal-open-food'))
                            .removeClass(o.fn.prefix('modal-open'));
                    });
                })
                .on('select', function(e, offer, flightOut, flightReturn) {
                    if(offer && String(offer.i)) {
                        o.hash.add('oid', offer.i, true);
                        o.tour.changeOffer(offer.i, offer.l, offer.d);
                    }

                    if(flightOut && flightReturn) {
                        self.$.find('[data-value-container=transport]').trigger('render', [flightOut, flightReturn]);
                        self.$.find(o.fn.prefix('t-order-price-descr', '.')).trigger('os.render', [offer, o.tour.hotel, {from: [flightOut], to: [flightReturn]}]);
                    }

                    return false;
                })
                .on('refresh', function() {
                    $(this).empty();
                    $(this).append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-modal-body-top'))
                            .text(o._('Транспорт'))
                    ).append([
                        $('<div>')
                            .addClass(o.fn.prefix('t-modal-body-middle'))
                            .append(
                                $('<div>')
                                    .addClass(o.fn.prefix('t-modal-table-container'))
                                    .append(
                                        $('<table>')
                                            .addClass(o.fn.prefix('t-modal-table'))
                                            .append(
                                                $('<tbody>').on('init', function() {
                                                    var $body = $(this);
                                                    // get similar offers
                                                    var offer = o.tour.offer;
                                                    var tkey = offer.d + offer.l;
                                                    var similar = 'offers' in o.tour && tkey in o.tour.offers ? o.tour.offers[tkey] : [];

                                                    // prepare offers with flights
                                                    var flightOffers = {};

                                                    if(offer.to && !$.isEmptyObject(offer.to)) {
                                                        flightOffers[offer.oi] = {
                                                            'data':   offer,
                                                            'out':    offer.to.from,
                                                            'return': offer.to.to
                                                        };
                                                    }

                                                    similar.reduce(function(offers, o) {
                                                        var uniqueOperator = !(o.oi in offers);
                                                        var sameParams = o.f === offer.f && o.y === offer.y && o.r === offer.r;
                                                        var hasFlights = o.to && (('from' in o.to && Array.isArray(o.to.from)) || ('to' in o.to && Array.isArray(o.to.to)));
                                                        if(uniqueOperator && sameParams && hasFlights) {
                                                            offers[o.oi] = {
                                                                'data':   o,
                                                                'out':    o.to.from,
                                                                'return': o.to.to
                                                            };
                                                        }

                                                        return offers;
                                                    }, flightOffers);

                                                    var renderFlight = function( flight ) {
                                                        var fee = this.offer.i !== o.tour.offer.i ? Math.ceil(o.tour.offer.pl - this.offer.pl) : null;
                                                        var flightBegin = flight.begin ? o.fn.parseDateTimeString(flight.begin).toLocaleTimeString('ru', {'hour': '2-digit', 'minute': '2-digit'}) : '???';
                                                        var flightEnd = flight.end ? o.fn.parseDateTimeString(flight.end).toLocaleTimeString('ru', {'hour': '2-digit', 'minute': '2-digit'}) : '???';

                                                        return $('<label>')
                                                            .addClass(o.fn.prefix('t-flight'))
                                                            .append([
                                                                $('<input>')
                                                                    .attr('type', 'radio')
                                                                    .attr('name', o.fn.prefix(this.type))
                                                                    .attr('data-type', this.type)
                                                                    .data('flight', flight)
                                                                    .data('offer', this.offer)
                                                                    .attr('offer', this.offer.i)
                                                                    .on('change', function(e) {
                                                                        var group = this.container.find('input[offer=' + this.offer.i + ']');
                                                                        // reset selection
                                                                        this.container.find('input').not(group).prop('checked', false);
                                                                        // check selection pair
                                                                        if(group.filter(':checked').length === 1) {
                                                                            // select first opposite option
                                                                            group.filter('[data-type=' + (this.type == 'out' ? 'return' : 'out')  + ']').first().prop('checked', true);
                                                                        }

                                                                    }.bind(this)),
                                                                $('<div>')
                                                                    .addClass(o.fn.prefix('t-flight-begin'))
                                                                    .append([
                                                                        $('<strong>').text(flightBegin),
                                                                        flight.portFr
                                                                    ]),
                                                                $('<div>')
                                                                    .addClass(o.fn.prefix('t-flight-end'))
                                                                    .append([
                                                                        $('<strong>').text(flightEnd),
                                                                        flight.portTo
                                                                    ]),
                                                                $('<div>')
                                                                    .addClass(o.fn.prefix('t-flight-info'))
                                                                    .append([
                                                                        $('<div>')
                                                                            .addClass(o.fn.prefix('t-flight-line'))
                                                                            .text(flight.line),
                                                                        $('<div>')
                                                                            .addClass(o.fn.prefix('t-flight-descr'))
                                                                            .append([
                                                                                'Рейс ',
                                                                                flight.code,
                                                                                flight.craft ? ' (' + flight.craft + ')' : ''
                                                                            ]),
                                                                        fee ? $('<div>')
                                                                            .addClass(o.fn.prefix('t-flight-fee'))
                                                                            .addClass(fee < 0 ? o.fn.prefix('t-flight-fee-more') : o.fn.prefix('t-flight-fee-less'))
                                                                            .append([
                                                                                fee < 0 ? 'Дороже на ' : 'Дешевле на ',
                                                                                Math.abs(fee) + ' грн'
                                                                            ]) : null
                                                                    ])
                                                            ]);
                                                    };

                                                    var $offers = $.map(flightOffers, function(offer) {
                                                        var $offer = $('<tr>').addClass('t-flight-offer');
                                                        var geoFrom = o.form.fromCity.view.getCityFromId(offer.data.c) ? o.form.fromCity.view.getCityFromId(offer.data.c)['name'] : null;
                                                        var geoTo = hotel.t.n;

                                                        $offer.append(
                                                            $('<td>')
                                                                .addClass('t-flight-out')
                                                                .append([
                                                                    $('<div>')
                                                                        .addClass(otpMain.fn.prefix('t-order-operator'))
                                                                        .css('background-image', 'url(https://export.otpusk.com/images/onsite/logo/logo-' + offer.data.oi + '.png)')
                                                                        .css('background-size', 'contain')
                                                                        .css('background-position', 'center')
                                                                        .css('background-repeat', 'no-repeat')
                                                                        .css('height', '40px')
                                                                        .css('width', '100px'),
                                                                    $('<div>')
                                                                        .addClass(o.fn.prefix('t-flight-name'))
                                                                        .append([geoFrom, ' <span>&rarr;</span> ', geoTo])
                                                                ])
                                                                .append(
                                                                    offer['out'] ? offer['out'].map(renderFlight.bind({
                                                                        'type':  'out',
                                                                        'offer': offer.data,
                                                                        'container': $body
                                                                    })) : '???'
                                                                )
                                                        ).append(
                                                            $('<td>')
                                                                .addClass('t-flight-return')
                                                                .append(
                                                                    $('<div>')
                                                                        .addClass(o.fn.prefix('t-flight-name'))
                                                                        .append([geoTo, ' <span>&rarr;</span> ', geoFrom])
                                                                )
                                                                .append(
                                                                    offer['return'] ? offer['return'].map(renderFlight.bind({
                                                                        'type':  'return',
                                                                        'offer': offer.data,
                                                                        'container': $body
                                                                    })) : '???'
                                                                )
                                                        );

                                                        return $offer;
                                                    });

                                                    if($offers.length) {
                                                        $body.append($offers);
                                                    }
                                                    else {
                                                        $body.append(
                                                            $('<tr>')
                                                                .addClass(o.fn.prefix('t-no-info'))
                                                                .append(
                                                                    $('<td>')
                                                                        .text('Нет дополнительной информации о транспорте')
                                                                )
                                                        );
                                                    }
                                                }).trigger('init')
                                            )
                                    )
                            ),
                        $('<div>')
                            .addClass(o.fn.prefix('t-modal-body-bottom'))
                            .append([
                                $('<a>')
                                    .attr('href', '#')
                                    .addClass(o.fn.prefix('t-modal-append'))
                                    .text('Отменить')
                                    .on('click', function(e) {
                                        $modal.trigger('hide');
                                        return false;
                                    }),
                                $('<a>')
                                    .attr('href', '#')
                                    .addClass(o.fn.prefix('t-modal-append'))
                                    .text('Применить')
                                    .on('click', function(e) {
                                        var offer = $modal.find('input:checked').first().data('offer');
                                        var flightOut = $modal.find('input:checked[data-type=out]').data('flight');
                                        var flightReturn = $modal.find('input:checked[data-type=return]').data('flight');

                                        $modal.trigger('select', [offer, flightOut, flightReturn]);
                                        $modal.trigger('hide');
                                        return false;
                                    })

                            ])
                    ])
                });

            return $modal;
        };

        /**
         * Render order modal
         *
         * @returns {*}
         */
        this.getOrderModal = function () {
            return $('<div>')
                .addClass(o.fn.prefix('t-modal-body-item order'))
                .append(
                    $('<div>')
                        .addClass(o.fn.prefix('t-modal-body-top'))
                        .text(o._('Отправить запрос'))
                ).append(
                    $('<div>')
                        .addClass(o.fn.prefix('t-modal-body-middle'))
                ).on('render', function (e, hotel, offer, agency) {
                    $(this)
                        .find(o.fn.prefix('t-modal-body-middle', '.'))
                        .empty()
                        .append(new o.tour.order.view(hotel, offer, agency));

                    // ga tracker
                    if(o.tracker && hotel) {
                        o.tracker.send('event', 'Отпуск.НаСайт Поиск', 'Открыта форма заказа', hotel.t.n +'+'+ hotel.c.n +'+'+ hotel.n +'+'+ offer.pl+' грн.');
                    }
                    return false;
                });
        };

        /**
         * Search and render page offer by query
         * @param query
         */
        this.searchOffer = function(query, callback) {
            // check query
            query = $.extend(query, { oid: null });
            if(!('d' in query && 'l' in query)) {
                console.error('o.tour.view.searchOffer "query" param missing required props');
                return;
            }

            // reset state
            o.tour.offer = {};
            o.tour.offers = [];

            self.$tourPage.empty();
            if(self.$orderBlock) {
                self.$orderBlock.hide();
            }

            // prepare spinner
            o.spinner.view.render(self.$spinner_offer);

            typeof before === 'function' && before();
            o.tour.getOffers(function(durations, dates) {
                if(!$.isEmptyObject(o.tour.offers)) {
                    // check target date and length
                    if ('od' in query && 'ol' in query) {
                        var key = query.od.toString() + query.ol.toString();
                        if (key in o.tour.offers && o.tour.offers[key].length) {
                            o.tour.offer = o.fn.getFirst(o.tour.offers[key]);
                            callback(o.tour.offer);
                            return 0;
                        }
                    }

                    // get non target offers
                    var offers = o.fn.getFirst(o.tour.offers);
                    if(!$.isEmptyObject(offers)) {
                        o.tour.offer = o.fn.getFirst(offers);
                        callback(o.tour.offer);
                        return 0;
                    }
                }

                callback(null);
                return -1;
            }, query);
        };

        /**
         * Search and render similar offer
         */
        this.searchAndRenderSimilarOffer = function(hotel) {
            var showMessages = o.hash.get('oid');
            showMessages && self.$message.trigger('show', [o._('Выбранный тур больше не актуален. Ищем альтернативы...')]);

            /* success action */
            var searchSuccess = function(offer) {
                o.tour.getOffer(hotel.i, offer.i, function(offer) {
                    // release render status
                    self.$.prop('status', 'rendered');

                    if(offer.i) {
                        o.tour.offer = $.extend({}, offer);
                        o.tour.offers = [$.extend({}, offer)];

                        o.hash.add('oid', offer.i, true);
                        self.renderTour(self.$tourPage, o.tour.hotel, offer);
                        showMessages && self.$message.trigger('show', [o._('Тур по этой ссылке уже устарел. Показан ближайший похожий тур.')]);
                    }
                });

            };
            /* not found action */
            var searchFail = function() {
                self.$message.trigger('hide');
                self.$tourPage.append(
                    msg = o.result.view.getNoToursMessage()
                );
                msg.trigger('os.render');
            };

            // search narrow alternative
            self.searchOffer(
                $.extend(
                    {},
                    o.hash.get(),
                    {
                        i:  hotel.i,
                        l:  o.hash.get('ol', +o.hash.get('l')),
                        lt: o.hash.get('ol', +o.hash.get('l') + 2),
                        c:  o.hash.get('od', o.hash.get('c')),
                        v:  o.hash.get('od', o.hash.get('v'))
                    }
                ),
                function(offer) {
                    if(offer) {
                        searchSuccess(offer)
                    }
                    else {
                        var c = o.hash.get('c');
                        var v = o.hash.get('v', o.hash.get('c'));
                        // search wide alternative
                        self.searchOffer(
                            $.extend(
                                {},
                                o.hash.get(),
                                {
                                    i:  hotel.i,
                                    lt: +o.hash.get('l') + 2,
                                    o:  null,
                                    c:  c === v ? o.fn.modifyDate(c, -7, 'days') : c,
                                    v:  c === v ? o.fn.modifyDate(c, +7, 'days') : v
                                }
                            ),
                            function(offer) {
                                if (offer) {
                                    searchSuccess(offer);
                                } else {
                                    searchFail()
                                }
                            }
                        );
                    }
                }
            );
        };

        /**
         * Get flight description
         * @param offer
         */
        this.renderPriceDescription = function(offer, hotel) {
            /* Define offer validators */
            var traits = {
                isOperator: function(offer, operator) {
                    return 'v' in offer && offer.v === operator;
                },
                isCountry: function(hotel, country) {
                    return 't' in hotel && 'i' in hotel.t && +hotel.t.i === +country;
                },
                isCity: function(hotel, city) {
                    return 'c' in hotel && 'i' in hotel.c && +hotel.c.i === +city;
                },
                isAnyFromFlightTimeBeforeHours: function(offer, hours) {
                    if('to' in offer && 'object' === typeof offer.to && 'from' in offer.to && offer.to.from.length) {
                        return offer.to.from.reduce(function(result, flight) {
                            var begin = new Date(flight.begin);

                            return result || begin.getHours() <= hours;
                        }, false);
                    }
                    return false;
                },
                isAnyReturnFlightTimeAfterHours: function(flights, hours) {
                    if('to' in offer && 'object' === typeof offer.to && 'to' in offer.to && offer.to.to.length) {
                        return offer.to.to.reduce(function(result, flight) {
                            var begin = new Date(flight.begin);

                            return result || begin.getHours() >= hours;
                        }, false)
                    }
                    return false;
                },
                isFlightsByRequest: function (offer) {
                    return 'ss' in offer && offer.ss.avia == 0 || offer.ss.aviaBack == 0;
                }
            };

            /* Describe rules */
            var rules = [
                {
                    name: 'extra-fee',
                    text: o._('Возможна доплата за вечерний обратный рейс $25 за каждого туриста.'),
                    conditions: [
                        traits.isCountry(hotel, 43),
                        traits.isOperator(offer, 'anex'),
                        traits.isAnyReturnFlightTimeAfterHours(offer, 12)
                    ]
                },
                {
                    name: 'extra-fee',
                    text: o._('Возможна доплата за утренний рейс туда $25 за каждого туриста.'),
                    conditions: [
                        traits.isCountry(hotel, 43),
                        traits.isOperator(offer, 'anex'),
                        traits.isAnyFromFlightTimeBeforeHours(offer, 12)
                    ]
                },
                {
                    name:       'extra-fee',
                    text:       o._('Возможна доплата за утренний рейс туда 25 евро за каждого туриста.'),
                    conditions: [
                        traits.isCity(hotel, 955),
                        traits.isCountry(hotel, 115),
                        traits.isOperator(offer, 'anex'),
                        traits.isAnyFromFlightTimeBeforeHours(offer, 12)
                    ],
                },
                {
                    name:       'extra-fee',
                    text:       o._('Возможна доплата за вечерний обратный рейс 25 евро за каждого туриста.'),
                    conditions: [
                        traits.isCity(hotel, 955),
                        traits.isCountry(hotel, 115),
                        traits.isOperator(offer, 'anex'),
                        traits.isAnyReturnFlightTimeAfterHours(offer, 12)
                    ],
                },
                {
                    name: 'request-flight',
                    text: o._('Наличие мест на рейсе и окончательную стоимость тура запрашивайте у турагента.'),
                    conditions: [
                        traits.isFlightsByRequest(offer)
                    ]
                }
            ];


            /* Convert rule to price description */
            var description = rules.map(function(rule) {
               var positive = rule.conditions.reduce(function(result, condition) {
                    return result && condition;
                }, true);

                return positive ? $('<div>').addClass(o.fn.prefix(rule.name)).text(rule.text) : null;
            }).filter(function(text) { return  text});

            return description;
        };

        /**
         * Get hotel photo carousel
         * @param hotel
         * @param size
         * @returns {*}
         */
        this.getPhotoCarousel = function (hotel, size) {
            var $owl = null;
            var $gallery = null;
            size = size || '400x0';



            /////////////////////////
            var maxTime = 10000,
                // allow movement if < 1000 ms (1 sec)
                maxDistance = 50,
                // swipe movement of 50 pixels triggers the swipe
                startX = 0,
                startTime = 0,
                touch = "ontouchend" in document,
                startEvent = (touch) ? 'touchstart' : 'mousedown',
                moveEvent = (touch) ? 'touchmove' : 'mousemove',
                endEvent = (touch) ? 'touchend' : 'mouseup';

            var swipeCounter = 0;

            $gallery = $('<span>')
                .addClass(o.fn.prefix('r-item-img-wrap'))
                .append([
                    $owl = $('<span>')
                        .addClass(o.fn.prefix('r-item-imgs'))
                        .addClass('owl-carousel')
                        .append(
                            (Array.isArray(hotel.f) ? hotel.f : [hotel.f]).map(function (image) {
                                return $('<span>')
                                    .addClass(o.fn.prefix('r-item-img'))
                                    .attr('data-original', o.tour.photo.view.getLink(image, '400x300', '', 3))
                                    .lazyload({threshold : 200, skip_invisible: true})
                            })
                        )
                        .prop('initialized', 'no')
                        /* Listen controls  */
                        .on('goto', function (e, direction) {
                            var status = $owl.prop('initialized');
                            switch (status) {
                                case 'yes':
                                    $owl.trigger(direction + '.owl.carousel');
                                    return false;
                                case 'no':
                                    $owl.prop('initialized', 'pending');
                                    o.tour.getHotel(hotel.i, function (h) {
                                        $owl.trigger('init');
                                        $owl.trigger('load', ['f' in h && Array.isArray(h.f) ? h.f.slice(1) : [], function () {
                                            $owl.trigger(direction + '.owl.carousel');
                                        }]);
                                        return false;
                                    });
                                case 'pending':
                                    return false;
                            }
                        })
                        /* Init owl */
                        .on('init', function (e) {
                            $owl.owlCarousel({
                                nav:        false,
                                dots:       false,
                                items:      1,
                                loop:       true,
                                navSpeed:   50
                            });
                            $owl.prop('initialized', 'yes');
                        })
                        /* Load images */
                        .on('load', function (e, images, after) {
                            images.map(function (image) {
                                var $image = $('<span>')
                                    .addClass(o.fn.prefix('r-item-img'))
                                    .css('background-image', 'url(https://newimg.otpusk.com/3/400x300/' + image + ')');
                                $owl.trigger('add.owl.carousel', [$image]);

                                return $image;
                            });

                            $owl.trigger('refresh.owl.carousel');
                            after();
                        })
                        .bind(startEvent, function(e) {
                            // prevent image drag (Firefox)
                            startTime = e.timeStamp;
                            startX = e.originalEvent.touches ? e.originalEvent.touches[0].pageX : e.pageX;
                        }).bind(endEvent, function(e) {
                            startTime = 0;
                            startX = 0;
                        }).bind(moveEvent, function(e) {
                            var currentX = e.originalEvent.touches ? e.originalEvent.touches[0].pageX : e.pageX,
                                currentDistance = (startX === 0) ? 0 : Math.abs(currentX - startX),
                                // allow if movement < 1 sec
                                currentTime = e.timeStamp;
                            if (startTime !== 0 && currentTime - startTime < maxTime && currentDistance > maxDistance) {
                                if (currentX < startX) {
                                    // swipe left code here
                                    swipeCounter++;
                                    if ($('.new_check-mobile').is(':visible') && swipeCounter < 2) {
                                        $owl.trigger('goto', ['prev']);
                                        console.log('pew');
                                        return false;
                                    }
                                }
                                if (currentX > startX) {
                                    // swipe right code here
                                    swipeCounter++;
                                    if ($('.new_check-mobile').is(':visible') && swipeCounter < 2) {
                                        $owl.trigger('goto', ['next']);
                                        console.log('pew');
                                        return false;
                                    }
                                }
                                startTime = 0;
                                startX = 0;
                            }
                        }),
                    $('<span>')
                        .addClass(o.fn.prefix('r-item-imgs-controls'))
                        .append([
                            $('<span>')
                                .addClass(o.fn.prefix('r-item-imgs-control prev'))
                                .on('click', function () {
                                    $owl.trigger('goto', ['prev']);
                                    return false;
                                }),
                            $('<span>')
                                .addClass(o.fn.prefix('r-item-imgs-control next'))
                                .on('click', function () {
                                    $owl.trigger('goto', ['next']);
                                    return false;
                                }),
                        ])
                ]);

            if (Array.isArray(hotel.f)) {
                $owl.trigger('init');
            }

            return $gallery;
        };

        /**
         * Get hotel tag
         * @param services
         * @returns {*}
         */
        this.getHotelTag = function(services) {
            var tags = {
                'topsales2018': o._('Хит продаж\' 2018'),
                'youngsters':   o._('Для молодежи'),
                'family':       o._('Семейный отдых'),
                'relaxing':     o._('Спокойный отдых'),
                'goodfood':     o._('Хорошее питание'),
                'tz':           o._('TEZ TOUR рекомендует'),
                'vip':          o._('VIP отель')
            };

            var $tags = [];
            var forbidden = o.form.service.view.getForbiddenServices();

            for (var i in services) {
                if(services.hasOwnProperty(i)) {
                    var isForbidden = forbidden.indexOf(services[i]) !== -1;
                    var inHotel = services[i] in tags;

                    if (inHotel && !isForbidden) {
                        $tags.push($('<div>', {
                            'class': o.fn.prefix('recommend-tag'),
                            'attr': {
                                'data-service': services[i]
                            },
                            'name': tags[services[i]],
                            'text': tags[services[i]],
                            'click': function (e) {
                                e.preventDefault();
                            }
                        }))
                    }
                }
            }

            return $tags;
        };

        /**
         * Add/remove loader
         * @param action show|hide
         * @param name
         * @param $el
         */
        this.loader = function(action, name, $el){
            if(['show','hide'].indexOf(action) !== -1 && name && $el) {
                if(action === 'show') {
                    $el.append(
                        $('<div>')
                            .css('display', 'none')
                            .addClass(o.fn.prefix('loading-container'))
                            .attr('loader-name', name)
                            .append('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100px" height="100px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve"><path opacity="0.2" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946 s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634 c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"></path><path d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0 C22.32,8.481,24.301,9.057,26.013,10.047z" transform="rotate(174.18 20 20)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 20 20" to="360 20 20" dur="1s" repeatCount="indefinite"></animateTransform></path></svg>')
                            .fadeIn(200)
                    );
                } else { // hide
                    $el.find('div[loader-name="'+ name +'"]').fadeOut(200, function(){
                        $(this).remove();
                    });
                }
            }
        };

        /**
         * Go back to search
         */
        this.goBack = function() {
            if(o.result.view.$results.html()) {
                // show results
                self.$.fadeOut(200, function(){
                    o.result.view.$.fadeIn(200);
                    o.result.view.hideMessage();
                });
                return false;

            } else {

                o.form.view.$button.trigger('click');

                // o.search.query = false;
                // o.search.submit();
                // o.search.query = o.form.parse();
                // o.search.setHash(o.search.query);
            }
        };

        /**
         * Render the tour page
         */
        this.render = function(oid){
            // prevent from parallel rendering
            if(self.$.prop('status') === 'pending') {
                return 0;
            }

            // reset the current offer
            o.tour.offer = {};

            // set rendering status
            self.$.prop('status', 'pending');

            // hide the tour container
            self.$.fadeOut(o.fn.isVisible(self.$) ? 100 : 0, function(){

                self.$.empty(); // reset the tour container
                $('html').removeClass(o.fn.prefix('modal-open'));

                // hide the results container
                o.result.view.$messages.fadeOut(o.fn.isVisible(o.result.view.$messages) ? 100 : 0);
                o.result.view.$.fadeOut(o.fn.isVisible(o.result.view.$) ? 100 : 0, function () {
                    // show the tour container
                    self.$.fadeIn(200, function () {

                        // add loader before load the hotel data
                        self.loader('show', 'hotel_load', self.$);

                        // load hotel info
                        o.tour.getData(function (hotel) {

                            // remove loader
                            self.loader('hide', 'hotel_load', self.$);

                            // init the hotel page
                            self.init(hotel);


                            var dateFrom = new Date(o.hash.get('od')),
                                dateTo = new Date(o.hash.get('od')),
                                dateNow = new Date();

                            if (dateFrom.getTime() < dateNow.getTime() || isNaN(dateFrom.getTime())) {
                                dateFrom = new Date(dateNow.getTime() + 3 * 24 * 60 * 60 * 1000); // +3 days
                                dateTo = new Date(dateNow.getTime() + 3 * 24 * 60 * 60 * 1000); // +3 days
                            }

                            // load offer
                            if (+oid && !isNaN(+oid)) {

                                o.tour.getOffer(hotel.i, oid, function (offer) {
                                    // reset render status
                                    self.$.prop('status', 'rendered');

                                    o.tour.offer = $.extend({}, offer);
                                    o.tour.offers = [$.extend({}, offer)];

                                    if (o.tour.offer.i) {
                                        // save offer
                                        o.storage.addOffer($.extend({
                                            'offers': [offer]
                                        }, hotel), offer);

                                        // update offer info
                                        self.renderTour(self.$tourPage, hotel, o.tour.offer);

                                        if ($(o.fn.prefix('t-menu-wrap', '.')).length) {
                                            $(o.fn.prefix('t-menu-wrap', '.')).animate({'scrollLeft': $(o.fn.prefix('t-menu-item.selected', '.')).position().left + 30 - ($(o.fn.prefix('os', '.')).parent().width() - $(o.fn.prefix('t-menu-item.selected', '.')).width()) / 2}, 500);
                                        }
                                        o.fn.durationFunc();
                                        o.result.view.hideMessage();

                                    } else {
                                        self.searchAndRenderSimilarOffer(hotel);
                                    }

                                });
                            }
                            else {
                                self.searchAndRenderSimilarOffer(hotel);
                            }
                        });
                    });
                });
            });
        };
    };

    o.tour.view = new f();

})(jQuery, otpMain);


/*********************/
/****** 	view/tour/hotelInfo.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 05/10/17.
 */

(function($,o){
    var f = function(){

        this.$ = undefined;
        var self = this,
            el,
            ul,
            $wrap;

        /**
         * Init the description
         * @param $el
         * @param h
         */
        this.init = function($el, h){

            $el.append(
                $('<div>')
                    .addClass(o.fn.prefix('tour-description'))
                    .append(
                        $wrap = $('<div>')
                            .addClass(o.fn.prefix('serv-cols'))
                    )
            );

            /* Location */
            if(h.o && h.o.di) {
                el = $('<div>')
                    .addClass(o.fn.prefix('br-avoid'))
                    .append(
                        $('<h6>')
                            .addClass(o.fn.prefix('h6'))
                            .text(o._('Расположение'))
                    )
                    .append(h.o.di)
                    .appendTo($wrap);
            }

            /* Beach */
            if(h.o.b || (h.e && !$.isEmptyObject(h.e.b))) {

                el = $('<div>')
                    .addClass(o.fn.prefix('br-avoid'))
                    .append(
                        $('<h6>')
                            .addClass(o.fn.prefix('h6'))
                            .text('Пляж')
                    ).appendTo($wrap);

                /* Beach description */
                if(h.o.b) {
                    el.append(h.o.b);
                }

                /* Beach items */
                if(h.e && !$.isEmptyObject(h.e.b)) {
                    ul = $('<ul>')
                        .addClass(o.fn.prefix('serv-list'))
                        .appendTo(el);

                    $.each(h.e.b, function(k, item){
                        ul.append($('<li>').text(item.name +';'));
                    });
                }
            }

            if(h.ad) {
                /* Address */
                if(h.ad.a) {
                    el = $('<div>')
                        .addClass(o.fn.prefix('br-avoid'))
                        .append(
                            $('<h6>')
                                .addClass(o.fn.prefix('h6'))
                                .text(o._('Адрес'))
                        )
                        .append(h.ad.a)
                        .appendTo($wrap);
                }

                /* Phones */
                if(h.ad.ph) {
                    el = $('<div>')
                        .addClass(o.fn.prefix('br-avoid'))
                        .append(
                            $('<h6>')
                                .addClass(o.fn.prefix('h6'))
                                .text(o._('Телефоны'))
                        )
                        .append(h.ad.ph)
                        .appendTo($wrap);
                }

                /* E-mail */
                if(h.ad.ml) {
                    el = $('<div>')
                        .addClass(o.fn.prefix('br-avoid'))
                        .append(
                            $('<h6>')
                                .addClass(o.fn.prefix('h6'))
                                .text('E-mail')
                        )
                        .append(h.ad.ml)
                        .appendTo($wrap);
                }

                /* URL */
                if(h.ad.u) {
                    el = $('<div>')
                        .addClass(o.fn.prefix('br-avoid'))
                        .append(
                            $('<h6>')
                                .addClass(o.fn.prefix('h6'))
                                .text(o._('Сайт отеля'))
                        )
                        .append('<a target="_blank" href="'+ h.ad.u +'">'+ h.n +'</a>')
                        .appendTo($wrap);
                }
            }

            /* In hotel */
            if(h.o.fh) {
                el = $('<div>')
                    .addClass(o.fn.prefix('br-avoid'))
                    .append(
                        $('<h6>')
                            .addClass(o.fn.prefix('h6'))
                            .text(o._('В отеле'))
                    ).appendTo($wrap);

                /* In hotel description */
                if(h.o.fh) {
                    el.append(h.o.fh);
                }

                /* In hotel items */
                if(h.e && h.e.h && typeof h.e.h !== 'string') {
                    ul = $('<ul>')
                        .addClass(o.fn.prefix('serv-list'))
                        .appendTo(el);

                    $.each(h.e.h, function(k, item){
                        ul.append(
                            $('<li>')
                                .addClass(o.fn.prefix(item.id))
                                .text(item.name +';')
                        );
                    });
                }
            }

            /* For children */
            if(h.o.c || (h.e && h.e.c)) {
                el = $('<div>')
                    .addClass(o.fn.prefix('br-avoid'))
                    .append(
                        $('<h6>')
                            .addClass(o.fn.prefix('h6'))
                            .text(o._('Для детей'))
                    ).appendTo($wrap);

                /* For children description */
                if(h.o.c) {
                    el.append(h.o.c);
                }

                /* For children items */
                if(h.e.c) {
                    ul = $('<ul>')
                        .addClass(o.fn.prefix('serv-list'))
                        .appendTo(el);

                    $.each(h.e.c, function(k, item){
                        ul.append($('<li>').text(item.name +';'));
                    });
                }
            }

            /* Entertainment and Sports */
            if(h.o.s || (h.e && h.e.s)) {
                el = $('<div>')
                    .addClass(o.fn.prefix('br-avoid'))
                    .append(
                        $('<h6>')
                            .addClass(o.fn.prefix('h6'))
                            .text(o._('Развлечение и спорт'))
                    ).appendTo($wrap);

                /* Sports description */
                if(h.o.s) {
                    el.append(h.o.s);
                }

                /* Sports items */
                if(h.e && h.e.s) {
                    ul = $('<ul>')
                        .addClass(o.fn.prefix('serv-list'))
                        .appendTo(el);

                    $.each(h.e.s, function(k, item){
                        ul.append($('<li>').text(item.name +';'));
                    });
                }
            }

            /* Rooms */
            if(h.o.ds) {
                el = $('<div>')
                    .addClass(o.fn.prefix('br-avoid'))
                    .append(
                        $('<h6>')
                            .addClass(o.fn.prefix('h6'))
                            .text(o._('Номера'))
                    )
                    .append(h.o.ds)
                    .appendTo($wrap);
            }

            /* Rooms items */
            if(h.e && h.e.r) {
                el = $('<div>')
                    .addClass(o.fn.prefix('br-avoid'))
                    .append(
                        $('<h6>')
                            .addClass(o.fn.prefix('h6'))
                            .text(o._('Номера'))
                    )
                    .appendTo($wrap);

                ul = $('<ul>')
                    .addClass(o.fn.prefix('serv-list'))
                    .appendTo(el);

                $.each(h.e.r, function(k, item){
                    ul.append($('<li>').text(item.name +';'));
                });
            }
        };

        /**
         * Render the page of hotel description
         * @param $el
         * @param hotel
         */
        this.render = function($el, hotel) {

            if(!$el.html()) {

                this.init($el, hotel);

                // Use a super-widget
                // $el.append('&nbsp;');
                //
                // // add loader before load the hotel data
                // o.tour.view.loader('show', 'hotel_load', $el);
                //
                // // load hotel description
                // o.tour.loadHotelDescription(function(data){
                //
                //     // remove loader
                //     o.tour.view.loader('hide', 'hotel_load', $el);
                //
                //     // use widget for render the description
                //     data.options = {
                //         'osprefix': o.fn.prefix(''),
                //         'notitle': true,      // hidden title
                //         'nodescription': true,// hidden description
                //         'nogallery': true     // hidden gallery
                //     };
                //
                //     o.widgetHotel.render($el, data); // widget hotel description render
                //
                // }, hotel.i);
            }
        }
    };

    o.tour.hotelInfo.view = new f();

})(jQuery, otpMain);


/*********************/
/****** 	view/tour/photo.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 05/10/17.
 */

(function($, o){
    var f = function() {

        this.$ = undefined;
        var self = this;

        /**
         * Init the page photos
         * @param $el
         * @param hotel
         */
        this.init = function($el, hotel) {
            $el.append('&nbsp;');

            var full = '730x0';

            $.each(hotel.f, function(i, photo){
                $el.append(
                    $('<img>')
                        .attr({
                            'src': i < 2 ? self.getLink(photo, full, hotel.watermark) : null,
                            'data-original': self.getLink(photo, full, hotel.watermark)
                        }).lazyload()
                );
            });
        };

        this.getLink = function(photo, size, watermark, format) {
            size = size || '240x160';
            format = format || 3;
            watermark = watermark ? '_' + watermark : '';

            return [
                'https://newimg.otpusk.com/',
                format + watermark + '/',
                size + '/',
                photo
            ].join('');
        };

        /**
         * Render the page photos
         * @param $el
         * @param hotel
         */
        this.render = function($el, hotel) {

            if(!$el.html()){

                self.init($el, hotel);
            }
        }
    };

    o.tour.photo.view = new f();

})(jQuery, otpMain);

/*********************/
/****** 	view/tour/hotelMap.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 05/10/17.
 */

(function($,o) {
    var f = function(){

        this.$ = undefined;
        this.$close = undefined;
        var self = this;

        /**
         * Empty method
         */
        this.renderNearestHotels = function () {};

        /**
         * Render the page map
         * @param $el
         * @param hotel
         */
        this.render = function($el, hotel) {

            // render the map page
            if(!$el.html()) {

                // add new marker
                o.map.addHotelMarker(o.fn.prefix('os-map'), hotel, o.tour.offer, { type: 'main' });

                // init the map
                o.map.initMap(function(map){

                    var mapNode = map.getDiv();

                    $el.append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-tab-content-top'))
                            .append(
                                self.$close = $('<div>')
                                    .addClass(o.fn.prefix('t-tab-content-close'))
                                    .html('&times;')
                                    .click(function() {
                                        $el.hide();
                                        $('html').removeClass(o.fn.prefix('layer-open-map'));
                                        $(o.fn.prefix('t-menu-item[data-name = "tour"]','.')).trigger('click');
                                    })
                            ).append(o._('Отель на карте'))
                    ).append(mapNode);

                    // set center
                    o.map.setCenter(o.fn.prefix('os-map'), hotel.g.a, hotel.g.o);
                    o.map.openMarker(o.fn.prefix('os-map'), hotel.g.a, hotel.g.o);

                    o.tour.call('afterMapInit', $el, hotel, map);

                    o.tracker && o.tracker.send('event', 'Разные', 'Maps (' + o.map.vendor + ')', 'Страница тура - отели на карте');

                }, o.fn.prefix('os-map'), {
                   'zoom': !isNaN(+hotel.g.z)? +hotel.g.z: 17,
                   'main_marker': hotel.g.a.toString() + hotel.g.o.toString()
                });
            }
        };
    };

    o.tour.hotelMap.view = new f();

})(jQuery, otpMain);

/*********************/
/****** 	view/tour/reviews.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 05/10/17.
 */

(function($, o){
    var f = function(){

        this.$ = undefined;
        var self = this;

        /**
         * Init the reviews page
         * @param $el
         * @param hotel
         * @param reviews
         */
        this.init = function($el, hotel, reviews){

            $el.append(
                $('<div>')
                    .addClass(o.fn.prefix('t-tab-content-top'))
                    .append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-tab-content-close'))
                            .append('&times;')
                            .click(function(){
                                $('.new_t-tab-content.reviews').hide();
                                $('html').removeClass(o.fn.prefix('modal-open'));
                                $('.new_t-menu-item[data-name = "tour"]').trigger('click');
                            })
                    ).append(o._('Отзывы'))
            ).append(
                $('<div>')
                    .addClass(o.fn.prefix('t-tab-content-body'))
                    .append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-header-title'))
                            .append(o._('Рейтинг отеля ')+ hotel.n)
                    ).append(
                        $('<div>')
                            .addClass(o.fn.prefix('t-rating-tab-container clearfix'))
                            .append(
                                +hotel.v > 0 && $('<div>')
                                    .addClass(o.fn.prefix('r-item-rating-container'))
                                    .addClass(o.fn.prefix('r-p'+ parseInt(hotel.r) +' big-rating'))
                                    .append(
                                        $('<span>')
                                            .addClass(o.fn.prefix('r-item-rating-value'))
                                            .append(parseFloat(hotel.r) > 0? hotel.r.toString().replace('.',','): '')
                                    ).append(
                                        $('<span>')
                                            .addClass(o.fn.prefix('r-item-rating-rev'))
                                            .append($('<span>').text(hotel.v))
                                            .append(o.fn.suffixForNumber(hotel.v, [o._('отзыв'), o._('отзыва'), [o._('отзывов')]]))

                                    ).append(
                                        $('<div>')
                                            .addClass('slice')
                                            .append($('<div>').addClass('bar'))
                                            .append($('<div>').addClass('fill'))
                                    )
                            ).append(
                                $('<div>')
                                    .addClass(o.fn.prefix('r-item-ratings-divider'))
                            )
                            // render the detail rates of Turpravda service
                            .on('init', function(){

                                var that = this;

                                $.each({1: 'Номер', 2: o._('Сервис'), 3: 'Чистота', 4: o._('Питание'), 5: o._('Инфраструктура')}, function(i, name){
                                    $(that).append(
                                        $('<div>')
                                            .addClass(o.fn.prefix('r-item-rating-container'))
                                            .addClass(o.fn.prefix('r-p'+ parseInt(hotel.vs[i]['vote'])))
                                            .append(
                                                $('<span>')
                                                    .addClass(o.fn.prefix('r-item-rating-value'))
                                                    .append(parseFloat(hotel.vs[i]['vote']) > 0? hotel.vs[i]['vote']: '')
                                            ).append(
                                            $('<span>')
                                                .addClass(o.fn.prefix('r-item-rating-rev'))
                                                .text(name)
                                        ).append(
                                            $('<div>')
                                                .addClass('slice')
                                                .append($('<div>').addClass('bar'))
                                                .append($('<div>').addClass('fill'))
                                        )
                                    )
                                });

                            }).trigger('init')

                    ).append(reviews)
            )
        };

        /**
         * Render the page reviews
         * @param $el
         * @param hotel
         */
        this.render = function($el, hotel){

            if(!$el.html()){

                $el.append('&nbsp;');

                // add loader before load the hotel data
                o.tour.view.loader('show', 'reviews_load', $el);

                // load reviews
                o.tour.reviews.load(function(reviews){

                    // remove loader
                    o.tour.view.loader('hide', 'reviews_load', $el);

                    self.init($el, hotel, reviews);

                }, hotel.i);
            }
        };
    };

    o.tour.reviews.view = new f();

})(jQuery, otpMain);

/*********************/
/****** 	view/tour/creditModal.js	 ***********/
/*********************/
(function($, o) {
    var phoneMask = function () {
        var maskShape = '(   )    -  -  ';
        var value = '';

        var validateValue = function (value) {
            switch (true) {
                case value.length > 10: {
                    return false;
                }
                case typeof Number(value) === 'number': {
                    return Number(value) || Number(value) === 0;
                }
            }
        };

        var extractValue = function (value) {
            return value.replace(/\D/g, '');
        };
        var assignValueWithMask = function (value, mask) {
            var valueArr = value.split('');

            return mask.replace(/ /g, function(match, index) {
                if (!valueArr.length || index === 5) {
                    return ' ';
                }

                return valueArr.shift();
            });
        };
        var searchIndexForCursor = function (str) {
            var lastNumberInStrIndex = (str.match(/(\d){1}\D*$/) || { index: -1 }).index;

            if ( lastNumberInStrIndex === -1 ) {
                return 1;
            }

            return lastNumberInStrIndex + 1;
        };

        return {
            onChange: function (e) {
                var phone = extractValue(e.target.value);

                if (validateValue(phone)) {
                    value = phone;
                    e.target.value = assignValueWithMask(phone, maskShape);
                } else {
                    e.target.value = assignValueWithMask(value, maskShape);
                };

                e.target.dispatchEvent(new window.CustomEvent('setValue', {
                    detail: { value: value }
                }));

                var index = searchIndexForCursor(e.target.value);
                e.target.setSelectionRange(index, index);
            },
            onFocus: function (e) {
                var input = e.target;
                var indexPointer = value === '' ? 1 : searchIndexForCursor(input.value);

                if (value === '') {
                    input.value = maskShape;
                }

                setTimeout(function() {
                    input.setSelectionRange(indexPointer, indexPointer);
                }, 1);
            },
            onBlur: function (e) {
                if (value === '') {
                    e.target.value = '';
                };
                e.target.dispatchEvent(new window.CustomEvent('setValue', {
                    detail: { value: value }
                }));
            }
        };
    };

    var $body = $('body');

    var f = function () {
        this.userPriceChannel = []; /*add func if you want get userPrice dynamic value*/

        // data
        this.userPrice = 0;
        this.countPay = 0;
        this.officeId = 0;

        var userInputCreater = function (validateFunc) {
            this.value = '';
            this.$el = null;
            this.isValid = function () {
                var isValid = validateFunc(this.value);

                if (isValid) {
                    this.$el.hasClass(this.errorClassName) && this.$el.removeClass(this.errorClassName);
                } else {
                    this.$el.addClass(this.errorClassName);
                }

                return isValid;
            }
        };
        userInputCreater.prototype.errorClassName = o.fn.prefix('credit-input-has-error');

        this.userFio = new userInputCreater(
            function (value) { return value.length >= 1 }
        );
        this.userInn = new userInputCreater(
            function (value) { return String(value).length === 10 }
        );
        this.userPhone = new userInputCreater(
            function (value) { return value.length === 10 }
        );

        this.stepPointer = 'data-step';
        this.isShow = false;
        this.step = null;
        this.isSubmit = false;

        // links to elements in DOM
        this.header = null;
        this.modalBody = null;
        this.modal = $('<div>', { 'class': o.fn.prefix('credit-modal') })
                        .append(
                            this.createModalBody()
                                .append(this.createModalHeader('Заявка на рассрочку'))
                        );
        this.submitBtn = null;

        $body.append(this.modal);
    };

    f.prototype.createOfficeSelect = function () {
        var _this = this;
        var $select = $('<select />', { value: 0, on: {
                change: function (e) {
                    _this.officeId = Number(e.target.value);
                }
            }});
        var addOffices = function (data) {
            $.each(data, function(index, offices) {
                var cityName = offices[0].cityName.default;
                var $officeGroup = $('<optgroup />', { attr: { label: cityName } });

                $.each(offices, function(i, office) {
                    $officeGroup.append(
                        $('<option />', { value: office.id, text: cityName + ', ' +office.address.default })
                    );
                });

                $select.append($officeGroup);
            });
        };

        $select.append($('<option>', {text: o._('Выберите офис'), value: 0}));

        return {
            $select: $select,
            addOffices: addOffices
        }
    }


    f.prototype.createPriceInput = function () {
        var _this = this;
        return $('<input />', {
            'class': o.fn.prefix('credit-modal__input') + ' ' + o.fn.prefix('credit-modal__input--price'),
            type: 'text',
            value: _this.userPrice,
            on: {
                input: function (e) {
                    var value = e.target.value === '' ? '' : Number(e.target.value);

                   if (value > Number(o.fn.onlyPriceEcho(o.tour.offer.pl))) {
                       _this.userPrice = o.fn.onlyPriceEcho(o.tour.offer.pl);
                       e.target.value = o.fn.onlyPriceEcho(o.tour.offer.pl);
                   } else if (value) {
                       _this.userPrice = value;
                       e.target.value = value;
                   } else if (value === '') {
                       _this.userPrice = 0;
                       e.target.value = 0;
                   } else if (!value) {
                       e.target.value = _this.userPrice;
                   }

                   _this.userPriceChannel.forEach(function (func) {
                       func(_this.userPrice)
                   })
                }
            }
        });
    };

    f.prototype.createPayCounter = function (data) {
        var count = data.count;
        var percent = data.percent;
        var _this = this;
        var $item = $('<div>', { 'class': o.fn.prefix('credit-modal-row-count-item') });
        var computedWord  = count === 5 ? o._(' платежей'): o._(' платежа');
        var dynamicElement = null;
        var updateDynamicElement = function (userPrice) {
            var value = o.fn.onlyPriceEcho((Number(o.fn.onlyPriceEcho(o.tour.offer.pl)) - userPrice) * percent / count);

            return 'по ' + value + ' ' + o.fn.onlyCurEcho(o.form.currencySwitch.view.getValue(), false)
        };

        $item.append(
            $('<div>', {
                'class': o.fn.prefix('credit-modal-row-count-item__header'),
                text: o._('Еще ') + count + computedWord
            })
        );

        $item.append(function () {
            dynamicElement = $('<div>', {
                'class': o.fn.prefix('credit-modal-row-count-item__price'),
                text: updateDynamicElement(_this.userPrice)
            });

            return dynamicElement;
        });

        $item.append(
            $('<button>', {
                'class': o.fn.prefix('credit-modal-row-count-item__btn'),
                text: o._('Отправить заявку'),
                click: function () {
                    _this.renderStep('second');
                    _this.countPay = count;
                }
            })
        );

        $item.append(
            $('<div>', {
                'class': o.fn.prefix('credit-modal-row-count-item__info'),
                text: o._('Всего ') + count + computedWord
            })
        );


        _this.userPriceChannel.push(function (value) {
            dynamicElement.text(updateDynamicElement(value));
        });

        return $item;
    };

    f.prototype.createModalHeader = function() {
        var headerWrapper = $('<div>').addClass(o.fn.prefix('credit-modal-header'));
        this.header = $('<h2>', {
            'class': o.fn.prefix('credit-modal-header__title'),
            text: o._('Заявка на рассрочку')
        });


        headerWrapper
            .append(this.closeButton())
            .append(this.header);

        return headerWrapper;
    };

    f.prototype.updateHeaderText = function (text) {
        this.header.text(text);
    };

    f.prototype.closeButton = function () {
        return $('<button>', {
            type: 'button',
            'class': o.fn.prefix('credit-modal__closeBtn'),
            html: '&times',
            click: this.closeModal.bind(this)
        });
    };

    f.prototype.createModalBody = function () {
        this.modalBody = $('<div>').addClass(o.fn.prefix('credit-modal-body'));

        return this.modalBody;
    };

    f.prototype.createFirstScreen = function () {
        var wrapper = $('<div>', { 'class': o.fn.prefix('credit-modal-firstScreen')}).attr(this.stepPointer, '');

        this.userPriceChannel = [];
        this.countPay = 0;

        wrapper
            .append($('<h3>', {
                'class': o.fn.prefix('credit-modal__subTitle'),
                text: o._('Условия оформления тура в рассрочку')
            }));

        wrapper
            .append($('<div>', {
                'class': o.fn.prefix('credit-modal__text'),
                text: o._('Вы подписываете в турагентстве турдоговор с рассрочкой оплаты и оплачиваете удобный первый взнос. Остальные платежи вы оплачиваете начиная со следующего месяца в срок до 20-го числа.')
            }));

        wrapper
            .append($('<div>', {
                'class': o.fn.prefix('credit-modal__text'),
                'data-block': 'price'
            }).html(o._('Цена тура') + ' – ' + '<span>' + o.fn.onlyPriceEcho(o.tour.offer.pl) + ' ' + o.fn.onlyCurEcho(o.form.currencySwitch.view.getValue(), false) + '</span>'));

        wrapper
            .append($('<h3>', {
                'class': o.fn.prefix('credit-modal__subTitle'),
                'data-block': 'credit-title',
                text: o._('Выберите ваш вариант рассрочки')
            }));

        wrapper
            .append(
                $('<div>', {
                    'class': o.fn.prefix('credit-modal-row')
                }).append(
                    $('<span>', {
                        'class': o.fn.prefix('credit-modal-bigNumber'),
                        text: '1.'
                    })
                ).append(
                    $('<span>', {
                        'class': o.fn.prefix('credit-modal__text'),
                        text: o._('Укажите удобный первый платеж:')
                    })
                ).append(
                    this.createPriceInput()
                ).append(
                    $('<span>', {
                        'class': o.fn.prefix('credit-modal__text'),
                        text: o.fn.onlyCurEcho(o.form.currencySwitch.view.getValue(), false)
                    })
                )
            );

        wrapper
            .append(
                $('<div>', {
                    'class': o.fn.prefix('credit-modal-row')
                }).append(
                    $('<span>', {
                        'class': o.fn.prefix('credit-modal-bigNumber'),
                        text: '2.'
                    })
                ).append(
                    $('<span>', {
                        'class': o.fn.prefix('credit-modal__text'),
                        text: o._('Выберите количество последующих платежей:')
                    })
                )
            );

        wrapper.append(
            $('<div>', { 'class': o.fn.prefix('credit-modal-row-count')})
                .append(
                    [{count: 3, percent: 1.15}, {count: 4, percent: 1.20}, {count: 5, percent: 1.25}].map(this.createPayCounter.bind(this))
                )
        );

        wrapper.append(
            $('<div>', { 'class': o.fn.prefix('credit-modal-bottom-desc')})
                .html(o._('Нажимая кнопку Отправить заявку я даю согласие на обработку своих личных данных.'))
        );

        wrapper.append(
            $('<div>', { 'class': o.fn.prefix('credit-modal-bottom-desc')})
                .html('<strong>' + o._('Внимание!') + '</strong> ' + o._('Оформление рассрочки возможно только для граждан Украины.'))
        );

        return wrapper;
    };

    f.prototype.createSecondScreen = function () {
        var wrapper = $('<div>', { 'class': o.fn.prefix('credit-modal-secondScreen')}).attr(this.stepPointer, '');
        var _this = this;
        var maskInputModule = phoneMask();
        var officesApi = this.createOfficeSelect();
        var isEnableOrderModule = window.api_modules && window.api_modules.order;

        this.submitBtn = $('<button>', {
            'class': o.fn.prefix('credit-modal-secondWrapper-form__btn'),
            attr: { type: 'submit' },
            text: o._('Отправить заявку'),
        });

        if (isEnableOrderModule) {
            if (!otpMain.tour.creditModal.officeList) {
                otpMain.tour.creditModal.getOffices(officesApi.addOffices);
            } else {
                officesApi.addOffices(otpMain.tour.creditModal.officeList);
            }
        }

        this.userFio.$el = $('<input/>', {
            attr: {
                type: 'text',
                id: 'fio-field',
                placeholder: 'Фамилия Имя Отчество',
            },
            on: {
                input: function (e) { _this.userFio.value = e.target.value },
                blur: function () {
                    _this.userFio.isValid();
                }
            }
        });

        this.userInn.$el = $('<input/>', {
            attr: {
                type: 'text',
                id: 'inn-field',
                placeholder: '0000000000'
            },
            on: {
                input: this.handleInnField.bind(this),
                blur: function () {
                    _this.userInn.isValid();
                }
            }
        });

        this.userPhone.$el = $('<input/>', {
            attr: {
                type: 'text',
                id: 'contact-number-field',
                placeholder: '(000) 000-00-00',
                value: '' ,
                autocomplete: 'off'
            },
            on: {
                input: maskInputModule.onChange,
                focus: maskInputModule.onFocus,
                blur: function (e) {
                    maskInputModule.onBlur(e);
                    _this.userPhone.isValid();
                },
                setValue: function (params) {
                    _this.userPhone.value = params.originalEvent.detail.value;
                }
            }
        });

        wrapper.append($('<h3>', {
            'class': o.fn.prefix('credit-modal__subTitle'),
            html: o._('Данные покупателя') + ' <span>*' + o._('Все поля формы обязательны для заполнения') + '</span>'
        }));

        wrapper.append(
            $('<form>', {
                'class': o.fn.prefix('credit-modal-secondWrapper-form'),
                on: { submit: _this.sendMsg.bind(_this) }
            }).append(
                $('<div>', {
                    'class': o.fn.prefix('credit-modal-secondWrapper-form-field')
                }).append(
                    $('<label>', {
                        'class': o.fn.prefix('credit-modal-secondWrapper-form-field__label'),
                        text: o._('ФИО'),
                        attr: { 'for': 'fio-field' }
                    }),
                    $('<div>').append(
                        this.userFio.$el,
                        $('<span>', {
                            'class': o.fn.prefix('credit-input-error'),
                            'text': o._('заполните поле')
                        })
                    )

                ),
                $('<div>', { 'class': o.fn.prefix('credit-modal-secondWrapper-form-field') }).append(
                    $('<label>', {
                        'class': o.fn.prefix('credit-modal-secondWrapper-form-field__label'),
                        text: o._('ИНН'),
                        attr: { 'for': 'inn-field' }
                    }),
                    $('<div>').append(
                        this.userInn.$el,
                        $('<span>', {
                            'class': o.fn.prefix('credit-input-error'),
                            'text': o._('заполните поле')
                        })
                    )
                ),
                $('<div>', { 'class': o.fn.prefix('credit-modal-secondWrapper-form-field') }).append(
                    $('<label>', {
                        'class': o.fn.prefix('credit-modal-secondWrapper-form-field__label'),
                        text: o._('Контактный телефон'),
                        attr: { 'for': 'contact-number-field' }
                    }),
                    $('<div>').append(
                        this.userPhone.$el,
                        $('<span>', {
                            'class': o.fn.prefix('credit-input-error'),
                            'text': o._('заполните поле')
                        })
                    )
                ),
                isEnableOrderModule ? $('<div>', { 'class': o.fn.prefix('credit-modal-secondWrapper-form-field') }).append(
                    $('<label>', {
                        'class': o.fn.prefix('credit-modal-secondWrapper-form-field__label'),
                        text: o._('Ближайший офис'),
                    }),
                    $('<label>').attr('class', o.fn.prefix('credit-modal-select')).append(
                        officesApi.$select
                    )
                ) : null,
                $('<div>', {
                    'class': o.fn.prefix('credit-modal-secondWrapper-form__btns')
                }).append(
                    $('<button>', {
                        'class': o.fn.prefix('credit-modal-secondWrapper-form__btn') + ' ' + o.fn.prefix('credit-modal-secondWrapper-form__btn--basic'),
                        attr: { type: 'button' },
                        text: o._('Вернуться'),
                        click: function () {
                            _this.renderStep('first');
                        }
                    }),
                    this.submitBtn
                )
            )
        );

        wrapper.append(
            $('<div>', {
                'class': o.fn.prefix('credit-modal-bottom-desc'),
                html: o._('Рассрочку предоставляет сервис «Плати позже»') + ', тел. 095-728-63-74 ' + o._('или') + ' 067-489-27-97.'
            })
        );

        return wrapper;
    };

    f.prototype.createThirdScreen = function () {
        var wrapper = $('<div>', { 'class': o.fn.prefix('credit-modal-thirdScreen')}).attr(this.stepPointer, '');

        wrapper.append($('<p>', {
            'class': o.fn.prefix('credit-modal__text'),
            text: o._('Благодарим Вас за оформление заявки. Через некоторое время с Вами свяжется наш менеджер для уточнения условий рассрочки.')
        })).append($('<p>', {
            'class': o.fn.prefix('credit-modal__text'),
            html: o._('Всю информацию Вы можете получить по телефонам') + ' <nobr><strong>(067) 489-27-97</strong>,</nobr> <nobr><strong>(095) 728-63-74</strong></nobr>'
        })).append($('<button>', {
            attr: { type: 'button', 'class': o.fn.prefix('credit-modal-secondWrapper-form__btn') + ' ' + o.fn.prefix('credit-modal-secondWrapper-form__btn--basic') },
            on: {
                click: this.closeModal.bind(this)
            },
            text: o._('Закрыть')
        }));

        this.isSubmit = false;

        return wrapper;
    };

    f.prototype.handleInnField = function (e) {
        var value = e.target.value.trim();

        switch (true) {
            case value === '': {
                this.userInn.value = value;
                break;
            }
            case String(value).length > 10: {
                e.target.value = this.userInn.value;
                break;
            }
            case typeof Number(value) === 'number': {
                if (Number(value) || Number(value) === 0) {
                    this.userInn.value = value;
                } else {
                    e.target.value = this.userInn.value;
                }
                break;
            }
            default: e.target.value = this.userInn.value;
        }
    };

    f.prototype.sendMsg = function (e) {
        e.preventDefault();

        if (this.isSubmit) {
            return;
        }

        var userFio = this.userFio.isValid();
        var userInn = this.userInn.isValid();
        var userPhone = this.userPhone.isValid();

        if (userFio && userInn && userPhone) {
            this.submitBtn.text(o._('Загрузка'));
            this.isSubmit = true;

            otpMain.tour.creditModal.sendData({
                officeId: this.officeId,
                phone: this.userPhone.value,
                email: '',
                name: this.userFio.value,
                comment: 'ИНН: '
                    + this.userInn.value
                    + ' | '
                    + 'Первоначальный взнос: '
                    + this.userPrice
                    + ' грн'
                    + ' | '
                    + 'Количество платежей: '
                    + this.countPay
                    + ' | '
                    + 'Размер платежа: '
                    + o.fn.onlyPriceEcho((Number(o.fn.onlyPriceEcho(o.tour.offer.pl)) - this.userPrice) * 1.15 / this.countPay)
                    + ' грн'
            }, this.renderStep.bind(this, 'third'), function () {});
        }
    };

    f.prototype.openModal = function () {
        $body.addClass('new_modal-open');
        this.modal.addClass('show');
        this.isShow = true;
    };

    f.prototype.closeModal = function () {
        if (this.step === 'third') {
            this.updateHeaderText('Заявка на рассрочку');
        }

        this.modal.removeClass('show');
        this.isShow = false;
        this.step = null;
        this.clearModalBody();
        this.userPrice = 0;
        this.userFio.value = '';
        this.userInn.value = '';
        this.userPhone.value = '';
        this.officeId = 0;

        $body.removeClass('new_modal-open');
    };

    f.prototype.clearModalBody = function () {
        this.modalBody.find('[' + this.stepPointer + ']').remove();
    };

    f.prototype.renderStep = function (step) {
        if (!this.isShow) {
            this.openModal();
        } else {
            this.clearModalBody();
        }

        this.step = step;

        switch (step) {
            case 'first': {
                this.modalBody.append(this.createFirstScreen());
                return;
            }
            case 'second': {
                this.modalBody.append(this.createSecondScreen());
                return;
            }
            case 'third': {
                this.modalBody.append(this.createThirdScreen());
                this.updateHeaderText('Заявка на рассрочку оформлена');
                return;
            }
            default: throw new Error('Step dont found')
        }
    };

    if (o.settings.get('osInstallments')) {
        o.tour.creditModal.view = new f;
    }
}(jQuery, otpMain));


/*********************/
/****** 	init.js	 ***********/
/*********************/
/**
 * Created by VShevtsov on 27/09/17.
 */

otpMain.page = otpMain.hash.parse().get('page','form');
if(jQuery.isNumeric(otpMain.page)) {
    otpMain.page = 'form';
}

//jQuery('head').append('<meta name="viewport" content="width=device-width, initial-scale=1">');
// document.write('<div class="'+otpMain.fn.prefix('os')+'"></div>'); //init parent form container

otpMain.view = {
    $: jQuery('.new_os')
};
// otpMain.view.$ = jQuery(otpMain.fn.prefix('os','.'));

if(!access_token) {
    console.info(apiError);
    otpMain.fn.errorPage(500);
}

if (typeof access_token !== 'undefined') {
    otpMain.apiToken = {'access_token': access_token};
}
else if (typeof api_session_token !== 'undefined') {
    otpMain.apiToken = {'api_session_token': api_session_token};
}

otpMain.apiId = osApiId;
otpMain.apiType = (typeof api_modules['tours'] !== 'undefined'? api_modules['tours']: false);
otpMain.osGeo = typeof osGeoS !== 'undefined' ? osGeoS : typeof osGeo !== 'undefined' ? osGeo : null;

// #10162
if(!otpMain.apiType) {
    console.info('the module is not enabled!');
    otpMain.fn.errorPage(500);
}

// #14219 GA tracker
otpMain.tracker = false;
jQuery(function(){
    if ('ga' in window && 'getAll' in window.ga && typeof ga.getAll === 'function') {
        otpMain.tracker = ga.getAll()[0];
    }
});

// Render the application
var runApplication = function(){
    otpMain.view.$ = jQuery('.new_os');
    otpMain.view.$.find('#os-preload-form-container').remove();
    // mobile version container
    otpMain.view.$.append(
        jQuery('<div>').addClass(otpMain.fn.prefix('check-mobile'))
    );

    otpMain.form.view.render(); //render form
};

// Cookies not started in Safari #4522
var is_chrome = navigator.userAgent.indexOf('Chrome') > -1;
var is_safari = navigator.userAgent.indexOf('Safari') > -1;
var is_facebook = navigator.userAgent.indexOf('FBAV/') > -1;
var ios = /iphone|ipod|ipad/.test(window.navigator.userAgent.toLowerCase());
if ((is_chrome) && (is_safari)) {is_safari=false;}

if(is_safari || is_facebook) {

    otpMain.form.location.geoSuggest({}, function(d){
        if(d.error){
            var countError = parseInt(otpMain.fn.getCookie('countError')) || 0;

            if(countError < 3) {
                document.cookie = "countError="+ (countError+1);
                window.location.href='https://export.otpusk.com/js/sessions/?url='+ window.location.href;
            } else {
                if(countError === 3) {
                    window.location.reload();
                } else {
                    console.log('error: can\'t set cookie');
                    document.cookie = "countError=2";
                    runApplication();
                }
            }

        } else {
            document.cookie = "countError=0";
            runApplication();
        }
    });

} else {
    runApplication();
}

var resizeForm = function(){
    if(jQuery('.'+otpMain.fn.prefix('os')).parent().width() < 770) {
        jQuery('.'+otpMain.fn.prefix('os')).removeClass('medium-form').addClass('medium-big');
        if(jQuery('.'+otpMain.fn.prefix('os')).parent().width() < 664) {
            jQuery('.'+otpMain.fn.prefix('os')).removeClass('medium-big').removeClass('small-form').addClass('medium-form');
            if(jQuery('.'+otpMain.fn.prefix('os')).parent().width() < 520) {
                jQuery('.'+otpMain.fn.prefix('os')).removeClass('medium-form').addClass('small-form');
            }
        }
    } else {
        jQuery('.'+otpMain.fn.prefix('os')).removeClass('medium-big');
    }
};

jQuery(function(){
    jQuery(document).ready(function() {
        resizeForm();
    });
    window.onresize = function(){
        resizeForm();
    }
});
})(api_session_token, api_modules, osApiId);if(typeof osjQuerryUse!="undefined"){var jQuery=osjQuerryUse;$=$osUse;}